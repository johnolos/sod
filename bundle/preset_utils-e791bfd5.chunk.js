var t=Object.defineProperty,e=(e,s,i)=>(((e,s,i)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i})(e,"symbol"!=typeof s?s+"":s,i),i);import{g as s,a as i,P as a,b as n,p as o,U as l,c as r,T as c,d,e as h,C as m,f as u,I as p,h as g,s as f,i as I,j as w,k as b,l as x,A as v,m as E,n as S,o as y,q as P,G as C,r as k,t as T,H as _,u as N,v as L,w as R,x as D,y as A,z as V,B as M,D as U,E as F,F as W,M as O,J as H,K as q,S as B,L as z,N as j,O as $,Q as G,R as K,V as J,W as Z,X as Y,Y as X,Z as Q,_ as tt,$ as et,a0 as st,a1 as it,a2 as at,a3 as nt,a4 as ot,a5 as lt,a6 as rt,a7 as ct,a8 as dt,a9 as ht,aa as mt,ab as ut,ac as pt,ad as gt,ae as ft,af as It,ag as wt,ah as bt,ai as xt,aj as vt,ak as Et,al as St,am as yt,an as Pt,ao as Ct,ap as kt,aq as Tt,ar as _t,as as Nt,at as Lt,au as Rt,av as Dt,aw as At,ax as Vt,ay as Mt,az as Ut,aA as Ft,aB as Wt,aC as Ot,aD as Ht,aE as qt,aF as Bt,aG as zt,aH as jt,aI as $t,aJ as Gt,aK as Kt,aL as Jt,aM as Zt,aN as Yt,aO as Xt,aP as Qt,aQ as te,aR as ee,aS as se,aT as ie,aU as ae,aV as ne,aW as oe,aX as le,aY as re,aZ as ce,a_ as de,a$ as he,b0 as me,b1 as ue,b2 as pe,b3 as ge,b4 as fe,b5 as Ie,b6 as we,b7 as be,b8 as xe,b9 as ve,ba as Ee,bb as Se,bc as ye,bd as Pe,be as Ce,bf as ke,bg as Te,bh as _e,bi as Ne,bj as Le,bk as Re,bl as De,bm as Ae,bn as Ve,bo as Me,bp as Ue,bq as Fe,br as We,bs as Oe,bt as He,bu as qe,bv as Be,bw as ze,bx as je,by as $e,bz as Ge,bA as Ke,bB as Je,bC as Ze,bD as Ye,bE as Xe,bF as Qe,bG as ts,bH as es,bI as ss,bJ as is,bK as as,bL as ns,bM as os,bN as ls,bO as rs,bP as cs,bQ as ds,bR as hs,bS as ms,bT as us,bU as ps,bV as gs,bW as fs,bX as Is,bY as ws,bZ as bs,b_ as xs,b$ as vs,c0 as Es,c1 as Ss,c2 as ys,c3 as Ps,c4 as Cs,c5 as ks,c6 as Ts,c7 as _s,c8 as Ns,c9 as Ls,ca as Rs,cb as Ds,cc as As,cd as Vs,ce as Ms,cf as Us,cg as Fs,ch as Ws,ci as Os,cj as Hs,ck as qs,cl as Bs,cm as zs,cn as js,co as $s,cp as Gs,cq as Ks,cr as Js,cs as Zs,ct as Ys,cu as Xs,cv as Qs,cw as ti,cx as ei,cy as si,cz as ii,cA as ai,cB as ni,cC as oi,cD as li,cE as ri,cF as ci,cG as di,cH as hi,cI as mi,cJ as ui,cK as pi,cL as gi,cM as fi,cN as Ii,cO as wi,cP as bi,cQ as xi,cR as vi,cS as Ei,cT as Si,cU as yi,cV as Pi,cW as Ci,cX as ki,cY as Ti,cZ as _i,c_ as Ni,c$ as Li,d0 as Ri,d1 as Di,d2 as Ai,d3 as Vi,d4 as Mi,d5 as Ui,d6 as Fi,d7 as Wi,d8 as Oi,d9 as Hi,da as qi,db as Bi,dc as zi,dd as ji,de as $i,df as Gi,dg as Ki,dh as Ji,di as Zi,dj as Yi,dk as Xi,dl as Qi}from"./detailed_results-50fb450f.chunk.js";import{T as ta,M as ea,P as sa}from"./index-50a990e3.chunk.js";const ia=s(i).length,aa=s(a).length;class na{constructor(t,s){e(this,"stat"),e(this,"pseudoStat"),this.stat=t,this.pseudoStat=s}isStat(){return null!=this.stat}isPseudoStat(){return null!=this.pseudoStat}getStat(){if(!this.isStat())throw new Error("Not a stat!");return this.stat}getPseudoStat(){if(!this.isPseudoStat())throw new Error("Not a pseudo stat!");return this.pseudoStat}equals(t){return this.stat==t.stat&&this.pseudoStat==t.pseudoStat}getName(t){return this.isStat()?n(this.stat,t):o.get(this.pseudoStat)}getProtoValue(t){return this.isStat()?t.stats[this.stat]:t.pseudoStats[this.pseudoStat]}setProtoValue(t,e){this.isStat()?t.stats[this.stat]=e:t.pseudoStats[this.pseudoStat]=e}static fromStat(t){return new na(t,null)}static fromPseudoStat(t){return new na(null,t)}static getAll(){const t=s(i).filter((t=>![i.StatEnergy,i.StatRage].includes(t))),e=s(a);return[t.map((t=>na.fromStat(t))),e.map((t=>na.fromPseudoStat(t)))].flat()}}class oa{constructor(t,s){e(this,"stats"),e(this,"pseudoStats"),this.stats=oa.initStatsArray(ia,t),this.pseudoStats=oa.initStatsArray(aa,s)}static initStatsArray(t,e){let s=e?.slice(0,t)||[];s.length<t&&(s=s.concat(new Array(t-(e?.length||0)).fill(0)));for(let i=0;i<t;i++)null==s[i]&&(s[i]=0);return s}equals(t){return this.stats.every(((e,s)=>e==t.getStat(s)))&&this.pseudoStats.every(((e,s)=>e==t.getPseudoStat(s)))}getStat(t){return this.stats[t]}getPseudoStat(t){return this.pseudoStats[t]}getUnitStat(t){return t.isStat()?this.stats[t.getStat()]:this.pseudoStats[t.getPseudoStat()]}withStat(t,e){const s=this.stats.slice();return s[t]=e,new oa(s,this.pseudoStats)}withPseudoStat(t,e){const s=this.pseudoStats.slice();return s[t]=e,new oa(this.stats,s)}withUnitStat(t,e){return t.isStat()?this.withStat(t.getStat(),e):this.withPseudoStat(t.getPseudoStat(),e)}addStat(t,e){return this.withStat(t,this.getStat(t)+e)}add(t){return new oa(this.stats.map(((e,s)=>e+t.stats[s])),this.pseudoStats.map(((e,s)=>e+t.pseudoStats[s])))}subtract(t){return new oa(this.stats.map(((e,s)=>e-t.stats[s])),this.pseudoStats.map(((e,s)=>e-t.pseudoStats[s])))}scale(t){return new oa(this.stats.map(((e,s)=>e*t)),this.pseudoStats.map(((e,s)=>e*t)))}computeEP(t){let e=0;return this.stats.forEach(((s,i)=>{e+=s*t.stats[i]})),this.pseudoStats.forEach(((s,i)=>{e+=s*t.pseudoStats[i]})),e}belowCaps(t){for(const[e,s]of this.stats.entries())if(t.stats[e]>0&&s>t.stats[e])return!1;return!0}asArray(){return this.stats.slice()}toJson(){return l.toJson(this.toProto())}toProto(){return l.create({stats:this.stats.slice(),pseudoStats:this.pseudoStats.slice()})}static fromJson(t){return oa.fromProto(l.fromJson(t))}static fromMap(t,e){const s=new Array(ia).fill(0);Object.entries(t).forEach((t=>{const[e,i]=t;s[Number(e)]=i}));const i=new Array(aa).fill(0);return e&&Object.entries(e).forEach((t=>{const[e,s]=t;i[Number(e)]=s})),new oa(s,i)}static fromProto(t){return t?new oa(t.stats,t.pseudoStats):new oa}}const la=5;class ra{constructor(t,s){e(this,"sim"),e(this,"raid"),e(this,"buffs",r.create()),e(this,"compChangeEmitter",new c),e(this,"buffsChangeEmitter",new c),e(this,"changeEmitter"),e(this,"players"),e(this,"playerChangeListener"),this.sim=s,this.raid=t,this.players=[...Array(5).keys()].map((t=>null)),this.playerChangeListener=t=>this.changeEmitter.emit(t),this.changeEmitter=c.onAny([this.compChangeEmitter,this.buffsChangeEmitter],"PartyChange")}size(){return this.players.filter((t=>null!=t)).length}isEmpty(){return 0==this.size()}clear(t){this.setBuffs(t,r.create());for(let e=0;e<5;e++)this.setPlayer(t,e,null)}getIndex(){return this.raid.getParties().indexOf(this)}getPlayers(){return this.players.slice()}getPlayer(t){return this.players[t]}setPlayer(t,e,s){if(e<0||e>=5)throw new Error("Invalid player index: "+e);s!=this.players[e]&&c.freezeAllAndDo((()=>{const i=this.players[e];if(null!=i&&(i.changeEmitter.off(this.playerChangeListener),i.setParty(null)),null!=s){const i=s.getParty();i&&i.setPlayer(t,s.getPartyIndex(),null),this.players[e]=s,s.changeEmitter.on(this.playerChangeListener),s.setParty(this)}else this.players[e]=null;this.compChangeEmitter.emit(t)}))}getBuffs(){return r.clone(this.buffs)}setBuffs(t,e){r.equals(this.buffs,e)||(this.buffs=r.clone(e),this.buffsChangeEmitter.emit(t))}toProto(t,e){return d.create({players:this.players.map((s=>null==s?h.create():s.toProto(t,e))),buffs:this.buffs})}fromProto(t,e){c.freezeAllAndDo((()=>{this.setBuffs(t,e.buffs||r.create());for(let s=0;s<5;s++){if(!e.players[s]||e.players[s].class==m.ClassUnknown){this.setPlayer(t,s,null);continue}const i=e.players[s],a=u(i),n=this.players[s];if(n&&a==n.spec)n.fromProto(t,i);else{const e=new Na(a,this.sim);e.fromProto(t,i),this.setPlayer(t,s,e)}}}))}}class ca extends p{constructor(t,s,i){super(t,"talents-picker-root",s,{...i,inline:!0}),e(this,"config"),e(this,"numRows"),e(this,"numCols"),e(this,"pointsPerRow"),e(this,"maxPoints"),e(this,"trees"),this.config=i,this.pointsPerRow=i.pointsPerRow,this.maxPoints=i.maxPoints,this.numRows=Math.max(...i.trees.map((t=>t.talents.map((t=>t.location.rowIdx)).flat())).flat())+1,this.numCols=Math.max(...i.trees.map((t=>t.talents.map((t=>t.location.colIdx)).flat())).flat())+1,this.rootElem.appendChild(g("div",{id:"talents-carousel",className:"carousel slide"},g("div",{className:"carousel-inner"}),g("button",{className:"carousel-control-prev",type:"button"},g("span",{className:"carousel-control-prev-icon",attributes:{"aria-hidden":!0}}),g("span",{className:"visually-hidden"},"Previous")),g("button",{className:"carousel-control-next",type:"button"},g("span",{className:"carousel-control-next-icon",attributes:{"aria-hidden":!0}}),g("span",{className:"visually-hidden"},"Next"))));const a=this.rootElem.querySelector(".carousel-inner"),n=this.rootElem.querySelector(".carousel-control-prev"),o=this.rootElem.querySelector(".carousel-control-next");this.trees=i.trees.map(((t,e)=>{const s=document.createElement("div");return a.appendChild(s),s.classList.add("carousel-item"),1===e&&s.classList.add("active"),"Ferocity"===t.name&&(e+=3),"Tenacity"===t.name&&(e+=4),"Cunning"===t.name&&(e+=5),new da(s,t,this,i.klass,e)})),this.trees.forEach((t=>t.talents.forEach((t=>t.setPoints(0,!1)))));let l=0;n.addEventListener("click",(()=>{l>=1||(l+=1,a.style.transform=`translateX(${33.3*l}%)`,a.children[Math.abs(l-2)%3].classList.remove("active"),a.children[Math.abs(l-1)%3].classList.add("active"))})),o.addEventListener("click",(()=>{l<=-1||(l-=1,a.style.transform=`translateX(${33.3*l}%)`,a.children[Math.abs(l)%3].classList.remove("active"),a.children[Math.abs(l)+1].classList.add("active"))})),this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.trees.map((t=>t.getTalentsString())).join("-").replace(/-+$/g,"")}setInputValue(t){const e=t.split("-");this.trees.forEach(((t,s)=>t.setTalentsString(e[s]||""))),this.updateTrees()}updateTrees(){this.isFull()?this.rootElem.classList.add("talents-full"):this.rootElem.classList.remove("talents-full"),this.trees.forEach((t=>t.update()))}get numPoints(){return f(this.trees.map((t=>t.numPoints)))}isFull(){return this.numPoints>=this.maxPoints}setMaxPoints(t){t!=this.maxPoints&&(this.maxPoints=t,this.updateTrees())}isHunterPet(){return["Cunning","Ferocity","Tenacity"].includes(this.config.trees[0].name)}}class da extends I{constructor(t,s,i,a,n){super(t,"talent-tree-picker-root"),e(this,"config"),e(this,"title"),e(this,"pointsElem"),e(this,"talents"),e(this,"picker"),e(this,"numPoints"),this.config=s,this.numPoints=0,this.picker=i,this.rootElem.appendChild(g(b,null,g("div",{className:"talent-tree-header"},g("img",{src:w(a,n),className:"talent-tree-icon"}),g("span",{className:"talent-tree-title"}),g("span",{className:"talent-tree-points"}),g("button",{className:"talent-tree-reset btn btn-link link-danger"},g("i",{className:"fa fa-times"}))),g("div",{className:"talent-tree-background"}),g("div",{className:"talent-tree-main"}))),this.title=this.rootElem.getElementsByClassName("talent-tree-title")[0],this.pointsElem=this.rootElem.querySelector(".talent-tree-points");this.rootElem.querySelector(".talent-tree-background").style.backgroundImage=`url('${s.backgroundUrl}')`;const o=this.rootElem.querySelector(".talent-tree-main");o.style.gridTemplateRows=`repeat(${this.picker.numRows}, 1fr)`,o.style.gridTemplateColumns=`repeat(${this.picker.numCols}, 1fr)`;const l="3.5rem";o.style.height=`calc(${l} * ${this.picker.numRows})`,o.style.maxWidth=`calc(${l} * ${this.picker.numCols})`,this.rootElem.style.maxWidth=`calc(${l} * ${this.picker.numCols+2})`,this.talents=s.talents.map((t=>new ma(o,t,this))),this.talents.forEach((t=>{t.config.prereqLocation&&this.getTalent(t.config.prereqLocation).config.childLocations.push(t.config.location)}));const r=(t,e)=>{t.initChildReqs(),t.zIndex=e;for(const s of t.config.childLocations){const i=this.getTalent(s);i.parentReq=t.getChildReqArrow(s),r(i,e-2)}};for(const e of this.talents)0!=e.config.childLocations.length&&void 0===e.config.prereqLocation&&r(e,20);const d=this.rootElem.querySelector(".talent-tree-reset");new ta(d,{title:"Reset talent points"}),d.addEventListener("click",(t=>{this.talents.forEach((t=>t.setPoints(0,!1))),this.picker.inputChanged(c.nextEventID())}))}update(){this.title.innerHTML=this.config.name,this.pointsElem.textContent=`${this.numPoints} / ${this.getMaxSpendablePoints()}`,this.talents.forEach((t=>t.update()))}getTalent(t){const e=this.talents.find((e=>e.getRow()==t.rowIdx&&e.getCol()==t.colIdx));if(!e)throw new Error("No talent found with location: "+t);return e}getTalentsString(){return this.talents.map((t=>String(t.getPoints()))).join("").replace(/0+$/g,"")}setTalentsString(t){this.talents.forEach(((e,s)=>e.setPoints(Number(t.charAt(s)),!1)))}getMaxSpendablePoints(){return this.picker.isHunterPet()?16:71}}class ha extends I{constructor(t,s,i){super(t,"talent-picker-req-arrow",document.createElement("div")),e(this,"dir"),e(this,"zIdx"),e(this,"parentLoc"),e(this,"childLoc"),this.zIdx=0,this.parentLoc=s,this.childLoc=i,this.rootElem.style.gridRow=String(s.rowIdx+1),this.rootElem.style.gridColumn=String(s.colIdx+1);let a=Math.max(s.rowIdx,i.rowIdx)+1,n=Math.max(s.colIdx,i.colIdx)+1;s.rowIdx==i.rowIdx?(this.dir=s.colIdx<i.colIdx?"right":"left",this.rootElem.dataset.reqArrowColSize=String(Math.abs(s.colIdx-i.colIdx)),n="left"==this.dir?n+1:n-1):s.colIdx==i.colIdx?(this.dir="down",this.rootElem.dataset.reqArrowRowSize=String(Math.abs(s.rowIdx-i.rowIdx)),a+=1):(this.dir=s.colIdx<i.colIdx?"rightdown":"leftdown",this.rootElem.dataset.reqArrowColSize=String(Math.abs(s.colIdx-i.colIdx)),this.rootElem.dataset.reqArrowRowSize=String(Math.abs(s.rowIdx-i.rowIdx)),a+=1,n="rightdown"==this.dir?n+1:n-1,this.rootElem.appendChild(g("div",null))),this.rootElem.style.gridRowEnd=String(a),this.rootElem.style.gridColumnEnd=String(n),this.rootElem.classList.add(`talent-picker-req-arrow-${this.dir}`)}get zIndex(){return this.zIdx}set zIndex(t){this.zIdx=t,this.rootElem.style.zIndex=String(t)}setReqFufilled(t){t?this.rootElem.dataset.reqActive="true":delete this.rootElem.dataset.reqActive}}class ma extends I{constructor(t,s,i){super(t,"talent-picker-root",document.createElement("a")),e(this,"config"),e(this,"tree"),e(this,"pointsDisplay"),e(this,"longTouchTimer"),e(this,"childReqs"),e(this,"zIdx"),e(this,"parentReq"),this.config=s,this.tree=i,this.childReqs=[],this.parentReq=null,this.zIdx=0,this.rootElem.style.gridRow=String(this.config.location.rowIdx+1),this.rootElem.style.gridColumn=String(this.config.location.colIdx+1),this.rootElem.dataset.maxPoints=String(this.config.maxPoints),this.rootElem.dataset.whtticon="false",this.pointsDisplay=document.createElement("span"),this.pointsDisplay.classList.add("talent-picker-points"),this.rootElem.appendChild(this.pointsDisplay),this.rootElem.addEventListener("click",(t=>{t.preventDefault()})),this.rootElem.addEventListener("contextmenu",(t=>{t.preventDefault()})),this.rootElem.addEventListener("touchmove",(t=>{null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0)})),this.rootElem.addEventListener("touchstart",(t=>{t.preventDefault(),this.longTouchTimer=window.setTimeout((()=>{this.setPoints(0,!0),this.tree.picker.inputChanged(c.nextEventID()),this.longTouchTimer=void 0}),750)})),this.rootElem.addEventListener("touchend",(t=>{if(t.preventDefault(),null!=this.longTouchTimer){clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0;var e=this.getPoints()+1;this.config.maxPoints<e&&(e=0),this.setPoints(e,!0),this.tree.picker.inputChanged(c.nextEventID())}})),this.rootElem.addEventListener("mousedown",(t=>{x(t)?this.setPoints(this.getPoints()-1,!0):this.setPoints(this.getPoints()+1,!0),this.tree.picker.inputChanged(c.nextEventID())}))}initChildReqs(){if(0!=this.config.childLocations.length)for(const t of this.config.childLocations)this.childReqs.push(new ha(this.rootElem.parentElement,this.config.location,t))}getChildReqArrow(t){for(let e of this.childReqs)if(e.childLoc===t)return e;throw Error("missing child prereq?")}get zIndex(){return this.zIdx}set zIndex(t){this.zIdx=t,this.rootElem.style.zIndex=String(this.zIdx);for(const e of this.childReqs)e.zIndex=this.zIdx-1}getRow(){return this.config.location.rowIdx}getCol(){return this.config.location.colIdx}getPoints(){const t=Number(this.rootElem.dataset.points);return isNaN(t)?0:t}isFull(){return this.getPoints()>=this.config.maxPoints}canSetPoints(t){const e=this.getPoints();if(t>e){const s=t-e;if(this.tree.picker.numPoints+s>this.tree.picker.maxPoints)return!1;if(this.tree.numPoints<this.getRow()*this.tree.picker.pointsPerRow)return!1;if(this.config.prereqLocation&&!this.tree.getTalent(this.config.prereqLocation).isFull())return!1}else{const s=e-t,i=[...Array(this.tree.picker.numRows).keys()].map((t=>this.tree.talents.filter((e=>e.getRow()==t)))).map((t=>f(t.map((t=>t.getPoints())))));i[this.getRow()]-=s;const a=i.map(((t,e)=>f(i.slice(0,e+1))));if(!this.tree.talents.every((t=>0==t.getPoints()||0==t.getRow()||a[t.getRow()-1]>=t.getRow()*this.tree.picker.pointsPerRow)))return!1;for(const t of this.config.childLocations)if(this.tree.getTalent(t).getPoints()>0)return!1}return!0}setPoints(t,e){const s=this.getPoints();if(t=Math.max(0,t),t=Math.min(this.config.maxPoints,t),e&&!this.canSetPoints(t))return;this.tree.numPoints+=t-s,this.rootElem.dataset.points=String(t),this.pointsDisplay.textContent=t+"/"+this.config.maxPoints,this.isFull()?this.rootElem.classList.add("talent-full"):this.rootElem.classList.remove("talent-full");const i=this.getSpellIdForPoints(t);v.fromSpellId(i).fill().then((t=>{t.setWowheadHref(this.rootElem),this.rootElem.style.backgroundImage=`url('${t.iconUrl}')`}))}getSpellIdForPoints(t){const e=Math.max(0,t-1);if(this.config.spellIds[e])return this.config.spellIds[e];throw new Error(`No rank ${t} for talent ${String(this.config.fieldName)}`)}update(){let t=this.canSetPoints(this.getPoints()+1);t?this.rootElem.classList.add("talent-picker-can-add"):this.rootElem.classList.remove("talent-picker-can-add"),this.parentReq&&this.parentReq.setReqFufilled(t||this.isFull())}}function ua(t){return t.forEach((t=>{t.talents.forEach(((e,s)=>{if(e.childLocations=[],0!=s){const i=t.talents[s-1];if(e.location.rowIdx<i.location.rowIdx||e.location.rowIdx==i.location.rowIdx&&e.location.colIdx<=i.location.colIdx)throw new Error(`Out-of-order talent: ${String(e.fieldName)}`)}if(e.spellIds.length<e.maxPoints){let t=e.spellIds[e.spellIds.length-1];for(let s=e.spellIds.length;s<e.maxPoints;s++)t++,e.spellIds.push(t)}}))})),t}const pa=ua([{name:"Balance",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/283.jpg",talents:[{fieldName:"improvedWrath",location:{rowIdx:0,colIdx:0},spellIds:[16814,16815,16816,16817,16818],maxPoints:5},{fieldName:"naturesGrasp",location:{rowIdx:0,colIdx:1},spellIds:[16689],maxPoints:1},{fieldName:"improvedNaturesGrasp",location:{rowIdx:0,colIdx:2},spellIds:[17245,17247,17248,17249],maxPoints:4,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedEntanglingRoots",location:{rowIdx:1,colIdx:0},spellIds:[16918,16919,16920],maxPoints:3},{fieldName:"improvedMoonfire",location:{rowIdx:1,colIdx:1},spellIds:[16821,16822,16823,16824,16825],maxPoints:5},{fieldName:"naturalWeapons",location:{rowIdx:1,colIdx:2},spellIds:[16902,16903,16904,16905,16906],maxPoints:5},{fieldName:"naturalShapeshifter",location:{rowIdx:1,colIdx:3},spellIds:[16833,16834,16835],maxPoints:3},{fieldName:"improvedThorns",location:{rowIdx:2,colIdx:0},spellIds:[16836,16839,16840],maxPoints:3},{fieldName:"omenOfClarity",location:{rowIdx:2,colIdx:2},spellIds:[16864],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"naturesReach",location:{rowIdx:2,colIdx:3},spellIds:[16819,16820],maxPoints:2},{fieldName:"vengeance",location:{rowIdx:3,colIdx:1},spellIds:[16909,16910,16911,16912,16913],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedStarfire",location:{rowIdx:3,colIdx:2},spellIds:[16850,16923,16924,16925,16926],maxPoints:5},{fieldName:"naturesGrace",location:{rowIdx:4,colIdx:1},spellIds:[16880],maxPoints:1},{fieldName:"moonglow",location:{rowIdx:4,colIdx:2},spellIds:[16845,16846,16847],maxPoints:3},{fieldName:"moonfury",location:{rowIdx:5,colIdx:1},spellIds:[16896,16897,16899,16900,16901],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"moonkinForm",location:{rowIdx:6,colIdx:1},spellIds:[24858],maxPoints:1}]},{name:"Feral Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/281.jpg",talents:[{fieldName:"ferocity",location:{rowIdx:0,colIdx:1},spellIds:[16934,16935,16936,16937,16938],maxPoints:5},{fieldName:"feralAggression",location:{rowIdx:0,colIdx:2},spellIds:[16858,16859,16860,16861,16862],maxPoints:5},{fieldName:"feralInstinct",location:{rowIdx:1,colIdx:0},spellIds:[16947,16948,16949,16950,16951],maxPoints:5},{fieldName:"brutalImpact",location:{rowIdx:1,colIdx:1},spellIds:[16940,16941],maxPoints:2},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[16929,16930,16931,16932,16933],maxPoints:5},{fieldName:"felineSwiftness",location:{rowIdx:2,colIdx:0},spellIds:[17002,24866],maxPoints:2},{fieldName:"feralCharge",location:{rowIdx:2,colIdx:1},spellIds:[16979],maxPoints:1},{fieldName:"sharpenedClaws",location:{rowIdx:2,colIdx:2},spellIds:[16942,16943,16944],maxPoints:3},{fieldName:"improvedShred",location:{rowIdx:3,colIdx:0},spellIds:[16966,16968],maxPoints:2},{fieldName:"predatoryStrikes",location:{rowIdx:3,colIdx:1},spellIds:[16972,16974,16975],maxPoints:3},{fieldName:"bloodFrenzy",location:{rowIdx:3,colIdx:2},spellIds:[16952,16954],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"primalFury",location:{rowIdx:3,colIdx:3},spellIds:[16958,16961],maxPoints:2},{fieldName:"savageFury",location:{rowIdx:4,colIdx:0},spellIds:[16998,16999],maxPoints:2},{fieldName:"faerieFireFeral",location:{rowIdx:4,colIdx:2},spellIds:[16857],maxPoints:1},{fieldName:"heartOfTheWild",location:{rowIdx:5,colIdx:1},spellIds:[17003,17004,17005,17006,24894],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"leaderOfThePack",location:{rowIdx:6,colIdx:1},spellIds:[17007],maxPoints:1}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/282.jpg",talents:[{fieldName:"improvedMarkOfTheWild",location:{rowIdx:0,colIdx:1},spellIds:[17050,17051,17053,17054,17055],maxPoints:5},{fieldName:"furor",location:{rowIdx:0,colIdx:2},spellIds:[17056,17058,17059,17060,17061],maxPoints:5},{fieldName:"improvedHealingTouch",location:{rowIdx:1,colIdx:0},spellIds:[17069,17070,17071,17072,17073],maxPoints:5},{fieldName:"naturesFocus",location:{rowIdx:1,colIdx:1},spellIds:[17063,17065,17066,17067,17068],maxPoints:5},{fieldName:"improvedEnrage",location:{rowIdx:1,colIdx:2},spellIds:[17079,17082],maxPoints:2},{fieldName:"reflection",location:{rowIdx:2,colIdx:1},spellIds:[17106,17107,17108],maxPoints:3},{fieldName:"insectSwarm",location:{rowIdx:2,colIdx:2},spellIds:[5570],maxPoints:1},{fieldName:"subtlety",location:{rowIdx:2,colIdx:3},spellIds:[17118,17119,17120,17121,17122],maxPoints:5},{fieldName:"tranquilSpirit",location:{rowIdx:3,colIdx:1},spellIds:[24968,24969,24970,24971,24972],maxPoints:5},{fieldName:"improvedRejuvenation",location:{rowIdx:3,colIdx:3},spellIds:[17111,17112,17113],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:0},spellIds:[17116],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"giftOfNature",location:{rowIdx:4,colIdx:2},spellIds:[17104,24943,24944,24945,24946],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedTranquility",location:{rowIdx:4,colIdx:3},spellIds:[17123,17124],maxPoints:2},{fieldName:"improvedRegrowth",location:{rowIdx:5,colIdx:2},spellIds:[17074,17075,17076,17077,17078],maxPoints:5},{fieldName:"swiftmend",location:{rowIdx:6,colIdx:1},spellIds:[18562],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),ga=ua([{name:"Beast Mastery",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/361.jpg",talents:[{fieldName:"improvedAspectOfTheHawk",location:{rowIdx:0,colIdx:1},spellIds:[19552,19553,19554,19555,19556],maxPoints:5},{fieldName:"enduranceTraining",location:{rowIdx:0,colIdx:2},spellIds:[19583,19584,19585,19586,19587],maxPoints:5},{fieldName:"improvedEyesOfTheBeast",location:{rowIdx:1,colIdx:0},spellIds:[19557,19558],maxPoints:2},{fieldName:"improvedAspectOfTheMonkey",location:{rowIdx:1,colIdx:1},spellIds:[19549,19550,19551,24386,24387],maxPoints:5},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[19609,19610,19612],maxPoints:3},{fieldName:"improvedRevivePet",location:{rowIdx:1,colIdx:3},spellIds:[24443,19575],maxPoints:2},{fieldName:"pathfinding",location:{rowIdx:2,colIdx:0},spellIds:[19559,19560],maxPoints:2},{fieldName:"bestialSwiftness",location:{rowIdx:2,colIdx:1},spellIds:[19596],maxPoints:1},{fieldName:"unleashedFury",location:{rowIdx:2,colIdx:2},spellIds:[19616,19617,19618,19619,19620],maxPoints:5},{fieldName:"improvedMendPet",location:{rowIdx:3,colIdx:1},spellIds:[19572,19573],maxPoints:2},{fieldName:"ferocity",location:{rowIdx:3,colIdx:2},spellIds:[19598,19599,19600,19601,19602],maxPoints:5},{fieldName:"spiritBond",location:{rowIdx:4,colIdx:0},spellIds:[19578,20895],maxPoints:2},{fieldName:"intimidation",location:{rowIdx:4,colIdx:1},spellIds:[19577],maxPoints:1},{fieldName:"bestialDiscipline",location:{rowIdx:4,colIdx:3},spellIds:[19590,19592],maxPoints:2},{fieldName:"frenzy",location:{rowIdx:5,colIdx:2},spellIds:[19621,19622,19623,19624,19625],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bestialWrath",location:{rowIdx:6,colIdx:1},spellIds:[19574],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Marksmanship",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/363.jpg",talents:[{fieldName:"improvedConcussiveShot",location:{rowIdx:0,colIdx:1},spellIds:[19407,19412,19413,19414,19415],maxPoints:5},{fieldName:"efficiency",location:{rowIdx:0,colIdx:2},spellIds:[19416,19417,19418,19419,19420],maxPoints:5},{fieldName:"improvedHuntersMark",location:{rowIdx:1,colIdx:1},spellIds:[19421,19422,19423,19424,19425],maxPoints:5},{fieldName:"lethalShots",location:{rowIdx:1,colIdx:2},spellIds:[19426,19427,19429,19430,19431],maxPoints:5},{fieldName:"aimedShot",location:{rowIdx:2,colIdx:0},spellIds:[19434],maxPoints:1},{fieldName:"improvedArcaneShot",location:{rowIdx:2,colIdx:1},spellIds:[19454,19455,19456,19457,19458],maxPoints:5},{fieldName:"hawkEye",location:{rowIdx:2,colIdx:3},spellIds:[19498,19499,19500],maxPoints:3},{fieldName:"improvedSerpentSting",location:{rowIdx:3,colIdx:1},spellIds:[19464,19465,19466,19467,19468],maxPoints:5},{fieldName:"mortalShots",location:{rowIdx:3,colIdx:2},spellIds:[19485,19487,19488,19489,19490],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"scatterShot",location:{rowIdx:4,colIdx:0},spellIds:[19503],maxPoints:1},{fieldName:"barrage",location:{rowIdx:4,colIdx:1},spellIds:[19461,19462,24691],maxPoints:3},{fieldName:"improvedScorpidSting",location:{rowIdx:4,colIdx:2},spellIds:[19491,19493,19494],maxPoints:3},{fieldName:"rangedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[19507,19508,19509,19510,19511],maxPoints:5},{fieldName:"trueshotAura",location:{rowIdx:6,colIdx:1},spellIds:[19506],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Survival",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/362.jpg",talents:[{fieldName:"monsterSlaying",location:{rowIdx:0,colIdx:0},spellIds:[24293,24294,24295],maxPoints:3},{fieldName:"humanoidSlaying",location:{rowIdx:0,colIdx:1},spellIds:[19151,19152,19153],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:2},spellIds:[19295,19297,19298,19300,19301],maxPoints:5},{fieldName:"entrapment",location:{rowIdx:1,colIdx:0},spellIds:[19184,19387,19388,19389,19390],maxPoints:5},{fieldName:"savageStrikes",location:{rowIdx:1,colIdx:1},spellIds:[19159,19160],maxPoints:2},{fieldName:"improvedWingClip",location:{rowIdx:1,colIdx:2},spellIds:[19228,19232,19233,19234,19235],maxPoints:5},{fieldName:"cleverTraps",location:{rowIdx:2,colIdx:0},spellIds:[19239,19245],maxPoints:2},{fieldName:"survivalist",location:{rowIdx:2,colIdx:1},spellIds:[19255,19256,19257,19258,19259],maxPoints:5},{fieldName:"deterrence",location:{rowIdx:2,colIdx:2},spellIds:[19263],maxPoints:1},{fieldName:"trapMastery",location:{rowIdx:3,colIdx:0},spellIds:[19376,19377],maxPoints:2},{fieldName:"surefooted",location:{rowIdx:3,colIdx:1},spellIds:[19290,19294,24283],maxPoints:3},{fieldName:"improvedFeignDeath",location:{rowIdx:3,colIdx:3},spellIds:[19286,19287],maxPoints:2},{fieldName:"killerInstinct",location:{rowIdx:4,colIdx:1},spellIds:[19370,19371,19373],maxPoints:3},{fieldName:"counterattack",location:{rowIdx:4,colIdx:2},spellIds:[19306],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"lightningReflexes",location:{rowIdx:5,colIdx:2},spellIds:[19168,19180,19181,24296,24297],maxPoints:5},{fieldName:"wyvernSting",location:{rowIdx:6,colIdx:1},spellIds:[19386],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),fa=ua([{name:"Arcane",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/81.jpg",talents:[{fieldName:"arcaneSubtlety",location:{rowIdx:0,colIdx:0},spellIds:[11210,12592],maxPoints:2},{fieldName:"arcaneFocus",location:{rowIdx:0,colIdx:1},spellIds:[11222,12839,12840,12841,12842],maxPoints:5},{fieldName:"improvedArcaneMissiles",location:{rowIdx:0,colIdx:2},spellIds:[11237,12463,12464,16769,16770],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:1,colIdx:0},spellIds:[6057,6085],maxPoints:2},{fieldName:"magicAbsorption",location:{rowIdx:1,colIdx:1},spellIds:[29441,29444,29445,29446,29447],maxPoints:5},{fieldName:"arcaneConcentration",location:{rowIdx:1,colIdx:2},spellIds:[11213,12574,12575,12576,12577],maxPoints:5},{fieldName:"magicAttunement",location:{rowIdx:2,colIdx:0},spellIds:[11247,12606],maxPoints:2},{fieldName:"improvedArcaneExplosion",location:{rowIdx:2,colIdx:1},spellIds:[11242,12467,12469],maxPoints:3},{fieldName:"arcaneResilience",location:{rowIdx:2,colIdx:2},spellIds:[28574],maxPoints:1},{fieldName:"improvedManaShield",location:{rowIdx:3,colIdx:0},spellIds:[11252,12605],maxPoints:2},{fieldName:"improvedCounterspell",location:{rowIdx:3,colIdx:1},spellIds:[11255,12598],maxPoints:2},{fieldName:"arcaneMeditation",location:{rowIdx:3,colIdx:3},spellIds:[18462,18463,18464],maxPoints:3},{fieldName:"presenceOfMind",location:{rowIdx:4,colIdx:1},spellIds:[12043],maxPoints:1},{fieldName:"arcaneMind",location:{rowIdx:4,colIdx:2},spellIds:[11232,12500,12501,12502,12503],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"arcaneInstability",location:{rowIdx:5,colIdx:1},spellIds:[15058,15059,15060],maxPoints:3,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"arcanePower",location:{rowIdx:6,colIdx:1},spellIds:[12042],maxPoints:1,prereqLocation:{rowIdx:5,colIdx:1}}]},{name:"Fire",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/41.jpg",talents:[{fieldName:"improvedFireball",location:{rowIdx:0,colIdx:1},spellIds:[11069,12338,12339,12340,12341],maxPoints:5},{fieldName:"impact",location:{rowIdx:0,colIdx:2},spellIds:[11103,12357,12358,12359,12360],maxPoints:5},{fieldName:"ignite",location:{rowIdx:1,colIdx:0},spellIds:[11119,11120,12846,12847,12848],maxPoints:5},{fieldName:"flameThrowing",location:{rowIdx:1,colIdx:1},spellIds:[11100,12353],maxPoints:2},{fieldName:"improvedFireBlast",location:{rowIdx:1,colIdx:2},spellIds:[11078,11080,12342],maxPoints:3},{fieldName:"incinerate",location:{rowIdx:2,colIdx:0},spellIds:[18459,18460],maxPoints:2},{fieldName:"improvedFlamestrike",location:{rowIdx:2,colIdx:1},spellIds:[11108,12349,12350],maxPoints:3},{fieldName:"pyroblast",location:{rowIdx:2,colIdx:2},spellIds:[11366],maxPoints:1},{fieldName:"burningSoul",location:{rowIdx:2,colIdx:3},spellIds:[11083,12351],maxPoints:2},{fieldName:"improvedScorch",location:{rowIdx:3,colIdx:0},spellIds:[11095,12872,12873],maxPoints:3},{fieldName:"improvedFireWard",location:{rowIdx:3,colIdx:1},spellIds:[11094,13043],maxPoints:2},{fieldName:"masterOfElements",location:{rowIdx:3,colIdx:3},spellIds:[29074,29075,29076],maxPoints:3},{fieldName:"criticalMass",location:{rowIdx:4,colIdx:1},spellIds:[11115,11367,11368],maxPoints:3},{fieldName:"blastWave",location:{rowIdx:4,colIdx:2},spellIds:[11113],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"firePower",location:{rowIdx:5,colIdx:2},spellIds:[11124,12378,12398,12399,12400],maxPoints:5},{fieldName:"combustion",location:{rowIdx:6,colIdx:1},spellIds:[11129],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Frost",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/61.jpg",talents:[{fieldName:"frostWarding",location:{rowIdx:0,colIdx:0},spellIds:[11189,28332],maxPoints:2},{fieldName:"improvedFrostbolt",location:{rowIdx:0,colIdx:1},spellIds:[11070,12473,16763,16765,16766],maxPoints:5},{fieldName:"elementalPrecision",location:{rowIdx:0,colIdx:2},spellIds:[29438,29439,29440],maxPoints:3},{fieldName:"iceShards",location:{rowIdx:1,colIdx:0},spellIds:[11207,12672,15047,15052,15053],maxPoints:5},{fieldName:"frostbite",location:{rowIdx:1,colIdx:1},spellIds:[11071,12496,12497],maxPoints:3},{fieldName:"improvedFrostNova",location:{rowIdx:1,colIdx:2},spellIds:[11165,12475],maxPoints:2},{fieldName:"permafrost",location:{rowIdx:1,colIdx:3},spellIds:[11175,12569,12571],maxPoints:3},{fieldName:"piercingIce",location:{rowIdx:2,colIdx:0},spellIds:[11151,12952,12953],maxPoints:3},{fieldName:"coldSnap",location:{rowIdx:2,colIdx:1},spellIds:[12472],maxPoints:1},{fieldName:"improvedBlizzard",location:{rowIdx:2,colIdx:3},spellIds:[11185,12487,12488],maxPoints:3},{fieldName:"arcticReach",location:{rowIdx:3,colIdx:0},spellIds:[16757,16758],maxPoints:2},{fieldName:"frostChanneling",location:{rowIdx:3,colIdx:1},spellIds:[11160,12518,12519],maxPoints:3},{fieldName:"shatter",location:{rowIdx:3,colIdx:2},spellIds:[11170,12982,12983,12984,12985],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"iceBlock",location:{rowIdx:4,colIdx:1},spellIds:[11958],maxPoints:1},{fieldName:"improvedConeOfCold",location:{rowIdx:4,colIdx:2},spellIds:[11190,12489,12490],maxPoints:3},{fieldName:"wintersChill",location:{rowIdx:5,colIdx:2},spellIds:[11180,28592,28593,28594,28595],maxPoints:5},{fieldName:"iceBarrier",location:{rowIdx:6,colIdx:1},spellIds:[11426],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Ia=ua([{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/382.jpg",talents:[{fieldName:"divineStrength",location:{rowIdx:0,colIdx:1},spellIds:[20262,20263,20264,20265,20266],maxPoints:5},{fieldName:"divineIntellect",location:{rowIdx:0,colIdx:2},spellIds:[20257,20258,20259,20260,20261],maxPoints:5},{fieldName:"spiritualFocus",location:{rowIdx:1,colIdx:1},spellIds:[20205,20206,20207,20208,20209],maxPoints:5},{fieldName:"improvedSealOfRighteousness",location:{rowIdx:1,colIdx:2},spellIds:[20224,20225,20330,20331,20332],maxPoints:5},{fieldName:"healingLight",location:{rowIdx:2,colIdx:0},spellIds:[20237,20238,20239],maxPoints:3},{fieldName:"consecration",location:{rowIdx:2,colIdx:1},spellIds:[26573],maxPoints:1},{fieldName:"improvedLayOnHands",location:{rowIdx:2,colIdx:2},spellIds:[20234,20235],maxPoints:2},{fieldName:"unyieldingFaith",location:{rowIdx:2,colIdx:3},spellIds:[9453,25836],maxPoints:2},{fieldName:"illumination",location:{rowIdx:3,colIdx:1},spellIds:[20210,20212,20213,20214,20215],maxPoints:5},{fieldName:"improvedBlessingOfWisdom",location:{rowIdx:3,colIdx:2},spellIds:[20244,20245],maxPoints:2},{fieldName:"divineFavor",location:{rowIdx:4,colIdx:1},spellIds:[20216],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"lastingJudgement",location:{rowIdx:4,colIdx:2},spellIds:[20359,20360,20361],maxPoints:3},{fieldName:"holyPower",location:{rowIdx:5,colIdx:2},spellIds:[5923,5924,5925,5926,25829],maxPoints:5},{fieldName:"holyShock",location:{rowIdx:6,colIdx:1},spellIds:[20473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/383.jpg",talents:[{fieldName:"improvedDevotionAura",location:{rowIdx:0,colIdx:1},spellIds:[20138,20139,20140,20141,20142],maxPoints:5},{fieldName:"redoubt",location:{rowIdx:0,colIdx:2},spellIds:[20127,20130,20135,20136,20137],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:0},spellIds:[20189,20192,20193],maxPoints:3},{fieldName:"guardiansFavor",location:{rowIdx:1,colIdx:1},spellIds:[20174,20175],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:3},spellIds:[20143,20144,20145,20146,20147],maxPoints:5},{fieldName:"blessingOfKings",location:{rowIdx:2,colIdx:0},spellIds:[20217],maxPoints:1},{fieldName:"improvedRighteousFury",location:{rowIdx:2,colIdx:1},spellIds:[20468,20469,20470],maxPoints:3},{fieldName:"shieldSpecialization",location:{rowIdx:2,colIdx:2},spellIds:[20148,20149,20150],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[20096,20097,20098,20099,20100],maxPoints:5},{fieldName:"improvedHammerOfJustice",location:{rowIdx:3,colIdx:1},spellIds:[20487,20488,20489],maxPoints:3},{fieldName:"improvedConcentrationAura",location:{rowIdx:3,colIdx:2},spellIds:[20254,20255,20256],maxPoints:3},{fieldName:"blessingOfSanctuary",location:{rowIdx:4,colIdx:1},spellIds:[20911],maxPoints:1},{fieldName:"reckoning",location:{rowIdx:4,colIdx:2},spellIds:[20177,20179,20180,20181,20182],maxPoints:5},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[20196,20197,20198,20199,20200],maxPoints:5},{fieldName:"holyShield",location:{rowIdx:6,colIdx:1},spellIds:[20925],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Retribution",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/381.jpg",talents:[{fieldName:"improvedBlessingOfMight",location:{rowIdx:0,colIdx:1},spellIds:[20042,20045,20046,20047,20048],maxPoints:5},{fieldName:"benediction",location:{rowIdx:0,colIdx:2},spellIds:[20101,20102,20103,20104,20105],maxPoints:5},{fieldName:"improvedJudgement",location:{rowIdx:1,colIdx:0},spellIds:[25956,25957],maxPoints:2},{fieldName:"improvedSealOfTheCrusader",location:{rowIdx:1,colIdx:1},spellIds:[20335,20336,20337],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:2},spellIds:[20060,20061,20062,20063,20064],maxPoints:5},{fieldName:"vindication",location:{rowIdx:2,colIdx:0},spellIds:[9452,26016,26021],maxPoints:3},{fieldName:"conviction",location:{rowIdx:2,colIdx:1},spellIds:[20117,20118,20119,20120,20121],maxPoints:5},{fieldName:"sealOfCommand",location:{rowIdx:2,colIdx:2},spellIds:[20375],maxPoints:1},{fieldName:"pursuitOfJustice",location:{rowIdx:2,colIdx:3},spellIds:[26022,26023],maxPoints:2},{fieldName:"eyeForAnEye",location:{rowIdx:3,colIdx:0},spellIds:[9799,25988],maxPoints:2},{fieldName:"improvedRetributionAura",location:{rowIdx:3,colIdx:2},spellIds:[20091,20092],maxPoints:2},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[20111,20112,20113],maxPoints:3},{fieldName:"sanctityAura",location:{rowIdx:4,colIdx:2},spellIds:[20218],maxPoints:1},{fieldName:"vengeance",location:{rowIdx:5,colIdx:1},spellIds:[20049,20056,20057,20058,20059],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"repentance",location:{rowIdx:6,colIdx:1},spellIds:[20066],maxPoints:1}]}]),wa=ua([{name:"Discipline",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/201.jpg",talents:[{fieldName:"unbreakableWill",location:{rowIdx:0,colIdx:1},spellIds:[14522,14788,14789,14790,14791],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14524,14525,14526,14527,14528],maxPoints:5},{fieldName:"silentResolve",location:{rowIdx:1,colIdx:0},spellIds:[14523,14784,14785,14786,14787],maxPoints:5},{fieldName:"improvedPowerWordFortitude",location:{rowIdx:1,colIdx:1},spellIds:[14749,14767],maxPoints:2},{fieldName:"improvedPowerWordShield",location:{rowIdx:1,colIdx:2},spellIds:[14748,14768,14769],maxPoints:3},{fieldName:"martyrdom",location:{rowIdx:1,colIdx:3},spellIds:[14531,14774],maxPoints:2},{fieldName:"innerFocus",location:{rowIdx:2,colIdx:1},spellIds:[14751],maxPoints:1},{fieldName:"meditation",location:{rowIdx:2,colIdx:2},spellIds:[14521,14776,14777],maxPoints:3},{fieldName:"improvedInnerFire",location:{rowIdx:3,colIdx:0},spellIds:[14747,14770,14771],maxPoints:3},{fieldName:"mentalAgility",location:{rowIdx:3,colIdx:1},spellIds:[14520,14780,14781,14782,14783],maxPoints:5},{fieldName:"improvedManaBurn",location:{rowIdx:3,colIdx:3},spellIds:[14750,14772],maxPoints:2},{fieldName:"mentalStrength",location:{rowIdx:4,colIdx:1},spellIds:[18551,18552,18553,18554,18555],maxPoints:5},{fieldName:"divineSpirit",location:{rowIdx:4,colIdx:2},spellIds:[14752],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"forceOfWill",location:{rowIdx:5,colIdx:2},spellIds:[18544,18547,18548,18549,18550],maxPoints:5},{fieldName:"powerInfusion",location:{rowIdx:6,colIdx:1},spellIds:[10060],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/202.jpg",talents:[{fieldName:"healingFocus",location:{rowIdx:0,colIdx:0},spellIds:[14913,15012],maxPoints:2},{fieldName:"improvedRenew",location:{rowIdx:0,colIdx:1},spellIds:[14908,15020,17191],maxPoints:3},{fieldName:"holySpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14889,15008,15009,15010,15011],maxPoints:5},{fieldName:"spellWarding",location:{rowIdx:1,colIdx:1},spellIds:[27900,27901,27902,27903,27904],maxPoints:5},{fieldName:"divineFury",location:{rowIdx:1,colIdx:2},spellIds:[18530,18531,18533,18534,18535],maxPoints:5},{fieldName:"holyNova",location:{rowIdx:2,colIdx:0},spellIds:[15237],maxPoints:1},{fieldName:"blessedRecovery",location:{rowIdx:2,colIdx:1},spellIds:[27811,27815,27816],maxPoints:3},{fieldName:"inspiration",location:{rowIdx:2,colIdx:3},spellIds:[14892,15362,15363],maxPoints:3},{fieldName:"holyReach",location:{rowIdx:3,colIdx:0},spellIds:[27789,27790],maxPoints:2},{fieldName:"improvedHealing",location:{rowIdx:3,colIdx:1},spellIds:[14912,15013,15014],maxPoints:3},{fieldName:"searingLight",location:{rowIdx:3,colIdx:2},spellIds:[14909,15017],maxPoints:2,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"improvedPrayerOfHealing",location:{rowIdx:4,colIdx:0},spellIds:[14911,15018],maxPoints:2},{fieldName:"spiritOfRedemption",location:{rowIdx:4,colIdx:1},spellIds:[20711],maxPoints:1},{fieldName:"spiritualGuidance",location:{rowIdx:4,colIdx:2},spellIds:[14901,15028,15029,15030,15031],maxPoints:5},{fieldName:"spiritualHealing",location:{rowIdx:5,colIdx:2},spellIds:[14898,15349,15354,15355,15356],maxPoints:5},{fieldName:"lightwell",location:{rowIdx:6,colIdx:1},spellIds:[724],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Shadow",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/203.jpg",talents:[{fieldName:"spiritTap",location:{rowIdx:0,colIdx:1},spellIds:[15270,15335,15336,15337,15338],maxPoints:5},{fieldName:"blackout",location:{rowIdx:0,colIdx:2},spellIds:[15268,15323,15324,15325,15326],maxPoints:5},{fieldName:"shadowAffinity",location:{rowIdx:1,colIdx:0},spellIds:[15318,15272,15320],maxPoints:3},{fieldName:"improvedShadowWordPain",location:{rowIdx:1,colIdx:1},spellIds:[15275,15317],maxPoints:2},{fieldName:"shadowFocus",location:{rowIdx:1,colIdx:2},spellIds:[15260,15327,15328],maxPoints:5},{fieldName:"improvedPsychicScream",location:{rowIdx:2,colIdx:0},spellIds:[15392,15448],maxPoints:2},{fieldName:"improvedMindBlast",location:{rowIdx:2,colIdx:1},spellIds:[15273,15312,15313,15314,15316],maxPoints:5},{fieldName:"mindFlay",location:{rowIdx:2,colIdx:2},spellIds:[15407],maxPoints:1},{fieldName:"improvedFade",location:{rowIdx:3,colIdx:1},spellIds:[15274,15311],maxPoints:2},{fieldName:"shadowReach",location:{rowIdx:3,colIdx:2},spellIds:[17322,17323,17325],maxPoints:3},{fieldName:"shadowWeaving",location:{rowIdx:3,colIdx:3},spellIds:[15257,15331,15332,15333,15334],maxPoints:5},{fieldName:"silence",location:{rowIdx:4,colIdx:0},spellIds:[15487],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"vampiricEmbrace",location:{rowIdx:4,colIdx:1},spellIds:[15286],maxPoints:1},{fieldName:"improvedVampiricEmbrace",location:{rowIdx:4,colIdx:2},spellIds:[27839,27840],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkness",location:{rowIdx:5,colIdx:2},spellIds:[15259,15307,15308,15309,15310],maxPoints:5},{fieldName:"shadowform",location:{rowIdx:6,colIdx:1},spellIds:[15473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),ba=ua([{name:"Assassination",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/182.jpg",talents:[{fieldName:"improvedEviscerate",location:{rowIdx:0,colIdx:0},spellIds:[14162,14163,14164],maxPoints:3},{fieldName:"remorselessAttacks",location:{rowIdx:0,colIdx:1},spellIds:[14144,14148],maxPoints:2},{fieldName:"malice",location:{rowIdx:0,colIdx:2},spellIds:[14138,14139,14140,14141,14142],maxPoints:5},{fieldName:"ruthlessness",location:{rowIdx:1,colIdx:0},spellIds:[14156,14160,14161],maxPoints:3},{fieldName:"murder",location:{rowIdx:1,colIdx:1},spellIds:[14158,14159],maxPoints:2},{fieldName:"improvedSliceAndDice",location:{rowIdx:1,colIdx:3},spellIds:[14165,14166,14167],maxPoints:3},{fieldName:"relentlessStrikes",location:{rowIdx:2,colIdx:0},spellIds:[14179],maxPoints:1},{fieldName:"improvedExposeArmor",location:{rowIdx:2,colIdx:1},spellIds:[14168,14169],maxPoints:2},{fieldName:"lethality",location:{rowIdx:2,colIdx:2},spellIds:[14128,14132,14135,14136,14137],maxPoints:5,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"vilePoisons",location:{rowIdx:3,colIdx:1},spellIds:[16513,16514,16515,16719,16720],maxPoints:5},{fieldName:"improvedPoisons",location:{rowIdx:3,colIdx:2},spellIds:[14113,14114,14115,14116,14117],maxPoints:5},{fieldName:"coldBlood",location:{rowIdx:4,colIdx:1},spellIds:[14177],maxPoints:1},{fieldName:"improvedKidneyShot",location:{rowIdx:4,colIdx:2},spellIds:[14174,14175,14176],maxPoints:3},{fieldName:"sealFate",location:{rowIdx:5,colIdx:1},spellIds:[14186,14190,14193,14194,14195],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"vigor",location:{rowIdx:6,colIdx:1},spellIds:[14983],maxPoints:1}]},{name:"Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/181.jpg",talents:[{fieldName:"improvedGouge",location:{rowIdx:0,colIdx:0},spellIds:[13741,13792,13793],maxPoints:3},{fieldName:"improvedSinisterStrike",location:{rowIdx:0,colIdx:1},spellIds:[13732,13863],maxPoints:2},{fieldName:"lightningReflexes",location:{rowIdx:0,colIdx:2},spellIds:[13712,13788,13789,13790,13791],maxPoints:5},{fieldName:"improvedBackstab",location:{rowIdx:1,colIdx:0},spellIds:[13733,13865,13866],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:1},spellIds:[13713,13853,13854,13855,13856],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:2},spellIds:[13705,13832,13843,13844,13845],maxPoints:5},{fieldName:"endurance",location:{rowIdx:2,colIdx:0},spellIds:[13742,13872],maxPoints:2},{fieldName:"riposte",location:{rowIdx:2,colIdx:1},spellIds:[14251],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedSprint",location:{rowIdx:2,colIdx:3},spellIds:[13743,13875],maxPoints:2},{fieldName:"improvedKick",location:{rowIdx:3,colIdx:0},spellIds:[13754,13867],maxPoints:2},{fieldName:"daggerSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[13706,13804,13805,13806,13807],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:2},spellIds:[13715,13848,13849,13851,13852],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[13709,13800,13801,13802,13803],maxPoints:5},{fieldName:"bladeFlurry",location:{rowIdx:4,colIdx:1},spellIds:[13877],maxPoints:1},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[13960,13961,13962,13963,13964],maxPoints:5},{fieldName:"fistWeaponSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[13707,13966,13967,13968,13969],maxPoints:5},{fieldName:"weaponExpertise",location:{rowIdx:5,colIdx:1},spellIds:[30919,30920],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"aggression",location:{rowIdx:5,colIdx:2},spellIds:[18427,18428,18429],maxPoints:3},{fieldName:"adrenalineRush",location:{rowIdx:6,colIdx:1},spellIds:[13750],maxPoints:1}]},{name:"Subtlety",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/183.jpg",talents:[{fieldName:"masterOfDeception",location:{rowIdx:0,colIdx:1},spellIds:[13958,13970,13971,13972,13973],maxPoints:5},{fieldName:"opportunity",location:{rowIdx:0,colIdx:2},spellIds:[14057,14072,14073,14074,14075],maxPoints:5},{fieldName:"sleightOfHand",location:{rowIdx:1,colIdx:0},spellIds:[30892,30893],maxPoints:2},{fieldName:"elusiveness",location:{rowIdx:1,colIdx:1},spellIds:[13981,14066],maxPoints:2},{fieldName:"camouflage",location:{rowIdx:1,colIdx:2},spellIds:[13975,14062,14063,14064,14065],maxPoints:5},{fieldName:"initiative",location:{rowIdx:2,colIdx:0},spellIds:[13976,13979,13980],maxPoints:3},{fieldName:"ghostlyStrike",location:{rowIdx:2,colIdx:1},spellIds:[14278],maxPoints:1},{fieldName:"improvedAmbush",location:{rowIdx:2,colIdx:2},spellIds:[14079,14080,14081],maxPoints:3},{fieldName:"setup",location:{rowIdx:3,colIdx:0},spellIds:[13983,14070,14071],maxPoints:3},{fieldName:"improvedSap",location:{rowIdx:3,colIdx:1},spellIds:[14076,14094],maxPoints:3},{fieldName:"serratedBlades",location:{rowIdx:3,colIdx:2},spellIds:[14171,14172,14173],maxPoints:3,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"heightenedSenses",location:{rowIdx:4,colIdx:0},spellIds:[30894,30895],maxPoints:2},{fieldName:"preparation",location:{rowIdx:4,colIdx:1},spellIds:[14185],maxPoints:1},{fieldName:"dirtyDeeds",location:{rowIdx:4,colIdx:2},spellIds:[14082,14083],maxPoints:2},{fieldName:"hemorrhage",location:{rowIdx:4,colIdx:3},spellIds:[16511],maxPoints:1},{fieldName:"deadliness",location:{rowIdx:5,colIdx:2},spellIds:[30902,30903,30904,30905,30906],maxPoints:5},{fieldName:"premeditation",location:{rowIdx:6,colIdx:1},spellIds:[14183],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),xa=ua([{name:"Elemental",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/261.jpg",talents:[{fieldName:"convection",location:{rowIdx:0,colIdx:1},spellIds:[16039,16109,16110,16111,16112],maxPoints:5},{fieldName:"concussion",location:{rowIdx:0,colIdx:2},spellIds:[16035,16105,16106,16107,16108],maxPoints:5},{fieldName:"earthsGrasp",location:{rowIdx:1,colIdx:0},spellIds:[16043,16130],maxPoints:2},{fieldName:"elementalWarding",location:{rowIdx:1,colIdx:1},spellIds:[28996,28997,28998],maxPoints:3},{fieldName:"callOfFlame",location:{rowIdx:1,colIdx:2},spellIds:[16038,16160,16161],maxPoints:3},{fieldName:"elementalFocus",location:{rowIdx:2,colIdx:0},spellIds:[16164],maxPoints:1},{fieldName:"reverberation",location:{rowIdx:2,colIdx:1},spellIds:[16040,16113,16114,16115,16116],maxPoints:5},{fieldName:"callOfThunder",location:{rowIdx:2,colIdx:2},spellIds:[16041,16117,16118,16119,16120],maxPoints:5},{fieldName:"improvedFireTotems",location:{rowIdx:3,colIdx:0},spellIds:[16086,16544],maxPoints:2},{fieldName:"eyeOfTheStorm",location:{rowIdx:3,colIdx:1},spellIds:[29062,29064,29065],maxPoints:3},{fieldName:"elementalDevastation",location:{rowIdx:3,colIdx:3},spellIds:[30160,29179,29180],maxPoints:3},{fieldName:"stormReach",location:{rowIdx:4,colIdx:0},spellIds:[28999,29e3],maxPoints:2},{fieldName:"elementalFury",location:{rowIdx:4,colIdx:1},spellIds:[16089],maxPoints:1},{fieldName:"lightningMastery",location:{rowIdx:5,colIdx:2},spellIds:[16578,16579,16580,16581,16582],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"elementalMastery",location:{rowIdx:6,colIdx:1},spellIds:[16166],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Enhancement",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/263.jpg",talents:[{fieldName:"ancestralKnowledge",location:{rowIdx:0,colIdx:1},spellIds:[17485,16579,16580,16581,16582],maxPoints:5},{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[16253,16298],maxPoints:5},{fieldName:"guardianTotems",location:{rowIdx:1,colIdx:0},spellIds:[16258,16293],maxPoints:2},{fieldName:"thunderingStrikes",location:{rowIdx:1,colIdx:1},spellIds:[16255,16302,16303,16304,16305],maxPoints:5},{fieldName:"improvedGhostWolf",location:{rowIdx:1,colIdx:2},spellIds:[16262,16287],maxPoints:2},{fieldName:"improvedLightningShield",location:{rowIdx:1,colIdx:3},spellIds:[16261,16290],maxPoints:3},{fieldName:"enhancingTotems",location:{rowIdx:2,colIdx:0},spellIds:[16259,16295],maxPoints:2},{fieldName:"twoHandedAxesAndMaces",location:{rowIdx:2,colIdx:2},spellIds:[16269],maxPoints:1},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[16254,16271,16272,16273,16274],maxPoints:5},{fieldName:"flurry",location:{rowIdx:3,colIdx:1},spellIds:[16256,16281,16282,16283,16284],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"toughness",location:{rowIdx:3,colIdx:2},spellIds:[16252,16306,16307,16308,16309],maxPoints:5},{fieldName:"improvedWeaponTotems",location:{rowIdx:4,colIdx:0},spellIds:[29192,29193],maxPoints:2},{fieldName:"elementalWeapons",location:{rowIdx:4,colIdx:1},spellIds:[16266,29079,29080],maxPoints:3},{fieldName:"parry",location:{rowIdx:4,colIdx:2},spellIds:[16268],maxPoints:1},{fieldName:"weaponMastery",location:{rowIdx:5,colIdx:2},spellIds:[29082,29084,29086,29087,29088],maxPoints:5},{fieldName:"stormstrike",location:{rowIdx:6,colIdx:1},spellIds:[17364],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/262.jpg",talents:[{fieldName:"improvedHealingWave",location:{rowIdx:0,colIdx:1},spellIds:[16182,16226,16227,16228,16229],maxPoints:5},{fieldName:"tidalFocus",location:{rowIdx:0,colIdx:2},spellIds:[16179,16214,16215,16216,16217],maxPoints:5},{fieldName:"improvedReincarnation",location:{rowIdx:1,colIdx:0},spellIds:[16184,16209],maxPoints:2},{fieldName:"ancestralHealing",location:{rowIdx:1,colIdx:1},spellIds:[16176,16235,16240],maxPoints:3},{fieldName:"totemicFocus",location:{rowIdx:1,colIdx:2},spellIds:[16173,16222,16223,16224,16225],maxPoints:5},{fieldName:"naturesGuidance",location:{rowIdx:2,colIdx:0},spellIds:[16180,16196,16198],maxPoints:3},{fieldName:"healingFocus",location:{rowIdx:2,colIdx:1},spellIds:[16181,16230,16232,16233,16234],maxPoints:5},{fieldName:"totemicMastery",location:{rowIdx:2,colIdx:2},spellIds:[16189],maxPoints:1},{fieldName:"healingGrace",location:{rowIdx:2,colIdx:3},spellIds:[29187,29189,29191],maxPoints:3},{fieldName:"restorativeTotems",location:{rowIdx:3,colIdx:1},spellIds:[16187,16205,16206,16207,16208],maxPoints:5},{fieldName:"tidalMastery",location:{rowIdx:3,colIdx:2},spellIds:[16194,16218,16219,16220,16221],maxPoints:5},{fieldName:"healingWay",location:{rowIdx:4,colIdx:0},spellIds:[29206,29202,29205],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:2},spellIds:[16188],maxPoints:1},{fieldName:"purification",location:{rowIdx:5,colIdx:2},spellIds:[16178,16210,16211,16212,16213],maxPoints:5},{fieldName:"manaTideTotem",location:{rowIdx:6,colIdx:1},spellIds:[16190],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),va=ua([{name:"Affliction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/302.jpg",talents:[{fieldName:"suppression",location:{rowIdx:0,colIdx:1},spellIds:[18174,18175,18176,18177,18178],maxPoints:5},{fieldName:"improvedCorruption",location:{rowIdx:0,colIdx:2},spellIds:[17810,17811,17812,17813,17814],maxPoints:5},{fieldName:"improvedCurseOfWeakness",location:{rowIdx:1,colIdx:0},spellIds:[18179,18180,18181],maxPoints:3},{fieldName:"improvedDrainSoul",location:{rowIdx:1,colIdx:1},spellIds:[18213,18372],maxPoints:2},{fieldName:"improvedLifeTap",location:{rowIdx:1,colIdx:2},spellIds:[18182,18183],maxPoints:2},{fieldName:"improvedDrainLife",location:{rowIdx:1,colIdx:3},spellIds:[17804,17805,17806,17807,17808],maxPoints:5},{fieldName:"improvedCurseOfAgony",location:{rowIdx:2,colIdx:0},spellIds:[18827,18829,18830],maxPoints:3},{fieldName:"felConcentration",location:{rowIdx:2,colIdx:1},spellIds:[17783,17784,17785,17786,17787],maxPoints:5},{fieldName:"amplifyCurse",location:{rowIdx:2,colIdx:2},spellIds:[18288],maxPoints:1},{fieldName:"grimReach",location:{rowIdx:3,colIdx:0},spellIds:[18218,18219],maxPoints:2},{fieldName:"nightfall",location:{rowIdx:3,colIdx:1},spellIds:[18094,18095],maxPoints:2},{fieldName:"improvedDrainMana",location:{rowIdx:3,colIdx:3},spellIds:[17864,18393],maxPoints:2},{fieldName:"siphonLife",location:{rowIdx:4,colIdx:1},spellIds:[18265],maxPoints:1},{fieldName:"curseOfExhaustion",location:{rowIdx:4,colIdx:2},spellIds:[18223],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedCurseOfExhaustion",location:{rowIdx:4,colIdx:3},spellIds:[18310,18311,18312,18313],maxPoints:4,prereqLocation:{rowIdx:4,colIdx:2}},{fieldName:"shadowMastery",location:{rowIdx:5,colIdx:1},spellIds:[18271,18272,18273,18274,18275],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkPact",location:{rowIdx:6,colIdx:1},spellIds:[18220],maxPoints:1}]},{name:"Demonology",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/303.jpg",talents:[{fieldName:"improvedHealthstone",location:{rowIdx:0,colIdx:0},spellIds:[18692,18693],maxPoints:2},{fieldName:"improvedImp",location:{rowIdx:0,colIdx:1},spellIds:[18694,18695,18696],maxPoints:3},{fieldName:"demonicEmbrace",location:{rowIdx:0,colIdx:2},spellIds:[18697,18698,18699,18700,18701],maxPoints:5},{fieldName:"improvedHealthFunnel",location:{rowIdx:1,colIdx:0},spellIds:[18703,18704],maxPoints:2},{fieldName:"improvedVoidwalker",location:{rowIdx:1,colIdx:1},spellIds:[18705,18706,18707],maxPoints:3},{fieldName:"felIntellect",location:{rowIdx:1,colIdx:2},spellIds:[18731,18743,18744,18745,18746],maxPoints:5},{fieldName:"improvedSayaad",location:{rowIdx:2,colIdx:0},spellIds:[18754,18755,18756],maxPoints:3},{fieldName:"felDomination",location:{rowIdx:2,colIdx:1},spellIds:[18708],maxPoints:1},{fieldName:"felStamina",location:{rowIdx:2,colIdx:2},spellIds:[18748],maxPoints:5},{fieldName:"masterSummoner",location:{rowIdx:3,colIdx:1},spellIds:[18709,18710],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"unholyPower",location:{rowIdx:3,colIdx:2},spellIds:[18769,18770,18771,18772,18773],maxPoints:5},{fieldName:"improvedSubjugateDemon",location:{rowIdx:4,colIdx:0},spellIds:[18821,18823,18824,18825],maxPoints:5},{fieldName:"demonicSacrifice",location:{rowIdx:4,colIdx:1},spellIds:[18788],maxPoints:1},{fieldName:"improvedFirestone",location:{rowIdx:4,colIdx:3},spellIds:[18767,18768],maxPoints:2},{fieldName:"masterDemonologist",location:{rowIdx:5,colIdx:2},spellIds:[23785,23822,23823,23824,23825],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"soulLink",location:{rowIdx:6,colIdx:1},spellIds:[19028],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"improvedSpellstone",location:{rowIdx:6,colIdx:2},spellIds:[18774,18775],maxPoints:2}]},{name:"Destruction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/301.jpg",talents:[{fieldName:"improvedShadowBolt",location:{rowIdx:0,colIdx:1},spellIds:[17793,17796,17801,17802,17803],maxPoints:5},{fieldName:"cataclysm",location:{rowIdx:0,colIdx:2},spellIds:[17778,17779,17780,17781,17782],maxPoints:5},{fieldName:"bane",location:{rowIdx:1,colIdx:1},spellIds:[17788,17789,17790,17791,17792],maxPoints:5},{fieldName:"aftermath",location:{rowIdx:1,colIdx:2},spellIds:[18119,18120,18121,18122,18123],maxPoints:5},{fieldName:"improvedFirebolt",location:{rowIdx:2,colIdx:0},spellIds:[18126,18127],maxPoints:2},{fieldName:"improvedLashOfPain",location:{rowIdx:2,colIdx:1},spellIds:[18128],maxPoints:2},{fieldName:"devastation",location:{rowIdx:2,colIdx:2},spellIds:[18130,18131,18132,18133,18134],maxPoints:5},{fieldName:"shadowburn",location:{rowIdx:2,colIdx:3},spellIds:[17877],maxPoints:1},{fieldName:"intensity",location:{rowIdx:3,colIdx:0},spellIds:[18135,18136],maxPoints:2},{fieldName:"destructiveReach",location:{rowIdx:3,colIdx:1},spellIds:[17917,17918],maxPoints:2},{fieldName:"improvedSearingPain",location:{rowIdx:3,colIdx:3},spellIds:[17927,17929,17930,17931,17932],maxPoints:5},{fieldName:"pyroclasm",location:{rowIdx:4,colIdx:0},spellIds:[18096,18073],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:0}},{fieldName:"improvedImmolate",location:{rowIdx:4,colIdx:1},spellIds:[17815,17833,17834,17835,17836],maxPoints:5},{fieldName:"ruin",location:{rowIdx:4,colIdx:2},spellIds:[17959],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"emberstorm",location:{rowIdx:5,colIdx:2},spellIds:[17954,17955,17956,17957,17958],maxPoints:5},{fieldName:"conflagrate",location:{rowIdx:6,colIdx:1},spellIds:[17962],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Ea=ua([{name:"Arms",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/161.jpg",talents:[{fieldName:"improvedHeroicStrike",location:{rowIdx:0,colIdx:0},spellIds:[12282,12663,12664],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:1},spellIds:[16462,16463,16464,16465,16466],maxPoints:5},{fieldName:"improvedRend",location:{rowIdx:0,colIdx:2},spellIds:[12286,12658,12659],maxPoints:3},{fieldName:"improvedCharge",location:{rowIdx:1,colIdx:0},spellIds:[12285,12658,12659],maxPoints:2},{fieldName:"tacticalMastery",location:{rowIdx:1,colIdx:1},spellIds:[12295,12676,12677,12678,12679],maxPoints:5},{fieldName:"improvedThunderClap",location:{rowIdx:1,colIdx:3},spellIds:[12287,12665,12666],maxPoints:3},{fieldName:"improvedOverpower",location:{rowIdx:2,colIdx:0},spellIds:[12290,12963],maxPoints:2},{fieldName:"angerManagement",location:{rowIdx:2,colIdx:1},spellIds:[12296],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"deepWounds",location:{rowIdx:2,colIdx:2},spellIds:[12834,12849,12867],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[12163,12711,12712,12713,12714],maxPoints:5},{fieldName:"impale",location:{rowIdx:3,colIdx:2},spellIds:[16493,16494],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"axeSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[12700,12781,12783,12784,12785],maxPoints:5},{fieldName:"sweepingStrikes",location:{rowIdx:4,colIdx:1},spellIds:[12292],maxPoints:1},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[12284,12701,12702,12703,12704],maxPoints:5},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[12281,12812,12813,12814,12815],maxPoints:5},{fieldName:"polearmSpecialization",location:{rowIdx:5,colIdx:0},spellIds:[12165,12830,12831,12832,12833],maxPoints:5},{fieldName:"improvedHamstring",location:{rowIdx:5,colIdx:2},spellIds:[12289,12668,23695],maxPoints:3},{fieldName:"mortalStrike",location:{rowIdx:6,colIdx:1},spellIds:[12294],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Fury",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/164.jpg",talents:[{fieldName:"boomingVoice",location:{rowIdx:0,colIdx:1},spellIds:[12321,12835,12836,12837,12838],maxPoints:5},{fieldName:"cruelty",location:{rowIdx:0,colIdx:2},spellIds:[12320,12852,12853,12855,12856],maxPoints:5},{fieldName:"improvedDemoralizingShout",location:{rowIdx:1,colIdx:1},spellIds:[12324,12876,12877,12878,12879],maxPoints:5},{fieldName:"unbridledWrath",location:{rowIdx:1,colIdx:2},spellIds:[12322,12999,13e3,13001,13002],maxPoints:5},{fieldName:"improvedCleave",location:{rowIdx:2,colIdx:0},spellIds:[12329,12950,20496],maxPoints:3},{fieldName:"piercingHowl",location:{rowIdx:2,colIdx:1},spellIds:[12323],maxPoints:1},{fieldName:"bloodCraze",location:{rowIdx:2,colIdx:2},spellIds:[16487,16489,16492],maxPoints:3},{fieldName:"improvedBattleShout",location:{rowIdx:2,colIdx:3},spellIds:[12318,12857,12858,12860,12861],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:0},spellIds:[23584,23585,23586,23587,23588],maxPoints:5},{fieldName:"improvedExecute",location:{rowIdx:3,colIdx:1},spellIds:[20502,20503],maxPoints:2},{fieldName:"enrage",location:{rowIdx:3,colIdx:2},spellIds:[12317,13045,13046,13047,13048],maxPoints:5},{fieldName:"improvedSlam",location:{rowIdx:4,colIdx:0},spellIds:[12862,12330,20497,20498,20499],maxPoints:5},{fieldName:"deathWish",location:{rowIdx:4,colIdx:1},spellIds:[12328],maxPoints:1},{fieldName:"improvedIntercept",location:{rowIdx:4,colIdx:3},spellIds:[20504,20505],maxPoints:2},{fieldName:"improvedBerserkerRage",location:{rowIdx:5,colIdx:0},spellIds:[20500,20501],maxPoints:2},{fieldName:"flurry",location:{rowIdx:5,colIdx:2},spellIds:[12319,12971,12972,12973,12974],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bloodthirst",location:{rowIdx:6,colIdx:1},spellIds:[23881],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/163.jpg",talents:[{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:1},spellIds:[12298,12724,12725,12726,12727],maxPoints:5},{fieldName:"anticipation",location:{rowIdx:0,colIdx:2},spellIds:[12297,12750,12751,12752,12753],maxPoints:5},{fieldName:"improvedBloodrage",location:{rowIdx:1,colIdx:0},spellIds:[12301,12818],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:2},spellIds:[12299,12761,12762,12763,12764],maxPoints:5},{fieldName:"ironWill",location:{rowIdx:1,colIdx:3},spellIds:[12300,12959,12960,12961,12962],maxPoints:5},{fieldName:"lastStand",location:{rowIdx:2,colIdx:0},spellIds:[12975],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"improvedShieldBlock",location:{rowIdx:2,colIdx:1},spellIds:[12945,12307,12944],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedRevenge",location:{rowIdx:2,colIdx:2},spellIds:[12797,12799,12800],maxPoints:3},{fieldName:"defiance",location:{rowIdx:2,colIdx:3},spellIds:[12303,12788,12789,12791,12792],maxPoints:5},{fieldName:"improvedSunderArmor",location:{rowIdx:3,colIdx:0},spellIds:[12308,12810,12811],maxPoints:3},{fieldName:"improvedDisarm",location:{rowIdx:3,colIdx:1},spellIds:[12313,12804,12807],maxPoints:3},{fieldName:"improvedTaunt",location:{rowIdx:3,colIdx:2},spellIds:[12302,12765],maxPoints:2},{fieldName:"improvedShieldWall",location:{rowIdx:4,colIdx:0},spellIds:[12312,12803],maxPoints:2},{fieldName:"concussionBlow",location:{rowIdx:4,colIdx:1},spellIds:[12809],maxPoints:1},{fieldName:"improvedShieldBash",location:{rowIdx:4,colIdx:2},spellIds:[12311,12958],maxPoints:2},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[16538,16539,16540,16541,16542],maxPoints:5},{fieldName:"shieldSlam",location:{rowIdx:6,colIdx:1},spellIds:[23922],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Sa={[m.ClassUnknown]:[],[m.ClassDruid]:pa,[m.ClassShaman]:xa,[m.ClassHunter]:ga,[m.ClassMage]:fa,[m.ClassRogue]:ba,[m.ClassPaladin]:Ia,[m.ClassPriest]:wa,[m.ClassWarlock]:va,[m.ClassWarrior]:Ea};function ya(t,e){return function(t,e,s){return e.split("-").forEach(((e,i)=>{const a=s[i];[...e].forEach(((e,s)=>{const i=a.talents[s],n=parseInt(e);i.fieldName&&(1==i.maxPoints?t[i.fieldName]=1==n:t[i.fieldName]=n)}))})),t}(E[t].talentsCreate(),e,Sa[S[t]])}class Pa{constructor(){e(this,"name"),e(this,"auras"),e(this,"spells"),this.name="",this.auras=[],this.spells=[]}getName(){return this.name}getAuras(){return this.auras.slice()}getSpells(){return this.spells.slice()}async update(t){let e=t.spells.map((t=>({data:t,id:v.fromProto(t.id)}))),s=t.auras.map((t=>({data:t,id:v.fromProto(t.id)})));await Promise.all([...e,...s].map((t=>t.id.fill().then((e=>t.id=e))))),e=e.sort(((t,e)=>at(t.id.name,e.id.name))),s=s.sort(((t,e)=>at(t.id.name,e.id.name)));let i=!1;return t.name!=this.name&&(this.name=t.name,i=!0),(e.length!=this.spells.length||e.some(((t,e)=>!t.id.equals(this.spells[e].id))))&&(this.spells=e,i=!0),(s.length!=this.auras.length||s.some(((t,e)=>!t.id.equals(this.auras[e].id))))&&(this.auras=s,i=!0),i}}class Ca{constructor(){e(this,"metadatas"),this.metadatas=[]}async update(t){const e=this.metadatas.length;if(t.length>e)for(let i=e;i<t.length;i++)this.metadatas.push(new Pa);else t.length<e&&(this.metadatas=this.metadatas.slice(0,t.length));const s=await Promise.all(t.map(((t,e)=>this.metadatas[e].update(t))));return e!=this.metadatas.length||s.some((t=>t))}asList(){return this.metadatas.slice()}}const ka={};function Ta(t){const e=ka[t];if(!e)throw new Error("No config registered for Spec: "+t);return e}const _a=class{constructor(t,s){e(this,"sim"),e(this,"party"),e(this,"raid"),e(this,"spec"),e(this,"name",""),e(this,"buffs",y.create()),e(this,"consumes",P.create()),e(this,"bonusStats",new oa),e(this,"gear",new C({})),e(this,"enableItemSwap",!1),e(this,"itemSwapGear",new k({})),e(this,"race"),e(this,"level"),e(this,"profession1",0),e(this,"profession2",0),e(this,"aplRotation",T.create()),e(this,"talentsString",""),e(this,"specOptions"),e(this,"reactionTime",0),e(this,"channelClipDelay",0),e(this,"inFrontOfTarget",!1),e(this,"distanceFromTarget",0),e(this,"healingModel",_.create()),e(this,"healingEnabled",!1),e(this,"autoRotationGenerator",null),e(this,"simpleRotationGenerator",null),e(this,"itemEPCache",new Array),e(this,"randomSuffixEPCache",new Map),e(this,"enchantEPCache",new Map),e(this,"talents",null),e(this,"specTypeFunctions"),e(this,"epRatios",new Array(_a.numEpRatios).fill(0)),e(this,"epWeights",new oa),e(this,"currentStats",N.create()),e(this,"metadata",new Pa),e(this,"petMetadatas",new Ca),e(this,"nameChangeEmitter",new c("PlayerName")),e(this,"buffsChangeEmitter",new c("PlayerBuffs")),e(this,"consumesChangeEmitter",new c("PlayerConsumes")),e(this,"bonusStatsChangeEmitter",new c("PlayerBonusStats")),e(this,"gearChangeEmitter",new c("PlayerGear")),e(this,"itemSwapChangeEmitter",new c("PlayerItemSwap")),e(this,"professionChangeEmitter",new c("PlayerProfession")),e(this,"raceChangeEmitter",new c("PlayerRace")),e(this,"levelChangeEmitter",new c("PlayerLevel")),e(this,"rotationChangeEmitter",new c("PlayerRotation")),e(this,"talentsChangeEmitter",new c("PlayerTalents")),e(this,"specOptionsChangeEmitter",new c("PlayerSpecOptions")),e(this,"inFrontOfTargetChangeEmitter",new c("PlayerInFrontOfTarget")),e(this,"distanceFromTargetChangeEmitter",new c("PlayerDistanceFromTarget")),e(this,"healingModelChangeEmitter",new c("PlayerHealingModel")),e(this,"epWeightsChangeEmitter",new c("PlayerEpWeights")),e(this,"miscOptionsChangeEmitter",new c("PlayerMiscOptions")),e(this,"currentStatsEmitter",new c("PlayerCurrentStats")),e(this,"epRatiosChangeEmitter",new c("PlayerEpRatios")),e(this,"epRefStatChangeEmitter",new c("PlayerEpRefStat")),e(this,"changeEmitter"),this.sim=s,this.party=null,this.raid=null,this.spec=t,this.race=L[this.spec][0],this.level=R,this.specTypeFunctions=E[this.spec],this.specOptions=this.specTypeFunctions.optionsCreate();const i=ka[this.spec];if(!i)throw new Error("Could not find spec config for spec: "+this.spec);this.autoRotationGenerator=i.autoRotation,i.simpleRotation?this.simpleRotationGenerator=i.simpleRotation:this.simpleRotationGenerator=null;for(let e=0;e<D.ItemSlotRanged+1;++e)this.itemEPCache[e]=new Map;this.changeEmitter=c.onAny([this.nameChangeEmitter,this.buffsChangeEmitter,this.consumesChangeEmitter,this.bonusStatsChangeEmitter,this.gearChangeEmitter,this.itemSwapChangeEmitter,this.professionChangeEmitter,this.raceChangeEmitter,this.levelChangeEmitter,this.rotationChangeEmitter,this.talentsChangeEmitter,this.specOptionsChangeEmitter,this.miscOptionsChangeEmitter,this.inFrontOfTargetChangeEmitter,this.distanceFromTargetChangeEmitter,this.healingModelChangeEmitter,this.epWeightsChangeEmitter,this.epRatiosChangeEmitter,this.epRefStatChangeEmitter],"PlayerChange")}getSpecIcon(){return A(this.spec,this.getTalentsString())}getClass(){return S[this.spec]}getClassColor(){return V[this.getClass()]}isSpec(t){return this.spec==t}isClass(t){return this.getClass()==t}getParty(){return this.party}getRaid(){return this.raid}getPartyIndex(){if(null==this.party)throw new Error("Can't get party index for player without a party!");return this.party.getPlayers().indexOf(this)}getRaidIndex(){if(null==this.party)throw new Error("Can't get raid index for player without a party!");return 5*this.party.getIndex()+this.getPartyIndex()}setParty(t){null==t?(this.party=null,this.raid=null):(this.party=t,this.raid=t.raid)}getOtherPartyMembers(){return null==this.party?[]:this.party.getPlayers().filter((t=>null!=t&&t!=this))}getItems(t){return this.sim.db.getItems(t).filter((e=>M(this,e,t)))}getRandomSuffixes(t){return t.randomSuffixOptions.map((t=>this.sim.db.getRandomSuffixById(t))).filter((t=>this.computeRandomSuffixEP(t)>0))}getEnchants(t){return this.sim.db.getEnchants(t).filter((t=>U(t,this.spec)))}getRunes(t){return this.sim.db.getRunes(t,this.getClass())}getEpWeights(){return this.epWeights}setEpWeights(t,e){this.epWeights=e,this.epWeightsChangeEmitter.emit(t),this.enchantEPCache=new Map,this.randomSuffixEPCache=new Map;for(let s=0;s<D.ItemSlotRanged+1;++s)this.itemEPCache[s]=new Map}getDefaultEpRatios(t,e){const s=new Array(_a.numEpRatios).fill(0);return e?s[1]=1:t?(s[2]=1,s[3]=1):s[0]=1,s}getEpRatios(){return this.epRatios.slice()}setEpRatios(t,e){this.epRatios=e,this.epRatiosChangeEmitter.emit(t)}async computeStatWeights(t,e,s,i,a){return await this.sim.statWeights(this,e,s,i,a)}getCurrentStats(){return N.clone(this.currentStats)}setCurrentStats(t,e){this.currentStats=e,this.currentStatsEmitter.emit(t)}getMetadata(){return this.metadata}getPetMetadatas(){return this.petMetadatas}async updateMetadata(){const t=this.metadata.update(this.currentStats.metadata),e=this.petMetadatas.update(this.currentStats.pets.map((t=>t.metadata))),s=await t,i=await e;return s||i}getName(){return this.name}setName(t,e){e!=this.name&&(this.name=e,this.nameChangeEmitter.emit(t))}getLabel(){return this.party?`${this.name} (#${this.getRaidIndex()+1})`:this.name}getRace(){return this.race}setRace(t,e){e!=this.race&&(this.race=e,this.raceChangeEmitter.emit(t))}getLevel(){return this.level}setLevel(t,e){e!=this.level&&(this.level=e,this.levelChangeEmitter.emit(t))}getProfession1(){return this.profession1}setProfession1(t,e){e!=this.profession1&&(this.profession1=e,this.professionChangeEmitter.emit(t))}getProfession2(){return this.profession2}setProfession2(t,e){e!=this.profession2&&(this.profession2=e,this.professionChangeEmitter.emit(t))}getProfessions(){return[this.profession1,this.profession2].filter((t=>t!=F.ProfessionUnknown))}setProfessions(t,e){c.freezeAllAndDo((()=>{this.setProfession1(t,e[0]||F.ProfessionUnknown),this.setProfession2(t,e[1]||F.ProfessionUnknown)}))}hasProfession(t){return this.getProfessions().includes(t)}isBlacksmithing(){return this.hasProfession(F.Blacksmithing)}getFaction(){return W[this.getRace()]}getBuffs(){return y.clone(this.buffs)}setBuffs(t,e){y.equals(this.buffs,e)||(this.buffs=y.clone(e),this.buffsChangeEmitter.emit(t))}getConsumes(){return P.clone(this.consumes)}setConsumes(t,e){P.equals(this.consumes,e)||(this.consumes=P.clone(e),this.consumesChangeEmitter.emit(t))}canDualWield2H(){return!1}equipItem(t,e,s){this.setGear(t,this.gear.withEquippedItem(e,s,this.canDualWield2H()))}getEquippedItem(t){return this.gear.getEquippedItem(t)}getGear(){return this.gear}setGear(t,e){e.equals(this.gear)||(this.gear=e,this.gearChangeEmitter.emit(t))}getEnableItemSwap(){return this.enableItemSwap}setEnableItemSwap(t,e){e!=this.enableItemSwap&&(this.enableItemSwap=e,this.itemSwapChangeEmitter.emit(t))}getItemSwapGear(){return this.itemSwapGear}setItemSwapGear(t,e){e.equals(this.itemSwapGear)||(this.itemSwapGear=e,this.itemSwapChangeEmitter.emit(t))}getBonusStats(){return this.bonusStats}setBonusStats(t,e){e.equals(this.bonusStats)||(this.bonusStats=e,this.bonusStatsChangeEmitter.emit(t))}getMeleeCritCapInfo(){const t=(this.currentStats.finalStats?.stats[i.StatMeleeCrit]||0)/O,e=(this.currentStats.finalStats?.stats[i.StatMeleeHit]||0)/H,s=(this.currentStats.finalStats?.stats[i.StatExpertise]||0)/q/4,a=void 0!==this.getGear().getEquippedItem(D.ItemSlotOffHand)?.item.weaponSpeed,n=a&&this.spec!=B.SpecWarrior?27:8,o=this.getInFrontOfTarget()?14:0,l=6.5+o,r=Math.max(n-e,0),c=Math.max(6.5-s,0)+Math.max(o-s,0);let d=0;if(this.spec===B.SpecEnhancementShaman){d=3*this.getTalents().elementalDevastation}this.sim.raid.getDebuffs();const h=80.8-r-c-d;return{meleeCrit:t,meleeHit:e,expertise:s,suppression:4.8,glancing:24,debuffCrit:0,hasOffhandWeapon:a,meleeHitCap:n,expertiseCap:l,remainingMeleeHitCap:r,remainingExpertiseCap:c,baseCritCap:h,specSpecificOffset:d,playerCritCapDelta:t-h+0}}getMeleeCritCap(){return this.getMeleeCritCapInfo().playerCritCapDelta}getSimpleRotation(){const t=this.aplRotation.simple?.specRotationJson||"";if(!t)return this.specTypeFunctions.rotationCreate();try{const e=JSON.parse(t);return this.specTypeFunctions.rotationFromJson(e)}catch(e){return console.warn(`Error parsing rotation spec options: ${e}\n\nSpec options: '${t}'`),this.specTypeFunctions.rotationCreate()}}setSimpleRotation(t,e){this.specTypeFunctions.rotationEquals(e,this.getSimpleRotation())||(this.aplRotation.simple||(this.aplRotation.simple=z.create()),this.aplRotation.simple.specRotationJson=JSON.stringify(this.specTypeFunctions.rotationToJson(e)),this.rotationChangeEmitter.emit(t))}getSimpleCooldowns(){return j.clone(this.aplRotation.simple?.cooldowns||j.create())}setSimpleCooldowns(t,e){j.equals(this.getSimpleCooldowns(),e)||(this.aplRotation.simple||(this.aplRotation.simple=z.create()),this.aplRotation.simple.cooldowns=e,this.rotationChangeEmitter.emit(t))}setAplRotation(t,e){T.equals(e,this.aplRotation)||(this.aplRotation=T.clone(e),this.rotationChangeEmitter.emit(t))}getRotationType(){return this.aplRotation.type==$.TypeUnknown?$.TypeAPL:this.aplRotation.type}hasSimpleRotationGenerator(){return null!=this.simpleRotationGenerator}getResolvedAplRotation(){const t=this.getRotationType();if(t==$.TypeAuto&&this.autoRotationGenerator){const t=T.clone(this.autoRotationGenerator(this));return t.type=$.TypeAuto,t}if(t==$.TypeSimple&&this.simpleRotationGenerator){const t=this.getSimpleRotation(),e=T.clone(this.simpleRotationGenerator(this,t,this.getSimpleCooldowns()));return e.simple=this.aplRotation.simple,e.type=$.TypeSimple,e}return this.aplRotation}getTalents(){return null==this.talents&&(this.talents=ya(this.spec,this.talentsString)),this.talents}getTalentsString(){return this.talentsString}setTalentsString(t,e){e!=this.talentsString&&(this.talentsString=e,this.talents=null,this.talentsChangeEmitter.emit(t))}getTalentTree(){return G(this.getTalentsString())}getTalentTreePoints(){return K(this.getTalentsString())}getTalentTreeIcon(){return A(this.spec,this.getTalentsString())}getSpecOptions(){return this.specTypeFunctions.optionsCopy(this.specOptions)}setSpecOptions(t,e){this.specTypeFunctions.optionsEquals(e,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(e),this.specOptionsChangeEmitter.emit(t))}getReactionTime(){return this.reactionTime}setReactionTime(t,e){e!=this.reactionTime&&(this.reactionTime=e,this.miscOptionsChangeEmitter.emit(t))}getChannelClipDelay(){return this.channelClipDelay}setChannelClipDelay(t,e){e!=this.channelClipDelay&&(this.channelClipDelay=e,this.miscOptionsChangeEmitter.emit(t))}getInFrontOfTarget(){return this.inFrontOfTarget}setInFrontOfTarget(t,e){e!=this.inFrontOfTarget&&(this.inFrontOfTarget=e,this.inFrontOfTargetChangeEmitter.emit(t))}getDistanceFromTarget(){return this.distanceFromTarget}setDistanceFromTarget(t,e){e!=this.distanceFromTarget&&(this.distanceFromTarget=e,this.distanceFromTargetChangeEmitter.emit(t))}setDefaultHealingParams(t){var e=this.sim.encounter.primaryTarget,s=e.dualWield;0==t.cadenceSeconds&&(t.cadenceSeconds=1.5*e.swingSpeed,s&&(t.cadenceSeconds/=2)),0==t.hps&&(t.hps=.175*e.minBaseDamage/e.swingSpeed,s&&(t.hps*=1.5))}enableHealing(){this.healingEnabled=!0;var t=this.getHealingModel();0!=t.cadenceSeconds&&0!=t.hps||(this.setDefaultHealingParams(t),this.setHealingModel(0,t))}getHealingModel(){return _.clone(this.healingModel)}setHealingModel(t,e){_.equals(this.healingModel,e)||(this.healingModel=_.clone(e),this.healingEnabled&&this.setDefaultHealingParams(this.healingModel),this.healingModelChangeEmitter.emit(t))}computeStatsEP(t){return null==t?0:t.computeEP(this.epWeights)}computeEnchantEP(t){if(this.enchantEPCache.has(t.effectId))return this.enchantEPCache.get(t.effectId);let e=this.computeStatsEP(new oa(t.stats));return this.enchantEPCache.set(t.effectId,e),e}computeRandomSuffixEP(t){if(this.randomSuffixEPCache.has(t.id))return this.randomSuffixEPCache.get(t.id);let e=this.computeStatsEP(new oa(t.stats));return this.randomSuffixEPCache.set(t.id,e),e}computeItemEP(t,e){if(null==t)return 0;let s=this.itemEPCache[e].get(t.id);if(void 0!==s)return s;let i=new oa(t.stats);if(t.weaponSpeed>0){const s=J(t);e==D.ItemSlotMainHand?i=i.withPseudoStat(a.PseudoStatMainHandDps,s):e==D.ItemSlotOffHand?i=i.withPseudoStat(a.PseudoStatOffHandDps,s):e==D.ItemSlotRanged&&(i=i.withPseudoStat(a.PseudoStatRangedDps,s))}let n=0;if(t.randomSuffixOptions.length>0){const e=t.randomSuffixOptions.map((t=>this.computeRandomSuffixEP(this.sim.db.getRandomSuffixById(t))));n=Math.max(...e)}let o=i.computeEP(this.epWeights)+n;return t.unique&&(o-=.01),this.itemEPCache[e].set(t.id,o),o}setWowheadData(t,e){const s=[],i=ot(),a=i?i+".":"";s.push(`domain=${a}classic`),null!=t.enchant&&s.push("ench="+t.enchant.effectId),s.push("pcs="+this.gear.asArray().filter((t=>null!=t)).map((t=>t.item.id)).join(":")),e.dataset.wowhead=s.join("&"),e.dataset.whtticon="false"}filterItemData(t,e,s){const i=this.sim.getFilters(),a=(t,s)=>t.filter((t=>s(e(t))));i.factionRestriction!=Z.UNSPECIFIED&&(t=a(t,(t=>t.factionRestriction==i.factionRestriction||t.factionRestriction==Z.UNSPECIFIED))),i.sources.includes(Y.SourceCrafting)||(t=a(t,(t=>!t.sources.some((t=>"crafted"==t.source.oneofKind))))),i.sources.includes(Y.SourceQuest)||(t=a(t,(t=>!t.sources.some((t=>"quest"==t.source.oneofKind)))));for(const[n,o]of Object.entries(_a.RAID_IDS)){const e=parseInt(n);i.raids.includes(e)||(t=a(t,(t=>!t.sources.some((t=>"drop"==t.source.oneofKind&&t.source.drop.zoneId==o)))))}return _a.ARMOR_SLOTS.includes(s)?t=a(t,(t=>!!i.armorTypes.includes(t.armorType))):_a.WEAPON_SLOTS.includes(s)?t=a(t,(t=>{if(!i.weaponTypes.includes(t.weaponType))return!1;if(!i.oneHandedWeapons&&t.handType!=nt.HandTypeTwoHand)return!1;if(!i.twoHandedWeapons&&t.handType==nt.HandTypeTwoHand)return!1;const e=s==D.ItemSlotMainHand?i.minMhWeaponSpeed:i.minOhWeaponSpeed,a=s==D.ItemSlotMainHand?i.maxMhWeaponSpeed:i.maxOhWeaponSpeed;return!(e>0&&t.weaponSpeed<e)&&!(a>0&&t.weaponSpeed>a)})):s==D.ItemSlotRanged&&(t=a(t,(t=>{if(!i.rangedWeaponTypes.includes(t.rangedWeaponType))return!1;const e=i.minRangedWeaponSpeed,s=i.maxRangedWeaponSpeed;return!(e>0&&t.weaponSpeed<e)&&!(s>0&&t.weaponSpeed>s)}))),t}filterEnchantData(t,e,s,i){return i?t.filter((t=>{const s=e(t);return!!X(s,i.item)})):t}makeUnitReference(){return null==this.party?Q():tt(this.getRaidIndex())}toDatabase(){const t=this.getGear().toDatabase(),e=this.getItemSwapGear().toDatabase();return et.mergeSimDatabases(t,e)}toProto(t,e,s){const i=t=>!s||0==s.length||s.includes(t),a=this.getGear(),n=e?this.getResolvedAplRotation():this.aplRotation;let o=h.create({class:this.getClass(),database:t?void 0:this.toDatabase()});return i(Ua.Gear)&&h.mergePartial(o,{equipment:a.asSpec(),bonusStats:this.getBonusStats().toProto(),enableItemSwap:this.getEnableItemSwap(),itemSwap:this.getItemSwapGear().toProto()}),i(Ua.Talents)&&h.mergePartial(o,{talentsString:this.getTalentsString()}),i(Ua.Rotation)&&h.mergePartial(o,{cooldowns:j.create({hpPercentForDefensives:this.getSimpleCooldowns().hpPercentForDefensives}),rotation:n}),i(Ua.Consumes)&&h.mergePartial(o,{consumes:this.getConsumes()}),i(Ua.Miscellaneous)&&(h.mergePartial(o,{name:this.getName(),race:this.getRace(),level:this.getLevel(),profession1:this.getProfession1(),profession2:this.getProfession2(),reactionTimeMs:this.getReactionTime(),channelClipDelayMs:this.getChannelClipDelay(),inFrontOfTarget:this.getInFrontOfTarget(),distanceFromTarget:this.getDistanceFromTarget(),healingModel:this.getHealingModel()}),o=st(this.spec,o,this.getSpecOptions())),i(Ua.External)&&h.mergePartial(o,{buffs:this.getBuffs()}),o}fromProto(t,e,s){const i=t=>!s||0==s.length||s.includes(t);e.rotation?.type==$.TypeLegacy&&(e.rotation.type=$.TypeAuto),c.freezeAllAndDo((()=>{i(Ua.Gear)&&(this.setGear(t,e.equipment?this.sim.db.lookupEquipmentSpec(e.equipment):new C({})),this.setEnableItemSwap(t,e.enableItemSwap),this.setItemSwapGear(t,e.itemSwap?this.sim.db.lookupItemSwap(e.itemSwap):new k({})),this.setBonusStats(t,oa.fromProto(e.bonusStats||l.create()))),i(Ua.Talents)&&this.setTalentsString(t,e.talentsString),i(Ua.Rotation)&&(e.rotation?.type!=$.TypeUnknown&&e.rotation?.type!=$.TypeLegacy||(e.rotation||(e.rotation=T.create()),e.rotation.type=$.TypeAuto),this.setAplRotation(t,e.rotation||T.create())),i(Ua.Consumes)&&this.setConsumes(t,e.consumes||P.create()),i(Ua.Miscellaneous)&&(this.setSpecOptions(t,this.specTypeFunctions.optionsFromPlayer(e)),this.setName(t,e.name),this.setLevel(t,e.level),this.setRace(t,e.race),this.setProfession1(t,e.profession1),this.setProfession2(t,e.profession2),this.setReactionTime(t,e.reactionTimeMs),this.setChannelClipDelay(t,e.channelClipDelayMs),this.setInFrontOfTarget(t,e.inFrontOfTarget),this.setDistanceFromTarget(t,e.distanceFromTarget),this.setHealingModel(t,e.healingModel||_.create())),i(Ua.External)&&this.setBuffs(t,e.buffs||y.create())}))}clone(t){const e=new _a(this.spec,this.sim);return e.fromProto(t,this.toProto()),e}applySharedDefaults(t){c.freezeAllAndDo((()=>{this.setEnableItemSwap(t,!1),this.setItemSwapGear(t,new k({})),this.setReactionTime(t,200),this.setInFrontOfTarget(t,it(this.spec)),this.setHealingModel(t,_.create({burstWindow:it(this.spec)?6:0})),this.setSimpleCooldowns(t,j.create({hpPercentForDefensives:it(this.spec)?.35:0})),this.setBonusStats(t,new oa),this.setAplRotation(t,T.create({type:$.TypeAuto}))}))}};let Na=_a;e(Na,"numEpRatios",6),e(Na,"ARMOR_SLOTS",[D.ItemSlotHead,D.ItemSlotShoulder,D.ItemSlotChest,D.ItemSlotWrist,D.ItemSlotHands,D.ItemSlotLegs,D.ItemSlotWaist,D.ItemSlotFeet]),e(Na,"WEAPON_SLOTS",[D.ItemSlotMainHand,D.ItemSlotOffHand]),e(Na,"RAID_IDS",{});class La{constructor(t){e(this,"sim"),e(this,"duration",60),e(this,"durationVariation",5),e(this,"executeProportion20",.2),e(this,"executeProportion25",.25),e(this,"executeProportion35",.35),e(this,"useHealth",!1),e(this,"targets"),e(this,"targetsMetadata"),e(this,"presetTargets"),e(this,"targetsChangeEmitter",new c),e(this,"durationChangeEmitter",new c),e(this,"executeProportionChangeEmitter",new c),e(this,"changeEmitter",new c),this.sim=t,t.waitForInit().then((()=>{this.presetTargets=t.db.getAllPresetTargets(),this.targets=[this.presetTargets[0].target]})),this.targetsMetadata=new Ca,[this.targetsChangeEmitter,this.durationChangeEmitter,this.executeProportionChangeEmitter].forEach((t=>t.on((t=>this.changeEmitter.emit(t)))))}get primaryTarget(){return lt.clone(this.targets[0])}getDurationVariation(){return this.durationVariation}setDurationVariation(t,e){e!=this.durationVariation&&(this.durationVariation=e,this.durationChangeEmitter.emit(t))}getDuration(){return this.duration}setDuration(t,e){e!=this.duration&&(this.duration=e,this.durationChangeEmitter.emit(t))}getExecuteProportion20(){return this.executeProportion20}setExecuteProportion20(t,e){e!=this.executeProportion20&&(this.executeProportion20=e,this.executeProportionChangeEmitter.emit(t))}getExecuteProportion25(){return this.executeProportion25}setExecuteProportion25(t,e){e!=this.executeProportion25&&(this.executeProportion25=e,this.executeProportionChangeEmitter.emit(t))}getExecuteProportion35(){return this.executeProportion35}setExecuteProportion35(t,e){e!=this.executeProportion35&&(this.executeProportion35=e,this.executeProportionChangeEmitter.emit(t))}getUseHealth(){return this.useHealth}setUseHealth(t,e){e!=this.useHealth&&(this.useHealth=e,this.durationChangeEmitter.emit(t),this.executeProportionChangeEmitter.emit(t))}matchesPreset(t){return t.targets.length==this.targets.length&&this.targets.every(((e,s)=>lt.equals(e,t.targets[s].target)))}applyPreset(t,e){this.targets=e.targets.map((t=>t.target||lt.create())),this.targetsChangeEmitter.emit(t)}applyPresetTarget(t,e,s){this.targets[s]=e.target||lt.create(),this.targetsChangeEmitter.emit(t)}toProto(){return rt.create({duration:this.duration,durationVariation:this.durationVariation,executeProportion20:this.executeProportion20,executeProportion25:this.executeProportion25,executeProportion35:this.executeProportion35,useHealth:this.useHealth,targets:this.targets})}fromProto(t,e){c.freezeAllAndDo((()=>{this.setDuration(t,e.duration),this.setDurationVariation(t,e.durationVariation),this.setExecuteProportion20(t,e.executeProportion20),this.setExecuteProportion25(t,e.executeProportion25),this.setExecuteProportion35(t,e.executeProportion35),this.setUseHealth(t,e.useHealth),this.targets=e.targets,this.targetsChangeEmitter.emit(t)}))}applyDefaults(t){this.fromProto(t,rt.create({duration:60,durationVariation:5,executeProportion20:.2,executeProportion25:.25,executeProportion35:.35,targets:[this.presetTargets[0].target]}))}static defaultTargetProto(){return lt.create({level:ct,mobType:dt.MobTypeGiant,tankIndex:0,swingSpeed:2,minBaseDamage:65e3,dualWield:!1,dualWieldPenalty:!1,parryHaste:!0,spellSchool:ht.SpellSchoolPhysical,stats:oa.fromMap({[i.StatArmor]:3731,[i.StatAttackPower]:805,[i.StatBlockValue]:76}).asArray(),targetInputs:new Array(0)})}}const Ra=8;class Da{constructor(t){e(this,"buffs",mt.create()),e(this,"debuffs",ut.create()),e(this,"tanks",[]),e(this,"targetDummies",0),e(this,"numActiveParties",5),e(this,"compChangeEmitter",new c),e(this,"buffsChangeEmitter",new c),e(this,"debuffsChangeEmitter",new c),e(this,"tanksChangeEmitter",new c),e(this,"targetDummiesChangeEmitter",new c),e(this,"numActivePartiesChangeEmitter",new c),e(this,"changeEmitter"),e(this,"parties"),e(this,"activePlayers"),e(this,"sim"),this.sim=t,this.parties=[...Array(8).keys()].map((e=>{const s=new ra(this,t);return s.compChangeEmitter.on((t=>this.compChangeEmitter.emit(t))),s.changeEmitter.on((t=>this.changeEmitter.emit(t))),s})),this.activePlayers=[],this.numActivePartiesChangeEmitter.on((t=>this.compChangeEmitter.emit(t))),this.changeEmitter=c.onAny([this.compChangeEmitter,this.buffsChangeEmitter,this.debuffsChangeEmitter,this.tanksChangeEmitter,this.targetDummiesChangeEmitter],"RaidChange"),this.changeEmitter.on((()=>{this.activePlayers=[]}))}size(){return f(this.parties.map((t=>t.size())))}isEmpty(){return 0==this.size()}getParties(){return this.parties.slice()}getParty(t){return this.parties[t]}getPlayers(){return this.parties.map((t=>t.getPlayers())).flat()}getPlayer(t){if(-1===t)return null;return this.parties[Math.floor(t/5)].getPlayer(t%5)}getPlayerFromUnitReference(t,e){return t&&t.type!=pt.Unknown?t.type==pt.Player?this.getPlayer(t.index):t.type==pt.Self&&e||null:null}setPlayer(t,e,s){this.parties[Math.floor(e/5)].setPlayer(t,e%5,s)}getClassCount(t){return this.getPlayers().filter((e=>null!=e&&e.getClass()==t)).length}getBuffs(){return mt.clone(this.buffs)}setBuffs(t,e){mt.equals(this.buffs,e)||(this.buffs=mt.clone(e),this.buffsChangeEmitter.emit(t))}getDebuffs(){return ut.clone(this.debuffs)}setDebuffs(t,e){ut.equals(this.debuffs,e)||(this.debuffs=ut.clone(e),this.debuffsChangeEmitter.emit(t))}getTanks(){return this.tanks.map((t=>gt.clone(t)))}setTanks(t,e){this.tanks.length==e.length&&this.tanks.every(((t,s)=>gt.equals(t,e[s])))||(this.tanks=e.map((t=>gt.clone(t))),this.tanksChangeEmitter.emit(t))}getTargetDummies(){return this.targetDummies}setTargetDummies(t,e){this.targetDummies!=e&&(this.targetDummies=e,this.targetDummiesChangeEmitter.emit(t))}getNumActiveParties(){return this.numActiveParties}setNumActiveParties(t,e){e!=this.numActiveParties&&e>0&&(this.numActiveParties=e,this.numActivePartiesChangeEmitter.emit(t))}getActivePlayers(){if(0==this.activePlayers.length){const t=this.getParties().filter(((t,e)=>e<this.numActiveParties));this.activePlayers=t.map((t=>t.getPlayers())).flat().filter((t=>null!=t))}return this.activePlayers}toProto(t,e){return ft.create({parties:this.parties.map((s=>s.toProto(t,e))),buffs:this.getBuffs(),debuffs:this.getDebuffs(),tanks:this.getTanks(),targetDummies:this.getTargetDummies(),numActiveParties:this.getNumActiveParties()})}fromProto(t,e){c.freezeAllAndDo((()=>{this.setBuffs(t,e.buffs||mt.create()),this.setDebuffs(t,e.debuffs||ut.create()),this.setTanks(t,e.tanks),this.setTargetDummies(t,e.targetDummies),this.setNumActiveParties(t,e.numActiveParties||5);for(let s=0;s<8;s++)e.parties[s]?this.parties[s].fromProto(t,e.parties[s]):this.parties[s].clear(t)}))}clear(t){c.freezeAllAndDo((()=>{for(let e=0;e<8;e++)this.parties[e].clear(t)}))}}const Aa=`/${Ct}/sim_worker.js`;class Va{constructor(t){e(this,"workers"),this.workers=[];for(let e=0;e<t;e++)this.workers.push(new Ma)}getLeastBusyWorker(){return this.workers.reduce(((t,e)=>t.numTasksRunning<e.numTasksRunning?t:e))}async makeApiCall(t,e){return await this.getLeastBusyWorker().doApiCall(t,e,"")}async computeStats(t){const e=await this.makeApiCall("computeStats",It.toBinary(t));return wt.fromBinary(e)}async statWeightsAsync(t,e){console.log("Stat weights request: "+bt.toJsonString(t));const s=this.getLeastBusyWorker(),i=s.makeTaskId();s.addPromiseFunc(i+"progress",this.newProgressHandler(i,s,e),(t=>{}));const a=await s.doApiCall("statWeightsAsync",bt.toBinary(t),i),n=xt.fromBinary(a);return console.log("Stat weights result: "+vt.toJsonString(n.finalWeightResult)),n.finalWeightResult}async bulkSimAsync(t,e){console.log("bulk sim request: "+Et.toJsonString(t,{enumAsInteger:!0}));const s=this.getLeastBusyWorker(),i=s.makeTaskId();s.addPromiseFunc(i+"progress",this.newProgressHandler(i,s,e),(t=>{}));const a=await s.doApiCall("bulkSimAsync",Et.toBinary(t),i),n=xt.fromBinary(a),o=St.toJson(n.finalBulkResult);return console.log("bulk sim result: "+JSON.stringify(o)),n.finalBulkResult}async raidSimAsync(t,e){console.log("Raid sim request: "+yt.toJsonString(t));const s=this.getLeastBusyWorker(),i=s.makeTaskId();s.addPromiseFunc(i+"progress",this.newProgressHandler(i,s,e),(t=>{}));const a=await s.doApiCall("raidSimAsync",yt.toBinary(t),i),n=xt.fromBinary(a),o=Pt.toJson(n.finalRaidResult);return delete o.logs,console.log("Raid sim result: "+JSON.stringify(o)),n.finalRaidResult}newProgressHandler(t,e,s){return i=>{var a=xt.fromBinary(i);s(a),null==a.finalRaidResult&&null==a.finalWeightResult&&e.addPromiseFunc(t+"progress",this.newProgressHandler(t,e,s),(t=>{}))}}}class Ma{constructor(){e(this,"numTasksRunning"),e(this,"taskIdsToPromiseFuncs"),e(this,"worker"),e(this,"onReady"),this.numTasksRunning=0,this.taskIdsToPromiseFuncs={},this.worker=new window.Worker(Aa);let t=null;this.onReady=new Promise(((e,s)=>{t=e})),this.worker.onmessage=e=>{if("ready"==e.data.msg)this.worker.postMessage({msg:"setID",id:"1"}),t();else if("idconfirm"==e.data.msg);else{const t=e.data.id;if(!this.taskIdsToPromiseFuncs[t])return void console.warn("Unrecognized result id: "+t);const s=this.taskIdsToPromiseFuncs[t];delete this.taskIdsToPromiseFuncs[t],this.numTasksRunning--,s[0](e.data.outputData)}}}addPromiseFunc(t,e,s){this.taskIdsToPromiseFuncs[t]=[e,s]}makeTaskId(){let t="";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<16;s++)t+=e.charAt(Math.floor(62*Math.random()));return t}async doApiCall(t,e,s){this.numTasksRunning++,await this.onReady;const i=new Promise(((i,a)=>{s||(s=this.makeTaskId()),this.taskIdsToPromiseFuncs[s]=[i,a],this.worker.postMessage({msg:t,id:s,inputData:e})}));return await i}}var Ua=(t=>(t[t.Gear=0]="Gear",t[t.Talents=1]="Talents",t[t.Rotation=2]="Rotation",t[t.Consumes=3]="Consumes",t[t.Miscellaneous=4]="Miscellaneous",t[t.External=5]="External",t[t.Encounter=6]="Encounter",t[t.UISettings=7]="UISettings",t))(Ua||{});const Fa=class{constructor(){e(this,"workerPool"),e(this,"iterations",3e3),e(this,"phase",kt),e(this,"faction",Tt.Alliance),e(this,"fixedRngSeed",0),e(this,"filters",Fa.defaultFilters()),e(this,"showDamageMetrics",!0),e(this,"showThreatMetrics",!1),e(this,"showHealingMetrics",!1),e(this,"showExperimental",!1),e(this,"showEPValues",!1),e(this,"language",""),e(this,"raid"),e(this,"encounter"),e(this,"db_",null),e(this,"iterationsChangeEmitter",new c),e(this,"phaseChangeEmitter",new c),e(this,"factionChangeEmitter",new c),e(this,"fixedRngSeedChangeEmitter",new c),e(this,"lastUsedRngSeedChangeEmitter",new c),e(this,"filtersChangeEmitter",new c),e(this,"showDamageMetricsChangeEmitter",new c),e(this,"showThreatMetricsChangeEmitter",new c),e(this,"showHealingMetricsChangeEmitter",new c),e(this,"showExperimentalChangeEmitter",new c),e(this,"showEPValuesChangeEmitter",new c),e(this,"languageChangeEmitter",new c),e(this,"crashEmitter",new c),e(this,"settingsChangeEmitter"),e(this,"unitMetadataEmitter",new c("UnitMetadata")),e(this,"changeEmitter"),e(this,"simResultEmitter",new c),e(this,"bulkSimStartEmitter",new c),e(this,"bulkSimResultEmitter",new c),e(this,"_initPromise"),e(this,"lastUsedRngSeed",0),e(this,"modifyRaidProto",(()=>{})),this.workerPool=new Va(1),this._initPromise=et.get().then((t=>{this.db_=t})),this.raid=new Da(this),this.encounter=new La(this),this.settingsChangeEmitter=c.onAny([this.iterationsChangeEmitter,this.phaseChangeEmitter,this.fixedRngSeedChangeEmitter,this.filtersChangeEmitter,this.showDamageMetricsChangeEmitter,this.showThreatMetricsChangeEmitter,this.showHealingMetricsChangeEmitter,this.showExperimentalChangeEmitter,this.showEPValuesChangeEmitter,this.languageChangeEmitter]),this.changeEmitter=c.onAny([this.settingsChangeEmitter,this.raid.changeEmitter,this.encounter.changeEmitter]),c.onAny([this.raid.changeEmitter,this.encounter.changeEmitter]).on((t=>this.updateCharacterStats(t)))}waitForInit(){return this._initPromise}get db(){return this.db_}setModifyRaidProto(t){this.modifyRaidProto=t}getModifiedRaidProto(){const t=this.raid.toProto(!1,!0);return this.modifyRaidProto(t),t.parties.forEach((t=>{t.players.forEach((t=>{t.equipment&&this.db.lookupEquipmentSpec(t.equipment)}))})),t}makeRaidSimRequest(t){const e=this.getModifiedRaidProto(),s=this.encounter.toProto();return yt.create({raid:e,encounter:s,simOptions:_t.create({iterations:t?1:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debugFirstIteration:!0})})}async runBulkSim(t,e,s){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const i=Et.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:t});if(null!=i.baseSettings&&null!=i.baseSettings.simOptions&&(i.baseSettings.simOptions.debugFirstIteration=!1),!i.baseSettings?.raid||0==i.baseSettings?.raid?.parties.length||0==i.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const a=i.baseSettings.raid.parties[0].players[0].database;a?.items.push(...e.items),a?.enchants.push(...e.enchants),this.bulkSimStartEmitter.emit(c.nextEventID(),i);var n=await this.workerPool.bulkSimAsync(i,s);if(""!=n.errorResult)throw new Oa(n.errorResult);return this.bulkSimResultEmitter.emit(c.nextEventID(),n),n}async runRaidSim(t,e){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const s=this.makeRaidSimRequest(!1);var i=await this.workerPool.raidSimAsync(s,e);if(""!=i.errorResult)throw new Oa(i.errorResult);const a=await Nt.makeNew(s,i);return this.simResultEmitter.emit(t,a),a}async runRaidSimWithLogs(t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const e=this.makeRaidSimRequest(!0),s=await this.workerPool.raidSimAsync(e,(()=>{}));if(""!=s.errorResult)throw new Oa(s.errorResult);const i=await Nt.makeNew(e,s);return this.simResultEmitter.emit(t,i),i}async updateCharacterStats(t){if(0==t)return;t=c.nextEventID(),await this.waitForInit();const e=this.raid.getPlayers(),s=It.create({raid:this.getModifiedRaidProto(),encounter:this.encounter.toProto()}),i=await this.workerPool.computeStats(s);""==i.errorResult?c.freezeAllAndDo((async()=>{const s=i.raidStats.parties.map(((s,i)=>s.players.map(((s,a)=>{const n=e[5*i+a];return n?(n.setCurrentStats(t,s),n.updateMetadata()):null})))).flat().filter((t=>null!=t)),a=this.encounter.targetsMetadata.update(i.encounterStats.targets.map((t=>t.metadata)));(await Promise.all(s.concat([a]))).some((t=>t))&&this.unitMetadataEmitter.emit(t)})):this.crashEmitter.emit(t,new Oa(i.errorResult))}async statWeights(t,e,s,i,a){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");if(await this.waitForInit(),null==t.getParty())return console.warn("Trying to get stat weights without a party!"),vt.create();{const n=this.raid.getTanks().map((t=>t.index)).includes(t.getRaidIndex())?[gt.create({type:pt.Player,index:0})]:[],o=bt.create({player:t.toProto(!1,!0),raidBuffs:this.raid.getBuffs(),partyBuffs:t.getParty().getBuffs(),debuffs:this.raid.getDebuffs(),encounter:this.encounter.toProto(),simOptions:_t.create({iterations:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debug:!1}),tanks:n,statsToWeigh:e,pseudoStatsToWeigh:s,epReferenceStat:i});return await this.workerPool.statWeightsAsync(o,a)}}getUnitMetadata(t,e,s){if(!t||t.type==pt.Unknown)return this.getUnitMetadata(s,e,s);if(t.type==pt.Player)return this.raid.getPlayerFromUnitReference(t)?.getMetadata();if(t.type==pt.Target)return this.encounter.targetsMetadata.asList()[t.index];if(t.type==pt.Pet){const s=this.raid.getPlayerFromUnitReference(t.owner,e);return s?s.getPetMetadatas().asList()[t.index]:void 0}return t.type==pt.Self?e?.getMetadata():t.type==pt.CurrentTarget?this.encounter.targetsMetadata.asList()[0]:void 0}getPhase(){return this.phase}setPhase(t,e){e!=this.phase&&e>0&&(this.phase=e,this.phaseChangeEmitter.emit(t))}getFaction(){return this.faction}setFaction(t,e){e!=this.faction&&e&&(this.faction=e,this.factionChangeEmitter.emit(t))}getFixedRngSeed(){return this.fixedRngSeed}setFixedRngSeed(t,e){e!=this.fixedRngSeed&&(this.fixedRngSeed=e,this.fixedRngSeedChangeEmitter.emit(t))}nextRngSeed(){let t=0;return t=this.fixedRngSeed?this.fixedRngSeed:Math.floor(Math.random()*Fa.MAX_RNG_SEED),this.lastUsedRngSeed=t,this.lastUsedRngSeedChangeEmitter.emit(c.nextEventID()),t}getLastUsedRngSeed(){return this.lastUsedRngSeed}getFilters(){return Lt.clone(this.filters)}setFilters(t,e){Lt.equals(e,this.filters)||(this.filters=Lt.clone(e),this.filtersChangeEmitter.emit(t))}getShowDamageMetrics(){return this.showDamageMetrics}setShowDamageMetrics(t,e){e!=this.showDamageMetrics&&(this.showDamageMetrics=e,this.showDamageMetricsChangeEmitter.emit(t))}getShowThreatMetrics(){return this.showThreatMetrics}setShowThreatMetrics(t,e){e!=this.showThreatMetrics&&(this.showThreatMetrics=e,this.showThreatMetricsChangeEmitter.emit(t))}getShowHealingMetrics(){return this.showHealingMetrics}setShowHealingMetrics(t,e){e!=this.showHealingMetrics&&(this.showHealingMetrics=e,this.showHealingMetricsChangeEmitter.emit(t))}getShowExperimental(){return this.showExperimental}setShowExperimental(t,e){e!=this.showExperimental&&(this.showExperimental=e,this.showExperimentalChangeEmitter.emit(t))}getShowEPValues(){return this.showEPValues}setShowEPValues(t,e){e!=this.showEPValues&&(this.showEPValues=e,this.showEPValuesChangeEmitter.emit(t))}getLanguage(){return this.language}setLanguage(t,e){(e=e||Rt())!=this.language&&(this.language=e,Dt(this.language),this.languageChangeEmitter.emit(t))}getIterations(){return this.iterations}setIterations(t,e){e!=this.iterations&&(this.iterations=e,this.iterationsChangeEmitter.emit(t))}toProto(){const t=this.getFilters();return t.armorTypes.length==Fa.ALL_ARMOR_TYPES.length&&(t.armorTypes=[]),t.weaponTypes.length==Fa.ALL_WEAPON_TYPES.length&&(t.weaponTypes=[]),t.rangedWeaponTypes.length==Fa.ALL_RANGED_WEAPON_TYPES.length&&(t.rangedWeaponTypes=[]),t.sources.length==Fa.ALL_SOURCES.length&&(t.sources=[]),t.raids.length==Fa.ALL_RAIDS.length&&(t.raids=[]),At.create({iterations:this.getIterations(),phase:this.getPhase(),fixedRngSeed:BigInt(this.getFixedRngSeed()),showDamageMetrics:this.getShowDamageMetrics(),showThreatMetrics:this.getShowThreatMetrics(),showHealingMetrics:this.getShowHealingMetrics(),showExperimental:this.getShowExperimental(),showEpValues:this.getShowEPValues(),language:this.getLanguage(),faction:this.getFaction(),filters:t})}fromProto(t,e){c.freezeAllAndDo((()=>{this.setIterations(t,e.iterations||3e3),this.setPhase(t,e.phase||kt),this.setFixedRngSeed(t,Number(e.fixedRngSeed)),this.setShowDamageMetrics(t,e.showDamageMetrics),this.setShowThreatMetrics(t,e.showThreatMetrics),this.setShowHealingMetrics(t,e.showHealingMetrics),this.setShowExperimental(t,e.showExperimental),this.setShowEPValues(t,e.showEpValues),this.setLanguage(t,e.language),this.setFaction(t,e.faction||Tt.Alliance);const s=e.filters||Fa.defaultFilters();0==s.armorTypes.length&&(s.armorTypes=Fa.ALL_ARMOR_TYPES.slice()),0==s.weaponTypes.length&&(s.weaponTypes=Fa.ALL_WEAPON_TYPES.slice()),0==s.rangedWeaponTypes.length&&(s.rangedWeaponTypes=Fa.ALL_RANGED_WEAPON_TYPES.slice()),0==s.sources.length&&(s.sources=Fa.ALL_SOURCES.slice()),0==s.raids.length&&(s.raids=Fa.ALL_RAIDS.slice()),this.setFilters(t,s)}))}applyDefaults(t,e,s){this.fromProto(t,At.create({iterations:3e3,phase:kt,faction:Tt.Alliance,showDamageMetrics:!s,showThreatMetrics:e,showHealingMetrics:s,language:this.getLanguage(),filters:Fa.defaultFilters(),showEpValues:!1}))}static defaultFilters(){return Lt.create({oneHandedWeapons:!0,twoHandedWeapons:!0})}};let Wa=Fa;e(Wa,"MAX_RNG_SEED",Math.pow(2,32)-1),e(Wa,"ALL_ARMOR_TYPES",s(Vt).filter((t=>0!=t))),e(Wa,"ALL_WEAPON_TYPES",s(Mt).filter((t=>0!=t))),e(Wa,"ALL_RANGED_WEAPON_TYPES",s(Ut).filter((t=>0!=t))),e(Wa,"ALL_SOURCES",s(Y).filter((t=>0!=t))),e(Wa,"ALL_RAIDS",s(Ft).filter((t=>0!=t)));class Oa extends Error{constructor(t){super(t),e(this,"errorStr"),this.errorStr=t}}var Ha={};!function(t){var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function s(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var a in i)s(i,a)&&(t[a]=i[a])}}return t},t.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,s,i,a){if(e.subarray&&t.subarray)t.set(e.subarray(s,s+i),a);else for(var n=0;n<i;n++)t[a+n]=e[s+n]},flattenChunks:function(t){var e,s,i,a,n,o;for(i=0,e=0,s=t.length;e<s;e++)i+=t[e].length;for(o=new Uint8Array(i),a=0,e=0,s=t.length;e<s;e++)n=t[e],o.set(n,a),a+=n.length;return o}},a={arraySet:function(t,e,s,i,a){for(var n=0;n<i;n++)t[a+n]=e[s+n]},flattenChunks:function(t){return[].concat.apply([],t)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(e)}(Ha);var qa={},Ba={},za={},ja=Ha,$a=0,Ga=1;function Ka(t){for(var e=t.length;--e>=0;)t[e]=0}var Ja=0,Za=29,Ya=256,Xa=Ya+1+Za,Qa=30,tn=19,en=2*Xa+1,sn=15,an=16,nn=7,on=256,ln=16,rn=17,cn=18,dn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],hn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],mn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],un=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pn=new Array(2*(Xa+2));Ka(pn);var gn=new Array(2*Qa);Ka(gn);var fn=new Array(512);Ka(fn);var In=new Array(256);Ka(In);var wn=new Array(Za);Ka(wn);var bn,xn,vn,En=new Array(Qa);function Sn(t,e,s,i,a){this.static_tree=t,this.extra_bits=e,this.extra_base=s,this.elems=i,this.max_length=a,this.has_stree=t&&t.length}function yn(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function Pn(t){return t<256?fn[t]:fn[256+(t>>>7)]}function Cn(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function kn(t,e,s){t.bi_valid>an-s?(t.bi_buf|=e<<t.bi_valid&65535,Cn(t,t.bi_buf),t.bi_buf=e>>an-t.bi_valid,t.bi_valid+=s-an):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=s)}function Tn(t,e,s){kn(t,s[2*e],s[2*e+1])}function _n(t,e){var s=0;do{s|=1&t,t>>>=1,s<<=1}while(--e>0);return s>>>1}function Nn(t,e,s){var i,a,n=new Array(sn+1),o=0;for(i=1;i<=sn;i++)n[i]=o=o+s[i-1]<<1;for(a=0;a<=e;a++){var l=t[2*a+1];0!==l&&(t[2*a]=_n(n[l]++,l))}}function Ln(t){var e;for(e=0;e<Xa;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Qa;e++)t.dyn_dtree[2*e]=0;for(e=0;e<tn;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*on]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function Rn(t){t.bi_valid>8?Cn(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function Dn(t,e,s,i){var a=2*e,n=2*s;return t[a]<t[n]||t[a]===t[n]&&i[e]<=i[s]}function An(t,e,s){for(var i=t.heap[s],a=s<<1;a<=t.heap_len&&(a<t.heap_len&&Dn(e,t.heap[a+1],t.heap[a],t.depth)&&a++,!Dn(e,i,t.heap[a],t.depth));)t.heap[s]=t.heap[a],s=a,a<<=1;t.heap[s]=i}function Vn(t,e,s){var i,a,n,o,l=0;if(0!==t.last_lit)do{i=t.pending_buf[t.d_buf+2*l]<<8|t.pending_buf[t.d_buf+2*l+1],a=t.pending_buf[t.l_buf+l],l++,0===i?Tn(t,a,e):(Tn(t,(n=In[a])+Ya+1,e),0!==(o=dn[n])&&kn(t,a-=wn[n],o),Tn(t,n=Pn(--i),s),0!==(o=hn[n])&&kn(t,i-=En[n],o))}while(l<t.last_lit);Tn(t,on,e)}function Mn(t,e){var s,i,a,n=e.dyn_tree,o=e.stat_desc.static_tree,l=e.stat_desc.has_stree,r=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=en,s=0;s<r;s++)0!==n[2*s]?(t.heap[++t.heap_len]=c=s,t.depth[s]=0):n[2*s+1]=0;for(;t.heap_len<2;)n[2*(a=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[a]=0,t.opt_len--,l&&(t.static_len-=o[2*a+1]);for(e.max_code=c,s=t.heap_len>>1;s>=1;s--)An(t,n,s);a=r;do{s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],An(t,n,1),i=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=i,n[2*a]=n[2*s]+n[2*i],t.depth[a]=(t.depth[s]>=t.depth[i]?t.depth[s]:t.depth[i])+1,n[2*s+1]=n[2*i+1]=a,t.heap[1]=a++,An(t,n,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var s,i,a,n,o,l,r=e.dyn_tree,c=e.max_code,d=e.stat_desc.static_tree,h=e.stat_desc.has_stree,m=e.stat_desc.extra_bits,u=e.stat_desc.extra_base,p=e.stat_desc.max_length,g=0;for(n=0;n<=sn;n++)t.bl_count[n]=0;for(r[2*t.heap[t.heap_max]+1]=0,s=t.heap_max+1;s<en;s++)(n=r[2*r[2*(i=t.heap[s])+1]+1]+1)>p&&(n=p,g++),r[2*i+1]=n,i>c||(t.bl_count[n]++,o=0,i>=u&&(o=m[i-u]),l=r[2*i],t.opt_len+=l*(n+o),h&&(t.static_len+=l*(d[2*i+1]+o)));if(0!==g){do{for(n=p-1;0===t.bl_count[n];)n--;t.bl_count[n]--,t.bl_count[n+1]+=2,t.bl_count[p]--,g-=2}while(g>0);for(n=p;0!==n;n--)for(i=t.bl_count[n];0!==i;)(a=t.heap[--s])>c||(r[2*a+1]!==n&&(t.opt_len+=(n-r[2*a+1])*r[2*a],r[2*a+1]=n),i--)}}(t,e),Nn(n,c,t.bl_count)}function Un(t,e,s){var i,a,n=-1,o=e[1],l=0,r=7,c=4;for(0===o&&(r=138,c=3),e[2*(s+1)+1]=65535,i=0;i<=s;i++)a=o,o=e[2*(i+1)+1],++l<r&&a===o||(l<c?t.bl_tree[2*a]+=l:0!==a?(a!==n&&t.bl_tree[2*a]++,t.bl_tree[2*ln]++):l<=10?t.bl_tree[2*rn]++:t.bl_tree[2*cn]++,l=0,n=a,0===o?(r=138,c=3):a===o?(r=6,c=3):(r=7,c=4))}function Fn(t,e,s){var i,a,n=-1,o=e[1],l=0,r=7,c=4;for(0===o&&(r=138,c=3),i=0;i<=s;i++)if(a=o,o=e[2*(i+1)+1],!(++l<r&&a===o)){if(l<c)do{Tn(t,a,t.bl_tree)}while(0!=--l);else 0!==a?(a!==n&&(Tn(t,a,t.bl_tree),l--),Tn(t,ln,t.bl_tree),kn(t,l-3,2)):l<=10?(Tn(t,rn,t.bl_tree),kn(t,l-3,3)):(Tn(t,cn,t.bl_tree),kn(t,l-11,7));l=0,n=a,0===o?(r=138,c=3):a===o?(r=6,c=3):(r=7,c=4)}}Ka(En);var Wn=!1;function On(t,e,s,i){kn(t,(Ja<<1)+(i?1:0),3),function(t,e,s,i){Rn(t),i&&(Cn(t,s),Cn(t,~s)),ja.arraySet(t.pending_buf,t.window,e,s,t.pending),t.pending+=s}(t,e,s,!0)}za._tr_init=function(t){Wn||(!function(){var t,e,s,i,a,n=new Array(sn+1);for(s=0,i=0;i<Za-1;i++)for(wn[i]=s,t=0;t<1<<dn[i];t++)In[s++]=i;for(In[s-1]=i,a=0,i=0;i<16;i++)for(En[i]=a,t=0;t<1<<hn[i];t++)fn[a++]=i;for(a>>=7;i<Qa;i++)for(En[i]=a<<7,t=0;t<1<<hn[i]-7;t++)fn[256+a++]=i;for(e=0;e<=sn;e++)n[e]=0;for(t=0;t<=143;)pn[2*t+1]=8,t++,n[8]++;for(;t<=255;)pn[2*t+1]=9,t++,n[9]++;for(;t<=279;)pn[2*t+1]=7,t++,n[7]++;for(;t<=287;)pn[2*t+1]=8,t++,n[8]++;for(Nn(pn,Xa+1,n),t=0;t<Qa;t++)gn[2*t+1]=5,gn[2*t]=_n(t,5);bn=new Sn(pn,dn,Ya+1,Xa,sn),xn=new Sn(gn,hn,0,Qa,sn),vn=new Sn(new Array(0),mn,0,tn,nn)}(),Wn=!0),t.l_desc=new yn(t.dyn_ltree,bn),t.d_desc=new yn(t.dyn_dtree,xn),t.bl_desc=new yn(t.bl_tree,vn),t.bi_buf=0,t.bi_valid=0,Ln(t)},za._tr_stored_block=On,za._tr_flush_block=function(t,e,s,i){var a,n,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,s=4093624447;for(e=0;e<=31;e++,s>>>=1)if(1&s&&0!==t.dyn_ltree[2*e])return $a;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return Ga;for(e=32;e<Ya;e++)if(0!==t.dyn_ltree[2*e])return Ga;return $a}(t)),Mn(t,t.l_desc),Mn(t,t.d_desc),o=function(t){var e;for(Un(t,t.dyn_ltree,t.l_desc.max_code),Un(t,t.dyn_dtree,t.d_desc.max_code),Mn(t,t.bl_desc),e=tn-1;e>=3&&0===t.bl_tree[2*un[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),a=t.opt_len+3+7>>>3,(n=t.static_len+3+7>>>3)<=a&&(a=n)):a=n=s+5,s+4<=a&&-1!==e?On(t,e,s,i):4===t.strategy||n===a?(kn(t,2+(i?1:0),3),Vn(t,pn,gn)):(kn(t,4+(i?1:0),3),function(t,e,s,i){var a;for(kn(t,e-257,5),kn(t,s-1,5),kn(t,i-4,4),a=0;a<i;a++)kn(t,t.bl_tree[2*un[a]+1],3);Fn(t,t.dyn_ltree,e-1),Fn(t,t.dyn_dtree,s-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Vn(t,t.dyn_ltree,t.dyn_dtree)),Ln(t),i&&Rn(t)},za._tr_tally=function(t,e,s){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&s,t.last_lit++,0===e?t.dyn_ltree[2*s]++:(t.matches++,e--,t.dyn_ltree[2*(In[s]+Ya+1)]++,t.dyn_dtree[2*Pn(e)]++),t.last_lit===t.lit_bufsize-1},za._tr_align=function(t){kn(t,2,3),Tn(t,on,pn),function(t){16===t.bi_valid?(Cn(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)};var Hn=function(t,e,s,i){for(var a=65535&t|0,n=t>>>16&65535|0,o=0;0!==s;){s-=o=s>2e3?2e3:s;do{n=n+(a=a+e[i++]|0)|0}while(--o);a%=65521,n%=65521}return a|n<<16|0};var qn=function(){for(var t,e=[],s=0;s<256;s++){t=s;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[s]=t}return e}();var Bn,zn=function(t,e,s,i){var a=qn,n=i+s;t^=-1;for(var o=i;o<n;o++)t=t>>>8^a[255&(t^e[o])];return-1^t},jn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},$n=Ha,Gn=za,Kn=Hn,Jn=zn,Zn=jn,Yn=0,Xn=4,Qn=0,to=-2,eo=-1,so=4,io=2,ao=8,no=9,oo=286,lo=30,ro=19,co=2*oo+1,ho=15,mo=3,uo=258,po=uo+mo+1,go=42,fo=103,Io=113,wo=666,bo=1,xo=2,vo=3,Eo=4;function So(t,e){return t.msg=Zn[e],e}function yo(t){return(t<<1)-(t>4?9:0)}function Po(t){for(var e=t.length;--e>=0;)t[e]=0}function Co(t){var e=t.state,s=e.pending;s>t.avail_out&&(s=t.avail_out),0!==s&&($n.arraySet(t.output,e.pending_buf,e.pending_out,s,t.next_out),t.next_out+=s,e.pending_out+=s,t.total_out+=s,t.avail_out-=s,e.pending-=s,0===e.pending&&(e.pending_out=0))}function ko(t,e){Gn._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Co(t.strm)}function To(t,e){t.pending_buf[t.pending++]=e}function _o(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function No(t,e){var s,i,a=t.max_chain_length,n=t.strstart,o=t.prev_length,l=t.nice_match,r=t.strstart>t.w_size-po?t.strstart-(t.w_size-po):0,c=t.window,d=t.w_mask,h=t.prev,m=t.strstart+uo,u=c[n+o-1],p=c[n+o];t.prev_length>=t.good_match&&(a>>=2),l>t.lookahead&&(l=t.lookahead);do{if(c[(s=e)+o]===p&&c[s+o-1]===u&&c[s]===c[n]&&c[++s]===c[n+1]){n+=2,s++;do{}while(c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&n<m);if(i=uo-(m-n),n=m-uo,i>o){if(t.match_start=e,o=i,i>=l)break;u=c[n+o-1],p=c[n+o]}}}while((e=h[e&d])>r&&0!=--a);return o<=t.lookahead?o:t.lookahead}function Lo(t){var e,s,i,a,n,o,l,r,c,d,h=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=h+(h-po)){$n.arraySet(t.window,t.window,h,h,0),t.match_start-=h,t.strstart-=h,t.block_start-=h,e=s=t.hash_size;do{i=t.head[--e],t.head[e]=i>=h?i-h:0}while(--s);e=s=h;do{i=t.prev[--e],t.prev[e]=i>=h?i-h:0}while(--s);a+=h}if(0===t.strm.avail_in)break;if(o=t.strm,l=t.window,r=t.strstart+t.lookahead,c=a,d=void 0,(d=o.avail_in)>c&&(d=c),s=0===d?0:(o.avail_in-=d,$n.arraySet(l,o.input,o.next_in,d,r),1===o.state.wrap?o.adler=Kn(o.adler,l,d,r):2===o.state.wrap&&(o.adler=Jn(o.adler,l,d,r)),o.next_in+=d,o.total_in+=d,d),t.lookahead+=s,t.lookahead+t.insert>=mo)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=(t.ins_h<<t.hash_shift^t.window[n+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[n+mo-1])&t.hash_mask,t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<mo)););}while(t.lookahead<po&&0!==t.strm.avail_in)}function Ro(t,e){for(var s,i;;){if(t.lookahead<po){if(Lo(t),t.lookahead<po&&e===Yn)return bo;if(0===t.lookahead)break}if(s=0,t.lookahead>=mo&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+mo-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==s&&t.strstart-s<=t.w_size-po&&(t.match_length=No(t,s)),t.match_length>=mo)if(i=Gn._tr_tally(t,t.strstart-t.match_start,t.match_length-mo),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=mo){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+mo-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=Gn._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(ko(t,!1),0===t.strm.avail_out))return bo}return t.insert=t.strstart<mo-1?t.strstart:mo-1,e===Xn?(ko(t,!0),0===t.strm.avail_out?vo:Eo):t.last_lit&&(ko(t,!1),0===t.strm.avail_out)?bo:xo}function Do(t,e){for(var s,i,a;;){if(t.lookahead<po){if(Lo(t),t.lookahead<po&&e===Yn)return bo;if(0===t.lookahead)break}if(s=0,t.lookahead>=mo&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+mo-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=mo-1,0!==s&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-po&&(t.match_length=No(t,s),t.match_length<=5&&(1===t.strategy||t.match_length===mo&&t.strstart-t.match_start>4096)&&(t.match_length=mo-1)),t.prev_length>=mo&&t.match_length<=t.prev_length){a=t.strstart+t.lookahead-mo,i=Gn._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-mo),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=a&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+mo-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=mo-1,t.strstart++,i&&(ko(t,!1),0===t.strm.avail_out))return bo}else if(t.match_available){if((i=Gn._tr_tally(t,0,t.window[t.strstart-1]))&&ko(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return bo}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=Gn._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<mo-1?t.strstart:mo-1,e===Xn?(ko(t,!0),0===t.strm.avail_out?vo:Eo):t.last_lit&&(ko(t,!1),0===t.strm.avail_out)?bo:xo}function Ao(t,e,s,i,a){this.good_length=t,this.max_lazy=e,this.nice_length=s,this.max_chain=i,this.func=a}function Vo(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ao,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new $n.Buf16(2*co),this.dyn_dtree=new $n.Buf16(2*(2*lo+1)),this.bl_tree=new $n.Buf16(2*(2*ro+1)),Po(this.dyn_ltree),Po(this.dyn_dtree),Po(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new $n.Buf16(ho+1),this.heap=new $n.Buf16(2*oo+1),Po(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new $n.Buf16(2*oo+1),Po(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Mo(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=io,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?go:Io,t.adler=2===e.wrap?0:1,e.last_flush=Yn,Gn._tr_init(e),Qn):So(t,to)}function Uo(t){var e,s=Mo(t);return s===Qn&&((e=t.state).window_size=2*e.w_size,Po(e.head),e.max_lazy_match=Bn[e.level].max_lazy,e.good_match=Bn[e.level].good_length,e.nice_match=Bn[e.level].nice_length,e.max_chain_length=Bn[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=mo-1,e.match_available=0,e.ins_h=0),s}function Fo(t,e,s,i,a,n){if(!t)return to;var o=1;if(e===eo&&(e=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),a<1||a>no||s!==ao||i<8||i>15||e<0||e>9||n<0||n>so)return So(t,to);8===i&&(i=9);var l=new Vo;return t.state=l,l.strm=t,l.wrap=o,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+mo-1)/mo),l.window=new $n.Buf8(2*l.w_size),l.head=new $n.Buf16(l.hash_size),l.prev=new $n.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new $n.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=n,l.method=s,Uo(t)}Bn=[new Ao(0,0,0,0,(function(t,e){var s=65535;for(s>t.pending_buf_size-5&&(s=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Lo(t),0===t.lookahead&&e===Yn)return bo;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+s;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,ko(t,!1),0===t.strm.avail_out))return bo;if(t.strstart-t.block_start>=t.w_size-po&&(ko(t,!1),0===t.strm.avail_out))return bo}return t.insert=0,e===Xn?(ko(t,!0),0===t.strm.avail_out?vo:Eo):(t.strstart>t.block_start&&(ko(t,!1),t.strm.avail_out),bo)})),new Ao(4,4,8,4,Ro),new Ao(4,5,16,8,Ro),new Ao(4,6,32,32,Ro),new Ao(4,4,16,16,Do),new Ao(8,16,32,32,Do),new Ao(8,16,128,128,Do),new Ao(8,32,128,256,Do),new Ao(32,128,258,1024,Do),new Ao(32,258,258,4096,Do)],Ba.deflateInit=function(t,e){return Fo(t,e,ao,15,8,0)},Ba.deflateInit2=Fo,Ba.deflateReset=Uo,Ba.deflateResetKeep=Mo,Ba.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?to:(t.state.gzhead=e,Qn):to},Ba.deflate=function(t,e){var s,i,a,n;if(!t||!t.state||e>5||e<0)return t?So(t,to):to;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===wo&&e!==Xn)return So(t,0===t.avail_out?-5:to);if(i.strm=t,s=i.last_flush,i.last_flush=e,i.status===go)if(2===i.wrap)t.adler=0,To(i,31),To(i,139),To(i,8),i.gzhead?(To(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),To(i,255&i.gzhead.time),To(i,i.gzhead.time>>8&255),To(i,i.gzhead.time>>16&255),To(i,i.gzhead.time>>24&255),To(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),To(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(To(i,255&i.gzhead.extra.length),To(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=Jn(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(To(i,0),To(i,0),To(i,0),To(i,0),To(i,0),To(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),To(i,3),i.status=Io);else{var o=ao+(i.w_bits-8<<4)<<8;o|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(o|=32),o+=31-o%31,i.status=Io,_o(i,o),0!==i.strstart&&(_o(i,t.adler>>>16),_o(i,65535&t.adler)),t.adler=1}if(69===i.status)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(t.adler=Jn(t.adler,i.pending_buf,i.pending-a,a)),Co(t),a=i.pending,i.pending!==i.pending_buf_size));)To(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(t.adler=Jn(t.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=Jn(t.adler,i.pending_buf,i.pending-a,a)),Co(t),a=i.pending,i.pending===i.pending_buf_size)){n=1;break}n=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,To(i,n)}while(0!==n);i.gzhead.hcrc&&i.pending>a&&(t.adler=Jn(t.adler,i.pending_buf,i.pending-a,a)),0===n&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=Jn(t.adler,i.pending_buf,i.pending-a,a)),Co(t),a=i.pending,i.pending===i.pending_buf_size)){n=1;break}n=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,To(i,n)}while(0!==n);i.gzhead.hcrc&&i.pending>a&&(t.adler=Jn(t.adler,i.pending_buf,i.pending-a,a)),0===n&&(i.status=fo)}else i.status=fo;if(i.status===fo&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Co(t),i.pending+2<=i.pending_buf_size&&(To(i,255&t.adler),To(i,t.adler>>8&255),t.adler=0,i.status=Io)):i.status=Io),0!==i.pending){if(Co(t),0===t.avail_out)return i.last_flush=-1,Qn}else if(0===t.avail_in&&yo(e)<=yo(s)&&e!==Xn)return So(t,-5);if(i.status===wo&&0!==t.avail_in)return So(t,-5);if(0!==t.avail_in||0!==i.lookahead||e!==Yn&&i.status!==wo){var l=2===i.strategy?function(t,e){for(var s;;){if(0===t.lookahead&&(Lo(t),0===t.lookahead)){if(e===Yn)return bo;break}if(t.match_length=0,s=Gn._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,s&&(ko(t,!1),0===t.strm.avail_out))return bo}return t.insert=0,e===Xn?(ko(t,!0),0===t.strm.avail_out?vo:Eo):t.last_lit&&(ko(t,!1),0===t.strm.avail_out)?bo:xo}(i,e):3===i.strategy?function(t,e){for(var s,i,a,n,o=t.window;;){if(t.lookahead<=uo){if(Lo(t),t.lookahead<=uo&&e===Yn)return bo;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=mo&&t.strstart>0&&(i=o[a=t.strstart-1])===o[++a]&&i===o[++a]&&i===o[++a]){n=t.strstart+uo;do{}while(i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&a<n);t.match_length=uo-(n-a),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=mo?(s=Gn._tr_tally(t,1,t.match_length-mo),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(s=Gn._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),s&&(ko(t,!1),0===t.strm.avail_out))return bo}return t.insert=0,e===Xn?(ko(t,!0),0===t.strm.avail_out?vo:Eo):t.last_lit&&(ko(t,!1),0===t.strm.avail_out)?bo:xo}(i,e):Bn[i.level].func(i,e);if(l!==vo&&l!==Eo||(i.status=wo),l===bo||l===vo)return 0===t.avail_out&&(i.last_flush=-1),Qn;if(l===xo&&(1===e?Gn._tr_align(i):5!==e&&(Gn._tr_stored_block(i,0,0,!1),3===e&&(Po(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Co(t),0===t.avail_out))return i.last_flush=-1,Qn}return e!==Xn?Qn:i.wrap<=0?1:(2===i.wrap?(To(i,255&t.adler),To(i,t.adler>>8&255),To(i,t.adler>>16&255),To(i,t.adler>>24&255),To(i,255&t.total_in),To(i,t.total_in>>8&255),To(i,t.total_in>>16&255),To(i,t.total_in>>24&255)):(_o(i,t.adler>>>16),_o(i,65535&t.adler)),Co(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?Qn:1)},Ba.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==go&&69!==e&&73!==e&&91!==e&&e!==fo&&e!==Io&&e!==wo?So(t,to):(t.state=null,e===Io?So(t,-3):Qn):to},Ba.deflateSetDictionary=function(t,e){var s,i,a,n,o,l,r,c,d=e.length;if(!t||!t.state)return to;if(2===(n=(s=t.state).wrap)||1===n&&s.status!==go||s.lookahead)return to;for(1===n&&(t.adler=Kn(t.adler,e,d,0)),s.wrap=0,d>=s.w_size&&(0===n&&(Po(s.head),s.strstart=0,s.block_start=0,s.insert=0),c=new $n.Buf8(s.w_size),$n.arraySet(c,e,d-s.w_size,s.w_size,0),e=c,d=s.w_size),o=t.avail_in,l=t.next_in,r=t.input,t.avail_in=d,t.next_in=0,t.input=e,Lo(s);s.lookahead>=mo;){i=s.strstart,a=s.lookahead-(mo-1);do{s.ins_h=(s.ins_h<<s.hash_shift^s.window[i+mo-1])&s.hash_mask,s.prev[i&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=i,i++}while(--a);s.strstart=i,s.lookahead=mo-1,Lo(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=mo-1,s.match_available=0,t.next_in=l,t.input=r,t.avail_in=o,s.wrap=n,Qn},Ba.deflateInfo="pako deflate (from Nodeca project)";var Wo={},Oo=Ha,Ho=!0,qo=!0;try{String.fromCharCode.apply(null,[0])}catch(pu){Ho=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(pu){qo=!1}for(var Bo=new Oo.Buf8(256),zo=0;zo<256;zo++)Bo[zo]=zo>=252?6:zo>=248?5:zo>=240?4:zo>=224?3:zo>=192?2:1;function jo(t,e){if(e<65534&&(t.subarray&&qo||!t.subarray&&Ho))return String.fromCharCode.apply(null,Oo.shrinkBuf(t,e));for(var s="",i=0;i<e;i++)s+=String.fromCharCode(t[i]);return s}Bo[254]=Bo[254]=1,Wo.string2buf=function(t){var e,s,i,a,n,o=t.length,l=0;for(a=0;a<o;a++)55296==(64512&(s=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(i=t.charCodeAt(a+1)))&&(s=65536+(s-55296<<10)+(i-56320),a++),l+=s<128?1:s<2048?2:s<65536?3:4;for(e=new Oo.Buf8(l),n=0,a=0;n<l;a++)55296==(64512&(s=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(i=t.charCodeAt(a+1)))&&(s=65536+(s-55296<<10)+(i-56320),a++),s<128?e[n++]=s:s<2048?(e[n++]=192|s>>>6,e[n++]=128|63&s):s<65536?(e[n++]=224|s>>>12,e[n++]=128|s>>>6&63,e[n++]=128|63&s):(e[n++]=240|s>>>18,e[n++]=128|s>>>12&63,e[n++]=128|s>>>6&63,e[n++]=128|63&s);return e},Wo.buf2binstring=function(t){return jo(t,t.length)},Wo.binstring2buf=function(t){for(var e=new Oo.Buf8(t.length),s=0,i=e.length;s<i;s++)e[s]=t.charCodeAt(s);return e},Wo.buf2string=function(t,e){var s,i,a,n,o=e||t.length,l=new Array(2*o);for(i=0,s=0;s<o;)if((a=t[s++])<128)l[i++]=a;else if((n=Bo[a])>4)l[i++]=65533,s+=n-1;else{for(a&=2===n?31:3===n?15:7;n>1&&s<o;)a=a<<6|63&t[s++],n--;n>1?l[i++]=65533:a<65536?l[i++]=a:(a-=65536,l[i++]=55296|a>>10&1023,l[i++]=56320|1023&a)}return jo(l,i)},Wo.utf8border=function(t,e){var s;for((e=e||t.length)>t.length&&(e=t.length),s=e-1;s>=0&&128==(192&t[s]);)s--;return s<0||0===s?e:s+Bo[t[s]]>e?s:e};var $o=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Go=Ba,Ko=Ha,Jo=Wo,Zo=jn,Yo=$o,Xo=Object.prototype.toString,Qo=0,tl=-1,el=0,sl=8;function il(t){if(!(this instanceof il))return new il(t);this.options=Ko.assign({level:tl,method:sl,chunkSize:16384,windowBits:15,memLevel:8,strategy:el,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Yo,this.strm.avail_out=0;var s=Go.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(s!==Qo)throw new Error(Zo[s]);if(e.header&&Go.deflateSetHeader(this.strm,e.header),e.dictionary){var i;if(i="string"==typeof e.dictionary?Jo.string2buf(e.dictionary):"[object ArrayBuffer]"===Xo.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(s=Go.deflateSetDictionary(this.strm,i))!==Qo)throw new Error(Zo[s]);this._dict_set=!0}}function al(t,e){var s=new il(e);if(s.push(t,!0),s.err)throw s.msg||Zo[s.err];return s.result}il.prototype.push=function(t,e){var s,i,a=this.strm,n=this.options.chunkSize;if(this.ended)return!1;i=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=Jo.string2buf(t):"[object ArrayBuffer]"===Xo.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new Ko.Buf8(n),a.next_out=0,a.avail_out=n),1!==(s=Go.deflate(a,i))&&s!==Qo)return this.onEnd(s),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(Jo.buf2binstring(Ko.shrinkBuf(a.output,a.next_out))):this.onData(Ko.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==s);return 4===i?(s=Go.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Qo):2!==i||(this.onEnd(Qo),a.avail_out=0,!0)},il.prototype.onData=function(t){this.chunks.push(t)},il.prototype.onEnd=function(t){t===Qo&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ko.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},qa.Deflate=il,qa.deflate=al,qa.deflateRaw=function(t,e){return(e=e||{}).raw=!0,al(t,e)},qa.gzip=function(t,e){return(e=e||{}).gzip=!0,al(t,e)};var nl={},ol={},ll=Ha,rl=15,cl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],dl=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],hl=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],ml=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],ul=Ha,pl=Hn,gl=zn,fl=function(t,e){var s,i,a,n,o,l,r,c,d,h,m,u,p,g,f,I,w,b,x,v,E,S,y,P,C;s=t.state,i=t.next_in,P=t.input,a=i+(t.avail_in-5),n=t.next_out,C=t.output,o=n-(e-t.avail_out),l=n+(t.avail_out-257),r=s.dmax,c=s.wsize,d=s.whave,h=s.wnext,m=s.window,u=s.hold,p=s.bits,g=s.lencode,f=s.distcode,I=(1<<s.lenbits)-1,w=(1<<s.distbits)-1;t:do{p<15&&(u+=P[i++]<<p,p+=8,u+=P[i++]<<p,p+=8),b=g[u&I];e:for(;;){if(u>>>=x=b>>>24,p-=x,0===(x=b>>>16&255))C[n++]=65535&b;else{if(!(16&x)){if(0==(64&x)){b=g[(65535&b)+(u&(1<<x)-1)];continue e}if(32&x){s.mode=12;break t}t.msg="invalid literal/length code",s.mode=30;break t}v=65535&b,(x&=15)&&(p<x&&(u+=P[i++]<<p,p+=8),v+=u&(1<<x)-1,u>>>=x,p-=x),p<15&&(u+=P[i++]<<p,p+=8,u+=P[i++]<<p,p+=8),b=f[u&w];s:for(;;){if(u>>>=x=b>>>24,p-=x,!(16&(x=b>>>16&255))){if(0==(64&x)){b=f[(65535&b)+(u&(1<<x)-1)];continue s}t.msg="invalid distance code",s.mode=30;break t}if(E=65535&b,p<(x&=15)&&(u+=P[i++]<<p,(p+=8)<x&&(u+=P[i++]<<p,p+=8)),(E+=u&(1<<x)-1)>r){t.msg="invalid distance too far back",s.mode=30;break t}if(u>>>=x,p-=x,E>(x=n-o)){if((x=E-x)>d&&s.sane){t.msg="invalid distance too far back",s.mode=30;break t}if(S=0,y=m,0===h){if(S+=c-x,x<v){v-=x;do{C[n++]=m[S++]}while(--x);S=n-E,y=C}}else if(h<x){if(S+=c+h-x,(x-=h)<v){v-=x;do{C[n++]=m[S++]}while(--x);if(S=0,h<v){v-=x=h;do{C[n++]=m[S++]}while(--x);S=n-E,y=C}}}else if(S+=h-x,x<v){v-=x;do{C[n++]=m[S++]}while(--x);S=n-E,y=C}for(;v>2;)C[n++]=y[S++],C[n++]=y[S++],C[n++]=y[S++],v-=3;v&&(C[n++]=y[S++],v>1&&(C[n++]=y[S++]))}else{S=n-E;do{C[n++]=C[S++],C[n++]=C[S++],C[n++]=C[S++],v-=3}while(v>2);v&&(C[n++]=C[S++],v>1&&(C[n++]=C[S++]))}break}}break}}while(i<a&&n<l);i-=v=p>>3,u&=(1<<(p-=v<<3))-1,t.next_in=i,t.next_out=n,t.avail_in=i<a?a-i+5:5-(i-a),t.avail_out=n<l?l-n+257:257-(n-l),s.hold=u,s.bits=p},Il=function(t,e,s,i,a,n,o,l){var r,c,d,h,m,u,p,g,f,I=l.bits,w=0,b=0,x=0,v=0,E=0,S=0,y=0,P=0,C=0,k=0,T=null,_=0,N=new ll.Buf16(16),L=new ll.Buf16(16),R=null,D=0;for(w=0;w<=rl;w++)N[w]=0;for(b=0;b<i;b++)N[e[s+b]]++;for(E=I,v=rl;v>=1&&0===N[v];v--);if(E>v&&(E=v),0===v)return a[n++]=20971520,a[n++]=20971520,l.bits=1,0;for(x=1;x<v&&0===N[x];x++);for(E<x&&(E=x),P=1,w=1;w<=rl;w++)if(P<<=1,(P-=N[w])<0)return-1;if(P>0&&(0===t||1!==v))return-1;for(L[1]=0,w=1;w<rl;w++)L[w+1]=L[w]+N[w];for(b=0;b<i;b++)0!==e[s+b]&&(o[L[e[s+b]]++]=b);if(0===t?(T=R=o,u=19):1===t?(T=cl,_-=257,R=dl,D-=257,u=256):(T=hl,R=ml,u=-1),k=0,b=0,w=x,m=n,S=E,y=0,d=-1,h=(C=1<<E)-1,1===t&&C>852||2===t&&C>592)return 1;for(;;){p=w-y,o[b]<u?(g=0,f=o[b]):o[b]>u?(g=R[D+o[b]],f=T[_+o[b]]):(g=96,f=0),r=1<<w-y,x=c=1<<S;do{a[m+(k>>y)+(c-=r)]=p<<24|g<<16|f|0}while(0!==c);for(r=1<<w-1;k&r;)r>>=1;if(0!==r?(k&=r-1,k+=r):k=0,b++,0==--N[w]){if(w===v)break;w=e[s+o[b]]}if(w>E&&(k&h)!==d){for(0===y&&(y=E),m+=x,P=1<<(S=w-y);S+y<v&&!((P-=N[S+y])<=0);)S++,P<<=1;if(C+=1<<S,1===t&&C>852||2===t&&C>592)return 1;a[d=k&h]=E<<24|S<<16|m-n|0}}return 0!==k&&(a[m+k]=w-y<<24|64<<16|0),l.bits=E,0},wl=1,bl=2,xl=0,vl=-2,El=1,Sl=12,yl=30,Pl=852,Cl=592;function kl(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function Tl(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new ul.Buf16(320),this.work=new ul.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _l(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=El,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new ul.Buf32(Pl),e.distcode=e.distdyn=new ul.Buf32(Cl),e.sane=1,e.back=-1,xl):vl}function Nl(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,_l(t)):vl}function Ll(t,e){var s,i;return t&&t.state?(i=t.state,e<0?(s=0,e=-e):(s=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?vl:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=s,i.wbits=e,Nl(t))):vl}function Rl(t,e){var s,i;return t?(i=new Tl,t.state=i,i.window=null,(s=Ll(t,e))!==xl&&(t.state=null),s):vl}var Dl,Al,Vl=!0;function Ml(t){if(Vl){var e;for(Dl=new ul.Buf32(512),Al=new ul.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Il(wl,t.lens,0,288,Dl,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Il(bl,t.lens,0,32,Al,0,t.work,{bits:5}),Vl=!1}t.lencode=Dl,t.lenbits=9,t.distcode=Al,t.distbits=5}function Ul(t,e,s,i){var a,n=t.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new ul.Buf8(n.wsize)),i>=n.wsize?(ul.arraySet(n.window,e,s-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):((a=n.wsize-n.wnext)>i&&(a=i),ul.arraySet(n.window,e,s-i,a,n.wnext),(i-=a)?(ul.arraySet(n.window,e,s-i,i,0),n.wnext=i,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0}ol.inflateReset=Nl,ol.inflateReset2=Ll,ol.inflateResetKeep=_l,ol.inflateInit=function(t){return Rl(t,15)},ol.inflateInit2=Rl,ol.inflate=function(t,e){var s,i,a,n,o,l,r,c,d,h,m,u,p,g,f,I,w,b,x,v,E,S,y,P,C=0,k=new ul.Buf8(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return vl;(s=t.state).mode===Sl&&(s.mode=13),o=t.next_out,a=t.output,r=t.avail_out,n=t.next_in,i=t.input,l=t.avail_in,c=s.hold,d=s.bits,h=l,m=r,S=xl;t:for(;;)switch(s.mode){case El:if(0===s.wrap){s.mode=13;break}for(;d<16;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}if(2&s.wrap&&35615===c){s.check=0,k[0]=255&c,k[1]=c>>>8&255,s.check=gl(s.check,k,2,0),c=0,d=0,s.mode=2;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",s.mode=yl;break}if(8!=(15&c)){t.msg="unknown compression method",s.mode=yl;break}if(d-=4,E=8+(15&(c>>>=4)),0===s.wbits)s.wbits=E;else if(E>s.wbits){t.msg="invalid window size",s.mode=yl;break}s.dmax=1<<E,t.adler=s.check=1,s.mode=512&c?10:Sl,c=0,d=0;break;case 2:for(;d<16;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}if(s.flags=c,8!=(255&s.flags)){t.msg="unknown compression method",s.mode=yl;break}if(57344&s.flags){t.msg="unknown header flags set",s.mode=yl;break}s.head&&(s.head.text=c>>8&1),512&s.flags&&(k[0]=255&c,k[1]=c>>>8&255,s.check=gl(s.check,k,2,0)),c=0,d=0,s.mode=3;case 3:for(;d<32;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}s.head&&(s.head.time=c),512&s.flags&&(k[0]=255&c,k[1]=c>>>8&255,k[2]=c>>>16&255,k[3]=c>>>24&255,s.check=gl(s.check,k,4,0)),c=0,d=0,s.mode=4;case 4:for(;d<16;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}s.head&&(s.head.xflags=255&c,s.head.os=c>>8),512&s.flags&&(k[0]=255&c,k[1]=c>>>8&255,s.check=gl(s.check,k,2,0)),c=0,d=0,s.mode=5;case 5:if(1024&s.flags){for(;d<16;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}s.length=c,s.head&&(s.head.extra_len=c),512&s.flags&&(k[0]=255&c,k[1]=c>>>8&255,s.check=gl(s.check,k,2,0)),c=0,d=0}else s.head&&(s.head.extra=null);s.mode=6;case 6:if(1024&s.flags&&((u=s.length)>l&&(u=l),u&&(s.head&&(E=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Array(s.head.extra_len)),ul.arraySet(s.head.extra,i,n,u,E)),512&s.flags&&(s.check=gl(s.check,i,u,n)),l-=u,n+=u,s.length-=u),s.length))break t;s.length=0,s.mode=7;case 7:if(2048&s.flags){if(0===l)break t;u=0;do{E=i[n+u++],s.head&&E&&s.length<65536&&(s.head.name+=String.fromCharCode(E))}while(E&&u<l);if(512&s.flags&&(s.check=gl(s.check,i,u,n)),l-=u,n+=u,E)break t}else s.head&&(s.head.name=null);s.length=0,s.mode=8;case 8:if(4096&s.flags){if(0===l)break t;u=0;do{E=i[n+u++],s.head&&E&&s.length<65536&&(s.head.comment+=String.fromCharCode(E))}while(E&&u<l);if(512&s.flags&&(s.check=gl(s.check,i,u,n)),l-=u,n+=u,E)break t}else s.head&&(s.head.comment=null);s.mode=9;case 9:if(512&s.flags){for(;d<16;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}if(c!==(65535&s.check)){t.msg="header crc mismatch",s.mode=yl;break}c=0,d=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=Sl;break;case 10:for(;d<32;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}t.adler=s.check=kl(c),c=0,d=0,s.mode=11;case 11:if(0===s.havedict)return t.next_out=o,t.avail_out=r,t.next_in=n,t.avail_in=l,s.hold=c,s.bits=d,2;t.adler=s.check=1,s.mode=Sl;case Sl:if(5===e||6===e)break t;case 13:if(s.last){c>>>=7&d,d-=7&d,s.mode=27;break}for(;d<3;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}switch(s.last=1&c,d-=1,3&(c>>>=1)){case 0:s.mode=14;break;case 1:if(Ml(s),s.mode=20,6===e){c>>>=2,d-=2;break t}break;case 2:s.mode=17;break;case 3:t.msg="invalid block type",s.mode=yl}c>>>=2,d-=2;break;case 14:for(c>>>=7&d,d-=7&d;d<32;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",s.mode=yl;break}if(s.length=65535&c,c=0,d=0,s.mode=15,6===e)break t;case 15:s.mode=16;case 16:if(u=s.length){if(u>l&&(u=l),u>r&&(u=r),0===u)break t;ul.arraySet(a,i,n,u,o),l-=u,n+=u,r-=u,o+=u,s.length-=u;break}s.mode=Sl;break;case 17:for(;d<14;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}if(s.nlen=257+(31&c),c>>>=5,d-=5,s.ndist=1+(31&c),c>>>=5,d-=5,s.ncode=4+(15&c),c>>>=4,d-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=yl;break}s.have=0,s.mode=18;case 18:for(;s.have<s.ncode;){for(;d<3;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}s.lens[T[s.have++]]=7&c,c>>>=3,d-=3}for(;s.have<19;)s.lens[T[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,y={bits:s.lenbits},S=Il(0,s.lens,0,19,s.lencode,0,s.work,y),s.lenbits=y.bits,S){t.msg="invalid code lengths set",s.mode=yl;break}s.have=0,s.mode=19;case 19:for(;s.have<s.nlen+s.ndist;){for(;I=(C=s.lencode[c&(1<<s.lenbits)-1])>>>16&255,w=65535&C,!((f=C>>>24)<=d);){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}if(w<16)c>>>=f,d-=f,s.lens[s.have++]=w;else{if(16===w){for(P=f+2;d<P;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}if(c>>>=f,d-=f,0===s.have){t.msg="invalid bit length repeat",s.mode=yl;break}E=s.lens[s.have-1],u=3+(3&c),c>>>=2,d-=2}else if(17===w){for(P=f+3;d<P;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}d-=f,E=0,u=3+(7&(c>>>=f)),c>>>=3,d-=3}else{for(P=f+7;d<P;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}d-=f,E=0,u=11+(127&(c>>>=f)),c>>>=7,d-=7}if(s.have+u>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=yl;break}for(;u--;)s.lens[s.have++]=E}}if(s.mode===yl)break;if(0===s.lens[256]){t.msg="invalid code -- missing end-of-block",s.mode=yl;break}if(s.lenbits=9,y={bits:s.lenbits},S=Il(wl,s.lens,0,s.nlen,s.lencode,0,s.work,y),s.lenbits=y.bits,S){t.msg="invalid literal/lengths set",s.mode=yl;break}if(s.distbits=6,s.distcode=s.distdyn,y={bits:s.distbits},S=Il(bl,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,y),s.distbits=y.bits,S){t.msg="invalid distances set",s.mode=yl;break}if(s.mode=20,6===e)break t;case 20:s.mode=21;case 21:if(l>=6&&r>=258){t.next_out=o,t.avail_out=r,t.next_in=n,t.avail_in=l,s.hold=c,s.bits=d,fl(t,m),o=t.next_out,a=t.output,r=t.avail_out,n=t.next_in,i=t.input,l=t.avail_in,c=s.hold,d=s.bits,s.mode===Sl&&(s.back=-1);break}for(s.back=0;I=(C=s.lencode[c&(1<<s.lenbits)-1])>>>16&255,w=65535&C,!((f=C>>>24)<=d);){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}if(I&&0==(240&I)){for(b=f,x=I,v=w;I=(C=s.lencode[v+((c&(1<<b+x)-1)>>b)])>>>16&255,w=65535&C,!(b+(f=C>>>24)<=d);){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}c>>>=b,d-=b,s.back+=b}if(c>>>=f,d-=f,s.back+=f,s.length=w,0===I){s.mode=26;break}if(32&I){s.back=-1,s.mode=Sl;break}if(64&I){t.msg="invalid literal/length code",s.mode=yl;break}s.extra=15&I,s.mode=22;case 22:if(s.extra){for(P=s.extra;d<P;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}s.length+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=23;case 23:for(;I=(C=s.distcode[c&(1<<s.distbits)-1])>>>16&255,w=65535&C,!((f=C>>>24)<=d);){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}if(0==(240&I)){for(b=f,x=I,v=w;I=(C=s.distcode[v+((c&(1<<b+x)-1)>>b)])>>>16&255,w=65535&C,!(b+(f=C>>>24)<=d);){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}c>>>=b,d-=b,s.back+=b}if(c>>>=f,d-=f,s.back+=f,64&I){t.msg="invalid distance code",s.mode=yl;break}s.offset=w,s.extra=15&I,s.mode=24;case 24:if(s.extra){for(P=s.extra;d<P;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}s.offset+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=yl;break}s.mode=25;case 25:if(0===r)break t;if(u=m-r,s.offset>u){if((u=s.offset-u)>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=yl;break}u>s.wnext?(u-=s.wnext,p=s.wsize-u):p=s.wnext-u,u>s.length&&(u=s.length),g=s.window}else g=a,p=o-s.offset,u=s.length;u>r&&(u=r),r-=u,s.length-=u;do{a[o++]=g[p++]}while(--u);0===s.length&&(s.mode=21);break;case 26:if(0===r)break t;a[o++]=s.length,r--,s.mode=21;break;case 27:if(s.wrap){for(;d<32;){if(0===l)break t;l--,c|=i[n++]<<d,d+=8}if(m-=r,t.total_out+=m,s.total+=m,m&&(t.adler=s.check=s.flags?gl(s.check,a,m,o-m):pl(s.check,a,m,o-m)),m=r,(s.flags?c:kl(c))!==s.check){t.msg="incorrect data check",s.mode=yl;break}c=0,d=0}s.mode=28;case 28:if(s.wrap&&s.flags){for(;d<32;){if(0===l)break t;l--,c+=i[n++]<<d,d+=8}if(c!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=yl;break}c=0,d=0}s.mode=29;case 29:S=1;break t;case yl:S=-3;break t;case 31:return-4;default:return vl}return t.next_out=o,t.avail_out=r,t.next_in=n,t.avail_in=l,s.hold=c,s.bits=d,(s.wsize||m!==t.avail_out&&s.mode<yl&&(s.mode<27||4!==e))&&Ul(t,t.output,t.next_out,m-t.avail_out),h-=t.avail_in,m-=t.avail_out,t.total_in+=h,t.total_out+=m,s.total+=m,s.wrap&&m&&(t.adler=s.check=s.flags?gl(s.check,a,m,t.next_out-m):pl(s.check,a,m,t.next_out-m)),t.data_type=s.bits+(s.last?64:0)+(s.mode===Sl?128:0)+(20===s.mode||15===s.mode?256:0),(0===h&&0===m||4===e)&&S===xl&&(S=-5),S},ol.inflateEnd=function(t){if(!t||!t.state)return vl;var e=t.state;return e.window&&(e.window=null),t.state=null,xl},ol.inflateGetHeader=function(t,e){var s;return t&&t.state?0==(2&(s=t.state).wrap)?vl:(s.head=e,e.done=!1,xl):vl},ol.inflateSetDictionary=function(t,e){var s,i=e.length;return t&&t.state?0!==(s=t.state).wrap&&11!==s.mode?vl:11===s.mode&&pl(1,e,i,0)!==s.check?-3:Ul(t,e,i,i)?(s.mode=31,-4):(s.havedict=1,xl):vl},ol.inflateInfo="pako inflate (from Nodeca project)";var Fl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var Wl=ol,Ol=Ha,Hl=Wo,ql=Fl,Bl=jn,zl=$o,jl=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},$l=Object.prototype.toString;function Gl(t){if(!(this instanceof Gl))return new Gl(t);this.options=Ol.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zl,this.strm.avail_out=0;var s=Wl.inflateInit2(this.strm,e.windowBits);if(s!==ql.Z_OK)throw new Error(Bl[s]);if(this.header=new jl,Wl.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Hl.string2buf(e.dictionary):"[object ArrayBuffer]"===$l.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(s=Wl.inflateSetDictionary(this.strm,e.dictionary))!==ql.Z_OK))throw new Error(Bl[s])}function Kl(t,e){var s=new Gl(e);if(s.push(t,!0),s.err)throw s.msg||Bl[s.err];return s.result}Gl.prototype.push=function(t,e){var s,i,a,n,o,l=this.strm,r=this.options.chunkSize,c=this.options.dictionary,d=!1;if(this.ended)return!1;i=e===~~e?e:!0===e?ql.Z_FINISH:ql.Z_NO_FLUSH,"string"==typeof t?l.input=Hl.binstring2buf(t):"[object ArrayBuffer]"===$l.call(t)?l.input=new Uint8Array(t):l.input=t,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new Ol.Buf8(r),l.next_out=0,l.avail_out=r),(s=Wl.inflate(l,ql.Z_NO_FLUSH))===ql.Z_NEED_DICT&&c&&(s=Wl.inflateSetDictionary(this.strm,c)),s===ql.Z_BUF_ERROR&&!0===d&&(s=ql.Z_OK,d=!1),s!==ql.Z_STREAM_END&&s!==ql.Z_OK)return this.onEnd(s),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&s!==ql.Z_STREAM_END&&(0!==l.avail_in||i!==ql.Z_FINISH&&i!==ql.Z_SYNC_FLUSH)||("string"===this.options.to?(a=Hl.utf8border(l.output,l.next_out),n=l.next_out-a,o=Hl.buf2string(l.output,a),l.next_out=n,l.avail_out=r-n,n&&Ol.arraySet(l.output,l.output,a,n,0),this.onData(o)):this.onData(Ol.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(d=!0)}while((l.avail_in>0||0===l.avail_out)&&s!==ql.Z_STREAM_END);return s===ql.Z_STREAM_END&&(i=ql.Z_FINISH),i===ql.Z_FINISH?(s=Wl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===ql.Z_OK):i!==ql.Z_SYNC_FLUSH||(this.onEnd(ql.Z_OK),l.avail_out=0,!0)},Gl.prototype.onData=function(t){this.chunks.push(t)},Gl.prototype.onEnd=function(t){t===ql.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ol.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},nl.Inflate=Gl,nl.inflate=Kl,nl.inflateRaw=function(t,e){return(e=e||{}).raw=!0,Kl(t,e)},nl.ungzip=Kl;var Jl={};(0,Ha.assign)(Jl,qa,nl,Fl);var Zl=Jl,Yl=(t=>(t[t.Unlaunched=0]="Unlaunched",t[t.Alpha=1]="Alpha",t[t.Beta=2]="Beta",t[t.Launched=3]="Launched",t))(Yl||{});const Xl=2,Ql={[B.SpecBalanceDruid]:1,[B.SpecFeralDruid]:1,[B.SpecFeralTankDruid]:0,[B.SpecRestorationDruid]:0,[B.SpecElementalShaman]:0,[B.SpecEnhancementShaman]:0,[B.SpecRestorationShaman]:0,[B.SpecHunter]:0,[B.SpecMage]:0,[B.SpecRogue]:0,[B.SpecHolyPaladin]:0,[B.SpecProtectionPaladin]:0,[B.SpecRetributionPaladin]:0,[B.SpecHealingPriest]:0,[B.SpecShadowPriest]:0,[B.SpecWarlock]:1,[B.SpecTankWarlock]:1,[B.SpecWarrior]:0,[B.SpecProtectionWarrior]:0};function tr(t){return Object.keys(S).map((t=>parseInt(t))).filter((e=>S[e]==t&&Ql[e]>0))}class er extends p{constructor(t,s,i){super(t,"number-picker-root",s,i),e(this,"inputElem"),e(this,"float"),e(this,"positive"),this.float=i.float||!1,this.positive=i.positive||!1,this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.classList.add("form-control","number-picker-input"),this.positive&&(this.inputElem.onchange=t=>{this.float?this.inputElem.value=Math.abs(parseFloat(this.inputElem.value)).toFixed(2):this.inputElem.value=Math.abs(parseInt(this.inputElem.value)).toString()}),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(t=>{this.inputChanged(c.nextEventID())})),this.inputElem.addEventListener("input",(t=>{this.updateSize()})),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.float?parseFloat(this.inputElem.value||"")||0:parseInt(this.inputElem.value||"")||0}setInputValue(t){this.float?this.inputElem.value=t.toFixed(2):this.inputElem.value=String(t)}updateSize(){const t=Math.max(3,this.inputElem.value.length);this.inputElem.size!=t&&(this.inputElem.size=t)}}class sr extends I{constructor(t){super(t,"results-viewer"),e(this,"pendingElem"),e(this,"contentElem"),e(this,"warningElem"),e(this,"warningsLink"),e(this,"warnings",[]),this.rootElem.appendChild(g(b,null,g("div",{className:"results-pending"},g("div",{className:"loader"})),g("div",{className:"results-content"}),g("div",{className:"warning-zone",style:"text-align: center"}))),this.pendingElem=this.rootElem.getElementsByClassName("results-pending")[0],this.contentElem=this.rootElem.getElementsByClassName("results-content")[0],this.warningElem=this.rootElem.getElementsByClassName("warning-zone")[0],this.warningsLink=this.addWarningsLink(),this.updateWarnings(),this.hideAll()}addWarningLink(t){let e=g("div",{className:"sim-toolbar-item"},g("a",{href:t.href?t.href:"javascript:void(0)",target:t.href?"_blank":"_self",className:t.classes},t.icon&&g("i",{className:t.icon}),t.text?t.text:"")),s=e.children[0];t.onclick&&s.addEventListener("click",(()=>{t.onclick&&t.onclick()}));let i={};return t.tooltip&&(i={title:t.tooltip,html:!0,placement:"bottom"},s.setAttribute("data-bs-title",t.tooltip)),new ta(s,i),t.parent.appendChild(e),e}addWarningsLink(){return this.addWarningLink({parent:this.warningElem,icon:"fas fa-exclamation-triangle fa-3x",tooltip:"<ul class='text-start ps-3 mb-0'></ul>",classes:"warning link-warning"}).children[0]}addWarning(t){this.warnings.push(t),t.updateOn.on((()=>this.updateWarnings())),this.updateWarnings()}updateWarnings(){const t=this.warnings.map((t=>t.getContent())).flat().filter((t=>""!=t));let e=document.createElement("fragment");e.innerHTML=this.warningsLink.getAttribute("data-bs-title");let s=e.children[0];s.innerHTML="",0==t.length?this.warningsLink.parentElement?.classList?.add("hide"):(this.warningsLink.parentElement?.classList?.remove("hide"),t.forEach((t=>{let e=document.createElement("li");e.innerHTML=t,s.appendChild(e)}))),this.warningsLink.setAttribute("data-bs-title",s.outerHTML),new ta(this.warningsLink,{title:s.outerHTML,html:!0,placement:"bottom"})}hideAll(){this.contentElem.style.display="none",this.pendingElem.style.display="none"}setPending(){this.contentElem.style.display="none",this.pendingElem.style.display="block"}setContent(t){this.contentElem.innerHTML=t,this.contentElem.style.display="block",this.pendingElem.style.display="none"}}class ir extends I{constructor(t,s,i={}){super(t,"sim-title-dropdown-root"),e(this,"dropdownMenu"),e(this,"specLabels",{[B.SpecBalanceDruid]:"Balance",[B.SpecFeralDruid]:"Feral DPS",[B.SpecFeralTankDruid]:"Feral Tank",[B.SpecRestorationDruid]:"Restoration",[B.SpecElementalShaman]:"Elemental",[B.SpecEnhancementShaman]:"Enhancement",[B.SpecRestorationShaman]:"Restoration",[B.SpecHunter]:"Hunter",[B.SpecMage]:"Mage",[B.SpecRogue]:"Rogue",[B.SpecHolyPaladin]:"Holy",[B.SpecProtectionPaladin]:"Protection",[B.SpecRetributionPaladin]:"Retribution",[B.SpecHealingPriest]:"Healing",[B.SpecShadowPriest]:"Shadow",[B.SpecWarlock]:"DPS",[B.SpecTankWarlock]:"Tank",[B.SpecWarrior]:"DPS",[B.SpecProtectionWarrior]:"Protection"});let a=null===s?{type:"Raid"}:{type:"Spec",index:s},n=this.buildRootSimLink(a);i.noDropdown?this.rootElem.innerHTML=n.outerHTML:(this.rootElem.innerHTML=`\n      <div class="dropdown sim-link-dropdown">\n        ${n.outerHTML}\n        <ul class="dropdown-menu"></ul>\n      </div>\n    `,this.dropdownMenu=this.rootElem.getElementsByClassName("dropdown-menu")[0],this.buildDropdown(),this.dropdownMenu.addEventListener("click",(t=>{t.target.closest('a:not([href="javascript:void(0)"]')||(t.stopPropagation(),t.preventDefault())})))}buildDropdown(){Wt.forEach((t=>{let e=document.createElement("li"),s=tr(t);1==s.length?(e.appendChild(this.buildClassLink(t)),this.dropdownMenu?.appendChild(e)):s.length>1&&(e.appendChild(this.buildClassDropdown(t)),this.dropdownMenu?.appendChild(e))}))}buildClassDropdown(t){let e=tr(t),s=document.createElement("fragment"),i=document.createElement("ul");i.classList.add("dropdown-menu");let a=this.buildClassLink(t);return e.forEach((t=>{let e=document.createElement("li"),s=this.buildSpecLink(t);e.appendChild(s),i.appendChild(e)})),s.innerHTML=`\n      <div class="dropend sim-link-dropdown">\n        ${a.outerHTML}\n        ${i.outerHTML}\n      </div>\n    `,s.children[0]}buildRootSimLink(t){let e,s=this.getSimIconPath(t),i=this.getContextualKlass(t);if("Raid"==t.type)e=Gt;else{let s=S[t.index];e=tr(s).length>1?Ot[t.index]:Bt[s]}let a=document.createElement("fragment");return a.innerHTML=`\n      <a href="javascript:void(0)" class="sim-link ${i}" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n        <div class="sim-link-content">\n          <img src="${s}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-label text-white">WoWSims - Season of Discovery</span>\n            <span class="sim-link-title">${e}</span>\n            ${this.launchStatusLabel(t)}\n          </div>\n        </div>\n      </a>\n    `,a.children[0]}buildRaidLink(){let t=this.getContextualKlass({type:"Raid"}),e=this.getSimIconPath({type:"Raid"}),s=Gt,i=document.createElement("fragment");return i.innerHTML=`\n      <a href="${Ht}" class="sim-link ${t}">\n        <div class="sim-link-content">\n          <img src="${e}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-title">${s}</span>\n            ${this.launchStatusLabel({type:"Raid"})}\n          </div>\n        </div>\n      </a>\n    `,i.children[0]}buildClassLink(t){let e=tr(t),s=e.length>1?"javascript:void(0)":qt(e[0]),i=this.getContextualKlass({type:"Class",index:t}),a=this.getSimIconPath({type:"Class",index:t}),n=Bt[t],o=document.createElement("fragment");return o.innerHTML=`\n      <a href="${s}" class="sim-link ${i}" ${e.length>1?'role="button" data-bs-toggle="dropdown" aria-expanded="false"':""}>\n        <div class="sim-link-content">\n          <img src="${a}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-title">${n}</span>\n            ${1==e.length?this.launchStatusLabel({type:"Spec",index:e[0]}):""}\n          </div>\n        </div>\n      </a>\n    `,o.children[0]}buildSpecLink(t){let e=qt(t),s=this.getContextualKlass({type:"Spec",index:t}),i=this.getSimIconPath({type:"Spec",index:t}),a=Bt[S[t]],n=this.specLabels[t],o=document.createElement("fragment");return o.innerHTML=`\n      <a href="${e}" class="sim-link ${s}" role="button">\n        <div class="sim-link-content">\n          <img src="${i}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-label">${a}</span>\n            <span class="sim-link-title">${n}</span>\n            ${this.launchStatusLabel({type:"Spec",index:t})}\n          </div>\n        </div>\n      </a>\n    `,o.children[0]}launchStatusLabel(t){if("Raid"==t.type&&2==Yl.Launched||"Spec"==t.type&&Ql[t.index]==Yl.Launched)return"";let e="Raid"==t.type?Yl[2]:Yl[Ql[t.index]],s=document.createElement("span");return s.classList.add("launch-status-label","text-brand"),s.textContent=e,s.outerHTML}getSimIconPath(t){let e;if("Raid"==t.type)e=Kt;else if("Class"==t.type){e=`/sod/assets/img/${Bt[t.index].toLowerCase().replace(/\s/g,"_")}_icon.png`}else e=zt[t.index];return e}getContextualKlass(t){return"Raid"==t.type?"text-white":"Class"==t.type?jt(t.index):$t(t.index)}}class ar extends p{constructor(t,s,i){super(t,"boolean-picker-root",s,i),e(this,"inputElem"),this.rootElem.classList.add("form-check","form-check-reverse"),this.inputElem=document.createElement("input"),this.inputElem.type="checkbox",this.inputElem.classList.add("boolean-picker-input","form-check-input"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(()=>{this.inputChanged(c.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){return Boolean(this.inputElem.checked)}setInputValue(t){this.inputElem.checked=t}}class nr extends p{constructor(t,s,i){super(t,"enum-picker-root",s,i),e(this,"selectElem"),this.selectElem=document.createElement("select"),this.selectElem.classList.add("enum-picker-selector","form-select"),i.values.forEach((t=>{const e=document.createElement("option");e.value=String(t.value),e.textContent=t.name,this.selectElem.appendChild(e),t.tooltip&&(e.title=t.tooltip)})),this.rootElem.appendChild(this.selectElem),this.init(),this.selectElem.addEventListener("change",(t=>{this.inputChanged(c.nextEventID())}))}getInputElem(){return this.selectElem}getInputValue(){return parseInt(this.selectElem.value)}setInputValue(t){this.selectElem.value=String(t)}}const or={fixed:!1};class lr extends I{constructor(t,s,i={}){super(t,"close-button",document.createElement("a")),e(this,"config"),this.config={...or,...i},this.config.fixed&&this.rootElem.classList.add("position-fixed"),this.rootElem.setAttribute("href","javascript:void(0)"),this.rootElem.setAttribute("role","button"),this.rootElem.addEventListener("click",(()=>s())),this.rootElem.insertAdjacentHTML("beforeend",'<i class="fas fa-times fa-2xl ms-1"></i>')}}const rr={closeButton:{},footer:!1,header:!0,scrollContents:!1,size:"lg",title:null};class cr extends I{constructor(t,s,i={}){super(t,"modal"),e(this,"modalConfig"),e(this,"modal"),e(this,"dialog"),e(this,"header"),e(this,"body"),e(this,"footer"),this.modalConfig={...rr,...i};const a=this.modalConfig.size&&"md"!=this.modalConfig.size?`modal-${this.modalConfig.size}`:"";this.rootElem.classList.add("fade"),this.rootElem.innerHTML=`\n\t\t\t<div class="modal-dialog ${s} ${a}">\n\t\t\t\t<div class="modal-content"></div>\n\t\t\t</div>\n\t\t`,this.dialog=this.rootElem.querySelector(".modal-dialog"),this.modalConfig.scrollContents&&this.dialog.classList.add("modal-overflow-scroll");const n=this.rootElem.querySelector(".modal-content");this.modalConfig.header&&(this.header=document.createElement("div"),this.header.classList.add("modal-header"),n.appendChild(this.header),this.modalConfig.title&&this.header.insertAdjacentHTML("afterbegin",`<h5 class="modal-title">${this.modalConfig.title}</h5>`)),this.body=document.createElement("div"),this.body.classList.add("modal-body"),n.appendChild(this.body),this.addCloseButton(),this.modalConfig.footer&&(this.footer=document.createElement("div"),this.footer.classList.add("modal-footer"),n.appendChild(this.footer)),this.modal=new ea(this.rootElem),this.open(),this.rootElem.addEventListener("hidden.bs.modal",(t=>{this.rootElem.remove(),this.dispose()}))}addCloseButton(){new lr(this.header?this.header:this.body,(()=>this.close()),this.modalConfig.closeButton)}onShow(t){}open(){this.rootElem.addEventListener("show.bs.modal",(async t=>{t.stopImmediatePropagation();const e=await new Promise((t=>{setTimeout((()=>{this.modal._backdrop._element&&t(this.modal._backdrop._element)}),100)}));this.rootElem.insertAdjacentElement("afterend",e),this.onShow(t)})),this.rootElem.addEventListener("hide.bs.modal",(t=>{t.stopImmediatePropagation()})),this.rootElem.addEventListener("hidden.bs.modal",(t=>{t.stopPropagation()})),this.modal.show()}close(){this.modal.hide()}}class dr extends cr{constructor(t,s){super(t,"settings-menu",{title:"Options",footer:!0}),e(this,"simUI"),this.simUI=s,this.body.innerHTML='\n\t\t\t<div class="picker-group">\n\t\t\t\t<div class="fixed-rng-seed-container">\n\t\t\t\t\t<div class="fixed-rng-seed"></div>\n\t\t\t\t\t<div class="form-text">\n\t\t\t\t\t\t<span>Last used RNG seed:</span>&nbsp;<span class="last-used-rng-seed">0</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="language-picker within-raid-sim-hide"></div>\n\t\t\t</div>\n\t\t\t<div class="show-threat-metrics-picker w-50 pe-2"></div>\n\t\t\t<div class="show-experimental-picker w-50 pe-2"></div>\n\t\t',this.footer.innerHTML='\n\t\t\t<button\n\t\t\t\tclass="restore-defaults-button btn btn-primary"\n\t\t\t>Restore Defaults</button>\n\t\t';const i=this.rootElem.getElementsByClassName("restore-defaults-button")[0];ta.getOrCreateInstance(i,{title:"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved."}),i.addEventListener("click",(t=>{this.simUI.applyDefaults(c.nextEventID())}));const a=this.rootElem.getElementsByClassName("fixed-rng-seed")[0];new er(a,this.simUI.sim,{label:"Fixed RNG Seed",labelTooltip:"Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.",extraCssClasses:["mb-0"],changedEvent:t=>t.fixedRngSeedChangeEmitter,getValue:t=>t.getFixedRngSeed(),setValue:(t,e,s)=>{e.setFixedRngSeed(t,s)}});const n=this.rootElem.getElementsByClassName("last-used-rng-seed")[0];n.textContent=String(this.simUI.sim.getLastUsedRngSeed()),this.simUI.sim.lastUsedRngSeedChangeEmitter.on((()=>n.textContent=String(this.simUI.sim.getLastUsedRngSeed())));const o=this.rootElem.getElementsByClassName("language-picker")[0],l=Object.keys(Jt),r=l.indexOf("en");new nr(o,this.simUI.sim,{label:"Language",labelTooltip:"Controls the language for Wowhead tooltips.",values:l.map(((t,e)=>({name:Jt[t],value:e}))),changedEvent:t=>t.languageChangeEmitter,getValue:t=>{const e=l.indexOf(t.getLanguage());return-1==e?r:e},setValue:(t,e,s)=>{e.setLanguage(t,l[s]||"en")}}).changeEmitter.on((()=>setTimeout((()=>location.reload()),100)));const d=this.rootElem.getElementsByClassName("show-threat-metrics-picker")[0];new ar(d,this.simUI.sim,{label:"Show Threat/Tank Options",labelTooltip:"Shows all options and metrics relevant to tanks, like TPS/DTPS.",inline:!0,changedEvent:t=>t.showThreatMetricsChangeEmitter,getValue:t=>t.getShowThreatMetrics(),setValue:(t,e,s)=>{e.setShowThreatMetrics(t,s)}});const h=this.rootElem.getElementsByClassName("show-experimental-picker")[0];new ar(h,this.simUI.sim,{label:"Show Experimental",labelTooltip:"Shows experimental options, if there are any active experiments.",inline:!0,changedEvent:t=>t.showExperimentalChangeEmitter,getValue:t=>t.getShowExperimental(),setValue:(t,e,s)=>{e.setShowExperimental(t,s)}})}}class hr extends I{constructor(t,s){super(t,"sim-header"),e(this,"simUI"),e(this,"simTabsContainer"),e(this,"simToolbar"),e(this,"knownIssuesLink"),e(this,"knownIssuesContent"),this.simUI=s,this.simTabsContainer=this.rootElem.querySelector(".sim-tabs"),this.simToolbar=this.rootElem.querySelector(".sim-toolbar"),this.knownIssuesContent=g("ul",{className:"text-start ps-3 mb-0"}),this.knownIssuesLink=this.addKnownIssuesLink(),this.addBugReportLink(),this.addDownloadBinaryLink(),this.addSimOptionsLink(),this.addSocialLinks(),new IntersectionObserver((([t])=>t.target.classList.toggle("stuck",t.intersectionRatio<1)),{threshold:[1]}).observe(this.rootElem)}activateTab(t){this.simTabsContainer.getElementsByClassName(t)[0].click()}addTab(t,e){const s=0==this.simTabsContainer.children.length;let i=g("li",{className:`${e} nav-item`,attributes:{role:"presentation"}},g("a",{className:`nav-link ${s&&"active"}`,dataset:{bsToggle:"tab",bsTarget:`#${e}`},attributes:{role:"tab","aria-selected":s},type:"button"},t));i.setAttribute("aria-controls",e),this.simTabsContainer.appendChild(i)}addSimTabLink(t){const e=0==this.simTabsContainer.children.length;t.navLink.setAttribute("aria-selected",e.toString()),e&&t.navLink.classList.add("active","show"),this.simTabsContainer.appendChild(t.navItem)}addImportLink(t,e,s){this.addImportExportLink("import-dropdown",t,e,s)}addExportLink(t,e,s){this.addImportExportLink("export-dropdown",t,e,s)}addImportExportLink(t,e,s,i){const a=this.rootElem.getElementsByClassName(t)[0].getElementsByClassName("dropdown-menu")[0],n=g("li",null,g("a",{href:"javascript:void(0)",className:"dropdown-item",attributes:{role:"button"}},e));n.children[0].addEventListener("click",(()=>s(a))),a.appendChild(n)}addToolbarLink(t){let e=g("div",{className:"sim-toolbar-item"},g("a",{href:t.href?t.href:"javascript:void(0)",className:t.classes,target:t.href?"_blank":"_self"},t.icon&&g("i",{className:t.icon}),t.text?` ${t.text} `:"")),s=e.children[0];return t.onclick&&s.addEventListener("click",(()=>{t.onclick&&t.onclick()})),t.tooltip&&new ta(s,{placement:"bottom",title:t.tooltip,html:!0}),t.parent.appendChild(e)}addKnownIssuesLink(){return this.addToolbarLink({parent:this.simToolbar,text:"Known Issues",tooltip:this.knownIssuesContent,classes:"known-issues link-danger hide"}).children[0]}addKnownIssue(t){this.knownIssuesContent.appendChild(g("li",null,t)),this.knownIssuesLink.classList.remove("hide"),ta.getInstance(this.knownIssuesLink)?.setContent({".tooltip-inner":this.knownIssuesContent})}addBugReportLink(){this.addToolbarLink({href:"https://github.com/wowsims/classic/issues/new/choose",parent:this.simToolbar,icon:"fas fa-bug fa-lg",tooltip:"Report a bug or<br>Request a feature"})}addDownloadBinaryLink(){let t="https://github.com/wowsims/classic/releases",e="fas fa-gauge-high fa-lg",s=this.simToolbar;document.location.href.includes("localhost")?fetch("/version").then((i=>{i.json().then((i=>{2==i.outdated&&this.addToolbarLink({href:t,parent:s,icon:e,tooltip:"Newer version of simulator available for download",classes:"downbin link-danger"})})).catch((t=>{console.warn("No version info found!")}))})):this.addToolbarLink({href:t,parent:s,icon:e,tooltip:"Download simulator for faster simulating",classes:"downbin"})}addSimOptionsLink(){this.addToolbarLink({parent:this.simToolbar,icon:"fas fa-cog fa-lg",tooltip:"Show Sim Options",classes:"sim-options",onclick:()=>new dr(this.simUI.rootElem,this.simUI)})}addSocialLinks(){let t=document.createElement("div");t.classList.add("sim-toolbar-socials"),this.simToolbar.appendChild(t),this.addDiscordLink(t),this.addGitHubLink(t),this.addPatreonLink(t)}addDiscordLink(t){this.addToolbarLink({href:"https://discord.gg/p3DgvmnDCS",parent:t,icon:"fab fa-discord fa-lg",tooltip:"Join us on Discord",classes:"discord-link link-alt"})}addGitHubLink(t){this.addToolbarLink({href:"https://github.com/wowsims/classic",parent:t,icon:"fab fa-github fa-lg",tooltip:"Contribute on GitHub",classes:"github-link link-alt"})}addPatreonLink(t){this.addToolbarLink({href:"https://patreon.com/wowsims",parent:t,text:"Support our devs",icon:"fab fa-patreon fa-lg",classes:"patreon-link link-alt"})}customRootElement(){return g("header",{className:"sim-header"},g("div",{className:"sim-header-container"},g("ul",{className:"sim-tabs nav nav-tabs",attributes:{role:"tablist"}}),g("div",{className:"import-export within-raid-sim-hide"},g("div",{className:"dropdown sim-dropdown-menu import-dropdown"},g("a",{href:"javascript:void(0)",className:"import-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},g("i",{className:"fa fa-download"})," Import "),g("ul",{className:"dropdown-menu"})),g("div",{className:"dropdown sim-dropdown-menu export-dropdown"},g("a",{href:"javascript:void(0)",className:"export-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},g("i",{className:"fa fa-right-from-bracket"})," Export "),g("ul",{className:"dropdown-menu"}))),g("div",{className:"sim-toolbar"})))}}const mr=[];class ur extends I{constructor(t,s,i){super(t,"sim-ui"),e(this,"sim"),e(this,"cssClass"),e(this,"cssScheme"),e(this,"isWithinRaidSim"),e(this,"changeEmitter"),e(this,"resultsViewer"),e(this,"simHeader"),e(this,"simContentContainer"),e(this,"simMain"),e(this,"simActionsContainer"),e(this,"iterationsPicker"),e(this,"simTabContentsContainer"),this.sim=s,this.cssClass=i.cssClass,this.cssScheme=i.cssScheme,this.isWithinRaidSim=null!=this.rootElem.closest(".within-raid-sim"),this.rootElem.innerHTML=`\n\t\t\t<div class="sim-root">\n\t\t\t\t<div class="sim-bg"></div>\n\t\t\t\t${i.noticeText?`<div class="notices-banner alert border-bottom mb-0 text-center">${i.noticeText}</div>`:""}\n\t\t\t\t<div class="sim-container">\n\t\t\t\t\t<aside class="sim-sidebar">\n\t\t\t\t\t\t<div class="sim-title"></div>\n\t\t\t\t\t\t<div class="sim-sidebar-content">\n\t\t\t\t\t\t\t<div class="sim-sidebar-actions within-raid-sim-hide"></div>\n\t\t\t\t\t\t\t<div class="sim-sidebar-results within-raid-sim-hide"></div>\n\t\t\t\t\t\t\t<div class="sim-sidebar-footer"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</aside>\n\t\t\t\t\t<div class="sim-content container-fluid"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,this.simContentContainer=this.rootElem.querySelector(".sim-content"),this.simHeader=new hr(this.simContentContainer,this),this.simMain=document.createElement("main"),this.simMain.classList.add("sim-main","tab-content"),this.simContentContainer.appendChild(this.simMain),this.rootElem.classList.add(this.cssClass),this.isWithinRaidSim||this.rootElem.classList.add("not-within-raid-sim"),this.changeEmitter=c.onAny([this.sim.changeEmitter],"SimUIChange"),this.sim.crashEmitter.on(((t,e)=>this.handleCrash(e)));const a=()=>{this.sim.getShowDamageMetrics()?this.rootElem.classList.remove("hide-damage-metrics"):this.rootElem.classList.add("hide-damage-metrics")};a(),this.sim.showDamageMetricsChangeEmitter.on(a);const n=()=>{this.sim.getShowThreatMetrics()?this.rootElem.classList.remove("hide-threat-metrics"):this.rootElem.classList.add("hide-threat-metrics")};n(),this.sim.showThreatMetricsChangeEmitter.on(n);const o=()=>{this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-healing-metrics"):this.rootElem.classList.add("hide-healing-metrics")};o(),this.sim.showHealingMetricsChangeEmitter.on(o);const l=()=>{this.sim.getShowThreatMetrics()||this.sim.getShowDamageMetrics()&&this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-ep-ratios"):this.rootElem.classList.add("hide-ep-ratios")};l(),this.sim.showDamageMetricsChangeEmitter.on(l),this.sim.showHealingMetricsChangeEmitter.on(l),this.sim.showThreatMetricsChangeEmitter.on(l);const r=()=>{this.sim.getShowExperimental()?this.rootElem.classList.remove("hide-experimental"):this.rootElem.classList.add("hide-experimental")};r(),this.sim.showExperimentalChangeEmitter.on(r),this.addKnownIssues(i);const d=this.rootElem.querySelector(".sim-title");new ir(d,i.spec,{noDropdown:this.isWithinRaidSim});const h=this.rootElem.getElementsByClassName("sim-sidebar-results")[0];this.resultsViewer=new sr(h),this.simActionsContainer=this.rootElem.getElementsByClassName("sim-sidebar-actions")[0],new er(this.simActionsContainer,this.sim,{label:"Iterations",extraCssClasses:["iterations-picker","within-raid-sim-hide"],changedEvent:t=>t.iterationsChangeEmitter,getValue:t=>t.getIterations(),setValue:(t,e,s)=>{e.setIterations(t,s)}}),this.iterationsPicker=this.rootElem.getElementsByClassName("iterations-picker")[0],this.simTabContentsContainer=this.rootElem.querySelector(".sim-main.tab-content"),this.isWithinRaidSim||window.addEventListener("message",(async t=>{"runOnce"==t.data&&this.runSimOnce()}))}addAction(t,e,s){const i=document.createElement("button");i.classList.add("btn","btn-primary","w-100",e),i.textContent=t,i.addEventListener("click",s),this.simActionsContainer.appendChild(i)}addTab(t,e,s){const i=e.replace(/\s+/g,"-")+"-tab",a=0==this.simTabContentsContainer.children.length;this.simHeader.addTab(t,i);const n=document.createElement("fragment");n.innerHTML=`\n\t\t\t<div\n\t\t\t\tid="${i}"\n\t\t\t\tclass="tab-pane fade ${a?"active show":""}"\n\t\t\t>${s}</div>\n\t\t`,this.simTabContentsContainer.appendChild(n.children[0])}addSimTab(t){this.simHeader.addSimTabLink(t)}addWarning(t){this.resultsViewer.addWarning(t)}addKnownIssues(t){let e="";t.launchStatus==Yl.Unlaunched?e="This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.":t.launchStatus==Yl.Alpha?e="This sim is in ALPHA. Bugs are expected; please let us know if you find one!":t.launchStatus==Yl.Beta&&(e="This sim is in BETA. There may still be a few bugs; please let us know if you find one!"),e&&(t.knownIssues=[e].concat(t.knownIssues||[])),t.knownIssues&&t.knownIssues.length&&t.knownIssues.forEach((t=>this.simHeader.addKnownIssue(t))),mr.forEach((t=>this.simHeader.addKnownIssue(t)))}getSettingsStorageKey(){return this.getStorageKey("__currentSettings__")}getSavedEncounterStorageKey(){return"sharedData__savedEncounter__"}isIndividualSim(){return this.rootElem.classList.contains("individual-sim-ui")}async runSim(t){this.resultsViewer.setPending();try{await this.sim.runRaidSim(c.nextEventID(),t)}catch(e){this.resultsViewer.hideAll(),this.handleCrash(e)}}async runSimOnce(){this.resultsViewer.setPending();try{await this.sim.runRaidSimWithLogs(c.nextEventID())}catch(t){this.resultsViewer.hideAll(),this.handleCrash(t)}}async handleCrash(t){if(!(t instanceof Oa))return void alert(t);const e=t.errorStr;if(e.startsWith("[USER_ERROR] ")){let t=e.substring(13);return t=await v.replaceAllInString(t),void alert(t)}if(window.confirm("Simulation Failure:\n"+e+"\nPress Ok to file crash report")){const t=this.hashCode(e),s=this.toLink(),i=this.sim.getLastUsedRngSeed();fetch("https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/classic+"+t).then((a=>{a.json().then((a=>{if(a.total_count>0)window.open(a.items[0].html_url,"_blank");else{const a=`${"https://github.com/wowsims/classic/issues/new?assignees=&labels=&title=Crash%20Report%20"}${t}&body=`,n=2048-a.length;let o=encodeURIComponent(`Link:\n${s}\n\nRNG Seed: ${i}\n\n${e}`);s.includes("/raid/")&&(o=encodeURIComponent(`${e}\nRNG Seed: ${i}\nLink:\n${s}`));let l=!1;for(;o.length>n-(l?3:0);)o=o.slice(0,o.lastIndexOf("%")),l=!0;l&&(o+="...",new pr(this.rootElem,s)),window.open(a+o,"_blank")}}))})).catch((t=>{alert("Failed to file report... try again another time:"+t)}))}}hashCode(t){let e=0;for(let s=0,i=t.length;s<i;s++){e=(e<<5)-e+t.charCodeAt(s),e|=0}return e}}class pr extends cr{constructor(t,e){super(t,"crash",{title:"Extra Crash Information"}),this.body.innerHTML='\n\t\t\t<div class="sim-crash-report">\n\t\t\t\t<h3 class="sim-crash-report-header">Please append the following complete link to the issue you just created. This will simplify debugging the issue.</h3>\n\t\t\t\t<textarea class="sim-crash-report-text form-control"></textarea>\n\t\t\t</div>\n\t\t';let s=document.createTextNode(e);this.body.querySelector("textarea")?.appendChild(s)}}class gr extends I{constructor(t,s,i,a){super(t,"character-stats-root"),e(this,"stats"),e(this,"valueElems"),e(this,"meleeCritCapValueElem"),e(this,"player"),e(this,"modifyDisplayStats"),this.stats=Zt.filter((t=>i.includes(t))),this.player=s,this.modifyDisplayStats=a;const o=document.createElement("label");o.classList.add("character-stats-label"),o.textContent="Stats",this.rootElem.appendChild(o);const l=document.createElement("table");if(l.classList.add("character-stats-table"),this.rootElem.appendChild(l),this.valueElems=[],this.stats.forEach((t=>{let e=n(t,s.getClass());const i=g("tr",{className:"character-stats-table-row"},g("td",{className:"character-stats-table-label"},e),g("td",{className:"character-stats-table-value"},this.bonusStatsLink(t)));l.appendChild(i);const a=i.getElementsByClassName("character-stats-table-value")[0];this.valueElems.push(a)})),this.shouldShowMeleeCritCap(s)){const t=g("tr",{className:"character-stats-table-row"},g("td",{className:"character-stats-table-label"},"Melee Crit Cap"),g("td",{className:"character-stats-table-value"}));l.appendChild(t),this.meleeCritCapValueElem=t.getElementsByClassName("character-stats-table-value")[0]}else this.meleeCritCapValueElem=void 0;this.updateStats(s),c.onAny([s.currentStatsEmitter,s.sim.changeEmitter,s.talentsChangeEmitter]).on((()=>{this.updateStats(s)}))}updateStats(t){const e=t.getCurrentStats(),s=this.modifyDisplayStats?this.modifyDisplayStats(this.player):{talents:new oa},i=oa.fromProto(e.baseStats),a=oa.fromProto(e.gearStats),n=oa.fromProto(e.talentsStats),o=oa.fromProto(e.buffsStats),l=oa.fromProto(e.consumesStats),r=this.getDebuffStats(),c=t.getBonusStats(),d=i,h=a.subtract(i).subtract(c),m=n.subtract(a).add(s.talents),u=o.subtract(n),p=l.subtract(o),f=oa.fromProto(e.finalStats).add(s.talents).add(r);if(this.stats.forEach(((t,e)=>{let s=g("a",{href:"javascript:void(0)",className:"stat-value-link",attributes:{role:"button"}},`${this.statDisplayString(f,f,t)} `);this.valueElems[e].querySelector(".stat-value-link")?.remove(),this.valueElems[e].prepend(s);let I=c.getStat(t);0==I?s.classList.add("text-white"):I>0?s.classList.add("text-success"):I<0&&s.classList.add("text-danger");let w=g("div",null,g("div",{className:"character-stats-tooltip-row"},g("span",null,"Base:"),g("span",null,this.statDisplayString(i,d,t))),g("div",{className:"character-stats-tooltip-row"},g("span",null,"Gear:"),g("span",null,this.statDisplayString(a,h,t))),g("div",{className:"character-stats-tooltip-row"},g("span",null,"Talents:"),g("span",null,this.statDisplayString(n,m,t))),g("div",{className:"character-stats-tooltip-row"},g("span",null,"Buffs:"),g("span",null,this.statDisplayString(o,u,t))),g("div",{className:"character-stats-tooltip-row"},g("span",null,"Consumes:"),g("span",null,this.statDisplayString(l,p,t))),0!=r.getStat(t)&&g("div",{className:"character-stats-tooltip-row"},g("span",null,"Debuffs:"),g("span",null,this.statDisplayString(r,r,t))),0!=I&&g("div",{className:"character-stats-tooltip-row"},g("span",null,"Bonus:"),g("span",null,this.statDisplayString(c,c,t))),g("div",{className:"character-stats-tooltip-row"},g("span",null,"Total:"),g("span",null,this.statDisplayString(f,f,t))));ta.getOrCreateInstance(s,{title:w,html:!0})})),this.meleeCritCapValueElem){const e=t.getMeleeCritCapInfo(),s=g("a",{href:"javascript:void(0)",className:"stat-value-link",attributes:{role:"button"}},`${this.meleeCritCapDisplayString(t,f)} `),i=e.playerCritCapDelta;0==i?s.classList.add("text-white"):i>0?s.classList.add("text-danger"):i<0&&s.classList.add("text-success"),this.meleeCritCapValueElem.querySelector(".stat-value-link")?.remove(),this.meleeCritCapValueElem.prepend(s);const a=g("div",null,g("div",{className:"character-stats-tooltip-row"},g("span",null,"Glancing:"),g("span",null,`${e.glancing.toFixed(2)}%`)),g("div",{className:"character-stats-tooltip-row"},g("span",null,"Suppression:"),g("span",null,`${e.suppression.toFixed(2)}%`)),g("div",{className:"character-stats-tooltip-row"},g("span",null,"To Hit Cap:"),g("span",null,`${e.remainingMeleeHitCap.toFixed(2)}%`)),g("div",{className:"character-stats-tooltip-row"},g("span",null,"To Exp Cap:"),g("span",null,`${e.remainingExpertiseCap.toFixed(2)}%`)),g("div",{className:"character-stats-tooltip-row"},g("span",null,"Debuffs:"),g("span",null,`${e.debuffCrit.toFixed(2)}%`)),0!=e.specSpecificOffset&&g("div",{className:"character-stats-tooltip-row"},g("span",null,"Spec Offsets:"),g("span",null,`${e.specSpecificOffset.toFixed(2)}%`)),g("div",{className:"character-stats-tooltip-row"},g("span",null,"Final Crit Cap:"),g("span",null,`${e.baseCritCap.toFixed(2)}%`)),g("hr",null),g("div",{className:"character-stats-tooltip-row"},g("span",null,"Can Raise By:"),g("span",null,`${(e.remainingExpertiseCap+e.remainingMeleeHitCap).toFixed(2)}%`)));ta.getOrCreateInstance(s,{title:a,html:!0})}}statDisplayString(t,e,s){let n=e.getStat(s);s==i.StatBlockValue&&(n*=t.getPseudoStat(a.PseudoStatBlockValueMultiplier)||1);let o=String(Math.round(n));if(s==i.StatMeleeHit)o=`${(n/H).toFixed(2)}%`;else if(s==i.StatSpellHit)o=`${(n/Yt).toFixed(2)}%`;else if(s==i.StatArcanePower||s==i.StatFirePower||s==i.StatFrostPower||s==i.StatHolyPower||s==i.StatNaturePower||s==i.StatShadowPower){const t=Math.round(n);o=Math.round(e.getStat(i.StatSpellPower))+t+` (+${t})`}else s==i.StatMeleeCrit||s==i.StatSpellCrit?o=`${(n/Xt).toFixed(2)}%`:s==i.StatMeleeHaste?[m.ClassDruid,m.ClassShaman,m.ClassPaladin].includes(this.player.getClass())?o+=` (${(n/Qt).toFixed(2)}%)`:o+=` (${(n/te).toFixed(2)}%)`:s==i.StatSpellHaste?o=`${(n/te).toFixed(2)}%`:s==i.StatArmorPenetration?o+=` (${(n/ee).toFixed(2)}%)`:s==i.StatExpertise?o+=` (${(n/q/4).toFixed(2)}%)`:s==i.StatDefense?o+=` (${(5*se+Math.floor(n/ie)).toFixed(0)})`:s==i.StatBlock?o+=` (${(n/ae+ne*Math.floor(t.getStat(i.StatDefense)/ie)+5).toFixed(2)}%)`:s==i.StatDodge?o+=` (${(100*t.getPseudoStat(a.PseudoStatDodge)).toFixed(2)}%)`:s==i.StatParry?o+=` (${(100*t.getPseudoStat(a.PseudoStatParry)).toFixed(2)}%)`:s==i.StatResilience&&(o+=` (${(n/oe).toFixed(2)}%)`);return o}getDebuffStats(){return new oa}bonusStatsLink(t){let e=n(t,this.player.getClass()),s=g("a",{href:"javascript:void(0)",className:"add-bonus-stats text-white ms-2",dataset:{bsToggle:"popover"},attributes:{role:"button"}},g("i",{className:"fas fa-plus-minus"})),i=null,a=new er(null,this.player,{label:`Bonus ${e}`,extraCssClasses:["mb-0"],changedEvent:t=>t.bonusStatsChangeEmitter,getValue:e=>e.getBonusStats().getStat(t),setValue:(e,s,a)=>{const n=s.getBonusStats().withStat(t,a);s.setBonusStats(e,n),i?.hide()}});return i=new sa(s,{customClass:"bonus-stats-popover",placement:"right",fallbackPlacement:["left"],sanitize:!1,html:!0,content:a.rootElem}),s}shouldShowMeleeCritCap(t){return[B.SpecEnhancementShaman,B.SpecRetributionPaladin,B.SpecRogue,B.SpecWarrior].includes(t.spec)}meleeCritCapDisplayString(t,e){const s=t.getMeleeCritCap();if(0===s)return"Exact";return`${s>0?"Over by ":"Under by "} ${Math.abs(s).toFixed(2)}%`}}const fr=class extends cr{constructor(t,s,i,a){super(t.rootElem,"ep-weights-menu",function(t){const e={footer:!0,scrollContents:!0};return t.sim.getShowThreatMetrics()&&t.sim.getShowExperimental()?{size:"xl",...e}:e}(t)),e(this,"simUI"),e(this,"container"),e(this,"table"),e(this,"tableBody"),e(this,"resultsViewer"),e(this,"statsType"),e(this,"epStats"),e(this,"epPseudoStats"),e(this,"epReferenceStat"),e(this,"showAllStats",!1),this.simUI=t,this.statsType="ep",this.epStats=s,this.epPseudoStats=i,this.epReferenceStat=a,this.header?.insertAdjacentHTML("afterbegin",'<h5 class="modal-title">Calculate Stat Weights</h5>'),this.body.innerHTML='\n\t\t\t<div class="ep-weights-options row">\n\t\t\t\t<div class="col col-sm-3">\n\t\t\t\t\t<select class="ep-type-select form-select">\n\t\t\t\t\t\t<option value="ep">EP</option>\n\t\t\t\t\t\t<option value="weight">Weights</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="show-all-stats-container col col-sm-3"></div>\n\t\t\t</div>\n\t\t\t<div class="ep-reference-options row experimental">\n\t\t\t\t<div class="col col-sm-4 damage-metrics">\n\t\t\t\t\t<span>DPS/TPS reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select damage-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 healing-metrics">\n\t\t\t\t\t<span>Healing reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select healing-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 threat-metrics">\n\t\t\t\t\t<span>Mitigation reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select threat-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<p>The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.</p>\n\t\t\t</div>\n\t\t\t<p>The \'Current EP\' column displays the values currently used by the item pickers to sort items.</br>\n\t\t\tUse the <a href=\'javascript:void(0)\' class="fa fa-copy"></a> icon above the EPs to use newly calculated EPs.</p>\n\t\t\t<div class="results-ep-table-container modal-scroll-table">\n\t\t\t\t<div class="results-pending-overlay"></div>\n\t\t\t\t<table class="results-ep-table">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Stat</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>HPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>HPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>TPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>TPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DTPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DTPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight experimental">\n\t\t\t\t\t\t\t\t<span>TMI Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep experimental">\n\t\t\t\t\t\t\t\t<span>TMI EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight experimental">\n\t\t\t\t\t\t\t\t<span>Death Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep experimental">\n\t\t\t\t\t\t\t\t<span>Death EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th style="text-align: center">\n\t\t\t\t\t\t\t\t<span>Current EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-arrows-rotate"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr class="ep-ratios">\n\t\t\t\t\t\t\t<td>EP Ratio</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="text-align: center; vertical-align: middle;">\n\t\t\t\t\t\t\t\t<button class="btn btn-primary compute-ep">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\t\t\t\t\t\t<span class="not-tiny">Update </span>EP\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t',this.footer.innerHTML='\n\t\t\t<button class="btn btn-primary calc-weights">\n\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\tCalculate\n\t\t\t</button>\n\t\t',this.container=this.rootElem.querySelector(".results-ep-table-container"),this.table=this.rootElem.querySelector(".results-ep-table"),this.tableBody=this.rootElem.querySelector(".results-ep-table tbody");const o=this.rootElem.querySelector(".results-pending-overlay");this.resultsViewer=new sr(o);const l=()=>{"ep"==this.statsType?(this.table.classList.remove("stats-type-weight"),this.table.classList.add("stats-type-ep")):(this.table.classList.add("stats-type-weight"),this.table.classList.remove("stats-type-ep"))},r=this.rootElem.getElementsByClassName("ep-type-select")[0];r.addEventListener("input",(t=>{this.statsType=r.value,l()})),r.value=this.statsType,l();const d=t=>void 0!==t?n(t,this.simUI.player.getClass()):"??",h=t=>{for(let e of this.epStats)if(d(e)==t)return e},m=()=>{this.simUI.player.epRefStatChangeEmitter.emit(c.nextEventID()),this.simUI.prevEpSimResult=this.calculateEp(this.getPrevSimResult()),this.updateTable()};this.rootElem.querySelectorAll(".ref-stat-select").forEach(((t,e)=>{this.epStats.forEach((e=>{t.options[t.options.length]=new Option(d(e))})),t.classList.contains("damage-metrics")?(t.addEventListener("input",(e=>{this.simUI.dpsRefStat=h(t.value),m()})),t.value=d(this.getDpsEpRefStat())):t.classList.contains("healing-metrics")?(t.addEventListener("input",(e=>{this.simUI.healRefStat=h(t.value),m()})),t.value=d(this.getHealEpRefStat())):t.classList.contains("threat-metrics")&&(t.addEventListener("input",(e=>{this.simUI.tankRefStat=h(t.value),m()})),t.value=d(this.getTankEpRefStat()))}));const u=this.rootElem.getElementsByClassName("calc-weights")[0];u.addEventListener("click",(async t=>{const e=u.innerHTML;u.classList.add("disabled"),u.style.width=`${u.getBoundingClientRect().width.toFixed(3)}px`,u.innerHTML='<i class="fa fa-spinner fa-spin"></i>&nbsp;Running',this.container.scrollTo({top:0}),this.container.classList.add("pending"),this.resultsViewer.setPending();const s=this.simUI.sim.getIterations(),i=await this.simUI.player.computeStatWeights(c.nextEventID(),this.epStats,this.epPseudoStats,this.epReferenceStat,(t=>{this.setSimProgress(t)}));this.container.classList.remove("pending"),this.resultsViewer.hideAll(),u.innerHTML=e,u.classList.remove("disabled"),this.simUI.prevEpIterations=s,this.simUI.prevEpSimResult=this.calculateEp(i),this.updateTable()}));const p=Array.from(this.rootElem.getElementsByClassName("col-action")),g=(t,e,s,i,a)=>{const n=t.previousElementSibling;new ta(n,{toggle:"tooltip",html:!0,title:()=>{if(!a)return e;const t=d(a());return e+` Normalized by ${t}.`}}),ta.getOrCreateInstance(t,{title:s,html:!0}),t.addEventListener("click",(t=>{this.simUI.player.setEpWeights(c.nextEventID(),oa.fromProto(i())),this.updateTable()}))};g(p[0],"Per-point increase in DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.weights)),g(p[1],"EP (Equivalency Points) for DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.epValues),(()=>this.getDpsEpRefStat())),g(p[2],"Per-point increase in HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.weights)),g(p[3],"EP (Equivalency Points) for HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.epValues),(()=>this.getHealEpRefStat())),g(p[4],"Per-point increase in TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.weights)),g(p[5],"EP (Equivalency Points) for TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.epValues),(()=>this.getDpsEpRefStat())),g(p[6],"Per-point increase in DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.weights)),g(p[7],"EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.epValues),(()=>this.getTankEpRefStat())),g(p[8],"Per-point decrease in TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.weights)),g(p[9],"EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.epValues),(()=>this.getTankEpRefStat())),g(p[10],"Per-point decrease in p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.weights)),g(p[11],"EP (Equivalency Points) for p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.epValues),(()=>this.getTankEpRefStat())),g(p[12],"Current EP Weights. Used to sort the gear selector menus.","Restore Default EP",(()=>this.simUI.individualConfig.defaults.epWeights.toProto()));const f=this.rootElem.getElementsByClassName("show-all-stats-container")[0];new ar(f,this,{label:"Show All Stats",inline:!0,changedEvent:()=>new c,getValue:()=>this.showAllStats,setValue:(t,e,s)=>{this.showAllStats=s,this.updateTable()}}),this.updateTable();const I=(t,e)=>{new er(t,this.simUI.player,{float:!0,changedEvent:t=>t.epRatiosChangeEmitter,getValue:t=>this.simUI.player.getEpRatios()[e],setValue:(t,s,i)=>{const a=s.getEpRatios();a[e]=i,s.setEpRatios(t,a)}})};this.body.querySelectorAll(".type-ratio.type-ep").forEach(I),this.simUI.player.epRatiosChangeEmitter.on((t=>this.updateTable()));this.body.querySelectorAll(".type-ratio.type-weight").forEach(I);const w=this.rootElem.getElementsByClassName("compute-ep")[0];ta.getOrCreateInstance(w,{title:"Compute Weighted EP"}),w.addEventListener("click",(t=>{const e=this.getPrevSimResult(),s=this.simUI.player.getEpRatios();if("ep"==this.statsType){const t=oa.fromProto(e.dps.epValues).scale(s[0]),i=oa.fromProto(e.hps.epValues).scale(s[1]),a=oa.fromProto(e.tps.epValues).scale(s[2]),n=oa.fromProto(e.dtps.epValues).scale(s[3]),o=oa.fromProto(e.tmi.epValues).scale(s[4]),l=oa.fromProto(e.pDeath.epValues).scale(s[5]),r=t.add(i).add(a).add(n).add(o).add(l);this.simUI.player.setEpWeights(c.nextEventID(),r)}else{const t=oa.fromProto(e.dps.weights).scale(s[0]),i=oa.fromProto(e.hps.weights).scale(s[1]),a=oa.fromProto(e.tps.weights).scale(s[2]),n=oa.fromProto(e.dtps.weights).scale(s[3]),o=oa.fromProto(e.tmi.weights).scale(s[4]),l=oa.fromProto(e.pDeath.weights).scale(s[5]),r=t.add(i).add(a).add(n).add(o).add(l);this.simUI.player.setEpWeights(c.nextEventID(),r)}this.updateTable()}))}setSimProgress(t){this.resultsViewer.setContent(`\n\t\t\t<div class="results-sim">\n\t\t\t\t<div class=""> ${t.completedSims} / ${t.totalSims}<br>simulations complete</div>\n\t\t\t\t<div class="">\n\t\t\t\t\t${t.completedIterations} / ${t.totalIterations}<br>iterations complete\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)}updateTable(){this.tableBody.innerHTML="",fr.epUnitStats.forEach((t=>{if(!this.showAllStats&&t.isStat()&&!this.epStats.includes(t.getStat())||t.isPseudoStat()&&!this.epPseudoStats.includes(t.getPseudoStat()))return;const e=this.makeTableRow(t);this.tableBody.appendChild(e)}))}makeTableRow(t){const e=document.createElement("tr"),s=this.simUI.prevEpSimResult,i=this.simUI.player.getEpRatios(),a=function(t,e,s){return s?e[0]*t.getProtoValue(s.dps?.epValues)+e[1]*t.getProtoValue(s.hps?.epValues)+e[2]*t.getProtoValue(s.tps?.epValues)+e[3]*t.getProtoValue(s.dtps?.epValues)+e[4]*t.getProtoValue(s.tmi?.epValues)+e[5]*t.getProtoValue(s.pDeath?.epValues):0}(t,i,s);e.innerHTML=`\n\t\t\t<td>${t.getName(this.simUI.player.getClass())}</td>\n\t\t\t${this.makeTableRowCells(t,s?.dps,"damage-metrics",a,i[0])}\n\t\t\t${this.makeTableRowCells(t,s?.hps,"healing-metrics",a,i[1])}\n\t\t\t${this.makeTableRowCells(t,s?.tps,"threat-metrics",a,i[2])}\n\t\t\t${this.makeTableRowCells(t,s?.dtps,"threat-metrics",a,i[3])}\n\t\t\t${this.makeTableRowCells(t,s?.tmi,"threat-metrics experimental",a,i[4])}\n\t\t\t${this.makeTableRowCells(t,s?.pDeath,"threat-metrics experimental",a,i[5])}\n\t\t\t<td class="current-ep"></td>\n\t\t`;const n=e.querySelector(".current-ep");return new er(n,this.simUI.player,{float:!0,changedEvent:t=>t.epWeightsChangeEmitter,getValue:e=>this.simUI.player.getEpWeights().getUnitStat(t),setValue:(e,s,i)=>{const a=s.getEpWeights().withUnitStat(t,i);s.setEpWeights(e,a)}}),e}makeTableRowCells(t,e,s,i,a){var n,o;if(e){const s=t.getProtoValue(e.weights),i=t.getProtoValue(e.weightsStdev);n=this.makeTableCellContents(s,i);const a=t.getProtoValue(e.epValues),l=t.getProtoValue(e.epValuesStdev);o=this.makeTableCellContents(a,l)}else o=n='<span class="results-avg notapplicable">N/A</span>';let l=document.createElement("template");if(l.innerHTML=`\n\t\t\t<td class="stdev-cell ${s} type-weight">\n\t\t\t\t${n}\n\t\t\t</td>\n\t\t\t<td class="stdev-cell ${s} type-ep">\n\t\t\t\t${o}\n\t\t\t</td>\n\t\t`,!e)return l.innerHTML;if(0==a){return l.content.querySelectorAll(".stdev-cell").forEach((t=>t.classList.add("unused-ep"))),l.innerHTML}const r=i-this.simUI.player.getEpWeights().getUnitStat(t),c=l.content.querySelector(".type-ep .results-avg");return"0.00"==r.toFixed(2)||(r>0?c.classList.add("positive"):r<0&&c.classList.add("negative")),l.innerHTML}makeTableCellContents(t,e){const s=this.simUI.prevEpIterations||1;return`\n\t\t\t<span class="results-avg">${t.toFixed(2)}</span>\n\t\t\t<span class="results-stdev">\n\t\t\t\t(<i class="fas fa-plus-minus fa-xs"></i>${le(e,s).toFixed(2)})\n\t\t\t</span>\n\t\t`}calculateEp(t){var e=vt.clone(t);const s=(t,e)=>{const s=na.fromStat(t),i=s.getProtoValue(e.weights),a=s.getProtoValue(e.weightsStdev);fr.epUnitStats.forEach((t=>{const s=t.getProtoValue(e.weights);t.setProtoValue(e.epValues,0==i?0:s/i);const n=t.getProtoValue(e.weightsStdev);t.setProtoValue(e.epValuesStdev,0==a?0:n/a)}))};return void 0!==this.simUI.dpsRefStat&&(s(this.simUI.dpsRefStat,e.dps),s(this.simUI.dpsRefStat,e.tps)),void 0!==this.simUI.healRefStat&&s(this.simUI.healRefStat,e.hps),void 0!==this.simUI.tankRefStat&&(s(this.simUI.tankRefStat,e.dtps),s(this.simUI.tankRefStat,e.tmi),s(this.simUI.tankRefStat,e.pDeath)),e}getDpsEpRefStat(){return void 0!==this.simUI.dpsRefStat?this.simUI.dpsRefStat:this.epReferenceStat}getHealEpRefStat(){return void 0!==this.simUI.healRefStat?this.simUI.healRefStat:this.epReferenceStat}getTankEpRefStat(){return void 0!==this.simUI.tankRefStat?this.simUI.tankRefStat:i.StatArmor}getPrevSimResult(){return this.simUI.prevEpSimResult||vt.create({dps:{weights:(new oa).toProto(),weightsStdev:(new oa).toProto(),epValues:(new oa).toProto(),epValuesStdev:(new oa).toProto()},hps:{weights:(new oa).toProto(),weightsStdev:(new oa).toProto(),epValues:(new oa).toProto(),epValuesStdev:(new oa).toProto()},tps:{weights:(new oa).toProto(),weightsStdev:(new oa).toProto(),epValues:(new oa).toProto(),epValuesStdev:(new oa).toProto()},dtps:{weights:(new oa).toProto(),weightsStdev:(new oa).toProto(),epValues:(new oa).toProto(),epValuesStdev:(new oa).toProto()},tmi:{weights:(new oa).toProto(),weightsStdev:(new oa).toProto(),epValues:(new oa).toProto(),epValuesStdev:(new oa).toProto()},pDeath:{weights:(new oa).toProto(),weightsStdev:(new oa).toProto(),epValues:(new oa).toProto(),epValuesStdev:(new oa).toProto()}})}};let Ir=fr;e(Ir,"epUnitStats",na.getAll().filter((t=>!!t.isStat()||[a.PseudoStatMainHandDps,a.PseudoStatOffHandDps,a.PseudoStatRangedDps].includes(t.getPseudoStat()))));class wr extends I{constructor(t,s,i){super(t,"content-block",i.rootElem),e(this,"headerElement"),e(this,"bodyElement"),e(this,"config"),this.config=i,this.rootElem.classList.add(s),i.extraCssClasses&&this.rootElem.classList.add(...i.extraCssClasses),this.headerElement=this.buildHeader(),this.bodyElement=this.buildBody(),i.bodyClasses?.forEach((t=>{this.bodyElement.classList.add(t)}))}buildHeader(){if(this.config.header&&Object.keys(this.config.header).length){let t=this.config.header.titleTag||"h6",e=g("div",{className:"content-block-header"},g(t,{className:"content-block-title"},this.config.header.title));return this.config.header.extraCssClasses&&e.classList.add(...this.config.header.extraCssClasses),this.config.header.tooltip&&ta.getOrCreateInstance(e.querySelector(".content-block-title"),{html:!0,title:this.config.header.tooltip}),this.rootElem.appendChild(e),e}return null}buildBody(){let t=document.createElement("div");return t.classList.add("content-block-body"),this.rootElem.appendChild(t),t}}class br extends cr{constructor(t,s,i,a){super(t,"importer",{title:i,footer:!0}),e(this,"textElem"),e(this,"descriptionElem"),e(this,"importButton"),e(this,"includeFile"),this.includeFile=a;const n="upload-input-"+i.toLowerCase().replaceAll(" ","-");if(this.body.innerHTML='\n\t\t\t<div class="import-description"></div>\n\t\t\t<textarea spellCheck="false" class="importer-textarea form-control"></textarea>\n\t\t',this.footer.innerHTML=`\n\t\t\t${this.includeFile?`\n\t\t\t\t<label for="${n}" class="importer-button btn btn-primary upload-button me-2">\n\t\t\t\t\t<i class="fas fa-file-arrow-up"></i>\n\t\t\t\t\tUpload File\n\t\t\t\t</label>\n\t\t\t\t<input type="file" id="${n}" class="importer-upload-input d-none" hidden>\n\t\t\t`:""}\n\t\t\t<button class="importer-button btn btn-primary import-button">\n\t\t\t\t<i class="fa fa-download"></i>\n\t\t\t\tImport\n\t\t\t</button>\n\t\t`,this.textElem=this.rootElem.getElementsByClassName("importer-textarea")[0],this.descriptionElem=this.rootElem.getElementsByClassName("import-description")[0],this.includeFile){this.rootElem.getElementsByClassName("importer-upload-input")[0].addEventListener("change",(async t=>{const e=await t.target.files[0].text();this.textElem.textContent=e}))}this.importButton=this.rootElem.getElementsByClassName("import-button")[0],this.importButton.addEventListener("click",(()=>{try{this.onImport(this.textElem.value||"")}catch(t){alert("Import error: "+t)}}))}async finishIndividualImport(t,e,s,i,a,n){const o=t.player.getClass();if(e!=o)throw new Error(`Wrong Class! Expected ${ge.get(o)} but found ${ge.get(e)}!`);await et.loadLeftoversIfNecessary(i);const l=t.sim.db.lookupEquipmentSpec(i),r=i.items.map((t=>t.enchant)),d=l.asSpec().items.map((t=>t.enchant)),h=r.filter((t=>0!=t&&!d.includes(t))),m=i.items.map((t=>t.id)),u=l.asSpec().items.map((t=>t.id)),p=m.filter((t=>!u.includes(t))),g=c.nextEventID();c.freezeAllAndDo((()=>{t.player.setRace(g,s),t.player.setGear(g,l),a&&"--"!=a&&t.player.setTalentsString(g,a),n.length>0&&t.player.setProfessions(g,n)})),this.close(),0==p.length&&0==h.length?alert("Import successful!"):alert("Import successful, but the following IDs were not found in the sim database:"+(0==p.length?"":"\n\nItems: "+p.join(", "))+(0==h.length?"":"\n\nEnchants: "+h.join(", ")))}}const xr=class{static tryParseUrlLocation(t){let e=t.hash;if(e.length<=1)return null;e=e.substring(1);const s=atob(e),i=new Uint8Array(s.length);for(let r=0;r<i.length;r++)i[r]=s.charCodeAt(r);const a=Zl.inflate(i),n=re.fromBinary(a);let o=xr.DEFAULT_CATEGORIES;const l=new URLSearchParams(window.location.search);if(l.has(xr.CATEGORY_PARAM)){o=l.get(xr.CATEGORY_PARAM).split("").map((t=>[...xr.CATEGORY_KEYS.entries()].find((e=>e[1]==t)))).filter((t=>t)).map((t=>t[0]))}return{settings:n,categories:o}}};let vr=xr;e(vr,"DEFAULT_CATEGORIES",s(Ua).filter((t=>t!=Ua.UISettings))),e(vr,"CATEGORY_PARAM","i"),e(vr,"CATEGORY_KEYS",(()=>{const t=new Map;return t.set(Ua.Gear,"g"),t.set(Ua.Talents,"t"),t.set(Ua.Rotation,"r"),t.set(Ua.Consumes,"c"),t.set(Ua.Miscellaneous,"m"),t.set(Ua.External,"x"),t.set(Ua.Encounter,"e"),t.set(Ua.UISettings,"u"),t})());class Er extends br{constructor(t,s){super(t,s,"JSON Import",!0),e(this,"simUI"),this.simUI=s,this.descriptionElem.innerHTML="\n\t\t\t<p>Import settings from a JSON file, which can be created using the JSON Export feature.</p>\n\t\t\t<p>To import, upload the file or paste the text below, then click, 'Import'.</p>\n\t\t"}async onImport(t){const e=re.fromJsonString(t,{ignoreUnknownFields:!0});e.player?.equipment&&await et.loadLeftoversIfNecessary(e.player.equipment),this.simUI.isWithinRaidSim?e.player&&this.simUI.player.fromProto(c.nextEventID(),e.player):this.simUI.fromProto(c.nextEventID(),e),this.close()}}const Sr=class extends br{constructor(t,s){super(t,s,"Wowhead Import",!0),e(this,"simUI"),this.simUI=s,this.descriptionElem.innerHTML='\n\t\t\t<p>\n\t\t\t\tImport settings from <a href="https://www.wowhead.com/classic/gear-planner" target="_blank">Wowhead Gear Planner</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the gear planner link below and click, \'Import\'.\n\t\t\t</p>\n\t\t'}onImport(t){const e=t.match(/www\.wowhead\.com\/classic\/gear-planner\/([a-z\-]+)\/([a-z\-]+)\/([a-zA-Z0-9_\-]+)/);if(!e)throw new Error(`Invalid WCL URL ${t}, must look like "https://www.wowhead.com/classic/gear-planner/CLASS/RACE/XXXX"`);const s=ce(e[1].replaceAll("-",""));if(s==m.ClassUnknown)throw new Error("Could not parse Class: "+e[1]);const i=de(e[2].replaceAll("-",""));if(i==he.RaceUnknown)throw new Error("Could not parse Race: "+e[2]);const a=e[3].replaceAll("_","/").replaceAll("-","+"),n=Uint8Array.from(atob(a),(t=>t.charCodeAt(0))),o=n[3],l=n.subarray(4,4+o),r=me(l).split("f").slice(0,3).join("-"),c=n.subarray(o),d=ue.create();let h=0;for(;h<c.length;){const t=pe.create(),e=63&c[h],s=Boolean(128&c[h]);h++;const i=31&c[h];if(h++,t.id=(i<<16)+(c[h]<<8)+c[h+1],h+=2,s){const e=(c[h]<<16)+(c[h+1]<<8)+c[h+2];t.enchant=this.simUI.sim.db.enchantSpellIdToEffectId(e),h+=3}null!=Object.entries(Sr.slotIDs).find((t=>t[1]==e))&&d.items.push(t)}this.simUI.sim.db.lookupEquipmentSpec(d),this.finishIndividualImport(this.simUI,s,i,d,r,[])}};e(Sr,"slotIDs",{[D.ItemSlotHead]:1,[D.ItemSlotNeck]:2,[D.ItemSlotShoulder]:3,[D.ItemSlotBack]:15,[D.ItemSlotChest]:5,[D.ItemSlotWrist]:9,[D.ItemSlotHands]:10,[D.ItemSlotWaist]:6,[D.ItemSlotLegs]:7,[D.ItemSlotFeet]:8,[D.ItemSlotFinger1]:11,[D.ItemSlotFinger2]:12,[D.ItemSlotTrinket1]:13,[D.ItemSlotTrinket2]:14,[D.ItemSlotMainHand]:16,[D.ItemSlotOffHand]:17,[D.ItemSlotRanged]:18});const yr={[Z.UNSPECIFIED]:"None",[Z.ALLIANCE_ONLY]:"Alliance only",[Z.HORDE_ONLY]:"Horde only"};class Pr extends cr{constructor(t,e,i){super(t,"filters-menu",{size:"md",title:"Filters"});let a=this.newSection("Factions");new nr(a,e.sim,{label:"Faction Restrictions",values:[Z.UNSPECIFIED,Z.ALLIANCE_ONLY,Z.HORDE_ONLY].map((t=>({name:yr[t],value:t}))),changedEvent:t=>t.filtersChangeEmitter,getValue:t=>t.getFilters().factionRestriction,setValue:(t,e,s)=>{const i=e.getFilters();i.factionRestriction=s,e.setFilters(t,i)}}),a=this.newSection("Source"),a.classList.add("filters-menu-section-bool-list");if(Wa.ALL_SOURCES.filter((t=>t!=Y.SourceUnknown)).forEach((t=>{new ar(a,e.sim,{label:fe.get(t),inline:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:e=>e.getFilters().sources.includes(t),setValue:(e,s,i)=>{const a=s.getFilters();i?a.sources.push(t):a.sources=a.sources.filter((e=>e!=t)),s.setFilters(e,a)}})})),Na.ARMOR_SLOTS.includes(i)){const t=Ie[e.getClass()];if(t>=Vt.ArmorTypeLeather){const i=this.newSection("Armor Type");i.classList.add("filters-menu-section-bool-list");s(Vt).filter((t=>t!=Vt.ArmorTypeUnknown)).filter((e=>e<=t)).forEach((t=>{new ar(i,e.sim,{label:we.get(t),inline:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:e=>e.getFilters().armorTypes.includes(t),setValue:(e,s,i)=>{const a=s.getFilters();i?a.armorTypes.push(t):a.armorTypes=a.armorTypes.filter((e=>e!=t)),s.setFilters(e,a)}})}))}}else if(Na.WEAPON_SLOTS.includes(i)){const t=this.newSection("Weapon Type");t.classList.add("filters-menu-section-bool-list");be[e.getClass()].map((t=>t.weaponType)).forEach((s=>{new ar(t,e.sim,{label:xe.get(s),inline:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:t=>t.getFilters().weaponTypes.includes(s),setValue:(t,e,i)=>{const a=e.getFilters();i?a.weaponTypes.push(s):a.weaponTypes=a.weaponTypes.filter((t=>t!=s)),e.setFilters(t,a)}})}));const s=this.newSection("Weapon Speed");s.classList.add("filters-menu-section-number-list"),new er(s,e.sim,{label:"Min MH Speed",float:!0,positive:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:t=>t.getFilters().minMhWeaponSpeed,setValue:(t,e,s)=>{const i=e.getFilters();i.minMhWeaponSpeed=s,e.setFilters(t,i)}}),new er(s,e.sim,{label:"Max MH Speed",float:!0,positive:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:t=>t.getFilters().maxMhWeaponSpeed,setValue:(t,e,s)=>{const i=e.getFilters();i.maxMhWeaponSpeed=s,e.setFilters(t,i)}}),ve(e.spec)&&(new er(s,e.sim,{label:"Min OH Speed",float:!0,positive:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:t=>t.getFilters().minOhWeaponSpeed,setValue:(t,e,s)=>{const i=e.getFilters();i.minOhWeaponSpeed=s,e.setFilters(t,i)}}),new er(s,e.sim,{label:"Max OH Speed",float:!0,positive:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:t=>t.getFilters().maxOhWeaponSpeed,setValue:(t,e,s)=>{const i=e.getFilters();i.maxOhWeaponSpeed=s,e.setFilters(t,i)}}))}else if(i==D.ItemSlotRanged){const t=Ee[e.getClass()];if(t.length<=1)return;const s=this.newSection("Ranged Weapon Type");s.classList.add("filters-menu-section-bool-list"),t.forEach((t=>{new ar(s,e.sim,{label:Se.get(t),inline:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:e=>e.getFilters().rangedWeaponTypes.includes(t),setValue:(e,s,i)=>{const a=s.getFilters();i?a.rangedWeaponTypes.push(t):a.rangedWeaponTypes=a.rangedWeaponTypes.filter((e=>e!=t)),s.setFilters(e,a)}})}));const i=this.newSection("Ranged Weapon Speed");i.classList.add("filters-menu-section-number-list"),new er(i,e.sim,{label:"Min Ranged Speed",float:!0,positive:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:t=>t.getFilters().minRangedWeaponSpeed,setValue:(t,e,s)=>{const i=e.getFilters();i.minRangedWeaponSpeed=s,e.setFilters(t,i)}}),new er(i,e.sim,{label:"Max Ranged Speed",float:!0,positive:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:t=>t.getFilters().maxRangedWeaponSpeed,setValue:(t,e,s)=>{const i=e.getFilters();i.maxRangedWeaponSpeed=s,e.setFilters(t,i)}})}}newSection(t){const e=document.createElement("div");return e.classList.add("menu-section"),this.body.appendChild(e),e.innerHTML=`\n\t\t\t<div class="menu-section-header">\n\t\t\t\t<h6 class="menu-section-title">${t}</h6>\n\t\t\t</div>\n\t\t\t<div class="menu-section-content"></div>\n\t\t`,e.getElementsByClassName("menu-section-content")[0]}}const Cr={type:"number",label:"Reaction Time",labelTooltip:"Reaction time of the player, in milliseconds. Used with certain APL values (such as 'Aura Is Active With Reaction Time').",changedEvent:t=>t.miscOptionsChangeEmitter,getValue:t=>t.getReactionTime(),setValue:(t,e,s)=>{e.setReactionTime(t,s)}},kr={type:"number",label:"Channel Clip Delay",labelTooltip:"Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.",changedEvent:t=>t.miscOptionsChangeEmitter,getValue:t=>t.getChannelClipDelay(),setValue:(t,e,s)=>{e.setChannelClipDelay(t,s)}},Tr={type:"boolean",label:"In Front of Target",labelTooltip:"Stand in front of the target, causing Blocks and Parries to be included in the attack table.",changedEvent:t=>t.inFrontOfTargetChangeEmitter,getValue:t=>t.getInFrontOfTarget(),setValue:(t,e,s)=>{e.setInFrontOfTarget(t,s)}},_r={type:"number",label:"Distance From Target",labelTooltip:"Distance from targets, in yards. Used to calculate travel time for certain spells.",changedEvent:t=>t.distanceFromTargetChangeEmitter,getValue:t=>t.getDistanceFromTarget(),setValue:(t,e,s)=>{e.setDistanceFromTarget(t,s)}},Nr={type:"enum",extraCssClasses:["tank-selector","threat-metrics","within-raid-sim-hide"],label:"Tank Assignment",labelTooltip:"Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:t=>t.getRaid().tanksChangeEmitter,getValue:t=>(t.getRaid()?.getTanks()||[]).findIndex((e=>gt.equals(e,t.makeUnitReference()))),setValue:(t,e,s)=>{const i=[];if(-1!=s){for(let t=0;t<s;t++)i.push(Q());i.push(e.makeUnitReference())}e.getRaid().setTanks(t,i)}},Lr={type:"number",label:"Incoming HPS",labelTooltip:"\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p>If set to 0, defaults to 17.5% of the primary target's base DPS.</p>\n\t",changedEvent:t=>t.getRaid().changeEmitter,getValue:t=>t.getHealingModel().hps,setValue:(t,e,s)=>{const i=e.getHealingModel();i.hps=s,e.setHealingModel(t,i)},enableWhen:t=>null!=(t.getRaid()?.getTanks()||[]).find((e=>gt.equals(e,t.makeUnitReference())))},Rr={type:"number",float:!0,label:"Healing Cadence",labelTooltip:"\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be recieved for 2000.</p>\n\t\t<p>If set to 0, defaults to 1.5 times the primary target's base swing timer, and half that for dual wielding targets.</p>\n\t",changedEvent:t=>t.getRaid().changeEmitter,getValue:t=>t.getHealingModel().cadenceSeconds,setValue:(t,e,s)=>{const i=e.getHealingModel();i.cadenceSeconds=s,e.setHealingModel(t,i)},enableWhen:t=>null!=(t.getRaid()?.getTanks()||[]).find((e=>gt.equals(e,t.makeUnitReference())))},Dr={type:"number",float:!0,label:"Cadence +/-",labelTooltip:"\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\n\t\t<p>The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\n\t",changedEvent:t=>t.getRaid().changeEmitter,getValue:t=>t.getHealingModel().cadenceVariation,setValue:(t,e,s)=>{const i=e.getHealingModel();i.cadenceVariation=s,e.setHealingModel(t,i)},enableWhen:t=>null!=(t.getRaid()?.getTanks()||[]).find((e=>gt.equals(e,t.makeUnitReference())))},Ar={type:"number",float:!1,label:"TMI Burst Window",labelTooltip:"\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\n\t",changedEvent:t=>t.getRaid().changeEmitter,getValue:t=>t.getHealingModel().burstWindow,setValue:(t,e,s)=>{const i=e.getHealingModel();i.burstWindow=s,e.setHealingModel(t,i)},enableWhen:t=>null!=(t.getRaid()?.getTanks()||[]).find((e=>gt.equals(e,t.makeUnitReference())))},Vr={type:"number",float:!0,label:"HP % for Defensive CDs",labelTooltip:"\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p>If set to 0, this restriction is disabled.</p>\n\t",changedEvent:t=>t.rotationChangeEmitter,getValue:t=>100*t.getSimpleCooldowns().hpPercentForDefensives,setValue:(t,e,s)=>{const i=e.getSimpleCooldowns();i.hpPercentForDefensives=s/100,e.setSimpleCooldowns(t,i)}},Mr={type:"number",float:!0,label:"Inspiration % Uptime",labelTooltip:"\n\t\t<p>% average of Encounter Duration, during which you have the Inspiration buff.</p>\n\t\t<p>If set to 0, the buff isn't applied.</p>\n\t",changedEvent:t=>t.healingModelChangeEmitter,getValue:t=>100*t.getHealingModel().inspirationUptime,setValue:(t,e,s)=>{const i=e.getHealingModel();i.inspirationUptime=s/100,e.setHealingModel(t,i)}},Ur={[ye.ItemQualityJunk]:"item-quality-junk",[ye.ItemQualityCommon]:"item-quality-common",[ye.ItemQualityUncommon]:"item-quality-uncommon",[ye.ItemQualityRare]:"item-quality-rare",[ye.ItemQualityEpic]:"item-quality-epic",[ye.ItemQualityLegendary]:"item-quality-legendary",[ye.ItemQualityArtifact]:"item-quality-artifact",[ye.ItemQualityHeirloom]:"item-quality-heirloom"};function Fr(t,e){Object.values(Ur).forEach((e=>t.classList.remove(e))),e&&t.classList.add(Ur[e])}let Wr=null;async function Or(t){return(await(null==Wr&&(Wr=fetch("/sod/assets/enchants/descriptions.json").then((t=>t.json())).then((t=>{const e={};for(let s in t)e[parseInt(s)]=t[s];return e}))),Wr))[t.effectId]||t.name}function Hr(t){return t.effectId+"-"+t.type}let qr={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};function Br(t,e){return window.getComputedStyle(e)[t]}class zr{constructor(t,s){e(this,"options"),e(this,"scroll_elem"),e(this,"content_elem"),e(this,"displayedRows"),e(this,"last_cluster",0),e(this,"scroll_debounce",0),e(this,"pointer_events_set",!1),e(this,"resize_debounce",0),e(this,"ds"),e(this,"cache",{}),this.options={rows_in_block:void 0!==s.rows_in_block?s.rows_in_block:qr.rows_in_block,blocks_in_cluster:void 0!==s.blocks_in_cluster?s.blocks_in_cluster:qr.blocks_in_cluster,show_no_data_row:void 0!==s.show_no_data_row?s.show_no_data_row:qr.show_no_data_row,no_data_class:void 0!==s.no_data_class?s.no_data_class:qr.no_data_class,no_data_text:void 0!==s.no_data_text?s.no_data_text:qr.no_data_text,keep_parity:void 0!==s.keep_parity?s.keep_parity:qr.keep_parity,tag:void 0!==s.tag?s.tag:qr.tag,callbacks:void 0!==s.callbacks?s.callbacks:qr.callbacks,cluster_height:0,item_height:void 0!==s.item_height?s.item_height:0,content_tag:"",block_height:0,scroll_top:0,rows_in_cluster:0},this.ds=t,this.displayedRows=s.rows,this.scroll_elem=s.scroll_elem,this.content_elem=s.content_elem,this.content_elem.hasAttribute("tabindex")||this.content_elem.setAttribute("tabindex","0");let i=this.scroll_elem.scrollTop;this.getRowsHeight(s.rows),this.insertToDom(s.rows,this.cache),this.scroll_elem.scrollTop=i,this.scroll_elem.addEventListener("scroll",this.scrollEv.bind(this)),window.addEventListener("resize",this.resizeEv.bind(this))}destroy(t){this.scroll_elem.removeEventListener("scroll",this.scrollEv.bind(this)),window.removeEventListener("resize",this.resizeEv.bind(this)),t&&this.setContentElemRows(this.generateEmptyRow())}dispose(){this.destroy()}refresh(t){(this.getRowsHeight(this.displayedRows)||t)&&this.update()}update(){let t=this.scroll_elem.scrollTop;this.ds.getNumberOfRows()*this.options.item_height<t&&(this.scroll_elem.scrollTop=0,this.last_cluster=0),this.insertToDom(this.displayedRows,this.cache),this.scroll_elem.scrollTop=t}elementUpdate(t){for(let e of this.displayedRows)t(e)}getScrollProgress(){return this.options.scroll_top/(this.ds.getNumberOfRows()*this.options.item_height)*100||0}scrollEv(){navigator.platform.toLowerCase().indexOf("mac")+1&&(this.pointer_events_set||(this.content_elem.style.pointerEvents="none"),this.pointer_events_set=!0,clearTimeout(this.scroll_debounce),this.scroll_debounce=window.setTimeout((()=>{this.content_elem.style.pointerEvents="auto",this.pointer_events_set=!1}),50)),this.last_cluster!=(this.last_cluster=this.getClusterNum(this.ds.getNumberOfRows()))&&this.insertToDom(this.displayedRows,this.cache),this.options.callbacks.scrollingProgress&&this.options.callbacks.scrollingProgress(this.getScrollProgress())}resizeEv(){clearTimeout(this.resize_debounce),this.resize_debounce=window.setTimeout(this.refresh.bind(this),100)}insertToDom(t,e){this.options.cluster_height||this.exploreEnvironment(t,e);let s=this.generate(),i=s.rows;this.displayedRows=s.rows;let a=this.checkChanges("data",i,e),n=this.checkChanges("top",s.top_offset,e),o=this.checkChanges("bottom",s.bottom_offset,e),l=this.options.callbacks,r=[];if(a||n){if(s.top_offset){if(this.options.keep_parity){let t=this.renderExtraTag("keep-parity");t.hidden=!0,r.push(t)}r.push(this.renderExtraTag("top-space",s.top_offset))}r.push(...i),s.bottom_offset&&r.push(this.renderExtraTag("bottom-space",s.bottom_offset)),l.clusterWillChange&&l.clusterWillChange(),this.setContentElemRows(r),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",s.rows_above.toString()),this.content_elem.style.counterIncrement="clusterize-counter "+(s.rows_above-1),l.clusterChanged&&l.clusterChanged()}else o&&(this.content_elem.lastChild.style.height=s.bottom_offset+"px")}exploreEnvironment(t,e){let s=this.options;s.content_tag=this.content_elem.tagName.toLowerCase(),t.length&&(this.content_elem.children.length<=1&&this.setContentElemRows([t[0],t[0],t[0]]),s.tag||(s.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(t))}setContentElemRows(t){this.content_elem.innerHTML="",this.content_elem.append(...t)}getRowsHeight(t){let e=this.options,s=e.item_height;e.cluster_height=0;let i=this.content_elem.children;if(t.length&&i.length){let t=i[Math.floor(i.length/2)];if(e.item_height=t.offsetHeight,"tr"==e.tag&&"collapse"!=Br("borderCollapse",this.content_elem)&&(e.item_height+=parseInt(Br("borderSpacing",this.content_elem),10)||0),"tr"!=e.tag){let s=parseInt(Br("marginTop",t),10)||0,i=parseInt(Br("marginBottom",t),10)||0;e.item_height+=Math.max(s,i)}}return e.block_height=e.item_height*e.rows_in_block,e.rows_in_cluster=e.blocks_in_cluster*e.rows_in_block,e.cluster_height=e.blocks_in_cluster*e.block_height,s!=e.item_height}generate(){let t=this.options,e=this.ds.getNumberOfRows();if(e<t.rows_in_block){let t=this.ds.generateRows(0,e);return{top_offset:0,bottom_offset:0,rows_above:0,rows:e?t:this.generateEmptyRow()}}let s=Math.max((t.rows_in_cluster-t.rows_in_block)*this.getClusterNum(e),0),i=s+t.rows_in_cluster,a=Math.max(s*t.item_height,0),n=Math.max((e-i)*t.item_height,0),o=[],l=s;return a<1&&l++,o=this.ds.generateRows(s,i),{top_offset:a,bottom_offset:n,rows_above:l,rows:o}}generateEmptyRow(){let t=this.options;if(!t.tag||!t.show_no_data_row)return[];let e,s=document.createElement(t.tag),i=document.createTextNode(t.no_data_text);return s.className=t.no_data_class,"tr"==t.tag&&(e=document.createElement("td"),e.colSpan=100,e.appendChild(i)),s.appendChild(e||i),[s]}getClusterNum(t){let e=this.options;e.scroll_top=this.scroll_elem.scrollTop;let s=Math.max(e.cluster_height-e.block_height,1),i=Math.floor(e.scroll_top/s),a=Math.floor(t*e.item_height/s);return Math.min(i,a)}renderExtraTag(t,e){let s=document.createElement(this.options.tag),i="clusterize-";return s.className=[i+"extra-row",i+t].join(" "),s.style.marginTop="0",s.style.marginBottom="0",e&&(s.style.height=e+"px"),s}checkChanges(t,e,s){var i=e!=s[t];return s[t]=e,i}}const jr=()=>g("span",{className:"heroic-label"},"[H]");class $r extends I{constructor(t,s,i){super(t,"gear-picker-root"),e(this,"itemPickers");const a=document.createElement("div");a.classList.add("gear-picker-left","tab-panel-col"),this.rootElem.appendChild(a);const n=document.createElement("div");n.classList.add("gear-picker-right","tab-panel-col"),this.rootElem.appendChild(n);const o=[D.ItemSlotHead,D.ItemSlotNeck,D.ItemSlotShoulder,D.ItemSlotBack,D.ItemSlotChest,D.ItemSlotWrist,D.ItemSlotMainHand,D.ItemSlotOffHand,D.ItemSlotRanged].map((t=>new Kr(a,s,i,t))),l=[D.ItemSlotHands,D.ItemSlotWaist,D.ItemSlotLegs,D.ItemSlotFeet,D.ItemSlotFinger1,D.ItemSlotFinger2,D.ItemSlotTrinket1,D.ItemSlotTrinket2].map((t=>new Kr(n,s,i,t)));this.itemPickers=o.concat(l).sort(((t,e)=>t.slot-e.slot))}}class Gr extends I{constructor(t,s){super(t,"item-picker-root"),e(this,"player"),e(this,"iconElem"),e(this,"nameElem"),e(this,"enchantElem"),e(this,"runeElem"),e(this,"createRuneContainer",(t=>{const e=Re();let s=g("div",{className:"item-picker-rune-container"},g("img",{ref:e,className:"item-picker-rune-icon"}));return t?v.fromSpellId(t.id).fill().then((t=>e.value.src=t.iconUrl)):e.value.src="https://wow.zamimg.com/images/wow/icons/medium/inventoryslot_empty.jpg",s})),this.player=s;let i=Re(),a=Re(),n=Re(),o=Re();this.rootElem.appendChild(g(b,null,g("a",{ref:i,className:"item-picker-icon",href:"javascript:void(0)",attributes:{role:"button"}}),g("div",{className:"item-picker-labels-container"},g("a",{ref:a,className:"item-picker-name",href:"javascript:void(0)",attributes:{role:"button"}}),g("a",{ref:n,className:"item-picker-enchant",href:"javascript:void(0)",attributes:{role:"button"}}),g("a",{ref:o,className:"item-picker-rune",href:"javascript:void(0)",attributes:{role:"button"}})))),this.iconElem=i.value,this.nameElem=a.value,this.enchantElem=n.value,this.runeElem=o.value}clear(){this.nameElem.removeAttribute("data-wowhead"),this.nameElem.removeAttribute("href"),this.iconElem.removeAttribute("data-wowhead"),this.iconElem.removeAttribute("href"),this.enchantElem.removeAttribute("data-wowhead"),this.enchantElem.removeAttribute("href"),this.iconElem.removeAttribute("href"),this.iconElem.style.backgroundImage="",this.enchantElem.innerText="",this.runeElem.innerText="",this.nameElem.textContent=""}update(t){this.nameElem.textContent=t.item.name,t.randomSuffix&&(this.nameElem.textContent+=" "+t.randomSuffix.name),t.item.heroic?this.nameElem.insertAdjacentElement("beforeend",jr()):this.nameElem.querySelector(".heroic-label")?.remove(),Fr(this.nameElem,t.item.quality),this.player.setWowheadData(t,this.iconElem),this.player.setWowheadData(t,this.nameElem),t.asActionId().fill().then((t=>{t.setBackgroundAndHref(this.iconElem),t.setWowheadHref(this.nameElem)})),t.enchant&&(Or(t.enchant).then((t=>{this.enchantElem.textContent=t})),t.enchant.spellId?(this.enchantElem.href=v.makeSpellUrl(t.enchant.spellId),this.enchantElem.dataset.wowhead=`domain=classic&spell=${t.enchant.spellId}`):(this.enchantElem.href=v.makeItemUrl(t.enchant.itemId),this.enchantElem.dataset.wowhead=`domain=classic&item=${t.enchant.itemId}`),this.enchantElem.dataset.whtticon="false");const e=Le[t._item.type]?.some((t=>this.player.sim.db.hasRuneBySlot(t,this.player.getClass())));e&&(this.iconElem.appendChild(this.createRuneContainer(t.rune)),t.rune&&(this.runeElem.textContent=t.rune.name,this.runeElem.href=v.makeSpellUrl(t.rune.id),this.enchantElem.dataset.wowhead=`domain=classic&spell=${t.rune.id}`))}}class Kr extends I{constructor(t,s,i,a){super(t,"item-picker-root"),e(this,"slot"),e(this,"simUI"),e(this,"player"),e(this,"itemElem"),e(this,"_items",[]),e(this,"_enchants",[]),e(this,"_runes",[]),e(this,"_equippedItem",null),this.slot=a,this.simUI=s,this.player=i,this.itemElem=new Gr(this.rootElem,i),this.item=i.getEquippedItem(a);const n=()=>this._items=this.player.getItems(this.slot);i.sim.waitForInit().then((()=>{this._enchants=this.player.getEnchants(this.slot),this._runes=this.player.getRunes(this.slot),n();const t={equipItem:(t,e)=>{this.player.equipItem(t,this.slot,e)},getEquippedItem:()=>this.player.getEquippedItem(this.slot),changeEvent:i.gearChangeEmitter},e=e=>{e.preventDefault(),this.openSelectorModal(Zr.Items,t)};this.itemElem.iconElem.addEventListener("click",e),this.itemElem.nameElem.addEventListener("click",e),this.itemElem.enchantElem.addEventListener("click",(e=>{e.preventDefault(),this.openSelectorModal(Zr.Enchants,t)}))})),i.levelChangeEmitter.on(n),i.gearChangeEmitter.on((()=>{this.item=i.getEquippedItem(a)})),i.professionChangeEmitter.on((()=>{null!=this._equippedItem&&this.player.setWowheadData(this._equippedItem,this.itemElem.iconElem)}))}set item(t){this.itemElem.clear(),this.itemElem.nameElem.textContent=Pe.get(this.slot)??"",Fr(this.itemElem.nameElem,null),null!=t?this.itemElem.update(t):this.itemElem.iconElem.style.backgroundImage=`url('${Qr(this.slot)}')`,this._equippedItem=t}openSelectorModal(t,e){new Yr(this.simUI.rootElem,this.simUI,this.player,{selectedTab:t,slot:this.slot,equippedItem:this._equippedItem,eligibleItems:this._items,eligibleEnchants:this._enchants,eligibleRunes:this._runes,gearData:e})}}class Jr extends p{constructor(t,s,i,a,n){super(t,"icon-picker-root",i,n),e(this,"config"),e(this,"iconAnchor"),e(this,"player"),e(this,"slot"),e(this,"_items",[]),e(this,"_enchants",[]),e(this,"_runes",[]),this.rootElem.classList.add("icon-picker"),this.player=i,this.config=n,this.slot=a,this.iconAnchor=document.createElement("a"),this.iconAnchor.classList.add("icon-picker-button"),this.iconAnchor.target="_blank",this.rootElem.prepend(this.iconAnchor),i.sim.waitForInit().then((()=>{this._items=this.player.getItems(a),this._enchants=this.player.getEnchants(a),this._runes=this.player.getRunes(a);const t={equipItem:(t,e)=>{let s=this.player.getItemSwapGear();this.player.setItemSwapGear(t,s.withEquippedItem(this.slot,e,i.canDualWield2H())),this.inputChanged(t)},getEquippedItem:()=>this.player.getItemSwapGear().getEquippedItem(this.slot),changeEvent:n.changedEvent(i)};this.iconAnchor.addEventListener("click",(e=>{e.preventDefault(),new Yr(s.rootElem,s,this.player,{selectedTab:Zr.Items,slot:this.slot,equippedItem:this.player.getItemSwapGear().getEquippedItem(a),eligibleItems:this._items,eligibleEnchants:this._enchants,eligibleRunes:this._runes,gearData:t})}))})).finally((()=>this.init()))}getInputElem(){return this.iconAnchor}getInputValue(){return this.player.getItemSwapGear().toProto()}setInputValue(t){this.iconAnchor.style.backgroundImage=`url('${Qr(this.slot)}')`,this.iconAnchor.removeAttribute("data-wowhead"),this.iconAnchor.href="#";const e=this.player.getItemSwapGear().getEquippedItem(this.slot);e?(this.iconAnchor.classList.add("active"),e.asActionId().fillAndSet(this.iconAnchor,!0,!0),this.player.setWowheadData(e,this.iconAnchor)):this.iconAnchor.classList.remove("active")}}var Zr=(t=>(t.Items="Items",t.Enchants="Enchants",t.Rune="Rune",t))(Zr||{});class Yr extends cr{constructor(t,s,i,a){super(t,"selector-modal"),e(this,"simUI"),e(this,"player"),e(this,"config"),e(this,"ilists"),e(this,"tabsElem"),e(this,"contentElem"),this.simUI=s,this.player=i,this.config=a,this.ilists=[],window.scrollTo({top:0}),this.header.insertAdjacentElement("afterbegin",g("ul",{className:"nav nav-tabs selector-modal-tabs"})),this.body.appendChild(g("div",{className:"tab-content selector-modal-tab-content"})),this.tabsElem=this.rootElem.querySelector(".selector-modal-tabs"),this.contentElem=this.rootElem.querySelector(".selector-modal-tab-content"),this.setData()}openTabName(t){Array.from(this.tabsElem.getElementsByClassName("selector-modal-item-tab")).forEach((e=>{e.getAttribute("data-content-id")==t+"-tab"&&e.click()}))}openTab(t){this.tabsElem.getElementsByClassName("selector-modal-item-tab")[t].click()}setData(){this.tabsElem.innerText="",this.contentElem.innerText="";const{slot:t,equippedItem:e,eligibleItems:s,eligibleEnchants:i,eligibleRunes:a,gearData:n}=this.config;this.addTab("Items",s.map((e=>({item:e,id:e.id,actionId:v.fromItem(e),name:e.name,quality:e.quality,heroic:e.heroic,phase:e.phase,baseEP:this.player.computeItemEP(e,t),ignoreEPFilter:!1,onEquip:(t,e)=>{const s=n.getEquippedItem();s?n.equipItem(t,s.withItem(e)):n.equipItem(t,new Ce({item:e}))}}))),(e=>this.player.computeItemEP(e,t)),(t=>t?.item),(t=>{n.equipItem(t,null),this.removeTabs("Random Suffixes")})),this.addTab("Enchants",i.map((t=>({item:t,id:t.effectId,actionId:t.spellId?v.fromSpellId(t.spellId):v.fromItemId(t.itemId),name:t.name,quality:t.quality,phase:t.phase||1,baseEP:this.player.computeStatsEP(new oa(t.stats)),ignoreEPFilter:!0,heroic:!1,onEquip:(t,e)=>{const s=n.getEquippedItem();s&&n.equipItem(t,s.withEnchant(e))}}))),(t=>this.player.computeEnchantEP(t)),(t=>t?.enchant),(t=>{const e=n.getEquippedItem();e&&n.equipItem(t,e.withEnchant(null))})),this.addTab("Rune",a.map((t=>({item:t,id:t.id,actionId:v.fromSpellId(t.id),name:t.name,quality:ye.ItemQualityCommon,phase:1,baseEP:1,ignoreEPFilter:!0,heroic:!1,onEquip:(t,e)=>{const s=n.getEquippedItem();s&&n.equipItem(t,s.withRune(e))}}))),(()=>1),(t=>t?.rune),(t=>{const e=n.getEquippedItem();e&&n.equipItem(t,e.withRune(null))})),this.addRandomSuffixTab(e,n)}onShow(t){let e=t.target.querySelector(".active").dataset.contentId;e.includes("Item")?this.ilists[0].sizeRefresh():e.includes("Enchant")&&this.ilists[1].sizeRefresh()}addRandomSuffixTab(t,e){if(null==t||0==t.item.randomSuffixOptions.length)return;const s=t.item;this.addTab("Random Suffixes",this.player.getRandomSuffixes(s).map((t=>({item:t,id:t.id,actionId:v.fromRandomSuffix(s,t),name:t.name,quality:s.quality,phase:s.phase,heroic:!1,baseEP:this.player.computeRandomSuffixEP(t),ignoreEPFilter:!0,onEquip:(t,s)=>{const i=e.getEquippedItem();i&&e.equipItem(t,i.withRandomSuffix(s))}}))),(t=>this.player.computeRandomSuffixEP(t)),(t=>t?.randomSuffix),(t=>{const s=e.getEquippedItem();s&&e.equipItem(t,s.withRandomSuffix(null))}))}addTab(t,e,s,i,a,n){if(0==e.length)return;const{gearData:o}=this.config,l=(t+"-tab").split(" ").join(""),r=t===this.config.selectedTab,d=Re();this.tabsElem.appendChild(g("li",{className:"nav-item"},g("a",{ref:d,className:"nav-link selector-modal-item-tab "+(r?"active":""),dataset:{label:t,contentId:l,bsToggle:"tab",bsTarget:`#${l}`},attributes:{role:"tab","aria-selected":r},type:"button"}))),n?n(d.value):d.value.textContent=t;let h=new tc(this.contentElem,this.simUI,this.config,this.player,t,e,s,i,a,(t=>{const e=t.item;t.onEquip(c.nextEventID(),e),ke.is(e)&&(this.removeTabs("Random Suffixes"),this.addRandomSuffixTab(o.getEquippedItem(),o))})),m=()=>{h.updateSelected()},u=()=>{h.applyFilters()},p=()=>{h.hideOrShowEPValues()};o.changeEvent.on(m),this.player.sim.phaseChangeEmitter.on(u),this.player.sim.filtersChangeEmitter.on(u),this.player.sim.showEPValuesChangeEmitter.on(p),this.addOnDisposeCallback((()=>{o.changeEvent.off(m),this.player.sim.phaseChangeEmitter.off(u),this.player.sim.filtersChangeEmitter.off(u),this.player.sim.showEPValuesChangeEmitter.off(p),h.dispose()})),d.value.addEventListener("shown.bs.tab",(t=>{h.sizeRefresh()})),this.ilists.push(h)}removeTabs(t){const e=Array.prototype.slice.call(this.tabsElem.getElementsByClassName("selector-modal-item-tab")).filter((e=>e.dataset.label.includes(t))),s=e.map((t=>document.getElementById(t.dataset.contentId))).filter((t=>Boolean(t)));e.forEach((t=>t.parentElement.remove())),s.forEach((t=>t.remove()))}}const Xr={[D.ItemSlotHead]:"/sod/assets/item_slots/head.jpg",[D.ItemSlotNeck]:"/sod/assets/item_slots/neck.jpg",[D.ItemSlotShoulder]:"/sod/assets/item_slots/shoulders.jpg",[D.ItemSlotBack]:"/sod/assets/item_slots/shirt.jpg",[D.ItemSlotChest]:"/sod/assets/item_slots/chest.jpg",[D.ItemSlotWrist]:"/sod/assets/item_slots/wrists.jpg",[D.ItemSlotHands]:"/sod/assets/item_slots/hands.jpg",[D.ItemSlotWaist]:"/sod/assets/item_slots/waist.jpg",[D.ItemSlotLegs]:"/sod/assets/item_slots/legs.jpg",[D.ItemSlotFeet]:"/sod/assets/item_slots/feet.jpg",[D.ItemSlotFinger1]:"/sod/assets/item_slots/finger.jpg",[D.ItemSlotFinger2]:"/sod/assets/item_slots/finger.jpg",[D.ItemSlotTrinket1]:"/sod/assets/item_slots/trinket.jpg",[D.ItemSlotTrinket2]:"/sod/assets/item_slots/trinket.jpg",[D.ItemSlotMainHand]:"/sod/assets/item_slots/mainhand.jpg",[D.ItemSlotOffHand]:"/sod/assets/item_slots/offhand.jpg",[D.ItemSlotRanged]:"/sod/assets/item_slots/ranged.jpg"};function Qr(t){return Xr[t]}class tc{constructor(t,s,i,a,n,o,l,r,d,h){e(this,"listElem"),e(this,"player"),e(this,"label"),e(this,"slot"),e(this,"itemData"),e(this,"itemsToDisplay"),e(this,"currentFilters"),e(this,"searchInput"),e(this,"computeEP"),e(this,"equippedToItemFn"),e(this,"gearData"),e(this,"tabContent"),e(this,"onItemClick"),e(this,"scroller"),this.label=n,this.player=a,this.itemData=o,this.computeEP=l,this.equippedToItemFn=r,this.onItemClick=h;const{slot:u,gearData:p}=i;this.slot=u,this.gearData=p,this.currentFilters=this.player.sim.getFilters();const f=(n+"-tab").split(" ").join(""),I=n===i.selectedTab,w=Re();if(this.tabContent=g("div",{id:f,className:"selector-modal-tab-pane tab-pane fade "+(I?"active show":"")},g("div",{className:"selector-modal-filters"},g("input",{className:"selector-modal-search form-control",type:"text",placeholder:"Search..."}),"Items"==n&&g("button",{className:"selector-modal-filters-button btn btn-primary"},"Filters"),g("div",{className:"selector-modal-phase-selector"}),g("div",{className:"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons"}),g("div",{className:"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons"}),g("div",{className:"sim-input selector-modal-boolean-option selector-modal-show-ep-values"}),g("button",{className:"selector-modal-simall-button btn btn-warning"},"Add to Batch Sim"),g("button",{className:"selector-modal-remove-button btn btn-danger"},"Unequip Item")),g("div",{className:"selector-modal-list-labels"},g("label",null,"Item"),g("label",{className:"ep-delta-label"},"EP",g("i",{className:"fa-solid fa-plus-minus fa-2xs"}),g("button",{ref:w,className:"btn btn-link p-0 ms-1"},g("i",{className:"far fa-question-circle fa-lg"})))),g("ul",{className:"selector-modal-list"})),t.appendChild(this.tabContent),new ta(w.value,{title:"\n\tEP (Equivalence Points) is way of comparing items by multiplying the raw stats of an item with your current stat weights.\n\tMore EP does not necessarily mean more DPS, as EP doesn't take into account stat caps and non-linear stat calculations.\n"}),function(t,e){new ar(t,e,{extraCssClasses:["show-1h-weapons-selector","mb-0"],label:"1H",inline:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:t=>t.getFilters().oneHandedWeapons,setValue:(t,e,s)=>{const i=e.getFilters();i.oneHandedWeapons=s,e.setFilters(t,i)}})}(this.tabContent.getElementsByClassName("selector-modal-show-1h-weapons")[0],a.sim),function(t,e){new ar(t,e,{extraCssClasses:["show-2h-weapons-selector","mb-0"],label:"2H",inline:!0,changedEvent:t=>t.filtersChangeEmitter,getValue:t=>t.getFilters().twoHandedWeapons,setValue:(t,e,s)=>{const i=e.getFilters();i.twoHandedWeapons=s,e.setFilters(t,i)}})}(this.tabContent.getElementsByClassName("selector-modal-show-2h-weapons")[0],a.sim),"Items"==n&&(u==D.ItemSlotMainHand||u==D.ItemSlotOffHand&&a.getClass()==m.ClassWarrior)||(this.tabContent.getElementsByClassName("selector-modal-show-1h-weapons")[0].style.display="none",this.tabContent.getElementsByClassName("selector-modal-show-2h-weapons")[0].style.display="none"),function(t,e){new ar(t,e,{extraCssClasses:["show-ep-values-selector","input-inline","mb-0"],label:"Show EP",inline:!0,changedEvent:t=>t.showEPValuesChangeEmitter,getValue:t=>t.getShowEPValues(),setValue:(t,e,s)=>{e.setShowEPValues(t,s)}})}(this.tabContent.getElementsByClassName("selector-modal-show-ep-values")[0],a.sim),function(t,e){new nr(t,e,{extraCssClasses:["phase-selector"],values:[{name:"Phase 1",value:1},{name:"Phase 2",value:2},{name:"Phase 3",value:3},{name:"Phase 4",value:4},{name:"Phase 5",value:5}],changedEvent:t=>t.phaseChangeEmitter,getValue:t=>t.getPhase(),setValue:(t,e,s)=>{e.setPhase(t,s)}})}(this.tabContent.getElementsByClassName("selector-modal-phase-selector")[0],a.sim),"Items"==n){this.tabContent.getElementsByClassName("selector-modal-filters-button")[0].addEventListener("click",(()=>new Pr(t,a,u)))}this.listElem=this.tabContent.getElementsByClassName("selector-modal-list")[0],this.itemsToDisplay=[],this.scroller=new zr({getNumberOfRows:()=>this.itemsToDisplay.length,generateRows:(t,e)=>{let s=[];for(let i=t;i<e&&!(i>=this.itemsToDisplay.length);++i)s.push(this.createItemElem({idx:this.itemsToDisplay[i],data:this.itemData[this.itemsToDisplay[i]]}));return s}},{rows:[],scroll_elem:this.listElem,content_elem:this.listElem,item_height:56,show_no_data_row:!1,no_data_text:"",tag:"li",rows_in_block:16,blocks_in_cluster:2});const b=this.tabContent.getElementsByClassName("selector-modal-remove-button")[0];b.addEventListener("click",(t=>{d(c.nextEventID())})),n.startsWith("Enchants")?b.textContent="Remove Enchant":n.startsWith("Rune")&&(b.textContent="Remove Rune"),this.updateSelected(),this.searchInput=this.tabContent.getElementsByClassName("selector-modal-search")[0],this.searchInput.addEventListener("input",(()=>this.applyFilters()));const x=this.tabContent.getElementsByClassName("selector-modal-simall-button")[0];"Items"==n?(x.hidden=!a.sim.getShowExperimental(),a.sim.showExperimentalChangeEmitter.on((()=>{x.hidden=!a.sim.getShowExperimental()})),x.addEventListener("click",(t=>{if(s instanceof cu){let t=Array();const e=this.slot==D.ItemSlotRanged||this.slot==D.ItemSlotTrinket1||this.slot==D.ItemSlotTrinket2,i=this.equippedToItemFn(this.player.getEquippedItem(this.slot));let a=0;null!=i&&(a=this.computeEP(i));for(let s of this.itemsToDisplay){const i=this.itemData[s];!e&&a>0&&i.baseEP<a/2||(i.baseEP>0||e)&&t.push(pe.create({id:i.id}))}s.bt.addItems(t)}}))):x.hidden=!0}sizeRefresh(){this.scroller.refresh(!0),this.applyFilters()}dispose(){this.scroller.dispose()}updateSelected(){const t=this.gearData.getEquippedItem(),e=this.equippedToItemFn(t),s=e?"Enchants"==this.label?e.effectId:e.id:0,i=e?this.computeEP(e):0;this.scroller.elementUpdate((t=>{let e=t.dataset.idx;const a=this.itemData[parseFloat(e)];a.id==s?t.classList.add("active"):t.classList.remove("active");const n=t.getElementsByClassName("selector-modal-list-item-ep-delta")[0];if(n&&(n.textContent="",a.item)){const t=this.computeEP(a.item);Te(n,i,t,0)}}))}applyFilters(){this.currentFilters=this.player.sim.getFilters();let t=new Array(this.itemData.length);for(let i=0;i<this.itemData.length;++i)t[i]=i;const e=this.player.getEquippedItem(this.slot);let s;"Items"==this.label?t=this.player.filterItemData(t,(t=>this.itemData[t].item),this.slot):"Enchants"==this.label&&(t=this.player.filterEnchantData(t,(t=>this.itemData[t].item),this.slot,e)),t=t.filter((t=>{const e=this.itemData[t];if(e.phase>this.player.sim.getPhase())return!1;if(this.searchInput.value.length>0){const t=this.searchInput.value.toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,"").split(" "),i=e.name.toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,"");var s=!0;if(t.forEach((t=>{i.includes(t)||(s=!1)})),!s)return!1}return!0})),s=this.slot==D.ItemSlotTrinket1||this.slot==D.ItemSlotTrinket2?(t,e)=>e.ilvl-t.ilvl:(t,e)=>{const s=this.computeEP(e)-this.computeEP(t);return Math.abs(s)<.01?e.ilvl-t.ilvl:s},t=t.sort(((t,e)=>{const i=this.itemData[t],a=this.itemData[e];return this.isItemFavorited(i)&&!this.isItemFavorited(a)?-1:this.isItemFavorited(a)&&!this.isItemFavorited(i)?1:s(i.item,a.item)})),this.itemsToDisplay=t,this.scroller.update(),this.hideOrShowEPValues()}hideOrShowEPValues(){const t=this.tabContent.getElementsByClassName("ep-delta-label"),e=this.tabContent.getElementsByClassName("selector-modal-list"),s=this.player.sim.getShowEPValues(),i=s?"":"none";for(let a of t)a.style.display=i;for(let a of e)s?a.classList.remove("hide-ep"):a.classList.add("hide-ep")}createItemElem(t){const e=t.data,s=this.computeEP(e.item),i=this.equippedToItemFn(this.gearData.getEquippedItem()),a=i?"Enchants"==this.label?i.effectId:i.id:0,n=Re(),o=Re(),l=Re(),r=g("li",{className:"selector-modal-list-item "+(a==e.id?"active":""),dataset:{idx:t.idx.toString()}},g("div",{className:"selector-modal-list-label-cell"},g("a",{className:"selector-modal-list-item-link",ref:o,dataset:{whtticon:"false"}},g("img",{className:"selector-modal-list-item-icon",ref:l}),g("label",{className:"selector-modal-list-item-name",ref:n},e.name,e.heroic&&jr()))));"Items"==this.label&&r.appendChild(g("div",{className:"selector-modal-list-item-source-container"},this.getSourceInfo(e.item,this.player.sim)));let d=Re();r.appendChild(g("div",null,g("button",{className:"selector-modal-list-item-favorite btn btn-link p-0",ref:d,onclick:()=>h("false"==r.dataset.fav)},g("i",{className:"fa-star fa-xl"})))),this.slot!=D.ItemSlotTrinket1&&this.slot!=D.ItemSlotTrinket2&&r.appendChild(g("div",{className:"selector-modal-list-item-ep"},g("span",{className:"selector-modal-list-item-ep-value"},s<9.95?s.toFixed(1).toString():Math.round(s).toString()))),r.appendChild(g("div",{className:"selector-modal-list-item-ep"},g("span",{className:"selector-modal-list-item-ep-delta",ref:t=>e.item&&Te(t,i?this.computeEP(i):0,s,0)}))),o.value.addEventListener("click",(t=>{if(t.preventDefault(),t.target===d.value)return!1;this.onItemClick(e)})),e.actionId.fill().then((t=>{t.setWowheadHref(o.value),l.value.src=t.iconUrl})),Fr(n.value,e.quality),new ta(d.value,{title:"Add to favorites"});const h=t=>{const s=this.player.sim.getFilters();if("Items"==this.label){const i=e.id;if(t)s.favoriteItems.push(i);else{const t=s.favoriteItems.indexOf(i);-1!=t&&s.favoriteItems.splice(t,1)}}else if("Enchants"==this.label){const i=Hr(e.item);if(t)s.favoriteEnchants.push(i);else{const t=s.favoriteEnchants.indexOf(i);-1!=t&&s.favoriteEnchants.splice(t,1)}}d.value.children[0].classList.toggle("fas"),d.value.children[0].classList.toggle("far"),r.dataset.fav=t.toString(),this.player.sim.setFilters(c.nextEventID(),s)};return this.isItemFavorited(e)?(d.value.children[0].classList.add("fas"),r.dataset.fav="true"):(d.value.children[0].classList.add("far"),r.dataset.fav="false"),r}isItemFavorited(t){return"Items"==this.label?this.currentFilters.favoriteItems.includes(t.id):"Enchants"==this.label&&this.currentFilters.favoriteEnchants.includes(Hr(t.item))}getSourceInfo(t,e){if(!t.sources||0==t.sources.length)return g(b,null);const s=(t,e)=>g("a",{href:t},g("small",null,e)),i=t.sources[0];if("crafted"==i.source.oneofKind){const t=i.source.crafted;return s(v.makeSpellUrl(t.spellId),_e.get(t.profession)??"Unknown")}if("drop"==i.source.oneofKind){const a=i.source.drop,n=e.db.getZone(a.zoneId),o=e.db.getNpc(a.npcId);if(!n)throw new Error("No zone found for item: "+t);let l=s(v.makeZoneUrl(n.id),`${n.name} (${Ne.get(a.difficulty)??"Unknown"})`);const r=a.category?` - ${a.category}`:"";return o?(l.appendChild(document.createElement("br")),l.appendChild(s(v.makeNpcUrl(o.id),`${o.name+r}`))):a.otherName,l}if("quest"==i.source.oneofKind){const t=i.source.quest;return s(v.makeQuestUrl(t.id),t.name)}if("soldBy"==i.source.oneofKind){const t=i.source.soldBy;return s(v.makeNpcUrl(t.npcId),t.npcName)}return g(b,null)}}class ec extends I{constructor(t,s,i){super(t,"sim-tab"),e(this,"simUI"),e(this,"config"),e(this,"navItem"),e(this,"navLink"),e(this,"contentContainer"),this.rootElem.classList.add(i.identifier),this.simUI=s,this.config=i,this.rootElem.id=this.config.identifier,this.rootElem.classList.add("tab-pane","fade"),0==t.childNodes.length&&this.rootElem.classList.add("active","show"),this.navItem=this.buildNavItem(),this.navLink=this.navItem.children[0],this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("tab-pane-content-container"),this.rootElem.appendChild(this.contentContainer),this.simUI.simHeader.addSimTabLink(this)}buildNavItem(){const t=document.createElement("fragment");return t.innerHTML=`\n\t\t\t<li class="${this.config.identifier} nav-item" role="presentation">\n\t\t\t\t<a\n\t\t\t\t\tclass="nav-link"\n\t\t\t\t\tdata-bs-toggle="tab"\n\t\t\t\t\tdata-bs-target="#${this.config.identifier}"\n\t\t\t\t\ttype="button"\n\t\t\t\t\trole="tab"\n\t\t\t\t\taria-controls="${this.config.identifier}"\n\t\t\t\t>${this.config.title}</a>\n\t\t\t</li>\n\t\t`,t.children[0]}buildColumn(t,e){let s=document.createElement("div");return s.classList.add("tab-panel-col",`${e}-${t}`),s}}class sc extends br{constructor(t,s,i){super(t,s,"Bag Item Import",!0),e(this,"simUI"),e(this,"bulkUI"),this.simUI=s,this.bulkUI=i,this.descriptionElem.innerHTML="\n      <p>Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn.</p>\n      <p>To import, upload the file or paste the text below, then click, 'Import'.</p>\n    "}async onImport(t){try{const e=ue.fromJsonString(t,{ignoreUnknownFields:!0});if(e?.items?.length>0){const t=await et.loadLeftoversIfNecessary(e),s=e.items.filter((e=>e.id>0&&t.lookupItemSpec(e)));s.length>0&&this.bulkUI.addItems(s)}this.close()}catch(e){alert(e.toString())}}}class ic{constructor(t,e,s,i){const a=document.createElement("div");a.classList.add("results-sim");const n=document.createElement("div");n.classList.add("bulk-result-body-dps","bulk-items-text-line","results-sim-dps","damage-metrics"),a.appendChild(n);const o=document.createElement("span");o.textContent=this.formatDps(s.unitMetrics?.dps?.avg),o.classList.add("topline-result-avg"),n.appendChild(o);const l=s.unitMetrics?.dps?.avg-i.unitMetrics?.dps?.avg,r=document.createElement("span");r.textContent=`${this.formatDpsDelta(l)}`,r.classList.add(l>=0?"bulk-result-header-positive":"bulk-result-header-negative"),n.appendChild(r);const d=document.createElement("div");if(d.classList.add("bulk-gear-combo"),t.bodyElement.appendChild(d),t.bodyElement.appendChild(a),s.itemsAdded&&s.itemsAdded.length>0){const i=document.createElement("button");i.textContent="Equip",i.classList.add("btn","btn-primary","bulk-equipit"),i.onclick=()=>{s.itemsAdded.forEach((t=>{const s=e.sim.db.lookupItemSpec(t.item);e.player.equipItem(c.nextEventID(),t.slot,s),e.simHeader.activateTab("gear-tab")}))},t.bodyElement.appendChild(i);for(const t of s.itemsAdded){const s=e.sim.db.lookupItemSpec(t.item),i=new Gr(d,e.player);i.update(s);const a=document.createElement("a");a.classList.add("bulk-result-item-slot"),a.textContent=this.itemSlotName(t),i.nameElem.appendChild(a)}}else{const e=document.createElement("p");e.textContent="No changes - this is your currently equipped gear!",t.bodyElement.appendChild(e),r.textContent=""}}formatDps(t){return(Math.round(100*t)/100).toFixed(2)}formatDpsDelta(t){return(t>=0?"+":"")+this.formatDps(t)}itemSlotName(t){return JSON.parse(Fe.toJsonString(t,{emitDefaultValues:!0})).slot.replace("ItemSlot","")}}class ac extends I{constructor(t,s,i,a,n){super(t,"bulk-item-picker"),e(this,"itemElem"),e(this,"simUI"),e(this,"bulkUI"),e(this,"index"),e(this,"item"),this.simUI=s,this.bulkUI=i,this.index=n,this.item=a,this.itemElem=new Gr(this.rootElem,s.player),this.simUI.sim.waitForInit().then((()=>{this.setItem(a);const t=We(this.item.item)[0],e=this.simUI.sim.db.getEnchants(t),s=s=>{s.preventDefault();const a=new c,n=new Yr(this.bulkUI.rootElem,this.simUI,this.simUI.player,{selectedTab:Zr.Enchants,slot:t,equippedItem:this.item,eligibleItems:new Array,eligibleEnchants:e,eligibleRunes:[],gearData:{equipItem:(t,e)=>{if(e){const t=this.bulkUI.getItems();t[this.index]=e.asSpec(),this.item=e,this.bulkUI.setItems(t),a.emit(c.nextEventID())}},getEquippedItem:()=>this.item,changeEvent:a}});e.length>0&&n.openTabName("Enchants");const o=document.createElement("button");o.textContent="Remove from Batch",o.classList.add("btn","btn-danger"),o.onclick=()=>{i.setItems(i.getItems().filter(((t,e)=>e!=this.index))),n.close()};const l=n.header?.querySelector(".close-button");null!=l&&n.header?.insertBefore(o,l)};this.itemElem.iconElem.addEventListener("click",s),this.itemElem.nameElem.addEventListener("click",s),this.itemElem.enchantElem.addEventListener("click",s)}))}setItem(t){this.itemElem.clear(),null!=t?(this.itemElem.update(t),this.item=t):(this.itemElem.rootElem.style.opacity="30%",this.itemElem.iconElem.style.backgroundImage="url('/sod/assets/item_slots/empty.jpg')",this.itemElem.nameElem.textContent="Add new item (not implemented)",this.itemElem.rootElem.style.alignItems="center")}}class nc extends ec{constructor(t,s){super(t,s,{identifier:"bulk-tab",title:"Batch"}),e(this,"simUI"),e(this,"itemsChangedEmitter",new c),e(this,"leftPanel"),e(this,"rightPanel"),e(this,"column1",this.buildColumn(1,"raid-settings-col")),e(this,"items",new Array),e(this,"pendingResults"),e(this,"pendingDiv"),e(this,"doCombos"),e(this,"fastMode"),e(this,"autoEnchant"),e(this,"gemIconElements"),this.simUI=s,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("bulk-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("bulk-tab-right","tab-panel-right"),this.pendingDiv=document.createElement("div"),this.pendingDiv.classList.add("results-pending-overlay"),this.pendingResults=new sr(this.pendingDiv),this.pendingResults.hideAll(),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.contentContainer.appendChild(this.pendingDiv),this.doCombos=!0,this.fastMode=!0,this.autoEnchant=!0,this.gemIconElements=[],this.buildTabContent(),this.simUI.sim.waitForInit().then((()=>{this.loadSettings()}))}getSettingsKey(){return this.simUI.getStorageKey("bulk-settings.v1")}loadSettings(){const t=window.localStorage.getItem(this.getSettingsKey());if(null!=t){let e=De.fromJsonString(t,{ignoreUnknownFields:!0});this.doCombos=e.combinations,this.fastMode=e.fastMode,this.autoEnchant=e.autoEnchant}}storeSettings(){const t=this.createBulkSettings(),e=De.toJsonString(t,{enumAsInteger:!0});window.localStorage.setItem(this.getSettingsKey(),e)}createBulkSettings(){return De.create({items:this.items,combinations:this.doCombos,fastMode:this.fastMode,autoEnchant:this.autoEnchant,iterationsPerCombo:this.simUI.sim.getIterations()})}createBulkItemsDatabase(){const t=Ae.create();for(const e of this.items){const s=this.simUI.sim.db.lookupItemSpec(e);if(!s)throw new Error(`item with ID ${e.id} not found in database`);t.items.push(Ve.fromJson(ke.toJson(s.item),{ignoreUnknownFields:!0})),s.enchant&&t.enchants.push(Me.fromJson(Ue.toJson(s.enchant),{ignoreUnknownFields:!0}))}return t}addItems(t){0==this.items.length?this.items=t:this.items=this.items.concat(t),this.itemsChangedEmitter.emit(c.nextEventID())}setItems(t){this.items=t,this.itemsChangedEmitter.emit(c.nextEventID())}clearItems(){this.items=new Array,this.itemsChangedEmitter.emit(c.nextEventID())}getItems(){const t=new Array;return this.items.forEach((e=>{t.push(pe.clone(e))})),t}setCombinations(t){this.doCombos=t,this.itemsChangedEmitter.emit(c.nextEventID())}setFastMode(t){this.fastMode=t,this.itemsChangedEmitter.emit(c.nextEventID())}async runBulkSim(t){this.pendingResults.setPending();try{await this.simUI.sim.runBulkSim(this.createBulkSettings(),this.createBulkItemsDatabase(),t)}catch(e){this.simUI.handleCrash(e)}}buildTabContent(){const t=new wr(this.column1,"bulk-items",{header:{title:"Items"}});t.bodyElement.classList.add("gear-picker-root");const e=document.createElement("div");e.classList.add("bulk-items-text-line"),t.bodyElement.appendChild(e),e.innerHTML="<i>Notice: This is under very early but active development and experimental. You may also need to update your WoW AddOn if you want to import your bags.</i>";const s=document.createElement("div");s.classList.add("bulk-items-text-line"),t.bodyElement.appendChild(s);const i=document.createElement("div");i.classList.add("tab-panel-col","bulk-gear-combo"),t.bodyElement.appendChild(i),this.itemsChangedEmitter.on((()=>{if(i.innerHTML="",this.items.length>0){s.textContent="The following items will be simmed together with your equipped gear.";for(let t=0;t<this.items.length;++t){const e=this.items[t],s=this.simUI.sim.db.lookupItemSpec(e);new ac(i,this.simUI,this,s,t)}}})),this.clearItems();let a=new wr(this.column1,"bulk-results",{header:{title:"Results",extraCssClasses:["bulk-results-header"]}});a.rootElem.hidden=!0,a.bodyElement.classList.add("gear-picker-root","tab-panel-col"),this.simUI.sim.bulkSimStartEmitter.on((()=>{a.rootElem.hidden=!0})),this.simUI.sim.bulkSimResultEmitter.on(((t,e)=>{a.rootElem.hidden=0==e.results.length,a.bodyElement.innerHTML="";for(const s of e.results){const t=new wr(a.bodyElement,"bulk-result",{header:{title:""},bodyClasses:["bulk-results-body"]});new ic(t,this.simUI,s,e.equippedGearResult)}}));const n=new wr(this.rightPanel,"bulk-settings",{header:{title:"Setup"}}),o=document.createElement("button");o.classList.add("btn","btn-primary","w-100","bulk-settings-button"),o.textContent="Simulate Batch",o.addEventListener("click",(()=>{this.pendingDiv.style.display="flex",this.leftPanel.classList.add("blurred"),this.rightPanel.classList.add("blurred");const t=o.innerHTML;o.disabled=!0,o.classList.add(".disabled"),o.innerHTML='<i class="fa fa-spinner fa-spin"></i>&nbsp;Running';let e=(new Date).getTime(),s=0,i=0,a=0,n=0;this.runBulkSim((l=>{console.log(l);const r=(new Date).getTime()-e,c=l.completedIterations/(r/1e3);0==n&&(n=l.totalSims),this.fastMode&&(0==i&&l.totalSims>0&&(i=Math.ceil(Math.log(l.totalSims/20)/Math.log(2))+1,a=1),l.totalSims<s&&(a+=1,e=(new Date).getTime())),this.setSimProgress(l,c,a,i,n),s=l.totalSims,null!=l.finalBulkResult&&(this.pendingDiv.style.display="none",this.leftPanel.classList.remove("blurred"),this.rightPanel.classList.remove("blurred"),this.pendingResults.hideAll(),o.disabled=!1,o.classList.remove(".disabled"),o.innerHTML=t)}))})),n.bodyElement.appendChild(o);const l=document.createElement("button");l.classList.add("btn","btn-secondary","w-100","bulk-settings-button"),l.innerHTML='<i class="fa fa-download"></i> Import From Bags',l.addEventListener("click",(()=>new sc(this.simUI.rootElem,this.simUI,this))),n.bodyElement.appendChild(l);const r=document.createElement("button");r.classList.add("btn","btn-secondary","w-100","bulk-settings-button"),r.innerHTML='<i class="fa fa-download"></i> Import Favorites',r.addEventListener("click",(()=>{const t=this.simUI.player.sim.getFilters().favoriteItems.map((t=>pe.create({id:t})));this.addItems(t)})),n.bodyElement.appendChild(r);const c=document.createElement("button");let d=document.createElement("input");d.type="text",d.placeholder="search...",d.style.display="none";const h=document.createElement("ul");h.classList.add("batch-search-results");let m=Array();d.addEventListener("keyup",(t=>{if("Enter"==t.key){let t=Array();h.childNodes.forEach((e=>{const s=e.getAttribute("data-item-id");null!=s&&t.push(pe.create({id:Number.parseInt(s)}))})),this.addItems(t)}})),d.addEventListener("input",(()=>{const t=d.value;if(h.innerHTML="",0==t.length)return;var e=t.split(" ");let s=0;m.every((t=>{let i=!0;const a=t.name.toLowerCase(),n=t.setName.toLowerCase();if(e.forEach((t=>{var e=t.toLowerCase();return!(!a.includes(e)&&!n.includes(e))||(i=!1,!1)})),i){let e=document.createElement("li");if(e.innerHTML=`<span>${t.name}</span>`,e.setAttribute("data-item-id",t.id.toString()),e.addEventListener("click",(()=>{this.addItems(Array(pe.create({id:t.id})))})),t.heroic){let t=document.createElement("span");t.style.color="green",t.innerText="[H]",e.appendChild(t)}if(t.factionRestriction==Z.HORDE_ONLY){let t=document.createElement("span");t.style.color="red",t.innerText="(H)",e.appendChild(t)}if(t.factionRestriction==Z.ALLIANCE_ONLY){let t=document.createElement("span");t.style.color="blue",t.innerText="(A)",e.appendChild(t)}h.append(e),s++}return s<10}))})),c.classList.add("btn","btn-secondary","w-100","bulk-settings-button");const u='<i class="fa fa-search"></i> Add Item';c.innerHTML=u,c.addEventListener("click",(()=>{"none"==d.style.display?(c.innerHTML="Close Search Results",m=this.simUI.sim.db.getAllItems().filter((t=>M(this.simUI.player,t,void 0))),d.style.display="block",d.focus()):(c.innerHTML=u,d.style.display="none",h.innerHTML="")})),n.bodyElement.appendChild(c),n.bodyElement.appendChild(d),n.bodyElement.appendChild(h);const p=document.createElement("button");p.classList.add("btn","btn-secondary","w-100","bulk-settings-button"),p.textContent="Clear All",p.addEventListener("click",(()=>{this.clearItems(),a.rootElem.hidden=!0,a.bodyElement.innerHTML=""})),n.bodyElement.appendChild(p),new ar(n.bodyElement,this,{label:"Fast Mode",labelTooltip:"Fast mode reduces accuracy but will run faster.",changedEvent:t=>this.itemsChangedEmitter,getValue:t=>this.fastMode,setValue:(t,e,s)=>{e.fastMode=s}}),new ar(n.bodyElement,this,{label:"Combinations",labelTooltip:"When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations becausee they have two slots to fill each.",changedEvent:t=>this.itemsChangedEmitter,getValue:t=>this.doCombos,setValue:(t,e,s)=>{e.doCombos=s}}),new ar(n.bodyElement,this,{label:"Auto Enchant",labelTooltip:"When checked bulk simulator apply the current enchant for a slot to each replacement item it can.",changedEvent:t=>this.itemsChangedEmitter,getValue:t=>this.autoEnchant,setValue:(t,e,s)=>{e.autoEnchant=s}})}setSimProgress(t,e,s,i,a){const n=((t.totalIterations-t.completedIterations)/e).toFixed();let o="";i>0&&(o=`${s} / ${i} refining rounds`),this.pendingResults.setContent(`\n      <div class="results-sim">\n        <div class="">${a} total combinations.</div>\n        <div class="">${o}</div>\n        <div class=""> ${t.completedSims} / ${t.totalSims}<br>simulations complete</div>\n        <div class="">\n          ${t.completedIterations} / ${t.totalIterations}<br>iterations complete\n        </div>\n        <div class="">\n          ${n} seconds remaining.\n        </div>\n      </div>\n    `)}}class oc extends I{constructor(t,s,i){super(t,"saved-data-manager-root"),e(this,"modObject"),e(this,"config"),e(this,"userData"),e(this,"presets"),e(this,"savedDataDiv"),e(this,"presetDataDiv"),e(this,"customDataDiv"),e(this,"saveInput"),e(this,"frozen"),this.modObject=s,this.config=i,this.userData=[],this.presets=[],this.frozen=!1;let a=new wr(this.rootElem,"saved-data",{header:i.header});a.bodyElement.innerHTML='\n\t\t\t<div class="saved-data-container hide">\n\t\t\t\t<div class="saved-data-presets"></div>\n\t\t\t\t<div class="saved-data-custom"></div>\n\t\t\t</div>\n\t\t',this.savedDataDiv=a.bodyElement.querySelector(".saved-data-container"),this.presetDataDiv=a.bodyElement.querySelector(".saved-data-presets"),this.customDataDiv=a.bodyElement.querySelector(".saved-data-custom"),i.presetsOnly||(a.bodyElement.appendChild(this.buildCreateContainer()),this.saveInput=a.bodyElement.querySelector(".saved-data-save-input"))}addSavedData(t){this.savedDataDiv.classList.remove("hide");const e=this.makeSavedData(t),s=t.isPreset?this.presets:this.userData,i=s.findIndex((e=>e.name==t.name));-1==i?(t.isPreset?this.presetDataDiv.appendChild(e.elem):this.customDataDiv.appendChild(e.elem),s.push(e)):(s[i].elem.replaceWith(e.elem),s[i]=e)}makeSavedData(t){const e=document.createElement("fragment");e.innerHTML=`\n\t\t\t<div class="saved-data-set-chip badge rounded-pill">\n\t\t\t\t<a href="javascript:void(0)" class="saved-data-set-name" role="button">${t.name}</a>\n\t\t\t</div>\n\t\t`;const s=e.children[0];if(s.addEventListener("click",(e=>{this.config.setData(c.nextEventID(),this.modObject,t.data),this.saveInput&&(this.saveInput.value=t.name)})),!t.isPreset){let e=document.createElement("fragment");e.innerHTML='\n\t\t\t\t<a\n\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\tclass="saved-data-set-delete"\n\t\t\t\t\trole="button"\n\t\t\t\t>\n\t\t\t\t\t<i class="fa fa-times fa-lg"></i>\n\t\t\t\t</a>\n\t\t\t';const i=e.children[0];s.appendChild(i);const a=ta.getOrCreateInstance(i,{title:`Delete saved ${this.config.label}`});i.addEventListener("click",(e=>{e.stopPropagation();if(!confirm(`Delete saved ${this.config.label} '${t.name}'?`))return;a.dispose();const s=this.userData.findIndex((e=>e.name==t.name));this.userData[s].elem.remove(),this.userData.splice(s,1),this.saveUserData()}))}t.tooltip&&ta.getOrCreateInstance(s,{title:t.tooltip,placement:"bottom",html:!0});const i=()=>{this.config.equals(t.data,this.config.getData(this.modObject))?s.classList.add("active"):s.classList.remove("active"),t.enableWhen&&!t.enableWhen(this.modObject)?s.classList.add("disabled"):s.classList.remove("disabled")};return i(),this.config.changeEmitters.forEach((t=>t.on(i))),{name:t.name,data:t.data,elem:s,enableWhen:t.enableWhen}}saveUserData(){const t={};this.userData.forEach((e=>{t[e.name]=this.config.toJson(e.data)})),0==this.userData.length&&0==this.presets.length&&this.savedDataDiv.classList.add("hide"),window.localStorage.setItem(this.config.storageKey,JSON.stringify(t))}loadUserData(){const t=window.localStorage.getItem(this.config.storageKey);if(!t)return;let e;try{e=JSON.parse(t)}catch(s){console.warn("Invalid json for local storage value: "+t)}for(let i in e)try{this.addSavedData({name:i,data:this.config.fromJson(e[i])})}catch(s){console.warn("Failed parsing saved data: "+e[i])}}freeze(){this.frozen=!0,this.rootElem.classList.add("frozen")}buildCreateContainer(){let t=document.createElement("fragment");t.innerHTML=`\n\t\t\t<div class="saved-data-create-container">\n\t\t\t\t<label class="form-label">${this.config.label} Name</label>\n\t\t\t\t<input class="saved-data-save-input form-control" type="text" placeholder="Name">\n\t\t\t\t<button class="saved-data-save-button btn btn-primary">Save ${this.config.label}</button>\n\t\t\t</div>\n\t\t`;return t.querySelector(".saved-data-save-button").addEventListener("click",(t=>{if(this.frozen)return;const e=this.saveInput?.value;e?e in this.presets?alert(`${this.config.label} with name ${e} already exists.`):(this.addSavedData({name:e,data:this.config.getData(this.modObject)}),this.saveUserData()):alert(`Choose a label for your saved ${this.config.label}!`)})),t.children[0]}}class lc extends ec{constructor(t,s){super(t,s,{identifier:"gear-tab",title:"Gear"}),e(this,"simUI"),e(this,"leftPanel"),e(this,"rightPanel"),this.simUI=s,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("gear-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("gear-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildGearPickers(),this.buildSavedGearsetPicker()}buildGearPickers(){new $r(this.leftPanel,this.simUI,this.simUI.player)}buildSavedGearsetPicker(){const t=new oc(this.rightPanel,this.simUI.player,{header:{title:"Gear Sets"},label:"Gear Set",storageKey:this.simUI.getSavedGearStorageKey(),getData:t=>Oe.create({gear:t.getGear().asSpec(),bonusStatsStats:t.getBonusStats().toProto()}),setData:(t,e,s)=>{c.freezeAllAndDo((()=>{e.setGear(t,this.simUI.sim.db.lookupEquipmentSpec(s.gear||ue.create())),e.setBonusStats(t,oa.fromProto(s.bonusStatsStats||l.create()))}))},changeEmitters:[this.simUI.player.changeEmitter],equals:(t,e)=>Oe.equals(t,e),toJson:t=>Oe.toJson(t),fromJson:t=>Oe.fromJson(t)});this.simUI.sim.waitForInit().then((()=>{t.loadUserData(),this.simUI.individualConfig.presets.gear.forEach((e=>{t.addSavedData({name:e.name,tooltip:e.tooltip,isPreset:!0,data:Oe.create({gear:this.simUI.sim.db.lookupEquipmentSpec(e.gear).asSpec(),bonusStatsStats:(new oa).toProto()}),enableWhen:e.enableWhen})}))}))}}const rc={actions:{create:{useIcon:!1}}};var cc=null;class dc extends p{constructor(t,s,i){if(super(t,"list-picker-root",s,i),e(this,"config"),e(this,"itemsDiv"),e(this,"itemPickerPairs"),this.config={...rc,...i},this.itemPickerPairs=[],this.rootElem.appendChild(g(b,null,i.title&&g("label",{className:"list-picker-title form-label"},i.title),g("div",{className:"list-picker-items"}))),this.config.hideUi&&this.rootElem.classList.add("d-none"),this.config.horizontalLayout&&(this.config.inlineMenuBar=!0,this.rootElem.classList.add("horizontal")),this.config.titleTooltip){let t={title:this.config.titleTooltip};ta.getOrCreateInstance(this.rootElem.querySelector(".list-picker-title"),t)}if(this.itemsDiv=this.rootElem.getElementsByClassName("list-picker-items")[0],this.actionEnabled("create")){let t=null,e=null;this.config.actions?.create?.useIcon?(t=dc.makeActionElem("link-success","fa-plus"),e=ta.getOrCreateInstance(t,{title:`New ${i.itemLabel}`})):(t=document.createElement("button"),t.classList.add("btn","btn-primary"),t.textContent=`New ${i.itemLabel}`),t.classList.add("list-picker-new-button"),t.addEventListener("click",(t=>{const s=this.config.newItem(),i=this.config.getValue(this.modObject).concat([s]);this.config.setValue(c.nextEventID(),this.modObject,i),e&&e.hide()})),this.rootElem.appendChild(t)}this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.itemPickerPairs.map((t=>t.picker.getInputValue()))}setInputValue(t){if(t.length<this.itemPickerPairs.length)this.itemPickerPairs.slice(t.length).forEach((t=>t.elem.remove())),this.itemPickerPairs=this.itemPickerPairs.slice(0,t.length);else if(t.length>this.itemPickerPairs.length){const e=t.length-this.itemPickerPairs.length;for(let t=0;t<e;t++)this.addNewPicker()}t.forEach(((t,e)=>this.itemPickerPairs[e].picker.setInputValue(t)))}actionEnabled(t){return!this.config.allowedActions||this.config.allowedActions.includes(t)}addNewPicker(){const t=this.itemPickerPairs.length,e=document.createElement("div");e.classList.add("list-picker-item-container"),this.config.inlineMenuBar&&e.classList.add("inline"),this.itemsDiv.appendChild(e);const s=document.createElement("div");s.classList.add("list-picker-item");const i=document.createElement("div");if(i.classList.add("list-picker-item-header"),this.config.inlineMenuBar)e.appendChild(s),e.appendChild(i);else if(e.appendChild(i),e.appendChild(s),this.config.itemLabel){const t=document.createElement("h6");t.classList.add("list-picker-item-title"),t.textContent=`${this.config.itemLabel} ${this.itemPickerPairs.length+1}`,i.appendChild(t)}const a=this.config.newItemPicker(s,this,t,{changedEvent:this.config.changedEvent,getValue:e=>this.getSourceValue()[t],setValue:(e,s,i)=>{const a=this.getSourceValue();a[t]=i,this.config.setValue(e,s,a)}}),n={elem:e,picker:a,idx:t};if(this.actionEnabled("move")){const s=dc.makeActionElem("list-picker-item-move","fa-arrows-up-down");i.appendChild(s);const a=ta.getOrCreateInstance(s,{title:"Move (Drag+Drop)"});s.addEventListener("click",(t=>{a.hide()})),s.draggable=!0,s.ondragstart=t=>{t.target==s&&(t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="move",e.classList.add("dragfrom"),cc={listPicker:this,item:n})};let o=0;e.ondragenter=t=>{cc&&cc.listPicker==this&&(t.preventDefault(),o++,e.classList.add("dragto"))},e.ondragleave=t=>{cc&&cc.listPicker==this&&(t.preventDefault(),o--,o<=0&&e.classList.remove("dragto"))},e.ondragover=t=>{cc&&cc.listPicker==this&&t.preventDefault()},e.ondrop=s=>{if(!cc||cc.listPicker!=this)return;s.preventDefault(),o=0,e.classList.remove("dragto"),cc.item.elem.classList.remove("dragfrom");const i=cc.item.idx,a=t,n=this.config.getValue(this.modObject),l=n[i];n.splice(i,1),n.splice(a,0,l),this.config.setValue(c.nextEventID(),this.modObject,n),cc=null}}if(this.actionEnabled("copy")){const e=dc.makeActionElem("list-picker-item-copy","fa-copy");i.appendChild(e);const s=ta.getOrCreateInstance(e,{title:`Copy to New ${this.config.itemLabel}`});e.addEventListener("click",(e=>{const i=this.config.getValue(this.modObject).slice();i.splice(t,0,this.config.copyItem(i[t])),this.config.setValue(c.nextEventID(),this.modObject,i),s.hide()}))}if(this.actionEnabled("delete")){const e=dc.makeActionElem("list-picker-item-delete","fa-times");e.classList.add("link-danger"),i.appendChild(e);const s=ta.getOrCreateInstance(e,{title:`Delete ${this.config.itemLabel}`});e.addEventListener("click",(e=>{const i=this.config.getValue(this.modObject);i.splice(t,1),this.config.setValue(c.nextEventID(),this.modObject,i),s.hide()}))}this.itemPickerPairs.push(n)}static makeActionElem(t,e){const s=document.createElement("a");s.classList.add("list-picker-item-action",t),s.href="javascript:void(0)",s.setAttribute("role","button");const i=document.createElement("i");return i.classList.add("fa","fa-xl",e),s.appendChild(i),s}static getItemHeaderElem(t){const e=t.rootElem.parentElement,s=e.nextElementSibling||e.previousElementSibling;if(!s?.classList.contains("list-picker-item-header"))throw new Error("Could not find list item header");return s}}class hc extends I{constructor(t,e,s,i){super(t,"encounter-picker-root"),gc(this.rootElem,e,s.showExecuteProportion),e.sim.waitForInit().then((()=>{const t=e.sim.db.getAllPresetTargets();new nr(this.rootElem,e,{extraCssClasses:["damage-metrics","npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(t.map(((t,e)=>({name:t.path,value:e})))),changedEvent:t=>t.changeEmitter,getValue:e=>t.findIndex((t=>Ic(e.primaryTarget,t.target))),setValue:(e,s,i)=>{-1!=i&&s.applyPresetTarget(e,t[i],0)}}),i.isIndividualSim()&&He(i.player.spec)&&new er(this.rootElem,i.sim.raid,{label:"Num Allies",labelTooltip:"Number of allied players in the raid.",changedEvent:t=>t.targetDummiesChangeEmitter,getValue:t=>t.getTargetDummies(),setValue:(t,e,s)=>{e.setTargetDummies(t,s)}}),i.isIndividualSim()&&it(i.player.spec)&&new er(this.rootElem,e,{label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:t=>t.changeEmitter,getValue:t=>t.primaryTarget.minBaseDamage,setValue:(t,e,s)=>{e.primaryTarget.minBaseDamage=s,e.targetsChangeEmitter.emit(t)}});let s=t.findIndex((t=>e.primaryTarget.id==t.target?.id)),a=t[s]?.target?.targetInputs||[];(a.length!=e.primaryTarget.targetInputs.length||e.primaryTarget.targetInputs.some(((t,e)=>t.label!=a[e].label)))&&(e.primaryTarget.targetInputs=a,e.targetsChangeEmitter.emit(c.nextEventID())),fc(this.rootElem,e,0);const n=document.createElement("button");n.classList.add("advanced-button","btn","btn-primary"),n.textContent="Advanced",n.addEventListener("click",(()=>new mc(i.rootElem,i,e))),this.rootElem.appendChild(n)}))}}class mc extends cr{constructor(t,s,i){super(t,"advanced-encounter-picker-modal"),e(this,"encounter"),this.encounter=i,this.addHeader(),this.body.innerHTML='\n\t\t\t<div class="encounter-header"></div>\n\t\t\t<div class="encounter-targets"></div>\n\t\t';const a=this.rootElem.getElementsByClassName("encounter-header")[0],n=this.rootElem.getElementsByClassName("encounter-targets")[0];gc(a,this.encounter,!0),s.isIndividualSim()||new ar(a,i,{label:"Use Health",labelTooltip:"Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.",changedEvent:t=>t.changeEmitter,getValue:t=>t.getUseHealth(),setValue:(t,e,s)=>{e.setUseHealth(t,s)}}),new dc(n,this.encounter,{extraCssClasses:["targets-picker","mb-0"],itemLabel:"Target",changedEvent:t=>t.targetsChangeEmitter,getValue:t=>t.targets,setValue:(t,e,s)=>{e.targets=s,e.targetsChangeEmitter.emit(t)},newItem:()=>La.defaultTargetProto(),copyItem:t=>lt.clone(t),newItemPicker:(t,e,s,a)=>new uc(t,i,s,a)})}addHeader(){const t=this.encounter.sim.db.getAllPresetEncounters();new nr(this.header,this.encounter,{label:"Encounter",extraCssClasses:["encounter-picker","mb-0","pe-2"],values:[{name:"Custom",value:-1}].concat(t.map(((t,e)=>({name:t.path,value:e})))),changedEvent:t=>t.changeEmitter,getValue:e=>t.findIndex((t=>e.matchesPreset(t))),setValue:(e,s,i)=>{-1!=i&&s.applyPreset(e,t[i])}})}}class uc extends p{constructor(t,s,i,a){super(t,"target-picker-root",s,a),e(this,"encounter"),e(this,"targetIndex"),e(this,"aiPicker"),e(this,"levelPicker"),e(this,"mobTypePicker"),e(this,"tankIndexPicker"),e(this,"statPickers"),e(this,"swingSpeedPicker"),e(this,"minBaseDamagePicker"),e(this,"dualWieldPicker"),e(this,"dwMissPenaltyPicker"),e(this,"parryHastePicker"),e(this,"spellSchoolPicker"),e(this,"damageSpreadPicker"),e(this,"targetInputPickers"),this.encounter=s,this.targetIndex=i,this.rootElem.innerHTML='\n\t\t\t<div class="target-picker-section target-picker-section1"></div>\n\t\t\t<div class="target-picker-section target-picker-section2"></div>\n\t\t\t<div class="target-picker-section target-picker-section3 threat-metrics"></div>\n\t\t';const n=this.rootElem.getElementsByClassName("target-picker-section1")[0],o=this.rootElem.getElementsByClassName("target-picker-section2")[0],l=this.rootElem.getElementsByClassName("target-picker-section3")[0],r=s.sim.db.getAllPresetTargets();new nr(n,null,{extraCssClasses:["npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(r.map(((t,e)=>({name:t.path,value:e})))),changedEvent:()=>s.targetsChangeEmitter,getValue:()=>r.findIndex((t=>Ic(this.getTarget(),t.target))),setValue:(t,e,i)=>{-1!=i&&(s.applyPresetTarget(t,r[i],this.targetIndex),s.targetsChangeEmitter.emit(t))}}),this.aiPicker=new nr(n,null,{extraCssClasses:["ai-picker"],label:"AI",labelTooltip:"\n\t\t\t\t<p>Determines the target's ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t",values:[{name:"None",value:0}].concat(r.map((t=>({name:t.path,value:t.target.id})))),changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().id,setValue:(t,e,i)=>{const a=this.getTarget();a.id=i,a.targetInputs=(r.find((t=>a.id==t.target?.id))?.target?.targetInputs||[]).map((t=>qe.clone(t))),s.targetsChangeEmitter.emit(t)}}),this.levelPicker=new nr(n,null,{label:"Level",values:[{name:"63",value:63},{name:"62",value:62},{name:"61",value:61},{name:"60",value:60},{name:"53",value:53},{name:"52",value:52},{name:"51",value:51},{name:"50",value:50},{name:"43",value:43},{name:"42",value:42},{name:"41",value:41},{name:"40",value:40},{name:"28",value:28},{name:"27",value:27},{name:"26",value:26},{name:"25",value:25}],changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().level,setValue:(t,e,i)=>{this.getTarget().level=i,s.targetsChangeEmitter.emit(t)}}),this.mobTypePicker=new nr(n,null,{label:"Mob Type",values:bc,changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().mobType,setValue:(t,e,i)=>{this.getTarget().mobType=i,s.targetsChangeEmitter.emit(t)}}),this.tankIndexPicker=new nr(n,null,{extraCssClasses:["threat-metrics"],label:"Tanked By",labelTooltip:"Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().tankIndex,setValue:(t,e,i)=>{this.getTarget().tankIndex=i,s.targetsChangeEmitter.emit(t)}}),this.targetInputPickers=fc(n,s,this.targetIndex),this.statPickers=wc.map((t=>{const e=t.stat;return new er(o,null,{inline:!0,extraCssClasses:t.extraCssClasses,label:Be.get(e),labelTooltip:t.tooltip,changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().stats[e],setValue:(t,i,a)=>{this.getTarget().stats[e]=a,s.targetsChangeEmitter.emit(t)}})})),this.swingSpeedPicker=new er(l,null,{label:"Swing Speed",labelTooltip:"Time in seconds between auto attacks. Set to 0 to disable auto attacks.",float:!0,changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().swingSpeed,setValue:(t,e,i)=>{this.getTarget().swingSpeed=i,s.targetsChangeEmitter.emit(t)}}),this.minBaseDamagePicker=new er(l,null,{label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().minBaseDamage,setValue:(t,e,i)=>{this.getTarget().minBaseDamage=i,s.targetsChangeEmitter.emit(t)}}),this.damageSpreadPicker=new er(l,null,{label:"Damage Spread",labelTooltip:"Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.",float:!0,changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().damageSpread,setValue:(t,e,i)=>{this.getTarget().damageSpread=i,s.targetsChangeEmitter.emit(t)}}),this.dualWieldPicker=new ar(l,null,{label:"Dual Wield",labelTooltip:"Uses 2 separate weapons to attack.",inline:!0,changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().dualWield,setValue:(t,e,i)=>{this.getTarget().dualWield=i,s.targetsChangeEmitter.emit(t)}}),this.dwMissPenaltyPicker=new ar(l,null,{label:"DW Miss Penalty",labelTooltip:"Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.",inline:!0,changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().dualWieldPenalty,setValue:(t,e,i)=>{this.getTarget().dualWieldPenalty=i,s.targetsChangeEmitter.emit(t)},enableWhen:()=>this.getTarget().dualWield}),this.parryHastePicker=new ar(l,null,{label:"Parry Haste",labelTooltip:"Whether this enemy will gain parry haste when parrying attacks.",inline:!0,changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().parryHaste,setValue:(t,e,i)=>{this.getTarget().parryHaste=i,s.targetsChangeEmitter.emit(t)}}),this.spellSchoolPicker=new nr(l,null,{label:"Spell School",labelTooltip:"Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.",values:[{name:"Physical",value:ht.SpellSchoolPhysical},{name:"Arcane",value:ht.SpellSchoolArcane},{name:"Fire",value:ht.SpellSchoolFire},{name:"Frost",value:ht.SpellSchoolFrost},{name:"Holy",value:ht.SpellSchoolHoly},{name:"Nature",value:ht.SpellSchoolNature},{name:"Shadow",value:ht.SpellSchoolShadow}],changedEvent:()=>s.targetsChangeEmitter,getValue:()=>this.getTarget().spellSchool,setValue:(t,e,i)=>{this.getTarget().spellSchool=i,s.targetsChangeEmitter.emit(t)}}),this.init()}getTarget(){return this.encounter.targets[this.targetIndex]||lt.create()}getInputElem(){return null}getInputValue(){return lt.create({id:this.aiPicker.getInputValue(),level:this.levelPicker.getInputValue(),mobType:this.mobTypePicker.getInputValue(),tankIndex:this.tankIndexPicker.getInputValue(),swingSpeed:this.swingSpeedPicker.getInputValue(),minBaseDamage:this.minBaseDamagePicker.getInputValue(),dualWield:this.dualWieldPicker.getInputValue(),dualWieldPenalty:this.dwMissPenaltyPicker.getInputValue(),parryHaste:this.parryHastePicker.getInputValue(),spellSchool:this.spellSchoolPicker.getInputValue(),damageSpread:this.damageSpreadPicker.getInputValue(),stats:this.statPickers.map((t=>t.getInputValue())).map(((t,e)=>(new oa).withStat(wc[e].stat,t))).reduce(((t,e)=>t.add(e))).asArray(),targetInputs:this.targetInputPickers.getInputValue()})}setInputValue(t){t&&(this.aiPicker.setInputValue(t.id),this.levelPicker.setInputValue(t.level),this.mobTypePicker.setInputValue(t.mobType),this.tankIndexPicker.setInputValue(t.tankIndex),this.swingSpeedPicker.setInputValue(t.swingSpeed),this.minBaseDamagePicker.setInputValue(t.minBaseDamage),this.dualWieldPicker.setInputValue(t.dualWield),this.dwMissPenaltyPicker.setInputValue(t.dualWieldPenalty),this.parryHastePicker.setInputValue(t.parryHaste),this.spellSchoolPicker.setInputValue(t.spellSchool),this.damageSpreadPicker.setInputValue(t.damageSpread),wc.forEach(((e,s)=>this.statPickers[s].setInputValue(t.stats[e.stat]))),this.targetInputPickers.setInputValue(t.targetInputs))}}class pc extends p{constructor(t,s,i,a,n){super(t,"target-input-picker-root",s,n),e(this,"encounter"),e(this,"targetIndex"),e(this,"targetInputIndex"),e(this,"boolPicker"),e(this,"numberPicker"),this.encounter=s,this.targetIndex=i,this.targetInputIndex=a,this.boolPicker=null,this.numberPicker=null,this.init()}getTargetInput(){return this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex]||qe.create()}getInputElem(){return this.rootElem}getInputValue(){return qe.create({boolValue:this.boolPicker?this.boolPicker.getInputValue():void 0,numberValue:this.numberPicker?this.numberPicker.getInputValue():void 0})}setInputValue(t){t&&(t.inputType!=ze.Number||this.numberPicker?t.inputType!=ze.Bool||this.boolPicker||(this.numberPicker&&(this.numberPicker.rootElem.remove(),this.numberPicker=null),this.boolPicker=new ar(this.rootElem,null,{label:t.label,labelTooltip:t.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().boolValue,setValue:(t,e,s)=>{this.getTargetInput().boolValue=s,this.encounter.targetsChangeEmitter.emit(t)}})):(this.boolPicker&&(this.boolPicker.rootElem.remove(),this.boolPicker=null),this.numberPicker=new er(this.rootElem,null,{label:t.label,labelTooltip:t.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().numberValue,setValue:(t,e,s)=>{this.getTargetInput().numberValue=s,this.encounter.targetsChangeEmitter.emit(t)}})))}}function gc(t,e,s){let i=p.newGroupContainer();if(t.appendChild(i),new er(i,e,{label:"Duration",labelTooltip:"The fight length for each sim iteration, in seconds.",changedEvent:t=>t.changeEmitter,getValue:t=>t.getDuration(),setValue:(t,e,s)=>{e.setDuration(t,s)},enableWhen:t=>!e.getUseHealth()}),new er(i,e,{label:"Duration +/-",labelTooltip:"Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.",changedEvent:t=>t.changeEmitter,getValue:t=>t.getDurationVariation(),setValue:(t,e,s)=>{e.setDurationVariation(t,s)},enableWhen:t=>!e.getUseHealth()}),s){let s=p.newGroupContainer();s.classList.add("execute-group"),t.appendChild(s),new er(s,e,{label:"Execute Duration 20 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:t=>t.changeEmitter,getValue:t=>100*t.getExecuteProportion20(),setValue:(t,e,s)=>{e.setExecuteProportion20(t,s/100)},enableWhen:t=>!e.getUseHealth()}),new er(s,e,{label:"Execute Duration 25 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock's Drain Soul.",changedEvent:t=>t.changeEmitter,getValue:t=>100*t.getExecuteProportion25(),setValue:(t,e,s)=>{e.setExecuteProportion25(t,s/100)},enableWhen:t=>!e.getUseHealth()}),new er(s,e,{label:"Execute Duration 35 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:t=>t.changeEmitter,getValue:t=>100*t.getExecuteProportion35(),setValue:(t,e,s)=>{e.setExecuteProportion35(t,s/100)},enableWhen:t=>!e.getUseHealth()})}}function fc(t,e,s){return new dc(t,e,{itemLabel:"Target Input",changedEvent:t=>t.targetsChangeEmitter,getValue:t=>t.targets[s].targetInputs,setValue:(t,e,i)=>{e.targets[s].targetInputs=i,e.targetsChangeEmitter.emit(t)},newItem:()=>qe.create(),copyItem:t=>qe.clone(t),newItemPicker:(t,i,a,n)=>new pc(t,e,s,a,n),hideUi:!0})}function Ic(t,e){if(null==t!=(null==e))return!1;if(null==t)return!0;const s=lt.clone(e);return s.targetInputs=t.targetInputs,lt.equals(t,s)}const wc=[{stat:i.StatHealth,tooltip:"",extraCssClasses:[]},{stat:i.StatArmor,tooltip:"",extraCssClasses:[]},{stat:i.StatArcaneResistance,tooltip:"",extraCssClasses:[]},{stat:i.StatFireResistance,tooltip:"",extraCssClasses:[]},{stat:i.StatFrostResistance,tooltip:"",extraCssClasses:[]},{stat:i.StatNatureResistance,tooltip:"",extraCssClasses:[]},{stat:i.StatShadowResistance,tooltip:"",extraCssClasses:[]},{stat:i.StatAttackPower,tooltip:"",extraCssClasses:["threat-metrics"]},{stat:i.StatBlockValue,tooltip:"",extraCssClasses:["threat-metrics"]}],bc=[{name:"None",value:dt.MobTypeUnknown},{name:"Beast",value:dt.MobTypeBeast},{name:"Demon",value:dt.MobTypeDemon},{name:"Dragonkin",value:dt.MobTypeDragonkin},{name:"Elemental",value:dt.MobTypeElemental},{name:"Giant",value:dt.MobTypeGiant},{name:"Humanoid",value:dt.MobTypeHumanoid},{name:"Mechanical",value:dt.MobTypeMechanical},{name:"Undead",value:dt.MobTypeUndead}];var xc=(t=>(t.Vertical="vertical",t.Horizontal="Horizontal",t))(xc||{});class vc extends p{constructor(t,s,i){super(t,"icon-enum-picker-root",s,i),e(this,"config"),e(this,"currentValue"),e(this,"storedValue"),e(this,"buttonElem"),e(this,"buttonText"),this.rootElem.classList.add("icon-picker","vertical"===(i.direction??"vertical")?"dropdown":"dropend"),this.config=i,this.currentValue=this.config.zeroValue,i.showWhen&&i.changedEvent(this.modObject).on((t=>{i.showWhen&&i.showWhen(this.modObject)||this.rootElem.classList.add("hide")})),i.tooltip&&ta.getOrCreateInstance(this.rootElem,{html:!0,title:i.tooltip}),this.rootElem.appendChild(g(b,null,g("a",{href:"javascript:void(0)",className:"icon-picker-button",attributes:{"aria-expanded":"false",role:"button"},dataset:{bsToggle:"dropdown",whtticon:"false",disableWowheadTouchTooltip:"true"}}),g("ul",{className:"dropdown-menu"}),g("label",{className:"form-label"}))),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.buttonText=this.rootElem.querySelector("label");const a=this.rootElem.querySelector(".dropdown-menu");this.config.numColumns&&(a.style.gridTemplateColumns=`repeat(${this.config.numColumns}, 1fr)`),"Horizontal"==this.config.direction&&(a.style.gridAutoFlow="column"),i.values.forEach(((t,e)=>{const s=document.createElement("li");s.classList.add("icon-dropdown-option","dropdown-option"),a.appendChild(s);const n=document.createElement("a");n.classList.add("icon-picker-button"),n.dataset.disableWowheadTouchTooltip="true",s.appendChild(n),this.setImage(n,t),t.tooltip&&ta.getOrCreateInstance(n,{html:!0,title:t.tooltip});!t.showWhen||t.showWhen(this.modObject)||s.classList.add("hide"),t.showWhen&&i.changedEvent(this.modObject).on((e=>{const i=t.showWhen&&t.showWhen(this.modObject),a=!s.classList.contains("hide");i?a||(s.classList.remove("hide"),this.storedValue==t.value&&this.restoreValue(),this.setImage(n,t)):a&&(this.getInputValue()==t.value&&this.storeValue(),s.classList.add("hide"))})),n.addEventListener("click",(e=>{e.preventDefault(),this.currentValue=t.value,this.storedValue=void 0,this.inputChanged(c.nextEventID())}))})),this.init()}storeValue(){this.storedValue=this.getInputValue(),this.setInputValue(this.config.zeroValue),this.inputChanged(c.nextEventID())}restoreValue(){this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(c.nextEventID()),this.storedValue=void 0)}setActionImage(t,e){e.fillAndSet(t,!0,!0)}setImage(t,e){!e.showWhen||e.showWhen(this.modObject)?e.actionId?(this.setActionImage(t,e.actionId),t.style.filter=""):e.iconUrl?(t.style.backgroundImage=`url(${e.iconUrl})`,t.style.filter="grayscale(1)"):(t.style.backgroundImage="",t.style.filter="",t.style.backgroundColor=e.color):t.removeAttribute("href")}update(){super.update(),this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue))}getInputElem(){return this.buttonElem}getInputValue(){return this.currentValue}setInputValue(t){this.currentValue=t,this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue)),this.buttonText.textContent="",this.buttonText.style.display="none";const e=this.config.values.find((t=>this.config.equals(t.value,this.currentValue)));if(e)this.setImage(this.buttonElem,e),null!=e.text&&(this.buttonText.style.display="block",this.buttonText.textContent=e.text);else if(this.config.backupIconUrl){const t=this.config.backupIconUrl(this.currentValue);this.setActionImage(this.buttonElem,t),this.setActive(!1)}}setActive(t){t?this.buttonElem.classList.add("active"):this.buttonElem.classList.remove("active")}}function Ec(t,e){return t.filter((t=>(!t.faction||t.faction==e.player.getFaction())&&!e.individualConfig.excludeBuffDebuffInputs.includes(t.config)&&0==t.stats.length||t.stats.some((t=>e.individualConfig.epStats.includes(t)))||e.individualConfig.includeBuffDebuffInputs.includes(t.config)))}class Sc extends I{constructor(t,s,i,a){super(t,"item-swap-picker-root"),e(this,"itemSlots"),e(this,"enableItemSwapPicker"),this.itemSlots=a.itemSlots,this.enableItemSwapPicker=new ar(this.rootElem,i,{label:"Enable Item Swapping",labelTooltip:"Allows configuring an Item Swap Set which is used with the <b>Item Swap</b> APL action.",extraCssClasses:["input-inline"],getValue:t=>t.getEnableItemSwap(),setValue(t,e,s){e.setEnableItemSwap(t,s)},changedEvent:t=>t.itemSwapChangeEmitter});const n=document.createElement("div");this.rootElem.appendChild(n);const o=()=>{i.getEnableItemSwap()?n.classList.remove("hide"):n.classList.add("hide")};i.itemSwapChangeEmitter.on(o),o();const l=document.createElement("label");l.classList.add("form-label"),l.textContent="Item Swap",n.appendChild(l);let r=p.newGroupContainer();r.classList.add("icon-group"),n.appendChild(r);let d=document.createElement("fragment");d.innerHTML='\n\t\t\t<a\n\t\t\t\thref="javascript:void(0)"\n\t\t\t\tclass="gear-swap-icon"\n\t\t\t\trole="button"\n\t\t\t\tdata-bs-toggle="tooltip"\n\t\t\t\tdata-bs-title="Swap Items with Main Gear"\n\t\t\t>\n\t\t\t\t<i class="fas fa-arrows-rotate me-1"></i>\n\t\t\t</a>\n\t\t';const h=d.children[0];r.appendChild(h),h.addEventListener("click",(t=>{this.swapWithGear(c.nextEventID(),i)})),this.itemSlots.forEach((t=>{new Jr(r,s,i,t,{getValue:e=>e.getItemSwapGear().getEquippedItem(t)?.asSpec()||pe.create(),setValue:(e,s,i)=>{let a=s.getItemSwapGear();a=a.withEquippedItem(t,s.sim.db.lookupItemSpec(i),s.canDualWield2H()),s.setItemSwapGear(e,a)},changedEvent:t=>t.itemSwapChangeEmitter})}))}swapWithGear(t,e){let s=e.getGear(),i=e.getItemSwapGear();this.itemSlots.forEach((t=>{const a=e.getGear().getEquippedItem(t),n=e.getItemSwapGear().getEquippedItem(t);s=s.withEquippedItem(t,n,e.canDualWield2H()),i=i.withEquippedItem(t,a,e.canDualWield2H())})),c.freezeAllAndDo((()=>{e.setGear(t,s),e.setItemSwapGear(t,i)}))}}class yc extends p{constructor(t,s,i){super(t,"icon-picker-root",s,i),e(this,"active"),e(this,"config"),e(this,"rootAnchor"),e(this,"improvedAnchor"),e(this,"improvedAnchor2"),e(this,"counterElem"),e(this,"currentValue"),e(this,"storedValue"),e(this,"handleLeftClick",(t=>{0==this.config.states||this.currentValue+1<this.config.states?(this.currentValue++,this.inputChanged(c.nextEventID())):this.currentValue>0&&(this.currentValue=0,this.inputChanged(c.nextEventID())),t.preventDefault()})),e(this,"handleRightClick",(t=>{this.currentValue>0?this.currentValue--:0===this.config.states?this.currentValue=1:this.currentValue=this.config.states-1,this.inputChanged(c.nextEventID())})),this.rootElem.classList.add("icon-picker"),this.active=!1,this.config=i,this.currentValue=0,this.rootAnchor=document.createElement("a"),this.rootAnchor.classList.add("icon-picker-button"),this.rootAnchor.dataset.whtticon="false",this.rootAnchor.dataset.disableWowheadTouchTooltip="true",this.rootAnchor.target="_blank",this.rootElem.prepend(this.rootAnchor);const a=Boolean(this.config.improvedId);a&&this.rootAnchor.classList.add("use-improved-icons"),this.config.improvedId2&&this.rootAnchor.classList.add("use-improved-icons2"),!a&&this.config.states>2&&this.rootAnchor.classList.add("use-counter");let n=Re(),o=Re(),l=Re();this.rootAnchor.appendChild(g("div",{className:"icon-input-level-container"},g("a",{ref:n,className:"icon-picker-button icon-input-improved icon-input-improved1",dataset:{disableWowheadTouchTooltip:"true"}}),g("a",{ref:o,className:"icon-picker-button icon-input-improved icon-input-improved2",dataset:{disableWowheadTouchTooltip:"true"}}),g("span",{ref:l,className:"icon-picker-label "+(this.config.states>2?"":"hide")}))),this.improvedAnchor=n.value,this.improvedAnchor2=o.value,this.counterElem=l.value,this.config.actionId.fillAndSet(this.rootAnchor,!0,!0),this.config.states>=3&&this.config.improvedId&&this.config.improvedId.fillAndSet(this.improvedAnchor,!0,!0),this.config.states>=4&&this.config.improvedId2&&this.config.improvedId2.fillAndSet(this.improvedAnchor2,!0,!0),this.config.showWhen&&i.changedEvent(this.modObject).on((t=>{this.config.showWhen&&this.config.showWhen(this.modObject)?(this.rootAnchor.classList.remove("hide"),this.restoreValue()):(this.storeValue(),this.rootAnchor.classList.add("hide"))})),this.init(),this.rootAnchor.addEventListener("click",(t=>{this.handleLeftClick(t)})),this.rootAnchor.addEventListener("contextmenu",(t=>{t.preventDefault()})),this.rootAnchor.addEventListener("mousedown",(t=>{x(t)&&(this.handleRightClick(t),t.preventDefault())}))}getInputElem(){return this.rootAnchor}getInputValue(){return 2==this.config.states?Boolean(this.currentValue):this.currentValue}getActionId(){const t=Number(this.config.getValue(this.modObject));return 0==t?null:1==t?this.config.actionId:2==t&&this.config.improvedId?this.config.improvedId:3==t&&this.config.improvedId2?this.config.improvedId2:this.config.actionId}setInputValue(t){this.currentValue=Number(t),this.currentValue>0?(this.active=!0,this.rootAnchor.classList.add("active"),this.counterElem.classList.add("active")):(this.active=!1,this.rootAnchor.classList.remove("active"),this.counterElem.classList.remove("active")),this.config.states>=3&&this.config.improvedId&&(this.currentValue>1?this.improvedAnchor.classList.add("active"):this.improvedAnchor.classList.remove("active")),this.config.states>=4&&this.config.improvedId2&&(this.currentValue>2?(this.improvedAnchor2.classList.add("active"),this.improvedAnchor.hidden=!0,this.improvedAnchor2.hidden=!1):(this.improvedAnchor2.classList.remove("active"),this.improvedAnchor.hidden=!1,this.improvedAnchor2.hidden=!0)),!this.config.improvedId&&(this.config.states>3||0==this.config.states)&&(this.counterElem.textContent=String(this.currentValue))}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(0),this.inputChanged(c.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(c.nextEventID()),this.storedValue=void 0)}}class Pc extends I{constructor(t,s,i,a){super(t,"multi-icon-picker-root"),e(this,"config"),e(this,"currentValue"),e(this,"buttonElem"),e(this,"dropdownMenu"),e(this,"pickers"),this.rootElem.classList.add("icon-picker"),this.config=i,this.currentValue=null,this.rootElem.innerHTML='\n\t\t\t<div class="dropend">\n\t\t\t\t<a\n\t\t\t\t\tclass="icon-picker-button"\n\t\t\t\t\trole="button"\n\t\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t\t\taria-expanded="false"\n\t\t\t\t\tdata-disable-wowhead-touch-tooltip=\'true\'\n\t\t\t\t\tdata-whtticon=\'false\'\n\t\t\t\t></a>\n\t\t\t\t<ul class="dropdown-menu"></ul>\n\t\t\t</div>\n\t\t\t<label class="multi-icon-picker-label form-label"></label>\n    ';const n=this.rootElem.querySelector(".multi-icon-picker-label");i.label?n.textContent=i.label:n.remove(),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.buttonElem.addEventListener("hide.bs.dropdown",(t=>{t.hasOwnProperty("clickEvent")&&t.preventDefault()})),this.buttonElem.addEventListener("contextmenu",(t=>{t.preventDefault()})),this.buttonElem.addEventListener("mousedown",(t=>{x(t)&&this.clearPicker()})),this.buildBlankOption(),this.pickers=i.inputs.map(((t,e)=>{const i=document.createElement("li");return i.classList.add("icon-picker-option","dropdown-option"),this.dropdownMenu.appendChild(i),new yc(i,s,t)})),a.sim.waitForInit().then((()=>this.updateButtonImage())),a.changeEmitter.on((()=>this.updateButtonImage())),a.changeEmitter.on((()=>{!this.config.showWhen||this.config.showWhen(a.sim.raid.getPlayer(0))?this.rootElem.classList.remove("hide"):this.rootElem.classList.add("hide")}))}buildBlankOption(){const t=document.createElement("li");this.dropdownMenu.appendChild(t);const e=document.createElement("a");e.classList.add("icon-dropdown-option","dropdown-option"),t.appendChild(e),e.addEventListener("click",(()=>this.clearPicker()))}clearPicker(){c.freezeAllAndDo((()=>{this.pickers.forEach((t=>{t.setInputValue(null),t.inputChanged(c.nextEventID())})),this.updateButtonImage()}))}updateButtonImage(){this.currentValue=this.getMaxValue(),this.currentValue?(this.buttonElem.classList.add("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.currentValue.fillAndSet(this.buttonElem,!1,!0)):(this.buttonElem.classList.remove("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.buttonElem.style.backgroundImage="",this.buttonElem.removeAttribute("href"))}getMaxValue(){return this.pickers.map((t=>t.getActionId())).filter((t=>null!=t))[0]||null}}function Cc(t,e){return{inputs:t,label:e,showWhen:e=>t.filter((t=>!t.showWhen||t.showWhen(e))).length>0}}function kc(t){const e=t.getModObject;return{type:"boolean",label:t.label,labelTooltip:t.labelTooltip,changedEvent:s=>t.changedEvent(e(s)),getValue:s=>t.getValue(e(s)),setValue:(s,i,a)=>t.setValue(s,e(i),a),enableWhen:t.enableWhen?s=>t.enableWhen(e(s)):void 0,showWhen:t.showWhen?s=>t.showWhen(e(s)):void 0,extraCssClasses:t.extraCssClasses}}function Tc(t){return kc({label:t.label,labelTooltip:t.labelTooltip,getModObject:t=>t,getValue:t.getValue||(e=>e.getSpecOptions()[t.fieldName]),setValue:t.setValue||((e,s,i)=>{const a=s.getSpecOptions();a[t.fieldName]=i,s.setSpecOptions(e,a)}),changedEvent:t.changeEmitter||(t=>t.specOptionsChangeEmitter),enableWhen:t.enableWhen,showWhen:t.showWhen,extraCssClasses:t.extraCssClasses})}function _c(t){return kc({label:t.label,labelTooltip:t.labelTooltip,getModObject:t=>t,getValue:t.getValue||(e=>e.getSimpleRotation()[t.fieldName]),setValue:t.setValue||((e,s,i)=>{const a=s.getSimpleRotation();a[t.fieldName]=i,s.setSimpleRotation(e,a)}),changedEvent:t.changeEmitter||(t=>t.rotationChangeEmitter),enableWhen:t.enableWhen,showWhen:t.showWhen,extraCssClasses:t.extraCssClasses})}function Nc(t){const e=t.getModObject;return{type:"number",label:t.label,labelTooltip:t.labelTooltip,float:t.float,positive:t.positive,changedEvent:s=>t.changedEvent(e(s)),getValue:s=>t.getValue(e(s)),setValue:(s,i,a)=>t.setValue(s,e(i),a),enableWhen:t.enableWhen?s=>t.enableWhen(e(s)):void 0,showWhen:t.showWhen?s=>t.showWhen(e(s)):void 0,extraCssClasses:t.extraCssClasses}}function Lc(t){const e={label:t.label,labelTooltip:t.labelTooltip,float:t.float,positive:t.positive,getModObject:t=>t,getValue:t.getValue||(e=>e.getSpecOptions()[t.fieldName]),setValue:t.setValue||((e,s,i)=>{const a=s.getSpecOptions();a[t.fieldName]=i,s.setSpecOptions(e,a)}),changedEvent:t.changeEmitter||(t=>t.specOptionsChangeEmitter),enableWhen:t.enableWhen,showWhen:t.showWhen,extraCssClasses:t.extraCssClasses};if(t.percent){const t=e.getValue;e.getValue=e=>100*t(e);const s=e.setValue;e.setValue=(t,e,i)=>s(t,e,i/100)}return Nc(e)}function Rc(t){const e={label:t.label,labelTooltip:t.labelTooltip,float:t.float,positive:t.positive,getModObject:t=>t,getValue:t.getValue||(e=>e.getSimpleRotation()[t.fieldName]),setValue:t.setValue||((e,s,i)=>{const a=s.getSimpleRotation();a[t.fieldName]=i,s.setSimpleRotation(e,a)}),changedEvent:t.changeEmitter||(t=>t.rotationChangeEmitter),enableWhen:t.enableWhen,showWhen:t.showWhen,extraCssClasses:t.extraCssClasses};if(t.percent){const t=e.getValue;e.getValue=e=>100*t(e);const s=e.setValue;e.setValue=(t,e,i)=>s(t,e,i/100)}return Nc(e)}function Dc(t){const e=t.getModObject;return{type:"enum",label:t.label,labelTooltip:t.labelTooltip,values:t.values,changedEvent:s=>t.changedEvent(e(s)),getValue:s=>t.getValue(e(s)),setValue:(s,i,a)=>t.setValue(s,e(i),a),enableWhen:t.enableWhen?s=>t.enableWhen(e(s)):void 0,showWhen:t.showWhen?s=>t.showWhen(e(s)):void 0}}function Ac(t){return Dc({label:t.label,labelTooltip:t.labelTooltip,values:t.values,getModObject:t=>t,getValue:t.getValue||(e=>e.getSpecOptions()[t.fieldName]),setValue:t.setValue||((e,s,i)=>{const a=s.getSpecOptions();a[t.fieldName]=i,s.setSpecOptions(e,a)}),changedEvent:t.changeEmitter||(t=>t.specOptionsChangeEmitter),enableWhen:t.enableWhen,showWhen:t.showWhen})}function Vc(t){return Dc({label:t.label,labelTooltip:t.labelTooltip,values:t.values,getModObject:t=>t,getValue:t.getValue||(e=>e.getSimpleRotation()[t.fieldName]),setValue:t.setValue||((e,s,i)=>{const a=s.getSimpleRotation();a[t.fieldName]=i,s.setSimpleRotation(e,a)}),changedEvent:t.changeEmitter||(t=>t.rotationChangeEmitter),enableWhen:t.enableWhen,showWhen:t.showWhen})}function Mc(t){const e=t.getModObject;return{type:"icon",actionId:t.actionId,states:t.states,showWhen:t.showWhen,changedEvent:s=>t.changedEvent(e(s)),getValue:s=>t.getValue(e(s)),setValue:(s,i,a)=>t.setValue(s,e(i),a),extraCssClasses:t.extraCssClasses}}function Uc(t,e,s,i){return Mc({getModObject:t.getModObject,actionId:e,states:2,changedEvent:t.changeEmitter,showWhen:t.showWhen,getValue:t.getFieldValue||(e=>i?t.getValue(e)[s]==i:t.getValue(e)[s]),setValue:t.setFieldValue||((e,a,n)=>{const o=t.getValue(a);i?n?o[s]=i:o[s]==i&&(o[s]=0):o[s]=n,t.setValue(e,a,o)}),extraCssClasses:t.extraCssClasses})}function Fc(t){return Uc({getModObject:t=>t,getValue:t=>t.getSpecOptions(),setValue:(t,e,s)=>e.setSpecOptions(t,s),changeEmitter:t.changeEmitter||(t=>t.specOptionsChangeEmitter),extraCssClasses:t.extraCssClasses,getFieldValue:t.getValue,setFieldValue:t.setValue},t.actionId,t.fieldName,t.value)}function Wc(t,e,s,i){return Mc({getModObject:t.getModObject,actionId:e,states:0,changedEvent:t.changeEmitter,showWhen:t.showWhen,getValue:e=>t.getValue(e)[s],setValue:(e,a,n)=>{const o=t.getValue(a);if(i){const t=n-o[s];n+=(i-1)*t}n<0&&(n=0),o[s]=n,t.setValue(e,a,o)}})}function Oc(t,e,s,i){const a=Wc(t,e,i);return a.states=3,a.improvedId=s,a}function Hc(t,e,s,i,a){const n=Wc(t,e,i,a);return n.states=s,n}function qc(t,e,s,i,a){return function(t){const e=t.getModObject;return{type:"iconEnum",numColumns:t.numColumns,direction:t.direction,values:t.values.map((t=>{if(t.showWhen){const s=t.showWhen;t.showWhen=t=>s(e(t))}return t})),equals:t.equals,showWhen:s=>!t.showWhen||t.showWhen(e(s)),zeroValue:t.zeroValue,changedEvent:s=>t.changedEvent(e(s)),getValue:s=>t.getValue(e(s)),setValue:(s,i,a)=>t.setValue(s,e(i),a),extraCssClasses:t.extraCssClasses}}({direction:a||xc.Vertical,numColumns:i,values:s,zeroValue:0,equals:(t,e)=>t==e,getModObject:t.getModObject,changedEvent:t.changeEmitter,showWhen:t.showWhen,getValue:s=>t.getValue(s)[e],setValue:(s,i,a)=>{const n=t.getValue(i);n[e]=a,t.setValue(s,i,n)}})}function Bc(t){return qc({showWhen:t.showWhen,getModObject:t=>t,getValue:t=>t.getSpecOptions(),setValue:(t,e,s)=>e.setSpecOptions(t,s),getFieldValue:t.getValue,setFieldValue:t.setValue,changeEmitter:t.changeEmitter||(t=>t.specOptionsChangeEmitter),extraCssClasses:t.extraCssClasses},t.fieldName,t.values,t.numColumns)}const zc=(t,e,s)=>"icon"==s.type?new yc(t,e,s):"iconEnum"==s.type?new vc(t,e,s):void 0;function jc(t,e){return t.label=e,t}function $c(t){return Uc({getModObject:t=>t,showWhen:e=>(t.minLevel||0)<=e.getLevel()&&e.getLevel()<=(t.maxLevel||se)&&(!t.faction||t.faction==e.getFaction()),getValue:t=>t.getRaid().getBuffs(),setValue:(t,e,s)=>e.getRaid().setBuffs(t,s),changeEmitter:t=>c.onAny([t.getRaid().buffsChangeEmitter,t.levelChangeEmitter,t.raceChangeEmitter])},t.actionId,t.fieldName,t.value)}function Gc(t){return Uc({getModObject:t=>t,showWhen:e=>(t.minLevel||0)<=e.getLevel()&&e.getLevel()<=(t.maxLevel||se)&&(!t.faction||t.faction==e.getFaction()),getValue:t=>t.getBuffs(),setValue:(t,e,s)=>e.setBuffs(t,s),changeEmitter:t=>c.onAny([t.buffsChangeEmitter,t.levelChangeEmitter,t.raceChangeEmitter])},t.actionId,t.fieldName,t.value)}function Kc(t){return Uc({getModObject:t=>t,showWhen:e=>e.getLevel()>=(t.minLevel||0),getValue:t=>t.getConsumes(),setValue:(t,e,s)=>e.setConsumes(t,s),changeEmitter:t=>c.onAny([t.consumesChangeEmitter,t.levelChangeEmitter])},t.actionId,t.fieldName,t.value)}function Jc(t){return Uc({getModObject:t=>t,showWhen:e=>(t.minLevel||0)<=e.getLevel()&&e.getLevel()<=(t.maxLevel||se),getValue:t=>t.getRaid().getDebuffs(),setValue:(t,e,s)=>e.getRaid().setDebuffs(t,s),changeEmitter:t=>c.onAny([t.getRaid().debuffsChangeEmitter,t.levelChangeEmitter])},t.actionId,t.fieldName,t.value)}function Zc(t){return Oc({getModObject:t=>t,showWhen:e=>(t.minLevel||0)<=e.getLevel()&&e.getLevel()<=(t.maxLevel||se)&&(!t.faction||t.faction==e.getFaction()),getValue:t=>t.getRaid().getBuffs(),setValue:(t,e,s)=>e.getRaid().setBuffs(t,s),changeEmitter:t=>c.onAny([t.getRaid().buffsChangeEmitter,t.levelChangeEmitter,t.raceChangeEmitter])},t.actionId,t.impId,t.fieldName)}function Yc(t){return Oc({getModObject:t=>t,showWhen:e=>(t.minLevel||0)<=e.getLevel()&&e.getLevel()<=(t.maxLevel||se)&&(!t.faction||t.faction==e.getFaction()),getValue:t=>t.getBuffs(),setValue:(t,e,s)=>e.setBuffs(t,s),changeEmitter:t=>c.onAny([t.buffsChangeEmitter,t.levelChangeEmitter,t.raceChangeEmitter])},t.actionId,t.impId,t.fieldName)}function Xc(t,e,s){return Oc({getModObject:t=>t.getRaid(),getValue:t=>t.getDebuffs(),setValue:(t,e,s)=>e.setDebuffs(t,s),changeEmitter:t=>t.debuffsChangeEmitter},t,e,s)}function Qc(t){return Hc({getModObject:t=>t,showWhen:e=>(t.minLevel||0)<=e.getLevel()&&e.getLevel()<=(t.maxLevel||se)&&(!t.faction||t.faction==e.getFaction()),getValue:t=>t.getBuffs(),setValue:(t,e,s)=>e.setBuffs(t,s),changeEmitter:t=>c.onAny([t.buffsChangeEmitter,t.levelChangeEmitter,t.raceChangeEmitter])},t.actionId,t.numStates,t.fieldName,t.multiplier)}function td(t,e,s,i){return Hc({getModObject:t=>t.getRaid(),getValue:t=>t.getDebuffs(),setValue:(t,e,s)=>e.setDebuffs(t,s),changeEmitter:t=>t.debuffsChangeEmitter},t,e,i,s)}function ed(t){return(e,s)=>({type:"iconEnum",tooltip:s,numColumns:e.length>5?2:1,values:[{value:0}].concat(e.map((t=>{const e={actionId:t.config.actionId,showWhen:e=>(!t.config.showWhen||t.config.showWhen(e))&&(t.config.minLevel||0)<=e.getLevel()&&(t.config.maxLevel||se)>=e.getLevel()&&(t.config.faction||e.getFaction())==e.getFaction()};return t.config.value&&(e.value=t.config.value),e}))),equals:(t,e)=>t==e,zeroValue:0,changedEvent:t=>c.onAny([t.consumesChangeEmitter,t.levelChangeEmitter,t.gearChangeEmitter]),showWhen:e=>!t.showWhen||t.showWhen(e),getValue:e=>e.getConsumes()[t.consumesFieldName],setValue:(e,s,i)=>{const a=s.getConsumes();a[t.consumesFieldName]!==i&&(a[t.consumesFieldName]=i,c.freezeAllAndDo((()=>{s.setConsumes(e,a),t.onSet&&t.onSet(e,s,i)})))}})}const sd={actionId:v.fromItemId(4381),value:je.ConjuredMinorRecombobulator,showWhen:t=>t.getGear().hasTrinket(4381)},id={actionId:v.fromItemId(12662),value:je.ConjuredDemonicRune,minLevel:40},ad=[{config:sd,stats:[i.StatIntellect]},{config:id,stats:[i.StatIntellect]}],nd=ed({consumesFieldName:"defaultConjured"}),od=[{config:{actionId:v.fromItemId(18641),value:$e.ExplosiveDenseDynamite,minLevel:40},stats:[]},{config:{actionId:v.fromItemId(15993),value:$e.ExplosiveThoriumGrenade,minLevel:40},stats:[]},{config:{actionId:v.fromItemId(4365),value:$e.ExplosiveCoarseDynamite},stats:[]}],ld=ed({consumesFieldName:"fillerExplosive"}),rd=Kc({actionId:v.fromItemId(10646),fieldName:"sapper",minLevel:40}),cd={actionId:v.fromItemId(13510),value:Ge.FlaskOfTheTitans,minLevel:50},dd={actionId:v.fromItemId(13511),value:Ge.FlaskOfDistilledWisdom,minLevel:50},hd={actionId:v.fromItemId(13512),value:Ge.FlaskOfSupremePower,minLevel:50},md={actionId:v.fromItemId(13513),value:Ge.FlaskOfChromaticResistance,minLevel:50},ud=[{config:cd,stats:[i.StatStamina]},{config:dd,stats:[i.StatMP5,i.StatSpellPower]},{config:hd,stats:[i.StatMP5,i.StatSpellPower]},{config:md,stats:[i.StatStamina]}],pd=ed({consumesFieldName:"flask"}),gd={actionId:v.fromItemId(21072),value:Ke.FoodSmokedSagefish,minLevel:10},fd={actionId:v.fromItemId(13851),value:Ke.FoodHotWolfRibs,minLevel:25};v.fromItemId(22480),Ke.FoodTenderWolfSteak;const Id={actionId:v.fromItemId(13931),value:Ke.FoodNightfinSoup,minLevel:35},wd={actionId:v.fromItemId(13928),value:Ke.FoodGrilledSquid,minLevel:35},bd={actionId:v.fromItemId(20452),value:Ke.FoodSmokedDesertDumpling,minLevel:45},xd={actionId:v.fromItemId(18254),value:Ke.FoodRunnTumTuberSurprise,minLevel:45},vd={actionId:v.fromItemId(13813),value:Ke.FoodBlessedSunfruitJuice,minLevel:45},Ed={actionId:v.fromItemId(13810),value:Ke.FoodBlessSunfruit,minLevel:45},Sd={actionId:v.fromItemId(21023),value:Ke.FoodDirgesKickChimaerokChops,minLevel:55},yd=[{config:fd,stats:[i.StatSpirit]},{config:gd,stats:[i.StatMP5]},{config:Id,stats:[i.StatMP5,i.StatSpellPower]},{config:wd,stats:[i.StatAgility]},{config:bd,stats:[i.StatStrength]},{config:xd,stats:[i.StatIntellect]},{config:Sd,stats:[i.StatStamina]},{config:Ed,stats:[i.StatStrength]},{config:vd,stats:[i.StatSpirit]}],Pd=ed({consumesFieldName:"food"}),Cd={actionId:v.fromItemId(13452),value:Je.ElixirOfTheMongoose,minLevel:46},kd={actionId:v.fromItemId(9187),value:Je.ElixirOfGreaterAgility,minLevel:38},Td={actionId:v.fromItemId(3390),value:Je.ElixirOfLesserAgility,minLevel:18},_d={actionId:v.fromItemId(10309),value:Je.ScrollOfAgility},Nd=[{config:Cd,stats:[i.StatAgility]},{config:kd,stats:[i.StatAgility]},{config:Td,stats:[i.StatAgility]},{config:_d,stats:[i.StatAgility]}],Ld=ed({consumesFieldName:"agilityElixir"}),Rd={actionId:v.fromItemId(12451),value:Ze.JujuPower,minLevel:46},Dd={actionId:v.fromItemId(9206),value:Ze.ElixirOfGiants,minLevel:46},Ad={actionId:v.fromItemId(3391),value:Ze.ElixirOfOgresStrength,minLevel:20},Vd={actionId:v.fromItemId(10310),value:Ze.ScrollOfStrength},Md=[{config:Rd,stats:[i.StatStrength]},{config:Dd,stats:[i.StatStrength]},{config:Ad,stats:[i.StatStrength]},{config:Vd,stats:[i.StatStrength]}],Ud=ed({consumesFieldName:"strengthBuff"}),Fd=Kc({actionId:v.fromItemId(5206),fieldName:"boglingRoot"}),Wd={actionId:v.fromItemId(3385),value:Ye.LesserManaPotion},Od={actionId:v.fromItemId(3827),value:Ye.ManaPotion},Hd=[{config:Wd,stats:[i.StatIntellect]},{config:Od,stats:[i.StatIntellect]}],qd=ed({consumesFieldName:"defaultPotion"}),Bd={actionId:v.fromItemId(9155),value:Xe.ArcaneElixir,minLevel:37},zd={actionId:v.fromItemId(13454),value:Xe.GreaterArcaneElixir,minLevel:46},jd=[{config:Bd,stats:[i.StatSpellPower]},{config:zd,stats:[i.StatSpellPower]}],$d=ed({consumesFieldName:"spellPowerBuff"}),Gd={actionId:v.fromItemId(6373),value:Qe.ElixirOfFirepower,minLevel:18},Kd={actionId:v.fromItemId(21546),value:Qe.ElixirOfGreaterFirepower,minLevel:40},Jd=[{config:Gd,stats:[i.StatFirePower]},{config:Kd,stats:[i.StatFirePower]}],Zd=ed({consumesFieldName:"firePowerBuff"}),Yd=[{config:{actionId:v.fromItemId(17708),value:ts.ElixirOfFrostPower,minLevel:40},stats:[i.StatFrostPower]}],Xd=ed({consumesFieldName:"frostPowerBuff"}),Qd=[{config:{actionId:v.fromItemId(9264),value:es.ElixirOfShadowPower,minLevel:40},stats:[i.StatShadowPower]}],th=ed({consumesFieldName:"shadowPowerBuff"}),eh={actionId:v.fromItemId(20749),value:ss.BrillianWizardOil,minLevel:45},sh={actionId:v.fromItemId(20748),value:ss.BrilliantManaOil,minLevel:45},ih={actionId:v.fromItemId(12404),value:ss.DenseSharpeningStone,minLevel:35},ah={actionId:v.fromItemId(18262),value:ss.ElementalSharpeningStone,minLevel:50},nh={actionId:v.fromItemId(211848),value:ss.BlackfathomManaOil,minLevel:25},oh={actionId:v.fromItemId(211845),value:ss.BlackfathomSharpeningStone},lh={actionId:v.fromSpellId(407975),value:ss.WildStrikes},rh=[{config:eh,stats:[i.StatSpellPower]},{config:sh,stats:[i.StatHealing,i.StatSpellPower]},{config:ih,stats:[i.StatAttackPower]},{config:ah,stats:[i.StatAttackPower]},{config:nh,stats:[i.StatSpellPower,i.StatMP5]},{config:oh,stats:[i.StatMeleeHit]}],ch=[...rh,{config:lh,stats:[i.StatMeleeHit]}],dh=ed({consumesFieldName:"mainHandImbue",showWhen:t=>!!t.getGear().getEquippedItem(D.ItemSlotMainHand)}),hh=ed({consumesFieldName:"offHandImbue",showWhen:t=>!!t.getGear().getEquippedItem(D.ItemSlotOffHand)});class mh extends I{constructor(t,s){super(t,"consumes-picker-root"),e(this,"simUI"),this.simUI=s,this.buildPotionsPicker(),this.buildFlaskPicker(),this.buildWeaponImbuePicker(),this.buildFoodPicker(),this.buildPhysicalBuffPicker(),this.buildSpellPowerBuffPicker(),this.buildEngPicker(),this.buildPetPicker()}buildPotionsPicker(){let t=document.createElement("fragment");t.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Potions</label>\n        <div class="consumes-row-inputs consumes-potions"></div>\n      </div>\n    ';const e=this.rootElem.appendChild(t.children[0]),s=this.rootElem.querySelector(".consumes-potions");this.buildPickers({changeEmitters:[this.simUI.player.levelChangeEmitter,this.simUI.player.gearChangeEmitter],containerElem:e,options:[{getConfig:()=>qd(Ec(Hd,this.simUI),"Combat Potion")},{getConfig:()=>nd(Ec(ad,this.simUI))}],parentElem:s})}buildFlaskPicker(){let t=document.createElement("fragment");t.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Elixirs</label>\n        <div class="consumes-row-inputs consumes-flasks"></div>\n      </div>\n    ';const e=this.rootElem.appendChild(t.children[0]),s=this.rootElem.querySelector(".consumes-flasks");this.buildPickers({changeEmitters:[this.simUI.player.levelChangeEmitter],containerElem:e,options:[{getConfig:()=>pd(Ec(ud,this.simUI))}],parentElem:s})}buildWeaponImbuePicker(){let t=document.createElement("fragment");t.innerHTML='\n    \t<div class="consumes-row input-root input-inline">\n        <label class="form-label">Weapon Imbues</label>\n        <div class="consumes-row-inputs consumes-weapon-imbues"></div>\n    \t</div>\n    ';const e=this.rootElem.appendChild(t.children[0]),s=this.rootElem.querySelector(".consumes-weapon-imbues");this.buildPickers({changeEmitters:[this.simUI.player.levelChangeEmitter,this.simUI.player.gearChangeEmitter],containerElem:e,options:[{getConfig:()=>dh(Ec(ch,this.simUI),"Main-Hand")},{getConfig:()=>hh(Ec(rh,this.simUI),"Off-Hand")}],parentElem:s})}buildFoodPicker(){let t=document.createElement("fragment");t.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Food</label>\n        <div class="consumes-row-inputs consumes-food"></div>\n      </div>\n    ';const e=this.rootElem.appendChild(t.children[0]),s=this.rootElem.querySelector(".consumes-food");this.buildPickers({changeEmitters:[this.simUI.player.levelChangeEmitter],containerElem:e,options:[{getConfig:()=>Pd(Ec(yd,this.simUI))}],parentElem:s})}buildPhysicalBuffPicker(){const t=this.simUI.individualConfig.epStats.includes(i.StatAgility),e=this.simUI.individualConfig.epStats.includes(i.StatStrength);if(!t&&!e)return;let s=document.createElement("fragment");s.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Physical</label>\n        <div class="consumes-row-inputs consumes-physical"></div>\n      </div>\n    ';const a=this.rootElem.appendChild(s.children[0]),n=this.rootElem.querySelector(".consumes-physical");this.buildPickers({changeEmitters:[this.simUI.player.levelChangeEmitter],containerElem:a,options:[{getConfig:()=>Ld(Ec(Nd,this.simUI),"Agility")},{getConfig:()=>Ud(Ec(Md,this.simUI),"Strength")},{getConfig:()=>Fd}],parentElem:n})}buildSpellPowerBuffPicker(){let t=document.createElement("fragment");t.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Spells</label>\n        <div class="consumes-row-inputs consumes-spells"></div>\n      </div>\n    ';const e=this.rootElem.appendChild(t.children[0]),s=this.rootElem.querySelector(".consumes-spells");this.buildPickers({changeEmitters:[this.simUI.player.levelChangeEmitter],containerElem:e,options:[{getConfig:()=>$d(Ec(jd,this.simUI),"Arcane")},{getConfig:()=>Zd(Ec(Jd,this.simUI),"Fire")},{getConfig:()=>Xd(Ec(Yd,this.simUI),"Frost")},{getConfig:()=>th(Ec(Qd,this.simUI),"Shadow")}],parentElem:s})}buildEngPicker(){let t=document.createElement("fragment");t.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Engineering</label>\n        <div class="consumes-row-inputs consumes-trade">\n\t\t\t\t</div>\n      </div>\n    ';const e=this.rootElem.appendChild(t.children[0]),s=this.rootElem.querySelector(".consumes-trade");this.buildPickers({changeEmitters:[this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter],containerElem:e,options:[{getConfig:()=>rd},{getConfig:()=>ld(Ec(od,this.simUI),"Explosives")}],parentElem:s})}buildPetPicker(){if(!this.simUI.individualConfig.petConsumeInputs?.length)return;let t=document.createElement("fragment");t.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Pet</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-pet"></div>\n\t\t\t</div>\n\t\t',this.rootElem.appendChild(t.children[0]);const e=this.rootElem.querySelector(".consumes-pet");this.simUI.individualConfig.petConsumeInputs.map((t=>zc(e,this.simUI.player,t)))}buildPickers({containerElem:t,changeEmitters:e,options:s,parentElem:i}){const a=()=>{i.innerHTML="";s.map((t=>{const e=t.getConfig();let s;return s="icon"==e.type?!e.showWhen||e.showWhen(this.simUI.player):(!e.showWhen||e.showWhen(this.simUI.player))&&e.values.filter((t=>!t.showWhen||t.showWhen(this.simUI.player))).length>1,s&&zc(i,this.simUI.player,e),s})).filter((t=>t)).length>0?t.classList.remove("hide"):t.classList.add("hide")};c.onAny(e).on(a),a()}}const uh="Specify Paladin Blessings for each role, in order of priority. Blessings in the 1st column will be used if there is at least 1 Paladin in the raid, 2nd column if at least 2, etc.",ph="<p>Preset gear lists are intended as rough approximations of BIS, and will often not be the absolute highest-DPS setup for you. Your optimal gear setup will depend on many factors; that's why we have a sim!</p><p>Items may also be omitted from the presets if they are highly contested and clearly better utilized on other classes, to encourage equitable gearing for the raid as a whole.</p>",gh=jc(Zc({actionId:v.fromSpellId(9885),impId:v.fromSpellId(17055),fieldName:"giftOfTheWild"}),"Mark of the Wild"),fh=Cc([Gc({actionId:v.fromSpellId(20217),fieldName:"blessingOfKings",faction:Tt.Alliance}),$c({actionId:v.fromSpellId(409580),fieldName:"aspectOfTheLion",faction:Tt.Alliance})],"Stats %"),Ih=jc($c({actionId:v.fromSpellId(409580),fieldName:"aspectOfTheLion",faction:Tt.Horde}),"Stats %"),wh=Cc([Zc({actionId:v.fromSpellId(10293),impId:v.fromSpellId(20142),fieldName:"devotionAura"}),$c({actionId:v.fromItemId(1478),fieldName:"scrollOfProtection"})],"Armor"),bh=Cc([Zc({actionId:v.fromSpellId(10938),impId:v.fromSpellId(14767),fieldName:"powerWordFortitude"}),Zc({actionId:v.fromSpellId(11767),impId:v.fromSpellId(18696),fieldName:"bloodPact"}),$c({actionId:v.fromItemId(10307),fieldName:"scrollOfStamina"})],"Stamina"),xh=Cc([Yc({actionId:v.fromSpellId(25291),impId:v.fromSpellId(20048),fieldName:"blessingOfMight",faction:Tt.Alliance}),$c({actionId:v.fromSpellId(425600),fieldName:"hornOfLordaeron",faction:Tt.Alliance})],"Paladin Physical"),vh=jc(Zc({actionId:v.fromSpellId(25361),impId:v.fromSpellId(16295),fieldName:"strengthOfEarthTotem",faction:Tt.Horde}),"Strength"),Eh=jc(Zc({actionId:v.fromSpellId(25359),impId:v.fromSpellId(16295),fieldName:"graceOfAirTotem",minLevel:42,faction:Tt.Horde}),"Agility"),Sh=Cc([$c({actionId:v.fromSpellId(23028),fieldName:"arcaneBrilliance"}),$c({actionId:v.fromItemId(10308),fieldName:"scrollOfIntellect"})],"Intellect"),yh=Cc([$c({actionId:v.fromSpellId(27841),fieldName:"divineSpirit",minLevel:30}),$c({actionId:v.fromItemId(10306),fieldName:"scrollOfSpirit"})],"Spirit"),Ph=Cc([Zc({actionId:v.fromSpellId(25289),impId:v.fromSpellId(12861),fieldName:"battleShout"})],"Battle Shout"),Ch=jc($c({actionId:v.fromSpellId(20906),fieldName:"trueshotAura",minLevel:40}),"Trueshot Aura");Cc([Gc({actionId:v.fromSpellId(25899),fieldName:"blessingOfSanctuary"})],"Mit %");const kh=Cc([$c({actionId:v.fromSpellId(10958),fieldName:"shadowProtection"}),$c({actionId:v.fromSpellId(10601),fieldName:"natureResistanceTotem",faction:Tt.Horde}),$c({actionId:v.fromSpellId(20190),fieldName:"aspectOfTheWild"}),$c({actionId:v.fromSpellId(19898),fieldName:"frostResistanceAura",faction:Tt.Alliance}),$c({actionId:v.fromSpellId(10479),fieldName:"frostResistanceTotem",faction:Tt.Horde})],"Resistances"),Th=jc(Yc({actionId:v.fromSpellId(25290),impId:v.fromSpellId(20245),fieldName:"blessingOfWisdom",faction:Tt.Alliance}),"Blessing of Wisdom"),_h=jc(Zc({actionId:v.fromSpellId(10497),impId:v.fromSpellId(16208),fieldName:"manaSpringTotem",minLevel:40,faction:Tt.Horde}),"Mana Spring Totem"),Nh=jc($c({actionId:v.fromSpellId(17007),fieldName:"leaderOfThePack",minLevel:40}),"Leader of the Pack"),Lh=jc($c({actionId:v.fromSpellId(24907),fieldName:"moonkinAura",minLevel:40}),"Moonkin Aura"),Rh=jc(Hc({getModObject:t=>t,showWhen:t=>(Dh.minLevel||0)<=t.getLevel()&&t.getLevel()<=(Dh.maxLevel||se)&&(!Dh.faction||Dh.faction==t.getFaction()),getValue:t=>t.getRaid().getBuffs(),setValue:(t,e,s)=>e.getRaid().setBuffs(t,s),changeEmitter:t=>c.onAny([t.getRaid().buffsChangeEmitter,t.levelChangeEmitter,t.raceChangeEmitter])},(Dh={actionId:v.fromSpellId(425464),numStates:200,fieldName:"demonicPact",multiplier:10}).actionId,Dh.numStates,Dh.fieldName,Dh.multiplier),"Demonic Pact");var Dh;const Ah=Cc([],"Defensive CDs"),Vh=jc($c({actionId:v.fromSpellId(10301),fieldName:"retributionAura"}),"Retribution Aura"),Mh=jc(Zc({actionId:v.fromSpellId(9910),impId:v.fromSpellId(16840),fieldName:"thorns"}),"Thorns"),Uh=jc(Qc({actionId:v.fromSpellId(29166),numStates:11,fieldName:"innervates",minLevel:40}),"Innervate"),Fh=jc(Qc({actionId:v.fromSpellId(10060),numStates:11,fieldName:"powerInfusions",minLevel:40}),"Power Infusion"),Wh=jc(Gc({actionId:v.fromSpellId(22888),fieldName:"rallyingCryOfTheDragonslayer"}),"Rallying Cry of the Dragonslayer"),Oh=jc(Gc({actionId:v.fromSpellId(24425),fieldName:"spiritOfZandalar"}),"Spirit of Zandalar"),Hh=jc(Gc({actionId:v.fromSpellId(15366),fieldName:"songflowerSerenade"}),"Songflower Serenade"),qh=jc(Gc({actionId:v.fromSpellId(16609),fieldName:"warchiefsBlessing"}),"Warchief's Blessing"),Bh=t=>function(t){return qc({getModObject:t=>t,showWhen:e=>(t.minLevel||0)<=e.getLevel()&&e.getLevel()<=(t.maxLevel||se)&&(!t.faction||t.faction==e.getFaction()),getValue:t=>t.getBuffs(),setValue:(t,e,s)=>e.setBuffs(t,s),changeEmitter:t=>c.onAny([t.buffsChangeEmitter,t.levelChangeEmitter,t.raceChangeEmitter])},t.fieldName,t.values,t.numColumns,t.direction||xc.Vertical)}({direction:xc.Horizontal,values:[{iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_orb_02.jpg",value:is.SaygesUnknown,text:"Sayge's Dark Fortune"},...t.map((t=>t.config))],fieldName:"saygesFortune"}),zh={actionId:v.fromSpellId(23768),value:is.SaygesDamage,text:"Sayge's Damage"},jh={actionId:v.fromSpellId(23736),value:is.SaygesAgility,text:"Sayge's Agility"},$h={actionId:v.fromSpellId(23766),value:is.SaygesIntellect,text:"Sayge's Intellect"},Gh={actionId:v.fromSpellId(23738),value:is.SaygesSpirit,text:"Sayge's Spirit"},Kh={actionId:v.fromSpellId(23737),value:is.SaygesStamina,text:"Sayge's Stamina"},Jh=jc(Gc({actionId:v.fromSpellId(22817),fieldName:"fengusFerocity"}),"Fengus' Ferocity"),Zh=jc(Gc({actionId:v.fromSpellId(22818),fieldName:"moldarsMoxie"}),"Moldar's Moxie");jc(Gc({actionId:v.fromSpellId(22820),fieldName:"slipkiksSavvy"}),"Slip'kik's Savvy");const Yh=jc(Gc({actionId:v.fromSpellId(430947),fieldName:"boonOfBlackfathom",maxLevel:39}),"Boon of Blackfathom"),Xh=jc(Gc({actionId:v.fromSpellId(430352),fieldName:"ashenvalePvpBuff",maxLevel:39}),"Ashenvale Pvp Buff"),Qh=Cc([Jc({actionId:v.fromSpellId(11597),fieldName:"sunderArmor"}),Xc(v.fromSpellId(11198),v.fromSpellId(14169),"exposeArmor"),td(v.fromSpellId(402818),101,10,"homunculi")],"Major Armor Penetration"),tm=jc(Jc({actionId:v.fromSpellId(11717),fieldName:"curseOfRecklessness"}),"Curse of Recklessness"),em=jc(Jc({actionId:v.fromSpellId(9907),fieldName:"faerieFire"}),"Faerie Fire"),sm=Cc([Xc(v.fromSpellId(11556),v.fromSpellId(12879),"demoralizingShout"),Xc(v.fromSpellId(9898),v.fromSpellId(16862),"demoralizingRoar")],"Attack Power"),im=Cc([],"Bleed"),am=jc(Xc(v.fromSpellId(6343),v.fromSpellId(12666),"thunderClap"),"Thunder Clap"),nm=jc(Jc({actionId:v.fromSpellId(24977),fieldName:"insectSwarm"}),"Insect Swarm"),om=jc(Jc({actionId:v.fromSpellId(17803),fieldName:"improvedShadowBolt"}),"Improved Shadow Bolt"),lm=jc(Jc({actionId:v.fromSpellId(12873),fieldName:"improvedScorch",minLevel:40}),"Improved Scorch"),rm=jc(Jc({actionId:v.fromSpellId(28595),fieldName:"wintersChill",minLevel:40}),"Winters Chill"),cm=jc(Xc(v.fromSpellId(14325),v.fromSpellId(19425),"huntersMark"),"Hunter's Mark"),dm=jc(Jc({actionId:v.fromSpellId(20355),fieldName:"judgementOfWisdom",minLevel:38}),"Judgement of Wisdom"),hm=Jc({actionId:v.fromSpellId(20346),fieldName:"judgementOfLight",minLevel:30}),mm=Jc({actionId:v.fromSpellId(427143),fieldName:"curseOfVulnerability",minLevel:25}),um=Jc({actionId:v.fromSpellId(11374),fieldName:"giftOfArthas",minLevel:38}),pm=Jc({actionId:v.fromSpellId(15235),fieldName:"crystalYield",minLevel:47}),gm=td(v.fromSpellId(422996),101,10,"ancientCorrosivePoison"),fm=[{config:gh,picker:yc,stats:[]},{config:fh,picker:Pc,stats:[],faction:Tt.Alliance},{config:Ih,picker:yc,stats:[],faction:Tt.Horde},{config:wh,picker:Pc,stats:[i.StatArmor]},{config:bh,picker:Pc,stats:[i.StatStamina]},{config:xh,picker:Pc,stats:[i.StatStrength,i.StatAgility,i.StatAttackPower]},{config:vh,picker:yc,stats:[i.StatStrength]},{config:Eh,picker:yc,stats:[i.StatAgility]},{config:Sh,picker:Pc,stats:[i.StatIntellect]},{config:yh,picker:Pc,stats:[i.StatSpirit]},{config:Ph,picker:Pc,stats:[i.StatAttackPower]},{config:Ch,picker:yc,stats:[i.StatAttackPower,i.StatRangedAttackPower]},{config:Nh,picker:yc,stats:[i.StatMeleeCrit]},{config:Rh,picker:yc,stats:[i.StatSpellPower]},{config:Lh,picker:yc,stats:[i.StatSpellCrit]},{config:kh,picker:Pc,stats:[i.StatNatureResistance,i.StatShadowResistance,i.StatFrostResistance]},{config:Ah,picker:Pc,stats:[i.StatArmor]},{config:Th,picker:yc,stats:[i.StatMP5]},{config:_h,picker:yc,stats:[i.StatMP5]},{config:Mh,picker:yc,stats:[i.StatArmor]},{config:Vh,picker:yc,stats:[i.StatArmor]},{config:Uh,picker:yc,stats:[i.StatMP5]},{config:Fh,picker:yc,stats:[i.StatMP5,i.StatSpellPower]}],Im=[{config:Yh,picker:yc,stats:[i.StatMeleeCrit,i.StatSpellCrit,i.StatAttackPower]},{config:Xh,picker:yc,stats:[i.StatAttackPower,i.StatSpellPower]},{config:Jh,picker:yc,stats:[i.StatAttackPower]},{config:Zh,picker:yc,stats:[i.StatStamina]},{config:Wh,picker:yc,stats:[i.StatMeleeCrit,i.StatSpellCrit,i.StatAttackPower]},{config:Hh,picker:yc,stats:[]},{config:Oh,picker:yc,stats:[]},{config:qh,picker:yc,stats:[i.StatHealth,i.StatMeleeHaste,i.StatMP5]}],wm=[{config:zh,stats:[]},{config:jh,stats:[i.StatAgility]},{config:$h,stats:[i.StatIntellect]},{config:Gh,stats:[i.StatSpirit,i.StatMP5]},{config:Kh,stats:[i.StatStamina]}],bm=[{config:Qh,stats:[i.StatAttackPower],picker:Pc},{config:tm,picker:yc,stats:[i.StatAttackPower]},{config:em,picker:yc,stats:[i.StatAttackPower]},{config:im,picker:Pc,stats:[i.StatAttackPower,i.StatRangedAttackPower]},{config:om,picker:yc,stats:[i.StatShadowPower]},{config:lm,picker:yc,stats:[i.StatFirePower]},{config:rm,picker:yc,stats:[i.StatFrostPower]},{config:sm,picker:Pc,stats:[i.StatArmor]},{config:am,picker:yc,stats:[i.StatArmor]},{config:nm,picker:yc,stats:[i.StatDodge]},{config:dm,picker:yc,stats:[i.StatMP5,i.StatIntellect]},{config:cm,picker:yc,stats:[i.StatRangedAttackPower]}],xm=[{config:hm,picker:yc,stats:[i.StatStamina]},{config:mm,picker:yc,stats:[i.StatAttackPower,i.StatRangedAttackPower]},{config:um,picker:yc,stats:[i.StatAttackPower,i.StatRangedAttackPower]},{config:pm,picker:yc,stats:[i.StatAttackPower,i.StatRangedAttackPower]},{config:gm,picker:yc,stats:[i.StatAttackPower,i.StatRangedAttackPower]}];class vm extends ec{constructor(t,s){super(t,s,{identifier:"settings-tab",title:"Settings"}),e(this,"simUI"),e(this,"leftPanel"),e(this,"rightPanel"),e(this,"column1",this.buildColumn(1,"settings-left-col")),e(this,"column2",this.buildColumn(2,"settings-left-col")),e(this,"column3",this.buildColumn(3,"settings-left-col")),e(this,"column4"),this.simUI=s,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.simUI.isWithinRaidSim&&(this.column4=this.buildColumn(4,"settings-left-col"),this.leftPanel.appendChild(this.column4)),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.isWithinRaidSim||this.buildEncounterSettings(),this.buildPlayerSettings(),this.buildCustomSettingsSections(),this.buildConsumesSection(),this.buildOtherSettings(),this.simUI.isWithinRaidSim||(this.buildBuffsSettings(),this.buildWorldBuffsSettings(),this.buildDebuffsSettings(),this.buildSavedDataPickers())}buildEncounterSettings(){const t=new wr(this.column1,"encounter-settings",{header:{title:"Encounter"}});new hc(t.bodyElement,this.simUI.sim.encounter,this.simUI.individualConfig.encounterPicker,this.simUI)}buildPlayerSettings(){const t=new wr(this.column1,"player-settings",{header:{title:"Player"}}),e=p.newGroupContainer();e.classList.add("player-icon-group","icon-group"),t.bodyElement.appendChild(e),this.configureIconSection(e,this.simUI.individualConfig.playerIconInputs.map((t=>zc(e,this.simUI.player,t))),!0),new nr(t.bodyElement,this.simUI.player,{label:"Level",values:[25,40,50,60].map((t=>({name:`Level ${t}`,value:t}))),changedEvent:t=>t.levelChangeEmitter,getValue:t=>t.getLevel(),setValue:(t,e,s)=>e.setLevel(t,s)});const i=L[this.simUI.player.spec];new nr(t.bodyElement,this.simUI.player,{label:"Race",values:i.map((t=>({name:as.get(t),value:t}))),changedEvent:t=>t.raceChangeEmitter,getValue:t=>t.getRace(),setValue:(t,e,s)=>e.setRace(t,s)}),this.simUI.individualConfig.playerInputs?.inputs.length&&this.configureInputSection(t.bodyElement,this.simUI.individualConfig.playerInputs);let a=p.newGroupContainer();t.bodyElement.appendChild(a);const n=s(F);new nr(a,this.simUI.player,{label:"Profession 1",values:n.map((t=>({name:_e.get(t),value:t}))),changedEvent:t=>t.professionChangeEmitter,getValue:t=>t.getProfession1(),setValue:(t,e,s)=>e.setProfession1(t,s)}),new nr(a,this.simUI.player,{label:"Profession 2",values:n.map((t=>({name:_e.get(t),value:t}))),changedEvent:t=>t.professionChangeEmitter,getValue:t=>t.getProfession2(),setValue:(t,e,s)=>e.setProfession2(t,s)})}buildCustomSettingsSections(){(this.simUI.individualConfig.customSections||[]).forEach((t=>{t(this.column2,this.simUI).rootElem.classList.add("custom-section")}))}buildConsumesSection(){const t=this.simUI.isWithinRaidSim?this.column3:this.column2,e=new wr(t,"consumes-settings",{header:{title:"Consumables"}});new mh(e.bodyElement,this.simUI)}buildOtherSettings(){const t=this.simUI.individualConfig.otherInputs?.inputs.filter((t=>!t.extraCssClasses?.includes("within-raid-sim-hide")||!0)),e=this.simUI.individualConfig.itemSwapSlots||[];if(t.length||e.length){const s=new wr(this.column2,"other-settings",{header:{title:"Other"}});t.length&&(this.configureInputSection(s.bodyElement,this.simUI.individualConfig.otherInputs),s.bodyElement.querySelectorAll(".input-root").forEach((t=>{t.classList.add("input-inline")}))),e.length&&new Sc(s.bodyElement,this.simUI,this.simUI.player,{itemSlots:e})}}buildBuffsSettings(){const t=Ec(fm,this.simUI),e=new wr(this.column3,"buffs-settings",{header:{title:"Raid Buffs",tooltip:"Buffs provided by other party/raid members. Note only the highest available buff rank will be applied, if possible, based on level selected"}});this.configureIconSection(e.bodyElement,t.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))))}buildWorldBuffsSettings(){const t=Ec(Im,this.simUI),e=new wr(this.column3,"world-buffs-settings",{header:{title:"World Buffs",tooltip:"World Buffs obtained from various sources across Azeroth."}});this.configureIconSection(e.bodyElement,t.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))));const s=Ec(wm,this.simUI);new vc(e.bodyElement,this.simUI.player,Bh(s))}buildDebuffsSettings(){const t=new wr(this.column3,"debuffs-settings",{header:{title:"Debuffs",tooltip:"Debuffs applied by other raid members."}}),e=Ec(bm,this.simUI);this.configureIconSection(t.bodyElement,e.map((e=>e.picker&&new e.picker(t.bodyElement,this.simUI.player,e.config,this.simUI))));const s=Ec(xm,this.simUI);s.length&&new Pc(t.bodyElement,this.simUI.player,{inputs:s.map((t=>t.config)),label:"Misc Debuffs"},this.simUI)}buildSavedDataPickers(){const t=new oc(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:t=>ns.create({encounter:t.toProto()}),setData:(t,e,s)=>e.fromProto(t,s.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(t,e)=>ns.equals(t,e),toJson:t=>ns.toJson(t),fromJson:t=>ns.fromJson(t)}),e=new oc(this.rightPanel,this.simUI,{label:"Settings",header:{title:"Saved Settings"},storageKey:this.simUI.getSavedSettingsStorageKey(),getData:t=>{const e=t.player;return os.create({raidBuffs:t.sim.raid.getBuffs(),partyBuffs:e.getParty()?.getBuffs()||r.create(),playerBuffs:e.getBuffs(),debuffs:t.sim.raid.getDebuffs(),consumes:e.getConsumes(),race:e.getRace(),level:e.getLevel(),professions:e.getProfessions(),enableItemSwap:e.getEnableItemSwap(),itemSwap:e.getItemSwapGear().toProto(),reactionTimeMs:e.getReactionTime(),channelClipDelayMs:e.getChannelClipDelay(),inFrontOfTarget:e.getInFrontOfTarget(),distanceFromTarget:e.getDistanceFromTarget(),healingModel:e.getHealingModel()})},setData:(t,e,s)=>{c.freezeAllAndDo((()=>{e.player.setLevel(t,s.level),e.sim.raid.setBuffs(t,s.raidBuffs||mt.create()),e.sim.raid.setDebuffs(t,s.debuffs||ut.create());const i=e.player.getParty();i&&i.setBuffs(t,s.partyBuffs||r.create()),e.player.setBuffs(t,s.playerBuffs||y.create()),e.player.setConsumes(t,s.consumes||P.create()),e.player.setRace(t,s.race),e.player.setProfessions(t,s.professions),e.player.setEnableItemSwap(t,s.enableItemSwap),e.player.setItemSwapGear(t,e.sim.db.lookupItemSwap(s.itemSwap||ls.create())),e.player.setReactionTime(t,s.reactionTimeMs),e.player.setChannelClipDelay(t,s.channelClipDelayMs),e.player.setInFrontOfTarget(t,s.inFrontOfTarget),e.player.setDistanceFromTarget(t,s.distanceFromTarget),e.player.setHealingModel(t,s.healingModel||_.create())}))},changeEmitters:[this.simUI.sim.raid.buffsChangeEmitter,this.simUI.sim.raid.debuffsChangeEmitter,this.simUI.player.getParty().buffsChangeEmitter,this.simUI.player.buffsChangeEmitter,this.simUI.player.consumesChangeEmitter,this.simUI.player.raceChangeEmitter,this.simUI.player.professionChangeEmitter,this.simUI.player.itemSwapChangeEmitter,this.simUI.player.miscOptionsChangeEmitter,this.simUI.player.inFrontOfTargetChangeEmitter,this.simUI.player.distanceFromTargetChangeEmitter,this.simUI.player.healingModelChangeEmitter],equals:(t,e)=>os.equals(t,e),toJson:t=>os.toJson(t),fromJson:t=>os.fromJson(t)});this.simUI.sim.waitForInit().then((()=>{t.loadUserData(),e.loadUserData()}))}configureInputSection(t,e){e.inputs.forEach((e=>{"number"==e.type?new er(t,this.simUI.player,e):"boolean"==e.type?new ar(t,this.simUI.player,{...e,cssScheme:this.simUI.cssScheme}):"enum"==e.type&&new nr(t,this.simUI.player,e)}))}configureIconSection(t,e,s){0==e.length?t.classList.add("hide"):s&&(e.length<=4?t.style.gridTemplateColumns=`repeat(${e.length}, 1fr)`:e.length>4&&e.length<8&&(t.style.gridTemplateColumns=`repeat(${Math.ceil(e.length/2)}, 1fr)`))}}class Em extends p{constructor(t,s,i){super(t,"number-list-picker-root",s,i),e(this,"inputElem"),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.placeholder=i.placeholder||"",this.inputElem.classList.add("number-list-picker-input","form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(t=>{this.inputChanged(c.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){const t=this.inputElem.value;return t?t.split(",").map(parseFloat).filter((t=>!isNaN(t))):[]}setInputValue(t){rs(this.getInputValue(),t)||(this.inputElem.value=t.map((t=>String(t))).join(","))}}class Sm extends I{constructor(t,s){super(t,"cooldowns-picker-root"),e(this,"player"),e(this,"cooldownPickers"),this.player=s,this.cooldownPickers=[],c.onAny([this.player.rotationChangeEmitter,this.player.sim.unitMetadataEmitter]).on((t=>{this.update()})),this.update()}update(){this.rootElem.innerHTML="";const t=this.player.getSimpleCooldowns().cooldowns;this.cooldownPickers=[];for(let e=0;e<t.length+1;e++){const s=t[e],i=document.createElement("div");i.classList.add("cooldown-picker"),e==t.length&&i.classList.add("add-cooldown-picker"),this.rootElem.appendChild(i),this.makeActionPicker(i,e);const a=document.createElement("label");a.classList.add("cooldown-picker-label","form-label"),s&&s.id&&v.fromProto(s.id).fill(this.player.getRaidIndex()).then((t=>a.textContent=t.name)),i.appendChild(a),this.makeTimingsPicker(i,e);let n=document.createElement("fragment");n.innerHTML='\n\t\t\t\t<a\n\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\tclass="delete-cooldown link-danger"\n\t\t\t\t\trole="button"\n\t\t\t\t>\n\t\t\t\t\t<i class="fa fa-times fa-xl"></i>\n\t\t\t\t</a>\n\t\t\t';const o=n.children[0],l=ta.getOrCreateInstance(o,{title:"Delete Cooldown"});o.addEventListener("click",(t=>{const s=this.player.getSimpleCooldowns();s.cooldowns.splice(e,1),this.player.setSimpleCooldowns(c.nextEventID(),s),l.hide()})),i.appendChild(o),this.cooldownPickers.push(i)}}makeActionPicker(t,e){const s=this.player.getMetadata().getSpells().filter((t=>t.data.isMajorCooldown)).map((t=>t.id));return new vc(t,this.player,{extraCssClasses:["cooldown-action-picker"],numColumns:3,values:[{color:"#grey",value:cs.create()}].concat(s.map((t=>({actionId:t,value:t.toProto()})))),equals:(t,e)=>cs.equals(t,e),zeroValue:cs.create(),backupIconUrl:t=>v.fromProto(t),changedEvent:t=>t.rotationChangeEmitter,getValue:t=>t.getSimpleCooldowns().cooldowns[e]?.id||cs.create(),setValue:(t,s,i)=>{const a=s.getSimpleCooldowns();for(;a.cooldowns.length<e;)a.cooldowns.push(ds.create());a.cooldowns[e]=ds.create({id:i,timings:[]}),s.setSimpleCooldowns(t,a)}})}makeTimingsPicker(t,e){return new Em(t,this.player,{extraCssClasses:["cooldown-timings-picker"],placeholder:"20, 40, ...",changedEvent:t=>t.rotationChangeEmitter,getValue:t=>t.getSimpleCooldowns().cooldowns[e]?.timings||[],setValue:(t,s,i)=>{const a=s.getSimpleCooldowns();a.cooldowns[e].timings=i,s.setSimpleCooldowns(t,a)},enableWhen:t=>{const s=t.getSimpleCooldowns().cooldowns[e];return s&&!cs.equals(s.id,cs.create())}})}}class ym extends p{constructor(t,s,i){super(t,"adaptive-string-picker-root",s,i),e(this,"inputElem"),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.classList.add("form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(t=>{this.inputChanged(c.nextEventID())})),this.inputElem.addEventListener("input",(t=>{this.updateSize()})),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.inputElem.value}setInputValue(t){this.inputElem.value=t,this.updateSize()}updateSize(){const t=Math.max(3,this.inputElem.value.length);this.inputElem.size!=t&&(this.inputElem.size=t)}}const Pm={auras:{defaultLabel:"Aura",getActionIDs:async t=>t.getAuras().map((e=>{const s=t.getAuras().filter((t=>t.id.name.startsWith(e.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:e.id,submenu:s?[e.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},stackable_auras:{defaultLabel:"Aura",getActionIDs:async t=>t.getAuras().filter((t=>t.data.maxStacks>0)).map((e=>{const s=t.getAuras().filter((t=>t.id.name.startsWith(e.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:e.id,submenu:s?[e.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},icd_auras:{defaultLabel:"Aura",getActionIDs:async t=>t.getAuras().filter((t=>t.data.hasIcd)).map((e=>{const s=t.getAuras().filter((t=>t.id.name.startsWith(e.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:e.id,submenu:s?[e.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},exclusive_effect_auras:{defaultLabel:"Aura",getActionIDs:async t=>t.getAuras().filter((t=>t.data.hasExclusiveEffect)).map((e=>{const s=t.getAuras().filter((t=>t.id.name.startsWith(e.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:e.id,submenu:s?[e.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},castable_spells:{defaultLabel:"Spell",getActionIDs:async t=>{const e=t.getSpells().filter((t=>t.data.isCastable)),{spells:s,cooldowns:i}=ps(e,(t=>t.data.isMajorCooldown?"cooldowns":"spells")),a=[v.fromOtherId(gs.OtherActionPotion)];return[[{value:v.fromEmpty(),headerText:"Spells",submenu:["Spells"]}],(s||[]).map((t=>{const e=s.filter((e=>e.id.name.startsWith(t.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:t.id,submenu:e?["Spells",t.id.name.replace(/ \(Rank \d+\)/g,"")]:["Spells"],extraCssClasses:t.data.prepullOnly?["apl-prepull-actions-only"]:t.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:v.fromEmpty(),headerText:"Cooldowns",submenu:["Cooldowns"]}],(i||[]).map((t=>{const e=i.filter((e=>e.id.name.startsWith(t.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:t.id,submenu:e?["Cooldowns",t.id.name.replace(/ \(Rank \d+\)/g,"")]:["Cooldowns"],extraCssClasses:t.data.prepullOnly?["apl-prepull-actions-only"]:t.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:v.fromEmpty(),headerText:"Placeholders",submenu:["Placeholders"]}],a.map((t=>({value:t,submenu:["Placeholders"],tooltip:"The Prepull Potion if CurrentTime < 0, or the Combat Potion if combat has started."})))].flat()}},channel_spells:{defaultLabel:"Channeled Spell",getActionIDs:async t=>t.getSpells().filter((t=>t.data.isCastable&&t.data.isChanneled)).map((e=>{const s=t.getSpells().filter((t=>t.id.name.startsWith(e.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:e.id,submenu:s?[e.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async t=>t.getSpells().filter((t=>t.data.hasDot)).map((e=>{const s=t.getSpells().filter((t=>t.id.name.startsWith(e.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:e.id,submenu:s?[e.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},shield_spells:{defaultLabel:"Shield Spell",getActionIDs:async t=>t.getSpells().filter((t=>t.data.hasShield)).map((e=>{const s=t.getSpells().filter((t=>t.id.name.startsWith(e.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:e.id,submenu:s?[e.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))}};class Cm extends hs{constructor(t,e,s){const i=Pm[s.actionIdSet];super(t,e,{...s,sourceToValue:t=>t?v.fromProto(t):v.fromEmpty(),valueToSource:t=>t.toProto(),defaultLabel:i.defaultLabel,equals:(t,e)=>null==t==(null==e)&&(!t||t.equals(e)),setOptionContent:(t,e)=>{const s=e.value,i=document.createElement("a");i.classList.add("apl-actionid-item-icon"),s.setBackgroundAndHref(i),t.appendChild(i);const a=document.createTextNode(s.name);t.appendChild(a)},createMissingValue:t=>t.fill().then((t=>({value:t}))),values:[]});const a=s.getUnitRef,n="self"==s.defaultUnitRef?gt.create({type:pt.Self}):gt.create({type:pt.CurrentTarget}),o=i.getActionIDs,l=async()=>{const t=a(e),s=e.sim.getUnitMetadata(t,e,n);if(s){const t=await o(s);this.setOptions(t)}};l(),c.onAny([e.sim.unitMetadataEmitter,e.rotationChangeEmitter]).on(l)}}const km={aura_sources:{getUnits:t=>[void 0,t.getPetMetadatas().asList().map(((t,e)=>gt.create({type:pt.Pet,index:e,owner:gt.create({type:pt.Self})}))),gt.create({type:pt.CurrentTarget}),t.sim.encounter.targetsMetadata.asList().map(((t,e)=>gt.create({type:pt.Target,index:e})))].flat()},aura_sources_targets_first:{targetUI:!0,getUnits:t=>[void 0,t.sim.encounter.targetsMetadata.asList().map(((t,e)=>gt.create({type:pt.Target,index:e}))),gt.create({type:pt.Self}),t.getPetMetadatas().asList().map(((t,e)=>gt.create({type:pt.Pet,index:e,owner:gt.create({type:pt.Self})})))].flat()},targets:{targetUI:!0,getUnits:t=>[void 0,t.sim.encounter.targetsMetadata.asList().map(((t,e)=>gt.create({type:pt.Target,index:e})))].flat()}};class Tm extends ms{constructor(t,s,i){const a=!!km[i.unitSet].targetUI;super(t,s,{...i,sourceToValue:t=>Tm.refToValue(t,s,a),valueToSource:t=>t.value,values:[],hideLabelWhenDefaultSelected:!0}),e(this,"unitSet"),this.unitSet=i.unitSet,this.rootElem.classList.add("apl-unit-picker"),this.updateValues(),s.sim.unitMetadataEmitter.on((()=>this.updateValues()))}static refToValue(t,e,s){if(!t||t.type==pt.Unknown)return{value:t,iconUrl:s?"fa-bullseye":"fa-user",text:s?"Current Target":"Self"};if(t.type==pt.Self)return{value:t,iconUrl:"fa-user",text:"Self"};if(t.type==pt.CurrentTarget)return{value:t,iconUrl:"fa-bullseye",text:"Current Target"};if(t.type==pt.Player){const s=e.sim.raid.getPlayer(t.index);if(s)return{value:t,iconUrl:s.getSpecIcon(),text:`Player ${t.index+1}`}}else if(t.type==pt.Target){if(e.sim.encounter.targetsMetadata.asList()[t.index])return{value:t,iconUrl:us,text:`Target ${t.index+1}`}}else if(t.type==pt.Pet){const s=e.sim.getUnitMetadata(t,e,gt.create({type:pt.Self}));let i=`Pet ${t.index+1}`,a="fa-paw";if(s){const t=s.getName();if(t){const e=t.indexOf(" - ");i=t.substring(e+3),a=fs(i)||a}}return{value:t,iconUrl:a,text:i}}return{value:t}}updateValues(){const t=km[this.unitSet],e=t.getUnits(this.modObject);this.setOptions(e.map((e=>{const s={value:Tm.refToValue(e,this.modObject,t.targetUI)};return e&&e.type==pt.Pet&&(t.targetUI?s.submenu=[Tm.refToValue(e.owner,this.modObject,t.targetUI)]:s.submenu=[Tm.refToValue(void 0,this.modObject,t.targetUI)]),s})))}}class _m extends p{constructor(t,s,i){super(t,"apl-picker-builder-root",s,i),e(this,"config"),e(this,"fieldPickers"),this.config=i,this.fieldPickers=i.fields.map((t=>_m.makeFieldPicker(this,t))),this.init()}static makeFieldPicker(t,e){const s=e.field,i=e.factory(t.rootElem,t.modObject,{label:e.label,labelTooltip:e.labelTooltip,changedEvent:t=>t.rotationChangeEmitter,getValue:()=>{const i=t.getSourceValue();return i[s]||(i[s]=e.newValue()),i[s]},setValue:(e,i,a)=>{t.getSourceValue()[s]=a,i.rotationChangeEmitter.emit(e)}},(()=>t.getSourceValue()));return"vals"!==s&&"actions"!==s||i.rootElem.classList.add("apl-picker-builder-multi"),{...e,picker:i}}getInputElem(){return this.rootElem}getInputValue(){const t=this.config.newValue();return this.fieldPickers.forEach((e=>{t[e.field]=e.picker.getInputValue()})),t}setInputValue(t){this.fieldPickers.forEach((e=>{e.picker.setInputValue(t[e.field])}))}}function Nm(t,e,s,i,a){return{field:t,newValue:()=>cs.create(),factory:(t,a,n,o)=>new Cm(t,a,{...n,actionIdSet:e,getUnitRef:()=>s?o()[s]:gt.create(),defaultUnitRef:i||"self"}),...a||{}}}function Lm(t,e,s){return{field:t,newValue:()=>{},factory:(t,s,i)=>new Tm(t,s,{...i,unitSet:e}),...s||{}}}function Rm(t,e,s){return{field:t,newValue:()=>!1,factory:(t,e,s)=>(s.extraCssClasses=["input-inline"].concat(s.extraCssClasses||[]),new ar(t,e,s)),...s||{},label:e}}function Dm(t,e,s){return{field:t,newValue:()=>0,factory:(t,s,i)=>{const a=i;return a.float=e,a.extraCssClasses=["input-inline"].concat(i.extraCssClasses||[]),new er(t,s,a)},...s||{}}}function Am(t,e){return{field:t,newValue:()=>"",factory:(t,e,s)=>(s.extraCssClasses=["input-inline"].concat(s.extraCssClasses||[]),new ym(t,e,s)),...e||{}}}function Vm(t,e){return(s,i,a)=>new _m(s,i,{...a,newValue:t,fields:e})}class Mm extends p{constructor(t,s,i){super(t,"apl-value-picker-root",s,i),e(this,"kindPicker"),e(this,"currentKind"),e(this,"valuePicker");const a=null!=this.rootElem.closest(".apl-prepull-action-picker"),n=Object.keys(Om).filter((t=>Om[t].includeIf?.(s,a)??!0));this.kindPicker=new fi(this.rootElem,s,{defaultLabel:"No Condition",values:[{value:void 0,label:"<None>"}].concat(n.map((t=>{const e=Om[t];return{value:t,label:e.label,submenu:e.submenu,tooltip:e.fullDescription?`<p>${e.shortDescription}</p> ${e.fullDescription}`:e.shortDescription}}))),equals:(t,e)=>t==e,changedEvent:t=>t.rotationChangeEmitter,getValue:t=>this.getSourceValue()?.value.oneofKind,setValue:(t,e,s)=>{const i=this.getSourceValue(),a=i?.value.oneofKind;if(a!=s){if(s){const e=Om[s];let n=this.makeAPLValue(s,e.newValue());i&&a&&this.valuePicker&&("not"==s?n.value.not.val=this.makeAPLValue(a,this.valuePicker.getInputValue()):"not"==i.value.oneofKind&&i.value.not.val?.value.oneofKind==s?n=i.value.not.val:"and"==s?"or"==i.value.oneofKind?n.value.and.vals=i.value.or.vals:n.value.and.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"or"==s?"and"==i.value.oneofKind?n.value.or.vals=i.value.and.vals:n.value.or.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"min"==s?"max"==i.value.oneofKind?n.value.min.vals=i.value.max.vals:n.value.min.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"max"==s?"min"==i.value.oneofKind?n.value.max.vals=i.value.min.vals:n.value.max.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"and"==i.value.oneofKind&&i.value.and.vals?.[0]?.value.oneofKind==s?n=i.value.and.vals[0]:"or"==i.value.oneofKind&&i.value.or.vals?.[0]?.value.oneofKind==s?n=i.value.or.vals[0]:"min"==i.value.oneofKind&&i.value.min.vals?.[0]?.value.oneofKind==s?n=i.value.min.vals[0]:"max"==i.value.oneofKind&&i.value.max.vals?.[0]?.value.oneofKind==s?n=i.value.max.vals[0]:"cmp"==s&&(n.value.cmp.lhs=this.makeAPLValue(a,this.valuePicker.getInputValue()))),i?i.value=n.value:this.setSourceValue(t,n)}else this.setSourceValue(t,void 0);e.rotationChangeEmitter.emit(t)}}}),this.currentKind=void 0,this.valuePicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const t=this.kindPicker.getInputValue();return t?vi.create({value:{oneofKind:t,...(()=>{const e={};return t&&this.valuePicker&&(e[t]=this.valuePicker.getInputValue()),e})()}}):void 0}setInputValue(t){const e=t?.value.oneofKind;this.updateValuePicker(e),e&&t&&this.valuePicker.setInputValue(t.value[e])}makeAPLValue(t,e){if(!t)return vi.create();const s={oneofKind:t};return s[t]=e,vi.create({value:s})}updateValuePicker(t){const e=this.currentKind;if(t==e)return;if(this.currentKind=t,this.valuePicker&&(this.valuePicker.rootElem.remove(),this.valuePicker=null),!t)return;this.kindPicker.setInputValue(t);const s=Om[t];this.valuePicker=s.factory(this.rootElem,this.modObject,{changedEvent:t=>t.rotationChangeEmitter,getValue:()=>{const e=this.getSourceValue();return e&&e.value[t]||s.newValue()},setValue:(e,s,i)=>{const a=this.getSourceValue();a&&(a.value[t]=i),s.rotationChangeEmitter.emit(e)}})}}function Um(t,e){return{field:t,newValue:vi.create,factory:(t,e,s)=>new Mm(t,e,s),...e||{}}}function Fm(t){return{field:t,newValue:()=>[],factory:(t,e,s)=>new dc(t,e,{...s,setValue:(t,e,i)=>{s.setValue(t,e,i.map((t=>t||vi.create())))},itemLabel:"Value",newItem:vi.create,copyItem:t=>t?vi.clone(t):t,newItemPicker:(t,s,i,a)=>new Mm(t,e,a),allowedActions:["create","delete"],actions:{create:{useIcon:!0}}})}}function Wm(t){return{label:t.label,submenu:t.submenu,shortDescription:t.shortDescription,fullDescription:t.fullDescription,newValue:t.newValue,includeIf:t.includeIf,factory:Vm(t.newValue,t.fields)}}const Om={const:Wm({label:"Const",shortDescription:"A fixed value.",fullDescription:"\n\t\t<p>\n\t\t\tExamples:\n\t\t\t<ul>\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\n\t\t\t</ul>\n\t\t</p>\n\t\t",newValue:Is.create,fields:[Am("val")]}),cmp:Wm({label:"Compare",submenu:["Logic"],shortDescription:"Compares two values.",newValue:ws.create,fields:[Um("lhs"),(Hm="op",{field:Hm,newValue:()=>gi.OpEq,factory:(t,e,s)=>new fi(t,e,{...s,defaultLabel:"None",equals:(t,e)=>t==e,values:[{value:gi.OpEq,label:"=="},{value:gi.OpNe,label:"!="},{value:gi.OpGe,label:">="},{value:gi.OpGt,label:">"},{value:gi.OpLe,label:"<="},{value:gi.OpLt,label:"<"}]})}),Um("rhs")]}),math:Wm({label:"Math",submenu:["Logic"],shortDescription:"Do basic math on two values.",newValue:bs.create,fields:[Um("lhs"),function(t){return{field:t,newValue:()=>Ii.OpAdd,factory:(t,e,s)=>new fi(t,e,{...s,defaultLabel:"None",equals:(t,e)=>t==e,values:[{value:Ii.OpAdd,label:"+"},{value:Ii.OpSub,label:"-"},{value:Ii.OpMul,label:"*"},{value:Ii.OpDiv,label:"/"}]})}}("op"),Um("rhs")]}),max:Wm({label:"Max",submenu:["Logic"],shortDescription:"Returns the largest value among the subvalues.",newValue:xs.create,fields:[Fm("vals")]}),min:Wm({label:"Min",submenu:["Logic"],shortDescription:"Returns the smallest value among the subvalues.",newValue:vs.create,fields:[Fm("vals")]}),and:Wm({label:"All of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Es.create,fields:[Fm("vals")]}),or:Wm({label:"Any of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Ss.create,fields:[Fm("vals")]}),not:Wm({label:"Not",submenu:["Logic"],shortDescription:"Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.",newValue:ys.create,fields:[Um("val")]}),currentTime:Wm({label:"Current Time",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration.",newValue:Ps.create,fields:[]}),currentTimePercent:Wm({label:"Current Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration, as a percentage.",newValue:Cs.create,fields:[]}),remainingTime:Wm({label:"Remaining Time",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration.",newValue:ks.create,fields:[]}),remainingTimePercent:Wm({label:"Remaining Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration, as a percentage.",newValue:Ts.create,fields:[]}),isExecutePhase:Wm({label:"Is Execute Phase",submenu:["Encounter"],shortDescription:"<b>True</b> if the encounter is in Execute Phase, meaning the target's health is less than the given threshold, otherwise <b>False</b>.",newValue:_s.create,fields:[function(t){return{field:t,newValue:()=>bi.E20,factory:(t,e,s)=>new fi(t,e,{...s,defaultLabel:"None",equals:(t,e)=>t==e,values:[{value:bi.E20,label:"20%"},{value:bi.E25,label:"25%"},{value:bi.E35,label:"35%"}]})}}("threshold")]}),numberTargets:Wm({label:"Number of Targets",submenu:["Encounter"],shortDescription:"Count of targets in the current encounter",newValue:Ns.create,fields:[]}),frontOfTarget:Wm({label:"Front of Target",submenu:["Encounter"],shortDescription:"<b>True</b> if facing from of target",newValue:Ls.create,fields:[]}),currentHealth:Wm({label:"Health",submenu:["Resources"],shortDescription:"Amount of currently available Health.",newValue:Rs.create,fields:[Lm("sourceUnit","aura_sources")]}),currentHealthPercent:Wm({label:"Health (%)",submenu:["Resources"],shortDescription:"Amount of currently available Health, as a percentage.",newValue:Ds.create,fields:[Lm("sourceUnit","aura_sources")]}),currentMana:Wm({label:"Mana",submenu:["Resources"],shortDescription:"Amount of currently available Mana.",newValue:As.create,fields:[]}),currentManaPercent:Wm({label:"Mana (%)",submenu:["Resources"],shortDescription:"Amount of currently available Mana, as a percentage.",newValue:Vs.create,fields:[]}),currentRage:Wm({label:"Rage",submenu:["Resources"],shortDescription:"Amount of currently available Rage.",newValue:Ms.create,fields:[]}),currentEnergy:Wm({label:"Energy",submenu:["Resources"],shortDescription:"Amount of currently available Energy.",newValue:Us.create,fields:[]}),currentComboPoints:Wm({label:"Combo Points",submenu:["Resources"],shortDescription:"Amount of currently available Combo Points.",newValue:Fs.create,fields:[]}),gcdIsReady:Wm({label:"GCD Is Ready",submenu:["GCD"],shortDescription:"<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.",newValue:Ws.create,fields:[]}),gcdTimeToReady:Wm({label:"GCD Time To Ready",submenu:["GCD"],shortDescription:"Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:Os.create,fields:[]}),autoTimeToNext:Wm({label:"Time To Next Auto",submenu:["Auto"],shortDescription:"Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.",newValue:Hs.create,fields:[function(t){return{field:t,newValue:()=>wi.Any,factory:(t,e,s)=>new fi(t,e,{...s,defaultLabel:"None",equals:(t,e)=>t==e,values:[{value:wi.Any,label:"Any"},{value:wi.Melee,label:"Melee"},{value:wi.MainHand,label:"Main Hand"},{value:wi.OffHand,label:"Off Hand"},{value:wi.Ranged,label:"Ranged"}]})}}("autoType")]}),spellCurrentCost:Wm({label:"Current Cost",submenu:["Spell"],shortDescription:"Returns current resource cost of spell",newValue:qs.create,fields:[Nm("spellId","castable_spells","")]}),spellCanCast:Wm({label:"Can Cast",submenu:["Spell"],shortDescription:"<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.",fullDescription:"\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\n\t\t",newValue:Bs.create,fields:[Nm("spellId","castable_spells","")]}),spellIsReady:Wm({label:"Is Ready",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.",newValue:zs.create,fields:[Nm("spellId","castable_spells","")]}),spellTimeToReady:Wm({label:"Time To Ready",submenu:["Spell"],shortDescription:"Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:js.create,fields:[Nm("spellId","castable_spells","")]}),spellCastTime:Wm({label:"Cast Time",submenu:["Spell"],shortDescription:"Amount of time to cast the spell including any haste and spell cast time adjustments.",newValue:$s.create,fields:[Nm("spellId","castable_spells","")]}),spellTravelTime:Wm({label:"Travel Time",submenu:["Spell"],shortDescription:"Amount of time for the spell to travel to the target.",newValue:Gs.create,fields:[Nm("spellId","castable_spells","")]}),spellCpm:Wm({label:"CPM",submenu:["Spell"],shortDescription:"Casts Per Minute for the spell so far in the current iteration.",newValue:Ks.create,fields:[Nm("spellId","castable_spells","")]}),spellIsChanneling:Wm({label:"Is Channeling",submenu:["Spell"],shortDescription:"<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.",newValue:Js.create,fields:[Nm("spellId","channel_spells","")]}),spellChanneledTicks:Wm({label:"Channeled Ticks",submenu:["Spell"],shortDescription:"The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.",newValue:Zs.create,fields:[Nm("spellId","channel_spells","")]}),channelClipDelay:Wm({label:"Channel Clip Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Channel Clip Delay</b> setting.",newValue:Ys.create,fields:[]}),auraIsActive:Wm({label:"Aura Active",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active, otherwise <b>False</b>.",newValue:Xs.create,fields:[Lm("sourceUnit","aura_sources"),Nm("auraId","auras","sourceUnit")]}),auraIsActiveWithReactionTime:Wm({label:"Aura Active (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:Qs.create,fields:[Lm("sourceUnit","aura_sources"),Nm("auraId","auras","sourceUnit")]}),auraRemainingTime:Wm({label:"Aura Remaining Time",submenu:["Aura"],shortDescription:"Time remaining before this aura will expire, or 0 if the aura is not currently active.",newValue:ti.create,fields:[Lm("sourceUnit","aura_sources"),Nm("auraId","auras","sourceUnit")]}),auraNumStacks:Wm({label:"Aura Num Stacks",submenu:["Aura"],shortDescription:"Number of stacks of the aura.",newValue:ei.create,fields:[Lm("sourceUnit","aura_sources"),Nm("auraId","stackable_auras","sourceUnit")]}),auraInternalCooldown:Wm({label:"Aura Remaining ICD",submenu:["Aura"],shortDescription:"Time remaining before this aura's internal cooldown will be ready, or <b>0</b> if the ICD is ready now.",newValue:si.create,fields:[Lm("sourceUnit","aura_sources"),Nm("auraId","icd_auras","sourceUnit")]}),auraIcdIsReadyWithReactionTime:Wm({label:"Aura ICD Is Ready (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura's ICD is currently ready OR it was put on CD recently, within the player's reaction time (configured in Settings), otherwise <b>False</b>.",newValue:ii.create,fields:[Lm("sourceUnit","aura_sources"),Nm("auraId","icd_auras","sourceUnit")]}),auraShouldRefresh:Wm({label:"Should Refresh Aura",submenu:["Aura"],shortDescription:"Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.",fullDescription:"\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\n\t\t",newValue:()=>ai.create({maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Lm("sourceUnit","aura_sources_targets_first"),Nm("auraId","exclusive_effect_auras","sourceUnit","currentTarget"),Um("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before the aura expires when it may be refreshed."})]}),dotIsActive:Wm({label:"Dot Is Active",submenu:["DoT"],shortDescription:"<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.",newValue:ni.create,fields:[Lm("targetUnit","targets"),Nm("spellId","dot_spells","")]}),dotRemainingTime:Wm({label:"Dot Remaining Time",submenu:["DoT"],shortDescription:"Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.",newValue:oi.create,fields:[Lm("targetUnit","targets"),Nm("spellId","dot_spells","")]}),sequenceIsComplete:Wm({label:"Sequence Is Complete",submenu:["Sequence"],shortDescription:"<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.",newValue:li.create,fields:[Am("sequenceName")]}),sequenceIsReady:Wm({label:"Sequence Is Ready",submenu:["Sequence"],shortDescription:"<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.",newValue:ri.create,fields:[Am("sequenceName")]}),sequenceTimeToReady:Wm({label:"Sequence Time To Ready",submenu:["Sequence"],shortDescription:"Returns the amount of time remaining until the next subaction in the sequence will be ready.",newValue:ci.create,fields:[Am("sequenceName")]}),totemRemainingTime:Wm({label:"Totem Remaining Time",submenu:["Shaman"],shortDescription:"Returns the amount of time remaining until the totem will expire.",newValue:di.create,includeIf:(t,e)=>t.getClass()==m.ClassShaman,fields:[function(t){return{field:t,newValue:()=>xi.Water,factory:(t,e,s)=>new fi(t,e,{...s,defaultLabel:"None",equals:(t,e)=>t==e,values:[{value:xi.Earth,label:"Earth"},{value:xi.Air,label:"Air"},{value:xi.Fire,label:"Fire"},{value:xi.Water,label:"Water"}]})}}("totemType")]}),catExcessEnergy:Wm({label:"Excess Energy",submenu:["Feral Druid"],shortDescription:"Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.",newValue:hi.create,includeIf:(t,e)=>t.spec==B.SpecFeralDruid,fields:[]}),catNewSavageRoarDuration:Wm({label:"New Savage Roar Duration",submenu:["Feral Druid"],shortDescription:"Returns duration of savage roar based on current combo points",newValue:mi.create,includeIf:(t,e)=>t.spec==B.SpecFeralDruid,fields:[]}),warlockShouldRecastDrainSoul:Wm({label:"Should Recast Drain Soul",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Drain Soul channel should be immediately recast, to get a better snapshot.",newValue:ui.create,includeIf:(t,e)=>t.getClass()==m.ClassWarlock,fields:[]}),warlockShouldRefreshCorruption:Wm({label:"Should Refresh Corruption",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Corruption has expired, or should be refreshed to get a better snapshot.",newValue:pi.create,includeIf:(t,e)=>t.getClass()==m.ClassWarlock,fields:[Lm("targetUnit","targets")]})};var Hm;class qm extends p{constructor(t,s,i){super(t,"apl-action-picker-root",s,i),e(this,"kindPicker"),e(this,"actionDiv"),e(this,"currentKind"),e(this,"actionPicker"),e(this,"conditionPicker"),this.conditionPicker=new Mm(this.rootElem,this.modObject,{label:"If:",changedEvent:t=>t.rotationChangeEmitter,getValue:t=>this.getSourceValue()?.condition,setValue:(t,e,s)=>{const i=this.getSourceValue();i?(i.condition=s,e.rotationChangeEmitter.emit(t)):this.setSourceValue(t,Wi.create({condition:s}))}}),this.conditionPicker.rootElem.classList.add("apl-action-condition","apl-priority-list-only"),this.actionDiv=document.createElement("div"),this.actionDiv.classList.add("apl-action-picker-action"),this.rootElem.appendChild(this.actionDiv);const a=null!=this.rootElem.closest(".apl-prepull-action-picker"),n=Object.keys(jm).filter((t=>jm[t].includeIf?.(s,a)??!0));this.kindPicker=new fi(this.actionDiv,s,{defaultLabel:"Action",values:n.map((t=>{const e=jm[t];return{value:t,label:e.label,submenu:e.submenu,tooltip:e.fullDescription?`<p>${e.shortDescription}</p> ${e.fullDescription}`:e.shortDescription}})),equals:(t,e)=>t==e,changedEvent:t=>t.rotationChangeEmitter,getValue:t=>this.getSourceValue()?.action.oneofKind,setValue:(t,e,s)=>{const i=this.getSourceValue(),a=i?.action.oneofKind;if(a!=s){if(s){const e=jm[s];let n=this.makeAPLAction(s,e.newValue());i&&a&&this.actionPicker&&("sequence"==s?"strictSequence"==i.action.oneofKind?n.action.sequence.actions=i.action.strictSequence.actions:n.action.sequence.actions=[this.makeAPLAction(a,this.actionPicker.getInputValue())]:"strictSequence"==s?"sequence"==i.action.oneofKind?n.action.strictSequence.actions=i.action.sequence.actions:n.action.strictSequence.actions=[this.makeAPLAction(a,this.actionPicker.getInputValue())]:"sequence"==i.action.oneofKind&&i.action.sequence.actions?.[0]?.action.oneofKind==s?n=i.action.sequence.actions[0]:"strictSequence"==i.action.oneofKind&&i.action.strictSequence.actions?.[0]?.action.oneofKind==s&&(n=i.action.strictSequence.actions[0])),i?i.action=n.action:this.setSourceValue(t,n)}else i.action={oneofKind:s};e.rotationChangeEmitter.emit(t)}}}),this.currentKind=void 0,this.actionPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const t=this.kindPicker.getInputValue();return Wi.create({condition:this.conditionPicker.getInputValue(),action:{oneofKind:t,...(()=>{const e={};return t&&this.actionPicker&&(e[t]=this.actionPicker.getInputValue()),e})()}})}setInputValue(t){if(!t)return;this.conditionPicker.setInputValue(t.condition||vi.create());const e=t.action.oneofKind;this.updateActionPicker(e),e&&this.actionPicker.setInputValue(t.action[e])}makeAPLAction(t,e){if(!t)return Wi.create();const s={oneofKind:t};return s[t]=e,Wi.create({action:s})}updateActionPicker(t){const e=this.currentKind;if(t==e)return;if(this.currentKind=t,this.actionPicker&&(this.actionPicker.rootElem.remove(),this.actionPicker=null),!t)return;this.kindPicker.setInputValue(t);const s=jm[t];this.actionPicker=s.factory(this.actionDiv,this.modObject,{changedEvent:t=>t.rotationChangeEmitter,getValue:()=>this.getSourceValue()?.action?.[t]||s.newValue(),setValue:(e,s,i)=>{const a=this.getSourceValue();a&&((a?.action)[t]=i),s.rotationChangeEmitter.emit(e)}}),this.actionPicker.rootElem.classList.add("apl-action-"+t)}}function Bm(t){return{field:t,newValue:()=>[],factory:(t,e,s)=>new dc(t,e,{...s,setValue:(t,e,i)=>{s.setValue(t,e,i.map((t=>t||Wi.create())))},itemLabel:"Action",newItem:Wi.create,copyItem:t=>t?Wi.clone(t):t,newItemPicker:(t,s,i,a)=>new qm(t,e,a),allowedActions:["create","delete","move"],actions:{create:{useIcon:!0}}})}}function zm(t){return{label:t.label,submenu:t.submenu,shortDescription:t.shortDescription,fullDescription:t.fullDescription,includeIf:t.includeIf,newValue:t.newValue,factory:Vm(t.newValue,t.fields)}}const jm={castSpell:zm({label:"Cast",shortDescription:"Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:Ei.create,fields:[Nm("spellId","castable_spells",""),Lm("target","targets")]}),multidot:zm({label:"Multi Dot",submenu:["Casting"],shortDescription:"Keeps a DoT active on multiple targets by casting the specified spell.",includeIf:(t,e)=>!e,newValue:()=>Si.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Nm("spellId","dot_spells",""),Dm("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),Um("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),multishield:zm({label:"Multi Shield",submenu:["Casting"],shortDescription:"Keeps a Shield active on multiple targets by casting the specified spell.",includeIf:(t,e)=>!e&&He(t.spec),newValue:()=>yi.create({maxShields:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Nm("spellId","shield_spells",""),Dm("maxShields",!1,{label:"Max Shields",labelTooltip:"Maximum number of Shields to simultaneously apply."}),Um("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a Shield expires when it may be refreshed."})]}),channelSpell:zm({label:"Channel",submenu:["Casting"],shortDescription:"Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",fullDescription:"\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\n\t\t\t<p>The channel will be interrupted only if all of the following are true:</p>\n\t\t\t<ul>\n\t\t\t\t<li>Immediately following a tick of the channel</li>\n\t\t\t\t<li>The <b>Interrupt If</b> condition evaluates to <b>True</b></li>\n\t\t\t\t<li>Another action in the APL list is available</li>\n\t\t\t</ul>\n\t\t\t<p>Note that if you simply want to allow other actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\n\t\t",newValue:()=>Pi.create({interruptIf:{value:{oneofKind:"gcdIsReady",gcdIsReady:{}}}}),fields:[Nm("spellId","channel_spells",""),Lm("target","targets"),Um("interruptIf",{label:"Interrupt If",labelTooltip:"Condition which must be true to allow the channel to be interrupted."}),Rm("allowRecast","Recast",{labelTooltip:"If checked, interrupts of this channel will recast the spell."})]}),autocastOtherCooldowns:zm({label:"Autocast Other Cooldowns",submenu:["Casting"],shortDescription:"Auto-casts cooldowns as soon as they are ready.",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\n\t\t\t</ul>\n\t\t",includeIf:(t,e)=>!e,newValue:Ci.create,fields:[]}),wait:zm({label:"Wait",submenu:["Timing"],shortDescription:"Pauses all APL actions for a specified amount of time.",includeIf:(t,e)=>!e,newValue:()=>ki.create({duration:{value:{oneofKind:"const",const:{val:"1000ms"}}}}),fields:[Um("duration")]}),waitUntil:zm({label:"Wait Until",submenu:["Timing"],shortDescription:"Pauses all APL actions until the specified condition is <b>True</b>.",includeIf:(t,e)=>!e,newValue:()=>Ti.create(),fields:[Um("condition")]}),schedule:zm({label:"Scheduled Action",submenu:["Timing"],shortDescription:"Executes the inner action once at each specified timing.",includeIf:(t,e)=>!e,newValue:()=>_i.create({schedule:"0s, 60s",innerAction:{action:{oneofKind:"castSpell",castSpell:{}}}}),fields:[Am("schedule",{label:"Do At",labelTooltip:"Comma-separated list of timings. The inner action will be performed once at each timing."}),function(t){return{field:t,newValue:vi.create,factory:(t,e,s)=>new qm(t,e,s)}}("innerAction")]}),sequence:zm({label:"Sequence",submenu:["Sequences"],shortDescription:"A list of sub-actions to execute in the specified order.",fullDescription:"\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\n\t\t",includeIf:(t,e)=>!e,newValue:Ni.create,fields:[Am("name"),Bm("actions")]}),resetSequence:zm({label:"Reset Sequence",submenu:["Sequences"],shortDescription:"Restarts a sequence, so that the next time it executes it will perform its first sub-action.",fullDescription:"\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\n\t\t",includeIf:(t,e)=>!e,newValue:Li.create,fields:[Am("sequenceName")]}),strictSequence:zm({label:"Strict Sequence",submenu:["Sequences"],shortDescription:"Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.",fullDescription:"\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\n\t\t",includeIf:(t,e)=>!e,newValue:Ri.create,fields:[Bm("actions")]}),changeTarget:zm({label:"Change Target",submenu:["Misc"],shortDescription:"Sets the current target, which is the target of auto attacks and most casts by default.",newValue:()=>Di.create(),fields:[Lm("newTarget","targets")]}),activateAura:zm({label:"Activate Aura",submenu:["Misc"],shortDescription:"Activates an aura",includeIf:(t,e)=>e,newValue:()=>Ai.create(),fields:[Nm("auraId","auras")]}),cancelAura:zm({label:"Cancel Aura",submenu:["Misc"],shortDescription:"Deactivates an aura, equivalent to /cancelaura.",newValue:()=>Vi.create(),fields:[Nm("auraId","auras")]}),triggerIcd:zm({label:"Trigger ICD",submenu:["Misc"],shortDescription:"Triggers an aura's ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.",includeIf:(t,e)=>e,newValue:()=>Mi.create(),fields:[Nm("auraId","icd_auras")]}),itemSwap:zm({label:"Item Swap",submenu:["Misc"],shortDescription:"Swaps items, using the swap set specified in Settings.",includeIf:(t,e)=>ru.includes(t.spec),newValue:()=>Oi.create(),fields:[function(t){return{field:t,newValue:()=>qi.Swap1,factory:(t,e,s)=>new fi(t,e,{...s,defaultLabel:"None",equals:(t,e)=>t==e,values:[{value:qi.Main,label:"Main"},{value:qi.Swap1,label:"Swapped"}]})}}("swapSet")]}),move:zm({label:"Move",submenu:["Misc"],shortDescription:"Starts a move to the desired range from target.",newValue:()=>Ui.create(),fields:[Um("rangeFromTarget",{label:"to Range",labelTooltip:"Desired range from target."})]}),customRotation:zm({label:"Custom Rotation",shortDescription:"INTERNAL ONLY",includeIf:(t,e)=>!1,newValue:()=>Hi.create(),fields:[]}),catOptimalRotationAction:zm({label:"Optimal Rotation Action",submenu:["Feral Druid"],shortDescription:"Executes optimized Feral DPS rotation using hardcoded legacy algorithm.",includeIf:(t,e)=>t.spec==B.SpecFeralDruid,newValue:()=>Fi.create({minCombosForRip:3,maxWaitTime:2,maintainFaerieFire:!1,useShredTrick:!1}),fields:[Dm("minCombosForRip",!1,{label:"Min Rip CP",labelTooltip:"Combo Point threshold for allowing a Rip cast"}),Dm("maxWaitTime",!0,{label:"Max Wait Time",labelTooltip:"Max seconds to wait for an Energy tick to cast rather than powershifting"}),Rm("maintainFaerieFire","Maintain Faerie Fire",{labelTooltip:"If checked, bundle Faerie Fire refreshes with powershifts. Ignored if an external Faerie Fire debuff is selected in settings."}),Rm("useShredTrick","Use Shred Trick",{labelTooltip:'If checked, enable the "Shred trick" micro-optimization. This should only be used on short fight lengths with full powershifting uptime.'})]})};class $m extends I{constructor(t,e,s){super(t,"apl-rotation-picker-root"),new dc(this.rootElem,s,{extraCssClasses:["apl-prepull-action-picker"],title:"Prepull Actions",titleTooltip:"Actions to perform before the pull.",itemLabel:"Prepull Action",changedEvent:t=>t.rotationChangeEmitter,getValue:t=>t.aplRotation.prepullActions,setValue:(t,e,s)=>{e.aplRotation.prepullActions=s,e.rotationChangeEmitter.emit(t)},newItem:()=>Bi.create({action:{},doAtValue:{value:{oneofKind:"const",const:{val:"-1s"}}}}),copyItem:t=>Bi.clone(t),newItemPicker:(t,e,i,a)=>new Gm(t,s,a,i),inlineMenuBar:!0}),new dc(this.rootElem,s,{extraCssClasses:["apl-list-item-picker"],title:"Priority List",titleTooltip:"At each decision point, the simulation will perform the first valid action from this list.",itemLabel:"Action",changedEvent:t=>t.rotationChangeEmitter,getValue:t=>t.aplRotation.priorityList,setValue:(t,e,s)=>{e.aplRotation.priorityList=s,e.rotationChangeEmitter.emit(t)},newItem:()=>zi.create({action:{}}),copyItem:t=>zi.clone(t),newItemPicker:(t,e,i,a)=>new Km(t,s,a,i),inlineMenuBar:!0})}}class Gm extends p{constructor(t,s,i,a){i.enableWhen=()=>!this.getItem().hide,super(t,"apl-list-item-picker-root",s,i),e(this,"player"),e(this,"hidePicker"),e(this,"doAtPicker"),e(this,"actionPicker"),this.player=s;const n=dc.getItemHeaderElem(this);Jm(n,s,(t=>t.getCurrentStats().rotationStats?.prepullActions[a]?.warnings||[])),this.hidePicker=new Zm(n,s,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(t,e,s)=>{this.getItem().hide=s,this.player.rotationChangeEmitter.emit(t)}}),this.doAtPicker=new ym(this.rootElem,this.player,{label:"Do At",labelTooltip:"Time before pull to do the action. Should be negative, and formatted like, '-1s' or '-2500ms'.",extraCssClasses:["apl-prepull-actions-doat"],changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().doAtValue?.value?.const.val||"",setValue:(t,e,s)=>{this.getItem().doAtValue=s?vi.create({value:{oneofKind:"const",const:{val:s}}}):void 0,this.player.rotationChangeEmitter.emit(t)},inline:!0}),this.actionPicker=new qm(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(t,e,s)=>{this.getItem().action=s,this.player.rotationChangeEmitter.emit(t)}}),this.init()}getItem(){return this.getSourceValue()||Bi.create({action:{}})}getInputElem(){return this.rootElem}getInputValue(){return Bi.create({hide:this.hidePicker.getInputValue(),doAtValue:{value:{oneofKind:"const",const:{val:this.doAtPicker.getInputValue()}}},action:this.actionPicker.getInputValue()})}setInputValue(t){t&&(this.hidePicker.setInputValue(t.hide),this.doAtPicker.setInputValue(t.doAtValue?.value?.const.val||""),this.actionPicker.setInputValue(t.action||Wi.create()))}}class Km extends p{constructor(t,s,i,a){i.enableWhen=()=>!this.getItem().hide,super(t,"apl-list-item-picker-root",s,i),e(this,"player"),e(this,"hidePicker"),e(this,"actionPicker"),this.player=s;const n=dc.getItemHeaderElem(this);Jm(n,s,(t=>t.getCurrentStats().rotationStats?.priorityList[a]?.warnings||[])),this.hidePicker=new Zm(n,s,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(t,e,s)=>{this.getItem().hide=s,this.player.rotationChangeEmitter.emit(t)}}),this.actionPicker=new qm(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(t,e,s)=>{this.getItem().action=s,this.player.rotationChangeEmitter.emit(t)}}),this.init()}getItem(){return this.getSourceValue()||zi.create({action:{}})}getInputElem(){return this.rootElem}getInputValue(){return zi.create({hide:this.hidePicker.getInputValue(),action:this.actionPicker.getInputValue()})}setInputValue(t){t&&(this.hidePicker.setInputValue(t.hide),this.actionPicker.setInputValue(t.action||Wi.create()))}}function Jm(t,e,s){const i=dc.makeActionElem("apl-warnings","fa-exclamation-triangle");i.classList.add("warning","link-warning"),i.setAttribute("data-bs-html","true");const a=ta.getOrCreateInstance(i,{customClass:"dropdown-tooltip",title:"Warnings",html:!0});t.appendChild(i);const n=async()=>{a.setContent({".tooltip-inner":""});const t=s(e);if(0==t.length)i.style.visibility="hidden";else{i.style.visibility="visible";const e=await Promise.all(t.map((t=>v.replaceAllInString(t))));a.setContent({".tooltip-inner":`\n\t\t\t\t<p>This action has warnings, and might not behave as expected.</p>\n\t\t\t\t<ul>\n\t\t\t\t\t${e.map((t=>`<li>${t}</li>`)).join("")}\n\t\t\t\t</ul>\n\t\t\t`})}};n(),e.currentStatsEmitter.on(n)}class Zm extends p{constructor(t,s,i){super(t,"hide-picker-root",s,i),e(this,"inputElem"),e(this,"iconElem"),e(this,"tooltip"),this.inputElem=dc.makeActionElem("hide-picker-button","fa-eye"),this.iconElem=this.inputElem.childNodes[0],this.rootElem.appendChild(this.inputElem),this.tooltip=ta.getOrCreateInstance(this.inputElem,{title:"Enable/Disable"}),this.init(),this.inputElem.addEventListener("click",(()=>{this.setInputValue(!this.getInputValue()),this.inputChanged(c.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){return this.iconElem.classList.contains("fa-eye-slash")}setInputValue(t){t?(this.iconElem.classList.add("fa-eye-slash"),this.iconElem.classList.remove("fa-eye"),this.tooltip.setContent({".tooltip-inner":"Enable Action"})):(this.iconElem.classList.add("fa-eye"),this.iconElem.classList.remove("fa-eye-slash"),this.tooltip.setContent({".tooltip-inner":"Disable Action"}))}}class Ym extends ec{constructor(t,s){super(t,s,{identifier:"rotation-tab",title:"Rotation"}),e(this,"simUI"),e(this,"leftPanel"),e(this,"rightPanel"),this.simUI=s,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("rotation-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("rotation-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent(),this.updateSections(),this.simUI.player.rotationChangeEmitter.on((()=>this.updateSections()))}buildTabContent(){this.buildHeader(),this.buildAutoContent(),this.buildAplContent(),this.buildSimpleContent(),this.buildSavedDataPickers()}updateSections(){this.rootElem.classList.remove("rotation-type-auto"),this.rootElem.classList.remove("rotation-type-simple"),this.rootElem.classList.remove("rotation-type-apl"),this.rootElem.classList.remove("rotation-type-legacy");const t=this.simUI.player.getRotationType();t==$.TypeAuto?this.rootElem.classList.add("rotation-type-auto"):t==$.TypeSimple?this.rootElem.classList.add("rotation-type-simple"):t==$.TypeAPL?this.rootElem.classList.add("rotation-type-apl"):t==$.TypeLegacy&&this.rootElem.classList.add("rotation-type-legacy")}buildHeader(){const t=document.createElement("div");t.classList.add("rotation-tab-header"),this.leftPanel.appendChild(t),new nr(t,this.simUI.player,{label:"Rotation Type",labelTooltip:"Which set of options to use for specifying the rotation.",inline:!0,values:this.simUI.player.hasSimpleRotationGenerator()?[{value:$.TypeAuto,name:"Auto"},{value:$.TypeSimple,name:"Simple"},{value:$.TypeAPL,name:"APL"}]:[{value:$.TypeAuto,name:"Auto"},{value:$.TypeAPL,name:"APL"}],changedEvent:t=>t.rotationChangeEmitter,getValue:t=>t.getRotationType(),setValue:(t,e,s)=>{e.aplRotation.type=s,e.rotationChangeEmitter.emit(t)}})}buildAutoContent(){const t=document.createElement("div");t.classList.add("rotation-tab-auto"),this.leftPanel.appendChild(t)}buildAplContent(){const t=document.createElement("div");t.classList.add("rotation-tab-apl"),this.leftPanel.appendChild(t),new $m(t,this.simUI,this.simUI.player)}buildSimpleContent(){if(!this.simUI.player.hasSimpleRotationGenerator()||!this.simUI.individualConfig.rotationInputs)return;const t="rotation-tab-simple",e=new wr(this.leftPanel,"rotation-settings",{header:{title:"Rotation"}});e.rootElem.classList.add(t);const s=p.newGroupContainer();s.classList.add("rotation-icon-group","icon-group"),e.bodyElement.appendChild(s),this.simUI.individualConfig.rotationIconInputs?.length&&this.configureIconSection(s,this.simUI.individualConfig.rotationIconInputs.map((t=>zc(s,this.simUI.player,t))),!0),this.configureInputSection(e.bodyElement,this.simUI.individualConfig.rotationInputs),e.bodyElement.querySelectorAll(".input-root").forEach((t=>{t.classList.add("input-inline")}));const i=new wr(this.leftPanel,"cooldown-settings",{header:{title:"Cooldowns",tooltip:"Specify cooldown timings, in seconds. Cooldowns will be used as soon as possible after their specified timings. When not specified, cooldowns will be used when ready and it is sensible to do so.<br><br>Multiple timings can be provided by separating with commas. Any cooldown usages after the last provided timing will use the default logic."}});i.rootElem.classList.add(t),new Sm(i.bodyElement,this.simUI.player)}configureInputSection(t,e){e.inputs.forEach((e=>{"number"==e.type?new er(t,this.simUI.player,e):"boolean"==e.type?new ar(t,this.simUI.player,{...e,cssScheme:this.simUI.cssScheme}):"enum"==e.type&&new nr(t,this.simUI.player,e)}))}configureIconSection(t,e,s){0==e.length?t.classList.add("hide"):s&&(e.length<=4?t.style.gridTemplateColumns=`repeat(${e.length}, 1fr)`:e.length>4&&e.length<8&&(t.style.gridTemplateColumns=`repeat(${Math.ceil(e.length/2)}, 1fr)`))}buildSavedDataPickers(){const t=new oc(this.rightPanel,this.simUI.player,{label:"Rotation",header:{title:"Saved Rotations"},storageKey:this.simUI.getSavedRotationStorageKey(),getData:t=>ji.create({rotation:T.clone(t.aplRotation)}),setData:(t,e,s)=>{c.freezeAllAndDo((()=>{e.setAplRotation(t,s.rotation||T.create())}))},changeEmitters:[this.simUI.player.rotationChangeEmitter,this.simUI.player.talentsChangeEmitter],equals:(t,e)=>ji.equals(t,e),toJson:t=>ji.toJson(t),fromJson:t=>ji.fromJson(t)});this.simUI.sim.waitForInit().then((()=>{t.loadUserData(),(this.simUI.individualConfig.presets.rotations||[]).forEach((e=>{const s=e.rotation;s.rotation||(s.rotation=T.create()),t.addSavedData({name:e.name,tooltip:e.tooltip,isPreset:!0,data:s,enableWhen:e.enableWhen})}))}))}}class Xm extends ec{constructor(t,s){super(t,s,{identifier:"talents-tab",title:"Talents"}),e(this,"simUI"),e(this,"leftPanel"),e(this,"rightPanel"),this.simUI=s,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("talents-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("talents-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.player.getClass()==m.ClassHunter?this.buildHunterPickers():this.buildTalentsPicker(this.leftPanel),this.buildSavedTalentsPicker()}buildTalentsPicker(t){new ca(t,this.simUI.player,{klass:this.simUI.player.getClass(),trees:Sa[this.simUI.player.getClass()],changedEvent:t=>t.talentsChangeEmitter,getValue:t=>t.getTalentsString(),setValue:(t,e,s)=>{e.setTalentsString(t,s)},pointsPerRow:5,maxPoints:$i})}buildHunterPickers(){this.leftPanel.innerHTML='\n      <div class="hunter-talents-pickers-container tab-content">\n        <ul class="nav nav-tabs" role="tablist">\n          <li class="nav-item" role="presentation">\n            <a\n              class="nav-link active"\n              type="button"\n              role="tab"\n              data-bs-toggle="tab"\n              data-bs-target="#player-talents-tab"\n              aria-controls="#player-talents-tab"\n              aria-selected="true"\n            >\n              Player\n            </a>\n          </li>\n          <li class="nav-item" role="presentation">\n            <a\n              class="nav-link"\n              type="button"\n              role="tab"\n              data-bs-toggle="tab"\n              data-bs-target="#pet-talents-tab"\n              aria-controls="#pet-talents-tab"\n              aria-selected="false"\n            >\n              Pet</a\n            >\n          </li>\n        </ul>\n        <div id="player-talents-tab" class="tab-pane fade active show" role="tabpanel">\n        </div>\n        <div id="pet-talents-tab" class="tab-pane fade" role="tabpanel">\n        </div>\n      </div>\n    ';const t=this.leftPanel.querySelector("#player-talents-tab");this.buildTalentsPicker(t)}buildSavedTalentsPicker(){const t=new oc(this.rightPanel,this.simUI.player,{label:"Talents",header:{title:"Saved Talents"},storageKey:this.simUI.getSavedTalentsStorageKey(),getData:t=>Gi.create({talentsString:t.getTalentsString()}),setData:(t,e,s)=>{c.freezeAllAndDo((()=>{e.setTalentsString(t,s.talentsString)}))},changeEmitters:[this.simUI.player.talentsChangeEmitter],equals:(t,e)=>Gi.equals(t,e),toJson:t=>Gi.toJson(t),fromJson:t=>Gi.fromJson(t)});this.simUI.sim.waitForInit().then((()=>{t.loadUserData(),this.simUI.individualConfig.presets.talents.forEach((e=>{e.isPreset=!0,t.addSavedData({name:e.name,isPreset:!0,data:e.data})}))}))}}class Qm extends cr{constructor(t,s,i){super(t,"exporter",{title:i.title,header:i.header,footer:!0}),e(this,"textElem"),e(this,"changedEvent",new c),this.body.innerHTML='\n\t\t\t<textarea spellCheck="false" class="exporter-textarea form-control"></textarea>\n\t\t',this.footer.innerHTML=`\n\t\t\t<button class="exporter-button btn btn-primary clipboard-button me-2">\n\t\t\t\t<i class="fas fa-clipboard"></i>\n\t\t\t\tCopy to Clipboard\n\t\t\t</button>\n\t\t\t${i.allowDownload?'\n\t\t\t\t<button class="exporter-button btn btn-primary download-button">\n\t\t\t\t\t<i class="fa fa-download"></i>\n\t\t\t\t\tDownload\n\t\t\t\t</button>\n\t\t\t':""}\n\t\t`,this.textElem=this.rootElem.getElementsByClassName("exporter-textarea")[0];const a=this.rootElem.getElementsByClassName("clipboard-button")[0];if(a.addEventListener("click",(t=>{const e=this.textElem.textContent;if(null==navigator.clipboard)alert(e);else{navigator.clipboard.writeText(e);const t=a.innerHTML;a.style.width=`${a.getBoundingClientRect().width.toFixed(3)}px`,a.innerHTML='<i class="fas fa-check"></i>&nbsp;Copied',setTimeout((()=>{a.innerHTML=t}),1500)}})),i.allowDownload){this.rootElem.getElementsByClassName("download-button")[0].addEventListener("click",(t=>{const e=this.textElem.textContent;Ki(e,"wowsims.json")}))}}init(){this.changedEvent.on((()=>this.updateContent())),this.updateContent()}updateContent(){this.textElem.textContent=this.getData()}}const tu=class extends Qm{constructor(t,i){super(t,i,{title:"Sharable Link",header:!0}),e(this,"simUI"),e(this,"exportCategories"),this.simUI=i;const a={};s(Ua).forEach((t=>a[t]=vr.DEFAULT_CATEGORIES.includes(t))),this.exportCategories=a;const n=document.createElement("div");n.classList.add("link-exporter-pickers"),this.body.prepend(n),tu.exportPickerConfigs.forEach((t=>{const e=t.category;new ar(n,this,{label:t.label,labelTooltip:t.labelTooltip,inline:!0,getValue:()=>this.exportCategories[e],setValue:(t,s,i)=>{this.exportCategories[e]=i,this.changedEvent.emit(t)},changedEvent:()=>this.changedEvent})})),this.init()}getData(){return tu.createLink(this.simUI,s(Ua).filter((t=>this.exportCategories[t])))}static createLink(t,e){e||(e=vr.DEFAULT_CATEGORIES);const s=t.toProto(e),i=re.toBinary(s),a=Zl.deflate(i,{to:"string"}),n=btoa(a),o=new URL(window.location.href);if(o.hash=n,rs(e,vr.DEFAULT_CATEGORIES))o.searchParams.delete(vr.CATEGORY_PARAM);else{const t=e.map((t=>vr.CATEGORY_KEYS.get(t))).join("");o.searchParams.set(vr.CATEGORY_PARAM,t)}return o.toString()}};let eu=tu;e(eu,"exportPickerConfigs",[{category:Ua.Gear,label:"Gear",labelTooltip:"Also includes bonus stats and weapon swaps."},{category:Ua.Talents,label:"Talents",labelTooltip:"Talents and Glyphs."},{category:Ua.Rotation,label:"Rotation",labelTooltip:"Includes everything found in the Rotation tab."},{category:Ua.Consumes,label:"Consumes",labelTooltip:"Flask, pots, food, etc."},{category:Ua.External,label:"Buffs & Debuffs",labelTooltip:"All settings which are applied by other raid members."},{category:Ua.Miscellaneous,label:"Misc",labelTooltip:"Spec-specific settings, front/back of target, distance from target, etc."},{category:Ua.Encounter,label:"Encounter",labelTooltip:"Fight-related settings."}]);class su extends Qm{constructor(t,s){super(t,s,{title:"JSON Export",allowDownload:!0}),e(this,"simUI"),this.simUI=s,this.init()}getData(){return Ji(re.toJson(this.simUI.toProto()),2,((t,e)=>!!["stats","pseudoStats"].includes(e[e.length-1])||(["player","equipment","items"].every(((t,s)=>e[s]==t))||!("player"!=e[0]||"rotation"!=e[1]||!["prepullActions","priorityList"].includes(e[2])))&&e.length>3))}}const iu=class extends Qm{constructor(t,s){super(t,s,{title:"80Upgrades EP Export",allowDownload:!0}),e(this,"simUI"),this.simUI=s,this.init()}getData(){const t=this.simUI.player,e=t.getEpWeights(),s=na.getAll(),i={};return s.forEach((t=>{const s=iu.getName(t),a=e.getUnitStat(t);0!=a&&""!=s&&(i[s]?i[s]+=a:i[s]=a)})),`https://eightyupgrades.com/ep/import?name=${encodeURIComponent(`${Ot[t.spec]} WoWSims Weights`)}`+Object.keys(i).map((t=>`&${t}=${i[t].toFixed(3)}`)).join("")}static getName(t){return t.isStat()?iu.statNames[t.getStat()]:iu.pseudoStatNames[t.getPseudoStat()]||""}};let au=iu;e(au,"statNames",{[i.StatStrength]:"strength",[i.StatAgility]:"agility",[i.StatStamina]:"stamina",[i.StatIntellect]:"intellect",[i.StatSpirit]:"spirit",[i.StatSpellPower]:"spellPower",[i.StatSpellDamage]:"spellDamage",[i.StatArcanePower]:"arcaneDamage",[i.StatHolyPower]:"holyDamage",[i.StatFirePower]:"fireDamage",[i.StatFrostPower]:"frostDamage",[i.StatNaturePower]:"natureDamage",[i.StatShadowPower]:"shadowDamage",[i.StatMP5]:"mp5",[i.StatSpellHit]:"hitRating",[i.StatSpellCrit]:"critRating",[i.StatSpellHaste]:"hasteRating",[i.StatSpellPenetration]:"spellPen",[i.StatAttackPower]:"attackPower",[i.StatMeleeHit]:"hitRating",[i.StatMeleeCrit]:"critRating",[i.StatMeleeHaste]:"hasteRating",[i.StatArmorPenetration]:"armorPenRating",[i.StatExpertise]:"expertiseRating",[i.StatMana]:"mana",[i.StatEnergy]:"energy",[i.StatRage]:"rage",[i.StatArmor]:"armor",[i.StatRangedAttackPower]:"attackPower",[i.StatDefense]:"defenseRating",[i.StatBlock]:"blockRating",[i.StatBlockValue]:"blockValue",[i.StatDodge]:"dodgeRating",[i.StatParry]:"parryRating",[i.StatResilience]:"resilienceRating",[i.StatHealth]:"health",[i.StatArcaneResistance]:"arcaneResistance",[i.StatFireResistance]:"fireResistance",[i.StatFrostResistance]:"frostResistance",[i.StatNatureResistance]:"natureResistance",[i.StatShadowResistance]:"shadowResistance",[i.StatBonusArmor]:"armorBonus",[i.StatHealing]:"Healing",[i.StatWeaponSkill]:"weaponSkill",[i.StatFeralAttackPower]:"feralAttackPower"}),e(au,"pseudoStatNames",{[a.PseudoStatMainHandDps]:"dps",[a.PseudoStatRangedDps]:"rangedDps"});const nu=class extends Qm{constructor(t,s){super(t,s,{title:"Pawn EP Export",allowDownload:!0}),e(this,"simUI"),this.simUI=s,this.init()}getData(){const t=this.simUI.player,e=t.getEpWeights(),s=na.getAll(),i={};return s.forEach((t=>{const s=nu.getName(t),a=e.getUnitStat(t);0!=a&&""!=s&&(i[s]?i[s]+=a:i[s]=a)})),`( Pawn: v1: "${Ot[t.spec]} WoWSims Weights": Class=${ge.get(t.getClass())},`+Object.keys(i).map((t=>`${t}=${i[t].toFixed(3)}`)).join(",")+" )"}static getName(t){return t.isStat()?nu.statNames[t.getStat()]:nu.pseudoStatNames[t.getPseudoStat()]||""}};let ou=nu;e(ou,"statNames",{[i.StatStrength]:"Strength",[i.StatAgility]:"Agility",[i.StatStamina]:"Stamina",[i.StatIntellect]:"Intellect",[i.StatSpirit]:"Spirit",[i.StatSpellPower]:"SpellDamage",[i.StatSpellDamage]:"SpellDamage",[i.StatArcanePower]:"ArcaneDamage",[i.StatFirePower]:"FireDamage",[i.StatFrostPower]:"FrostDamage",[i.StatHolyPower]:"HolyDamage",[i.StatNaturePower]:"NatureDamage",[i.StatShadowPower]:"ShadowDamage",[i.StatMP5]:"Mp5",[i.StatSpellHit]:"HitRating",[i.StatSpellCrit]:"CritRating",[i.StatSpellHaste]:"HasteRating",[i.StatSpellPenetration]:"SpellPen",[i.StatAttackPower]:"Ap",[i.StatMeleeHit]:"HitRating",[i.StatMeleeCrit]:"CritRating",[i.StatMeleeHaste]:"HasteRating",[i.StatArmorPenetration]:"ArmorPenetration",[i.StatExpertise]:"ExpertiseRating",[i.StatMana]:"Mana",[i.StatEnergy]:"Energy",[i.StatRage]:"Rage",[i.StatArmor]:"Armor",[i.StatRangedAttackPower]:"Ap",[i.StatDefense]:"DefenseRating",[i.StatBlock]:"BlockRating",[i.StatBlockValue]:"BlockValue",[i.StatDodge]:"DodgeRating",[i.StatParry]:"ParryRating",[i.StatResilience]:"ResilienceRating",[i.StatHealth]:"Health",[i.StatArcaneResistance]:"ArcaneResistance",[i.StatFireResistance]:"FireResistance",[i.StatFrostResistance]:"FrostResistance",[i.StatNatureResistance]:"NatureResistance",[i.StatShadowResistance]:"ShadowResistance",[i.StatBonusArmor]:"Armor2",[i.StatHealing]:"Healing",[i.StatWeaponSkill]:"WeaponSkill",[i.StatFeralAttackPower]:"FeralAttackPower"}),e(ou,"pseudoStatNames",{[a.PseudoStatMainHandDps]:"MeleeDps",[a.PseudoStatRangedDps]:"RangedDps"});function lu(t,e){return function(t,e){ka[t]=e}(t,e),e}let ru=[];class cu extends ur{constructor(t,s,i){super(t,s.sim,{cssClass:i.cssClass,cssScheme:i.cssScheme,spec:s.spec,knownIssues:i.knownIssues,launchStatus:Ql[s.spec],noticeText:""}),e(this,"player"),e(this,"individualConfig"),e(this,"raidSimResultsManager"),e(this,"prevEpIterations"),e(this,"prevEpSimResult"),e(this,"dpsRefStat"),e(this,"healRefStat"),e(this,"tankRefStat"),e(this,"bt"),this.rootElem.classList.add("individual-sim-ui"),this.player=s,this.individualConfig=i,this.raidSimResultsManager=null,this.prevEpIterations=0,this.prevEpSimResult=null,(i.itemSwapSlots||[]).length>0&&!ru.includes(s.spec)&&ru.push(s.spec),this.addWarning({updateOn:c.onAny([this.player.gearChangeEmitter,this.player.professionChangeEmitter]),getContent:()=>{const t=this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());return 0==t.length?"":t.map((t=>`${t.name} requires ${_e.get(t.requiredProfession)}, but it is not selected.`))}}),this.addWarning({updateOn:c.onAny([this.player.talentsChangeEmitter,this.player.levelChangeEmitter]),getContent:()=>{const t=Zi(this.player.getTalentsString());return 0==t?"":t<this.player.getLevel()-9?"Unspent talent points.":t>this.player.getLevel()-9?"More talent points spent than current level selected.":""}}),this.addWarning({updateOn:c.onAny([this.player.gearChangeEmitter,this.player.talentsChangeEmitter]),getContent:()=>this.player.canDualWield2H()||(this.player.getEquippedItem(D.ItemSlotMainHand)?.item.handType!=nt.HandTypeTwoHand||null==this.player.getEquippedItem(D.ItemSlotOffHand))&&this.player.getEquippedItem(D.ItemSlotOffHand)?.item.handType!=nt.HandTypeTwoHand?"":"Dual wielding two-handed weapon(s) without Titan's Grip spec."}),(i.warnings||[]).forEach((t=>this.addWarning(t(this)))),this.isWithinRaidSim||this.sim.waitForInit().then((()=>{this.loadSettings(),He(this.player.spec)&&alert("*** WARNING - USE AT YOUR OWN RISK ***\n\nThe entire concept of a healing sim is EXPERIMENTAL. All results should be taken with an EXTREMELY large grain of salt.\n\nThis tool is currently more similar to a spreadsheet than a true sim. Options for specifying incoming damage profiles in order to have proper reactive rotations have not yet been added.")})),this.addSidebarComponents(),this.addGearTab(),this.bt=this.addBulkTab(),this.addSettingsTab(),this.addTalentsTab(),this.addRotationTab(),this.isWithinRaidSim||this.addDetailedResultsTab(),this.addTopbarComponents()}loadSettings(){const t=c.nextEventID();c.freezeAllAndDo((()=>{let e=!1,s=window.location.hash;if(s.length>1){s=s.substring(1);try{const i=atob(s),a=new Uint8Array(i.length);for(let t=0;t<a.length;t++)a[t]=i.charCodeAt(t);const n=Zl.inflate(a),o=re.fromBinary(n);this.fromProto(t,o),e=!0}catch(a){console.warn("Failed to parse settings from window hash: "+a)}}window.location.hash="";const i=window.localStorage.getItem(this.getSettingsStorageKey());if(!e&&null!=i)try{const s=re.fromJsonString(i);this.fromProto(t,s),e=!0}catch(a){console.warn("Failed to parse saved settings: "+a)}e||this.applyDefaults(t),this.player.setName(t,"Player"),this.changeEmitter.on((t=>{const e=re.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey(),e)}))}))}addSidebarComponents(){var t,e,s,i;this.raidSimResultsManager=Yi(this),t=this,e=this.individualConfig.epStats,s=this.individualConfig.epPseudoStats,i=this.individualConfig.epReferenceStat,t.addAction("Stat Weights","ep-weights-action",(()=>{new Ir(t,e,s||[],i)})),new gr(this.rootElem.getElementsByClassName("sim-sidebar-footer")[0],this.player,this.individualConfig.displayStats,this.individualConfig.modifyDisplayStats)}addGearTab(){new lc(this.simTabContentsContainer,this).rootElem.classList.add("active","show")}addBulkTab(){let t=new nc(this.simTabContentsContainer,this);return t.navLink.hidden=!this.sim.getShowExperimental(),this.sim.showExperimentalChangeEmitter.on((()=>{t.navLink.hidden=!this.sim.getShowExperimental()})),t}addSettingsTab(){new vm(this.simTabContentsContainer,this)}addTalentsTab(){new Xm(this.simTabContentsContainer,this)}addRotationTab(){new Ym(this.simTabContentsContainer,this)}addDetailedResultsTab(){this.addTab("Results","detailed-results-tab",'\n\t\t\t<div class="detailed-results">\n\t\t\t</div>\n\t\t'),new Xi(this.rootElem.getElementsByClassName("detailed-results")[0],this,this.raidSimResultsManager)}addTopbarComponents(){this.simHeader.addImportLink("JSON",(t=>new Er(this.rootElem,this)),!0),this.simHeader.addExportLink("Link",(t=>new eu(this.rootElem,this)),!1),this.simHeader.addExportLink("JSON",(t=>new su(this.rootElem,this)),!0)}applyDefaults(t){c.freezeAllAndDo((()=>{const e=it(this.player.spec),s=He(this.player.spec);this.player.applySharedDefaults(t),this.player.setRace(t,L[this.player.spec][0]),this.player.setLevel(t,R),this.player.setGear(t,this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear)),this.player.setConsumes(t,this.individualConfig.defaults.consumes),this.player.setTalentsString(t,this.individualConfig.defaults.talents.talentsString),this.player.setSpecOptions(t,this.individualConfig.defaults.specOptions),this.player.setBuffs(t,this.individualConfig.defaults.individualBuffs),this.player.getParty().setBuffs(t,this.individualConfig.defaults.partyBuffs),this.player.getRaid().setBuffs(t,this.individualConfig.defaults.raidBuffs),this.player.setEpWeights(t,this.individualConfig.defaults.epWeights);const i=this.player.getDefaultEpRatios(e,s);this.player.setEpRatios(t,i),this.player.setProfession1(t,this.individualConfig.defaults.other?.profession1||F.Engineering),this.player.setProfession2(t,this.individualConfig.defaults.other?.profession2||F.ProfessionUnknown),this.player.setDistanceFromTarget(t,this.individualConfig.defaults.other?.distanceFromTarget||0),this.player.setChannelClipDelay(t,this.individualConfig.defaults.other?.channelClipDelay||0),this.isWithinRaidSim?this.sim.raid.setTargetDummies(t,0):(this.sim.raid.setTargetDummies(t,s?9:0),this.sim.encounter.applyDefaults(t),this.sim.raid.setDebuffs(t,this.individualConfig.defaults.debuffs),this.sim.applyDefaults(t,e,s),e?this.sim.raid.setTanks(t,[this.player.makeUnitReference()]):this.sim.raid.setTanks(t,[]))}))}getSavedGearStorageKey(){return this.getStorageKey("__savedGear__")}getSavedRotationStorageKey(){return this.getStorageKey("__savedRotation__")}getSavedSettingsStorageKey(){return this.getStorageKey("__savedSettings__")}getSavedTalentsStorageKey(){return this.getStorageKey("__savedTalents__")}getStorageKey(t){return Qi[this.player.spec]+t}toProto(t){const e=e=>!t||0==t.length||t.includes(e),s=re.create({player:this.player.toProto(!0,!1,t)});return e(Ua.Miscellaneous)&&re.mergePartial(s,{tanks:this.sim.raid.getTanks()}),e(Ua.Encounter)&&re.mergePartial(s,{encounter:this.sim.encounter.toProto()}),e(Ua.External)&&re.mergePartial(s,{partyBuffs:this.player.getParty()?.getBuffs()||r.create(),raidBuffs:this.sim.raid.getBuffs(),debuffs:this.sim.raid.getDebuffs(),targetDummies:this.sim.raid.getTargetDummies()}),e(Ua.UISettings)&&re.mergePartial(s,{settings:this.sim.toProto(),epWeightsStats:this.player.getEpWeights().toProto(),epRatios:this.player.getEpRatios(),dpsRefStat:this.dpsRefStat,healRefStat:this.healRefStat,tankRefStat:this.tankRefStat}),s}toLink(){return eu.createLink(this)}fromProto(t,e,s){const i=t=>!s||0==s.length||s.includes(t),a=it(this.player.spec),n=He(this.player.spec);c.freezeAllAndDo((()=>{if(e.player){if(this.player.fromProto(t,e.player,s),i(Ua.Miscellaneous)&&this.sim.raid.setTanks(t,e.tanks||[]),i(Ua.External)){this.sim.raid.setBuffs(t,e.raidBuffs||mt.create()),this.sim.raid.setDebuffs(t,e.debuffs||ut.create());const s=this.player.getParty();s&&s.setBuffs(t,e.partyBuffs||r.create()),this.sim.raid.setTargetDummies(t,e.targetDummies)}if(i(Ua.Encounter)&&this.sim.encounter.fromProto(t,e.encounter||rt.create()),i(Ua.UISettings)){e.epWeightsStats?this.player.setEpWeights(t,oa.fromProto(e.epWeightsStats)):this.player.setEpWeights(t,this.individualConfig.defaults.epWeights);const s=this.player.getDefaultEpRatios(a,n);if(e.epRatios){const i=new Array(s.length-e.epRatios.length).fill(0);this.player.setEpRatios(t,e.epRatios.concat(i))}else this.player.setEpRatios(t,s);e.dpsRefStat&&(this.dpsRefStat=e.dpsRefStat),e.healRefStat&&(this.healRefStat=e.healRefStat),e.tankRefStat&&(this.tankRefStat=e.tankRefStat),e.settings?this.sim.fromProto(t,e.settings):this.sim.applyDefaults(t,a,n)}}}))}}function du(t,e,s){return function(t,e,s){let i=[];null!=s.talentTree&&i.push((t=>t.getTalentTree()==s.talentTree));null!=s.talentTrees&&i.push((t=>(s.talentTrees||[]).includes(t.getTalentTree())));null!=s.faction&&i.push((t=>t.getFaction()==s.faction));null!=s.customCondition&&i.push(s.customCondition);return{name:t,tooltip:s.tooltip||ph,gear:e,enableWhen:i.length>0?t=>i.every((e=>e(t))):void 0}}(t,ue.fromJson(e),s||{})}function hu(t,e,s){return uu(t,ji.create({rotation:T.fromJson(e)}),s)}function mu(t,e,s,i){return uu(t,ji.create({rotation:{type:$.TypeSimple,simple:{specRotationJson:JSON.stringify(E[e].rotationToJson(s))}}}),i)}function uu(t,e,s){let i=[];return null!=s?.talentTree&&i.push((t=>t.getTalentTree()==s.talentTree)),{name:t,rotation:e,enableWhen:i.length>0?t=>i.every((e=>e(t))):void 0}}export{uh as $,Nd as A,Th as B,wr as C,_r as D,Lr as E,Jd as F,Dr as G,Rr as H,cu as I,dm as J,Ar as K,Mr as L,_h as M,Vr as N,Vc as O,Na as P,bh as Q,Cr as R,Wa as S,Nr as T,Ta as U,nr as V,la as W,cr as X,ec as Y,oc as Z,hc as _,hu as a,br as a0,Qm as a1,La as a2,Ra as a3,ur as a4,Xl as a5,kr as a6,oa as b,om as c,lm as d,rm as e,Md as f,Yd as g,Qd as h,Tc as i,Bc as j,vc as k,Uc as l,du as m,yc as n,Ac as o,yh as p,im as q,lu as r,Tr as s,Fc as t,Lc as u,Rc as v,_c as w,mu as x,Sh as y,Lh as z};
//# sourceMappingURL=preset_utils-e791bfd5.chunk.js.map
